"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[1668],{93310:(ee,F,e)=>{e.d(F,{S:()=>l,b:()=>i});var m=e(4794),w=e(81801),A=e(6945),p=e(78925),_=e(24255),P=e(10109),T=e(67022),S=e(33726),z=e(2166),E=e(97139),R=e(69960),O=e(17625),D=e(63123),M=e(22355),t=e(42743),a=e(16396);function i(c){const r=new M.kG,d=c.hasMultipassTerrain&&(c.output===A.H.Color||c.output===A.H.Alpha);r.include(_.w),r.include(w.A,c),r.include(p.f5,c);const{vertex:h,fragment:g}=r;return g.include(S.Y),(0,z.S)(r,c),g.uniforms.add(new R.N("uColor",L=>L.color)),r.attributes.add(a.T.POSITION,"vec3"),r.varyings.add("vWorldPosition","vec3"),d&&r.varyings.add("depth","float"),c.screenSizeEnabled&&r.attributes.add(a.T.OFFSET,"vec3"),c.shadingEnabled&&(h.uniforms.add(new D.g("viewNormal",(L,B)=>B.camera.viewInverseTransposeMatrix)),r.attributes.add(a.T.NORMAL,"vec3"),r.varyings.add("vViewNormal","vec3")),h.code.add(O.H`
    void main(void) {
      vWorldPosition = ${c.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),c.shadingEnabled&&h.code.add(O.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),h.code.add(O.H`
    ${d?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),d&&r.include(P.l,c),g.code.add(O.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${d?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),c.shadingEnabled?(g.uniforms.add(new E.J("shadingDirection",L=>L.shadingDirection)),g.uniforms.add(new R.N("shadedColor",L=>function o(c,r){const d=1-c[3],h=c[3]+r[3]*d;return 0===h?(u[3]=h,u):(u[0]=(c[0]*c[3]+r[0]*r[3]*d)/h,u[1]=(c[1]*c[3]+r[1]*r[3]*d)/h,u[2]=(c[2]*c[3]+r[2]*r[3]*d)/h,u[3]=r[3],u)}(L.shadingTint,L.color))),g.code.add(O.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):g.code.add(O.H`vec4 finalColor = uColor;`),g.code.add(O.H`
      if (finalColor.a < ${O.H.float(T.b)}) {
        discard;
      }
      ${c.output===A.H.Alpha?O.H`gl_FragColor = vec4(finalColor.a);`:""}

      ${c.output===A.H.Color?O.H`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${c.transparencyPassType===t.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),r}const u=(0,m.c)(),l=Object.freeze(Object.defineProperty({__proto__:null,build:i},Symbol.toStringTag,{value:"Module"}))},45403:(ee,F,e)=>{e.d(F,{Z:()=>ue}),e(29132);var w=e(94573),A=e(61885),p=e(21286),_=e(62208),P=e(23841),T=e(52323),S=e(30217),z=e(550),E=e(28347),R=e(43703),O=e(67831),D=e(84161),M=e(28093),t=e(55915),a=e(12080),i=e(65401),o=e(13777),u=e(90014),l=e(70562),c=e(26242),r=e(84786),d=e(53929),h=e(26046),g=e(42743),L=e(59856),B=e(97272),I=e(34103),G=e(33786),re=e(49672);class ue{constructor(s){this.camera=new L.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,R.c)(),this._worldFrame=null,this._renderLocation=(0,M.c)(),this._renderLocationDirty=!0,this._location=new re.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new re.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=G.jg.None,this._focused=!1,this.events=new A.Z.EventEmitter,this._screenLocation={screenPointArray:(0,P.s1)(),renderScreenPointArray:(0,P.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=s.view.spatialReference;for(const n in s)this[n]=s[n];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(s){this._elevationInfo=s,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(s){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=s.slice(),this._updateEngineObject()}set available(s){s!==this._available&&(this._available=s,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,T.IH)(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}}set radius(s){s!==this._radius&&(this._radius=s,this._updateEngineObject())}get radius(){return this._radius}set worldSized(s){s!==this._worldSized&&(this._worldSized=s,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(s){ce(s)&&(this._screenLocationDirty=!0),(0,E.c)(this._modelTransform,s),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,R.c)()),function ge($,s,n){switch($.viewingMode){case"local":return(0,E.i)(n),!0;case"global":{const v=(0,a.Iu)($.renderCoordsHelper.spatialReference);(0,t.PR)(s,0,Z,0,v.radius),(0,t.yH)((0,p.Vl)(Z[0]),(0,p.Vl)(Z[1]),n)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(s){this.view.renderCoordsHelper.fromRenderCoords(s,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(s){(0,r.WG)(s,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(s){(0,r.WG)(s,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const s=(0,_.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=s+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(s){s!==this._grabbing&&(this._grabbing=s,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(s){s!==this._hovering&&(this._hovering=s,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(s){s!==this._selected&&(this._selected=s,this._updateEngineObject(),this.events.emit("select-changed",{action:s?"select":"deselect"}))}get state(){return this._state}set state(s){s!==this._state&&(this._state=s,this._updateEngineObject())}updateStateEnabled(s,n){n?this.state|=s:this.state&=~s}_setFocused(s){s!==this._focused&&(this._focused=s,this.events.emit("focus-changed",{action:!0===s?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let s;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,ce(this._modelTransform)){const n=this._calculateModelTransformOffset(oe);s=(0,D.a)(n,n,this.renderLocation)}else s=this.renderLocation;this.camera.projectToRenderScreen(s,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(s){this._applyObjectTransform=s,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(s,n){var W;if(!this.available)return null;const v=(0,P.md)(s,_e),y=this._getCollisionRadius(n),j=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,O.s)(this.screenLocation.screenPointArray,v)<y*y)return this.screenLocation.renderScreenPointArray[2]+j;break;case"line":{const b=this.collisionType.paths,V=this._getWorldToScreenObjectScale(),H=this._calculateObjectTransform(V,x),K=y*this.screenLocation.pixelSize,Q=(0,h.u4)(this.camera,v,Y);if((0,_.Wi)(Q))return null;for(const U of b){if(0===U.length)continue;const se=(0,D.m)(Z,U[0],H);for(let ie=1;ie<U.length;ie++){const X=(0,D.m)(te,U[ie],H),k=(0,o.Gr)((0,o.zk)(se,X,he),Q);if(null!=k&&k<K*K){const q=(0,D.a)(c.WM.get(),se,X);(0,D.g)(q,q,.5);const le=(0,P.So)(c.WM.get());return this.camera.projectToRenderScreen(q,le),le[2]+j}(0,D.c)(se,X)}}break}case"disc":{const b=this.collisionType.direction,V=null!=(W=this.collisionType.offset)?W:M.Z,H=this._getWorldToScreenObjectScale(),K=this._calculateObjectTransform(H,x),Q=y*this.screenLocation.pixelSize,U=(0,h.u4)(this.camera,v,Y);if((0,_.Wi)(U))return null;const se=(0,S.f)(f,K),ie=(0,D.t)(ne,b,se),X=(0,D.m)(de,V,K);(0,u.Yq)(X,ie,N);const k=J;if((0,u.BR)(N,U,k)&&(0,D.d)(k,X)<Q*Q)return this.screenLocation.renderScreenPointArray[2]+j;break}case"ribbon":{const{paths:b,direction:V}=this.collisionType,H=this._getWorldToScreenObjectScale(),K=this._calculateObjectTransform(H,x),Q=y*this.camera.computeScreenPixelSizeAt(this.renderLocation),U=(0,h.u4)(this.camera,v,Y);if((0,_.Wi)(U))return null;const se=(0,S.f)(f,K),ie=(0,D.t)(ne,V,se),X=this._calculateModelTransformPosition(de);(0,u.Yq)(X,ie,N);const k=J;if(!(0,u.BR)(N,U,k))break;for(const q of b){if(0===q.length)continue;const le=(0,D.m)(Z,q[0],K);for(let ve=1;ve<q.length;ve++){const fe=(0,D.m)(te,q[ve],K),pe=(0,o.Jk)((0,o.zk)(le,fe,he),k);if(null!=pe&&pe<Q*Q){const Ee=(0,D.a)(c.WM.get(),le,fe);(0,D.g)(Ee,Ee,.5);const me=(0,P.So)(c.WM.get());return this.camera.projectToRenderScreen(Ee,me),me[2]+j}(0,D.c)(le,fe)}}break}default:(0,w.Bg)(this.collisionType)}return null}attach(s={manipulator3D:{}}){var v;if(!this.view._stage)return;const n=s.manipulator3D;if((0,_.Wi)(n.engineLayerId)){const y=new I.F({isPickable:!1,updatePolicy:g.jq.SYNC});this.view._stage.add(y),n.engineLayerId=y.id,this._engineLayer=y}else null!=(v=this.view._stage)&&v.getObject&&(this._engineLayer=this.view._stage.getObject(n.engineLayerId));n.engineLayerReferences=(n.engineLayerReferences||0)+1,this._materialIdReferences=n.materialIdReferences,(0,_.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,n.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,t.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new re.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(s={manipulator3D:{}}){const n=s.manipulator3D;n.engineLayerReferences--;const v=0===n.engineLayerReferences;v&&(n.engineLayerId=null),this._removeResourcesFromStage(v),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(s){(0,t.nF)(this.location,ae,s.spatialReference),(0,i.Qn)(s.extent,ae)&&(this.location=this._location)}_evaluateElevationAlignment(s=this.location){if((0,_.Wi)(this.elevationInfo))return!1;let n=null,v=0;const y=(0,_.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":n=(0,_.Pt)((0,d.KO)(this.view.elevationProvider,s,"ground"),0);break;case"relative-to-ground":v=(0,_.Pt)((0,d.KO)(this.view.elevationProvider,s,"ground"),0)+y;break;case"relative-to-scene":v=(0,_.Pt)((0,d.KO)(this.view.elevationProvider,s,"scene"),0)+y;break;case"absolute-height":v=y}return(v!==this._elevation.offset||n!==this._elevation.override)&&(this._elevation.offset=v,this._elevation.override=n,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const s=this._getWorldToScreenObjectScale(),n=x;if(!0===this.autoScaleRenderObjects){const W=this._getFocusedSize(this._radius,this.focused)*s;this._calculateObjectTransform(W,n)}else this._calculateObjectTransform(s,n);const{objectsByState:v}=this._ensureEngineResources(),y=(this.focused?G.Q9.Focused:G.Q9.Unfocused)|(this.selected?G.Q9.Selected:G.Q9.Unselected),j=this._noDisplayCount>0;for(const{stateMask:W,objects:b}of v){if(j){for(const U of b)U.setVisible(!1);continue}const Q=!((W&G.jg.All)!==G.jg.None)||(this.state&W)==(W&G.jg.All);if((W&G.Q9.All)!==G.Q9.None&&(y&W)!=(W&G.Q9.All)||!Q)for(const U of b)U.setVisible(!1);else for(const U of b)U.setVisible(!0),U.transformation=n}}_ensureEngineResources(){if((0,_.Wi)(this._engineResources)){const s=(0,_.Wg)(this._engineLayer),n=[],v=new Set;this.renderObjects.forEach(({material:b})=>{v.has(b)||(n.push(b),v.add(b))});const y=(b,V)=>{const{geometry:H,material:K,transform:Q}=V;Array.isArray(H)?H.forEach(U=>b.addGeometry(U,K,Q)):b.addGeometry(H,K,Q)},j=new Map;this._renderObjects.forEach(b=>{const V=new B.T({castShadow:!1});y(V,b);const H=b.stateMask||0,K=j.get(H)||[];K.push(V),j.set(H,K)});const W=[];j.forEach((b,V)=>W.push({stateMask:V,objects:b})),this._engineResources={objectsByState:W,layer:s,materials:n}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||(0,_.Wi)(this._engineResources))return;const{objectsByState:s,layer:n,materials:v}=this._engineResources;v.forEach(y=>{const j=(0,_.Wg)(this._materialIdReferences),W=j.get(y.id)||0;0===W&&this.view._stage.add(y),j.set(y.id,W+1)}),s.forEach(({objects:y})=>{n.addMany(y),this.view._stage.addMany(y)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(s=!1){if(!this._engineResourcesAddedToStage||(0,_.Wi)(this._engineResources)||!this.view._stage)return;const{objectsByState:n,layer:v,materials:y}=this._engineResources;n.forEach(({objects:j})=>{v.removeMany(j),this.view._stage.removeMany(j)}),y.forEach(j=>{const W=(0,_.Wg)(this._materialIdReferences),b=W.get(j.id);1===b?(this.view._stage.remove(j),W.delete(j.id)):W.set(j.id,b-1)}),s&&this.view._stage.remove(v),this._engineResourcesAddedToStage=!1}_getCollisionRadius(s){return this._getFocusedSize(this.radius,!0)*("touch"===s?this.touchMultiplier:1)}_getFocusedSize(s,n){return s*(n?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(s){const n=this._getWorldToScreenObjectScale(),v=this._calculateObjectTransform(n,C);return(0,D.s)(s,v[12],v[13],v[14])}_calculateModelTransformOffset(s){const n=this._calculateModelTransformPosition(s);return(0,D.b)(s,n,this.renderLocation)}_calculateObjectTransform(s,n){return(0,E.s)(n,s,0,0,0,0,s,0,0,0,0,s,0,0,0,0,1),this._worldFrame&&(0,E.m)(n,n,this._worldFrame),(0,E.m)(n,n,this._modelTransform),n[12]+=this.renderLocation[0],n[13]+=this.renderLocation[1],n[14]+=this.renderLocation[2],n[15]=1,(0,_.pC)(this._applyObjectTransform)&&this._applyObjectTransform(n),n}get test(){let s=!1;if((0,_.pC)(this._engineResources))for(const n in this._engineResources.objectsByState){const v=this._engineResources.objectsByState[n];for(const y of v.objects)if(y.isVisible){s=!0;break}if(s)break}return{areAnyResourcesVisible:s}}}function ce($){return 0!==$[12]||0!==$[13]||0!==$[14]}const _e=(0,P.s1)(),he=(0,o.Ue)(),Y=(0,l.Ue)(),f=(0,z.c)(),C=(0,R.c)(),x=(0,R.c)(),N=(0,u.Ue)(),Z=(0,M.c)(),te=(0,M.c)(),J=(0,M.c)(),ne=(0,M.c)(),de=(0,M.c)(),oe=(0,M.c)(),ae=new re.Z({x:0,y:0,z:0,spatialReference:null})},19142:(ee,F,e)=>{e.d(F,{Aq:()=>o,EA:()=>M,Gd:()=>i,aD:()=>a,du:()=>u,qJ:()=>t,u2:()=>l});var m=e(62208),w=e(28347),A=e(84161),p=e(4794),_=e(26242),P=e(84786),T=e(45403),S=e(67225),z=e(42743),E=e(57521),R=e(40723),O=e(92972),D=e(81040);function M(r,d=R.yD.OccludeAndTransparent,h=!0){const g=(0,p.f)(r[0],r[1],r[2],r.length>3?r[3]:1),L=r[3]<1;return h?new D.Q({color:g,transparent:L,writeDepth:!0,cullFace:z.Vr.Back,renderOccluded:d}):new O.E({color:g,transparent:L,writeDepth:!0,cullFace:z.Vr.Back,renderOccluded:d})}function t(r,d=R.yD.OccludeAndTransparent){const h=(0,p.f)(r[0],r[1],r[2],4===r.length?r[3]:1);return new O.E({color:h,transparent:!0,writeDepth:!0,cullFace:z.Vr.Front,renderOccluded:d})}function a(r,d,h){return new T.Z({view:r,renderObjects:[{geometry:E.Z.createSphereGeometry(1,32,32),material:M((0,p.f)(d[0],d[1],d[2],null!=h?h:1))}]})}function i(r,d,h,g){const L=(0,A.b)(_.WM.get(),r,h),B=o(L,(0,A.f)(_.WM.get(),g,L),h,_.MP.get());(0,w.a)(B,B);const I=(0,A.m)(_.WM.get(),d,B);return Math.atan2(I[1],I[0])}function o(r,d,h,g){const L=(0,A.n)(_.WM.get(),r),B=(0,A.n)(_.WM.get(),d),I=(0,A.f)(_.WM.get(),L,B);return g[0]=L[0],g[1]=L[1],g[2]=L[2],g[3]=0,g[4]=B[0],g[5]=B[1],g[6]=B[2],g[7]=0,g[8]=I[0],g[9]=I[1],g[10]=I[2],g[11]=0,g[12]=h[0],g[13]=h[1],g[14]=h[2],g[15]=1,g}function u(r,d){const h=r.getViewForGraphic(d);return(0,m.pC)(h)&&"computeAttachmentOrigin"in h?h.computeAttachmentOrigin(d,r.spatialReference):null}function l(r,d,h){const g=u(r,h);(0,m.pC)(g)?d.elevationAlignedLocation=g:function c(r,d){if((0,m.Wi)(d))return;const h="mesh"===d.type?d.anchor:(0,S.zE)(d);(0,m.Wi)(h)||(r.location=(0,P.kB)(h))}(d,h.geometry)}},87469:(ee,F,e)=>{e.d(F,{r:()=>O});var m=e(62208),w=e(28347),A=e(43703),p=e(84161),_=e(28093),P=e(993),T=e(67709),S=e(53928),z=e(44014),E=e(40723),R=e(92222);class O extends S._{constructor(t){super(t),this._renderOccluded=E.yD.OccludeAndTransparent,this._width=1,this._color=(0,T.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(t)}setGeometryFromRenderSpacePoint(t,a=1e3){const i=[];i.push([[t[0]-a,t[1]+0,t[2]+0],[t[0]+a,t[1]+0,t[2]+0]]),i.push([[t[0]-0,t[1]-a,t[2]+0],[t[0]+0,t[1]+a,t[2]+0]]),i.push([[t[0]-0,t[1]+0,t[2]-a],[t[0]+0,t[1]+0,t[2]+a]]),this.geometry=i}setGeometryFromExtent(t){const a=this.view.spatialReference,i=(0,_.c)(),o=(0,_.c)(),u=100,l=[];(0,p.s)(i,t[0],t[1],u),this.view.renderCoordsHelper.toRenderCoords(i,a,o),l.push([o[0],o[1],o[2]]),(0,p.s)(i,t[2],t[1],u),this.view.renderCoordsHelper.toRenderCoords(i,a,o),l.push([o[0],o[1],o[2]]),(0,p.s)(i,t[2],t[3],u),this.view.renderCoordsHelper.toRenderCoords(i,a,o),l.push([o[0],o[1],o[2]]),(0,p.s)(i,t[0],t[3],u),this.view.renderCoordsHelper.toRenderCoords(i,a,o),l.push([o[0],o[1],o[2]]),(0,p.s)(i,t[0],t[1],u),this.view.renderCoordsHelper.toRenderCoords(i,a,o),l.push([o[0],o[1],o[2]]),(0,p.s)(i,t[0],t[1],u),this.view.renderCoordsHelper.toRenderCoords(i,a,o),l.push([o[0],o[1],o[2]]),this.geometry=[l]}setGeometryFromFrustum(t){const a=[];t.lines.forEach(i=>{a.push([i.origin[0],i.origin[1],i.origin[2]]),a.push([i.endpoint[0],i.endpoint[1],i.endpoint[2]])}),this.geometry=[a]}setGeometryFromBoundedPlane(t){const a=[],i=t.origin,o=t.basis1,u=t.basis2,l=.5,c=(0,_.c)(),r=(0,_.c)(),d=(0,_.c)(),h=(0,_.c)();c[0]=i[0]-o[0]*l-u[0]*l,c[1]=i[1]-o[1]*l-u[1]*l,c[2]=i[2]-o[2]*l-u[2]*l,r[0]=i[0]-o[0]*l+u[0]*l,r[1]=i[1]-o[1]*l+u[1]*l,r[2]=i[2]-o[2]*l+u[2]*l,d[0]=i[0]+o[0]*l+u[0]*l,d[1]=i[1]+o[1]*l+u[1]*l,d[2]=i[2]+o[2]*l+u[2]*l,h[0]=i[0]+o[0]*l-u[0]*l,h[1]=i[1]+o[1]*l-u[1]*l,h[2]=i[2]+o[2]*l-u[2]*l,a.push([c[0],c[1],c[2]]),a.push([r[0],r[1],r[2]]),a.push([d[0],d[1],d[2]]),a.push([h[0],h[1],h[2]]),a.push([c[0],c[1],c[2]]),this.geometry=[a]}setGeometryFromSegment(t){const a=t.endRenderSpace;this.transform=(0,w.f)(D,a);const{points:i}=t.createRenderGeometry(a,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(t,a=_.Z){this.transform=(0,w.f)(D,a),this.geometry=t.map(i=>i.createRenderGeometry(a,this.view.renderCoordsHelper).points)}getTransformedGeometry(){return(0,m.Wi)(this._geometry)?null:this._geometry.map(t=>t.map(a=>(0,p.m)((0,_.c)(),a,this.transform)))}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){(0,P.g)(t,this._color)||((0,P.c)(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){(0,m.pC)(t)?!(0,m.Wi)(this._innerColor)&&(0,P.g)(t,this._innerColor)||(this._innerColor=(0,P.c)((0,T.c)(),t),this._updateMaterial()):(0,m.pC)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const a=(0,m.pC)(t)!==(0,m.pC)(this._stipplePattern);this._stipplePattern=t,a?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){((0,m.Wi)(t)||(0,m.Wi)(this._stippleOffColor)||!(0,P.g)(t,this._stippleOffColor))&&(this._stippleOffColor=(0,m.pC)(t)?(0,T.a)(t):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(t){this._stipplePreferContinuous!==t&&(this._stipplePreferContinuous=t,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(t){this._writeDepthEnabled!==t&&(this._writeDepthEnabled=t,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){t!==this._polygonOffset&&(this._polygonOffset=t,this._updateMaterial())}createExternalResources(){this._material=new R.U(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(t){const a=this._createLineGeometries();if(0!==a.length)for(let i=0;i<a.length;++i){const o=(0,z.YU)(a[i]);t.addGeometry(o,this._material)}}forEachExternalMaterial(t){t(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const t=this.geometry;if((0,m.Wi)(t)||0===t.length)return[];const a=[];return t.forEach(i=>{const u=new Float64Array(3*i.length);i.forEach((c,r)=>{u[3*r+0]=c[0],u[3*r+1]=c[1],u[3*r+2]=c[2]}),a.push({overlayInfo:null,attributeData:{position:u},removeDuplicateStartEnd:z.NW.KEEP})}),a}}const D=(0,A.c)()},53928:(ee,F,e)=>{e.d(F,{_:()=>S});var m=e(62208),w=e(28347),A=e(43703),p=e(68604),_=e(42743),P=e(97272),T=e(34103);class S extends p.l{constructor(E){super(E.view),this._resources=null,this._transform=(0,A.c)()}get object(){return(0,m.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(E){(0,w.c)(this._transform,E),(0,m.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,m.Wi)(this._resources))return;const E=this._resources.object,R=this.view._stage;R.removeMany(E.geometries),E.removeAllGeometries(),this.createGeometries(E),this.visible||E.setVisible(this.visible),R.addMany(E.geometries)}createResources(){this.destroyResources();const E=this.view._stage;if(!E)return;const R=new T.F({isPickable:!1,updatePolicy:_.jq.SYNC});E.add(R);const O=new P.T({castShadow:!1});O.transformation=this._transform,this.createExternalResources(),this.createGeometries(O),E.addMany(O.geometries),this.forEachExternalMaterial(D=>E.add(D)),E.add(O),R.add(O),this.visible||O.setVisible(!1),this._resources={layer:R,object:O}}destroyResources(){const E=this.view._stage;!(0,m.Wi)(this._resources)&&E&&(E.remove(this._resources.object),E.remove(this._resources.layer),this.forEachExternalMaterial(R=>{E.remove(R),R.dispose()}),E.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(E){(0,m.Wi)(this._resources)||this._resources.object.setVisible(E)}}},68604:(ee,F,e)=>{e.d(F,{l:()=>w});var m=e(32917);class w{constructor(p){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=p,this._handle=(0,m.YP)(()=>this.view.ready,_=>{this._resourcesCreated&&(_?this._createResources():this._destroyResources())})}applyProps(p){let _=!1;for(const P in p)P in this?"attached"===P?_=p[P]:this[P]=p[P]:console.error("Cannot set unknown property",P);this.attached=_}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(p){p!==this._attached&&this.view._stage&&(this._attached=p,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(p){p!==this._visible&&(this._visible=p,this.attached&&this.updateVisibility(p))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},81801:(ee,F,e)=>{e.d(F,{A:()=>p});var m=e(2166),w=e(65787),A=e(17625);function p(_,P){if(!P.screenSizeEnabled)return;const T=_.vertex;(0,m.h)(T,P),T.uniforms.add(new w.p("perScreenPixelRatio",(S,z)=>z.camera.perScreenPixelRatio)),T.uniforms.add(new w.p("screenSizeScale",S=>S.screenSizeScale)),T.code.add(A.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},81040:(ee,F,e)=>{e.d(F,{Q:()=>re});var m=e(84161),w=e(28093),A=e(4794),p=e(5548),_=e(60479),P=e(19625),T=e(6945),S=e(42743),z=e(60881),E=e(32393),R=e(40723),O=e(5894),D=e(2282),M=e(16396),t=e(42037),a=e(57623),i=e(17626),o=e(651),u=e(91056),l=e(87601),c=e(88569),r=e(12407),d=e(41528),h=e(93310),g=e(67969),L=e(2078);class B extends u.A{initializeProgram(f){const C=B.shader.get().build(this.configuration);return new r.$(f.rctx,C,G)}_setPipelineState(f){const C=this.configuration,x=f===S.Am.NONE,N=f===S.Am.FrontFace;return(0,L.sm)({blending:C.output!==T.H.Color&&C.output!==T.H.Alpha||!C.transparent?null:x?c.wu:(0,c.j7)(f),culling:(0,L.zp)(C.cullFace),depthTest:{func:N?g.wb.LESS:C.shadingEnabled?g.wb.LEQUAL:g.wb.LESS},depthWrite:x?C.writeDepth&&L.LZ:(0,c.K5)(f),colorWrite:L.BK,polygonOffset:x||N?null:c.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}B.shader=new o.J(h.S,()=>e.e(8271).then(e.bind(e,88271)));class I extends d.W{constructor(){super(...arguments),this.output=T.H.Color,this.cullFace=S.Vr.None,this.transparencyPassType=S.Am.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,i._)([(0,l.o)({count:T.H.COUNT})],I.prototype,"output",void 0),(0,i._)([(0,l.o)({count:S.Vr.COUNT})],I.prototype,"cullFace",void 0),(0,i._)([(0,l.o)({count:S.Am.COUNT})],I.prototype,"transparencyPassType",void 0),(0,i._)([(0,l.o)()],I.prototype,"hasSlicePlane",void 0),(0,i._)([(0,l.o)()],I.prototype,"transparent",void 0),(0,i._)([(0,l.o)()],I.prototype,"writeDepth",void 0),(0,i._)([(0,l.o)()],I.prototype,"screenSizeEnabled",void 0),(0,i._)([(0,l.o)()],I.prototype,"shadingEnabled",void 0),(0,i._)([(0,l.o)()],I.prototype,"hasMultipassTerrain",void 0),(0,i._)([(0,l.o)()],I.prototype,"cullAboveGround",void 0);const G=new Map([[M.T.POSITION,0],[M.T.NORMAL,1],[M.T.OFFSET,2]]);class re extends R.F5{constructor(f){super(f,new ce),this.supportsEdges=!0,this.techniqueConfig=new I,this._vertexAttributeLocations=G}getConfiguration(f,C){return this.techniqueConfig.output=f,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=C.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=C.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=C.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(f,C,x,N,Z,te,J){if(this.parameters.screenSizeEnabled){const ne=f.vertexAttributes.get(M.T.OFFSET),de={applyToVertex:(oe,ae,$,s)=>{const n=(0,m.s)(_e,ne.data[3*s+0],ne.data[3*s+1],ne.data[3*s+2]),v=(0,m.s)(he,oe,ae,$);return(0,m.g)(n,n,this.parameters.screenSizeScale*N.camera.computeRenderPixelSizeAt(n)),(0,m.a)(v,v,n),[v[0],v[1],v[2]]},applyToAabb:oe=>{const ae=(0,p.be)(oe,_e);return(0,p.bA)(oe,this.parameters.screenSizeScale*N.camera.computeRenderPixelSizeAt(ae))}};(0,a.Bw)(f,C,N,Z,te,de,J)}else(0,a.Bw)(f,C,N,Z,te,void 0,J)}requiresSlot(f,C){if((0,E.S)(C)===T.H.Highlight)return f===O.r.OPAQUE_MATERIAL;let x=O.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(x=this.parameters.writeDepth?O.r.TRANSPARENT_MATERIAL:O.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),f===x||f===O.r.DRAPED_MATERIAL}createGLMaterial(f){return f.output===T.H.Color||f.output===T.H.Alpha||f.output===T.H.Highlight?new ue(f):null}createBufferWriter(){return new ge(this.parameters.screenSizeEnabled)}}class ue extends z.Z{beginSlot(f){return this.ensureTechnique(B,f)}}class ce extends R.Mt{constructor(){super(...arguments),this.color=(0,A.f)(1,1,1,1),this.shadingTint=(0,A.f)(0,0,0,.25),this.shadingDirection=(0,m.n)((0,w.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=S.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class ge{constructor(f){this.screenSizeEnabled=f;const C=(0,P.U$)().vec3f(M.T.POSITION).vec3f(M.T.NORMAL);this.screenSizeEnabled&&C.vec3f(M.T.OFFSET),this.vertexBufferLayout=C}allocate(f){return this.vertexBufferLayout.createBuffer(f)}elementCount(f){return f.indices.get(M.T.POSITION).length}write(f,C,x,N){if((0,t.NK)(C,this.vertexBufferLayout,f.transformation,f.invTranspTransformation,x,N),this.screenSizeEnabled){if(!C.vertexAttributes.has(M.T.OFFSET))throw new Error(`${M.T.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const Z=C.vertexAttributes.get(M.T.OFFSET),te=C.indices.get(M.T.OFFSET);(0,D.hu)(3===Z.size);const J=x.getField(M.T.OFFSET,_.ct);if(!J)throw new Error("unable to acquire view for "+M.T.OFFSET);(0,t.ho)(te,Z.data,f.invTranspTransformation,J,N)}}}}const _e=(0,w.c)(),he=(0,w.c)()}}]);