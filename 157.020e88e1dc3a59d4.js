"use strict";var ue=Object.defineProperty,pe=Object.defineProperties,de=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,ce=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,re=(S,h,o)=>h in S?ue(S,h,{enumerable:!0,configurable:!0,writable:!0,value:o}):S[h]=o,W=(S,h)=>{for(var o in h||(h={}))ce.call(h,o)&&re(S,o,h[o]);if(te)for(var o of te(h))ye.call(h,o)&&re(S,o,h[o]);return S},ne=(S,h)=>pe(S,de(h));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[157,587],{52489:(S,h,o)=>{o.d(h,{D:()=>u});var c=o(22558);function u(O){O&&O.writtenProperties&&O.writtenProperties.forEach(({target:m,propName:_,newOrigin:R})=>{(0,c.l)(m)&&R&&m.originOf(_)!==R&&m.updateOrigin(_,R)})}},22558:(S,h,o)=>{function c(u){return u&&"getAtOrigin"in u&&"originOf"in u}o.d(h,{l:()=>c})},10157:(S,h,o)=>{o.d(h,{xp:()=>Q,Vt:()=>oe});var c=o(15861),u=o(17626),O=o(84792),m=o(26584),R=(o(8314),o(63290)),b=o(62208),U=o(10699),I=o(21726),v=o(77712),P=(o(85931),o(90912),o(68653)),N=o(76898),C=o(99433),A=o(52489),Z=o(2004),j=o(79334),z=o(65234),M=o(38305),a=o(13812),p=o(60595),g=o(84687),x=o(55463),T=o(59213),$=o(35948),K=o(10587);function D(l,i,t){return L.apply(this,arguments)}function L(){return(L=(0,c.Z)(function*(l,i,t){if(!i||!i.resources)return;const e=i.portalItem===l.portalItem?new Set(l.paths):new Set;l.paths.length=0,l.portalItem=i.portalItem;const r=new Set(i.resources.toKeep.map(d=>d.resource.path)),s=new Set,n=[];r.forEach(d=>{e.delete(d),l.paths.push(d)});for(const d of i.resources.toUpdate)if(e.delete(d.resource.path),r.has(d.resource.path)||s.has(d.resource.path)){const{resource:F,content:ae,finish:ie,error:le}=d,ee=(0,K.getSiblingOfSameTypeI)(F,(0,$.D)());l.paths.push(ee.path),n.push(E({resource:ee,content:ae,finish:ie,error:le},t))}else l.paths.push(d.resource.path),n.push(Y(d,t)),s.add(d.resource.path);for(const d of i.resources.toAdd)n.push(E(d,t)),l.paths.push(d.resource.path);if(e.forEach(d=>{const F=i.portalItem.resourceFromPath(d);n.push(F.portalItem.removeResource(F).catch(()=>{}))}),0===n.length)return;const y=yield(0,U.as)(n);(0,U.k_)(t);const f=y.filter(d=>"error"in d).map(d=>d.error);if(f.length>0)throw new m.Z("save:resources","Failed to save one or more resources",{errors:f})})).apply(this,arguments)}function E(l,i){return J.apply(this,arguments)}function J(){return(J=(0,c.Z)(function*(l,i){const t=yield(0,T.q6)(l.resource.portalItem.addResource(l.resource,l.content,i));if(!0!==t.ok)throw l.error&&l.error(t.error),t.error;l.finish&&l.finish(l.resource)})).apply(this,arguments)}function Y(l,i){return G.apply(this,arguments)}function G(){return(G=(0,c.Z)(function*(l,i){const t=yield(0,T.q6)(l.resource.update(l.content,i));if(!0!==t.ok)throw l.error(t.error),t.error;l.finish(l.resource)})).apply(this,arguments)}const V=R.Z.getLogger("esri.layers.mixins.SceneService"),oe=l=>{let i=class extends l{constructor(){var t;super(...arguments),t=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,U.Ds)(function(){var e=(0,c.Z)(function*(r,s,n){switch(r){case Q.SAVE:return t._save(s);case Q.SAVE_AS:return t._saveAs(n,s)}});return function(r,s,n){return e.apply(this,arguments)}}())}readSpatialReference(t,e){return this._readSpatialReference(e)}_readSpatialReference(t){if(null!=t.spatialReference)return z.Z.fromJSON(t.spatialReference);{const e=t.store,r=e.indexCRS||e.geographicCRS,s=r&&parseInt(r.substring(r.lastIndexOf("/")+1,r.length),10);return null!=s?new z.Z(s):null}}readFullExtent(t,e,r){if(null!=t&&"object"==typeof t){const y=null==t.spatialReference?ne(W({},t),{spatialReference:this._readSpatialReference(e)}):t;return Z.Z.fromJSON(y,r)}const s=e.store,n=this._readSpatialReference(e);return null==n||null==s||null==s.extent||!Array.isArray(s.extent)||s.extent.some(y=>y<k)?null:new Z.Z({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:n})}parseVersionString(t){const e={major:Number.NaN,minor:Number.NaN,versionString:t},r=t.split(".");return r.length>=2&&(e.major=parseInt(r[0],10),e.minor=parseInt(r[1],10)),e}readVersion(t,e){const r=e.store,s=null!=r.version?r.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(t){return"item-title"!==this.sublayerTitleMode?void 0:t}readTitleService(t,e){const r=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return(0,M.a7)(this.url,e.name);let s=e.name;if(!s&&this.url){const n=(0,M.Qc)(this.url);(0,b.pC)(n)&&(s=n.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&r&&(s=r+" - "+s),(0,M.ld)(s)}set url(t){const e=(0,M.XG)({layer:this,url:t,nonStandardUrlAllowed:!1,logger:V});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(t,e,r,s){(0,M.wH)(this,t,"layers",e,s)}get parsedUrl(){const t=this._get("url");if(!t)return null;const e=(0,I.mN)(t);return null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(t,e){var r=this;return(0,c.Z)(function*(){r.indexInfo=(0,p.T)(r.parsedUrl.path,r.rootNode,t,r.apiKey,V,e),null==r.fullExtent||r.fullExtent.hasZ||r._updateExtent(yield r.indexInfo)})()}_updateExtent(t){var e,r,s;if("page"===(null==t?void 0:t.type)){const n=t.rootIndex%t.pageSize,y=null==(r=null==(e=t.rootPage)?void 0:e.nodes)?void 0:r[n];if(null==y||null==y.obb||null==y.obb.center||null==y.obb.halfSize)throw new m.Z("sceneservice:invalid-node-page","Invalid node page.");if(y.obb.center[0]<k||null==this.fullExtent||this.fullExtent.hasZ)return;const f=y.obb.halfSize,d=y.obb.center[2],F=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);this.fullExtent.zmin=d-F,this.fullExtent.zmax=d+F}else if("node"===(null==t?void 0:t.type)){const n=null==(s=t.rootNode)?void 0:s.mbs;if(!Array.isArray(n)||4!==n.length||n[0]<k)return;const y=n[2],f=n[3];this.fullExtent.zmin=y-f,this.fullExtent.zmax=y+f}}_fetchService(t){var e=this;return(0,c.Z)(function*(){if(null==e.url)throw new m.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const r=yield e._fetchFirstLayerId(t);null!=r&&(e.layerId=r)}return e._fetchServiceLayer(t)})()}_fetchFirstLayerId(t){var e=this;return(0,c.Z)(function*(){const r=yield(0,O.default)(e.url,{query:{f:"json",token:e.apiKey},responseType:"json",signal:t});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id})()}_fetchServiceLayer(t){var e=this;return(0,c.Z)(function*(){const r=yield(0,O.default)(e.parsedUrl.path,{query:{f:"json",token:e.apiKey},responseType:"json",signal:t});r.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));let s=!1;if(r.data.layerType&&"Voxel"===r.data.layerType&&(s=!0),s)return e._fetchVoxelServiceLayer();const n=r.data;e.read(n,{origin:"service",url:e.parsedUrl}),e.validateLayer(n)})()}_fetchVoxelServiceLayer(t){var e=this;return(0,c.Z)(function*(){const r=(yield(0,O.default)(e.parsedUrl.path+"/layer",{query:{f:"json",token:e.apiKey},responseType:"json",signal:t})).data;e.read(r,{origin:"service",url:e.parsedUrl}),e.validateLayer(r)})()}_ensureLoadBeforeSave(){var t=this;return(0,c.Z)(function*(){yield t.load(),"beforeSave"in t&&"function"==typeof t.beforeSave&&(yield t.beforeSave())})()}validateLayer(t){}_updateTypeKeywords(t,e,r){t.typeKeywords||(t.typeKeywords=[]);const s=e.getTypeKeywords();for(const n of s)t.typeKeywords.push(n);t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((n,y,f)=>f.indexOf(n)===y),r===H.newItem&&(t.typeKeywords=t.typeKeywords.filter(n=>"Hosted Service"!==n)))}_saveAs(t,e){var r=this;return(0,c.Z)(function*(){const s=W(W({},q),e);let n=x.default.from(t);n||(V.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new m.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const y=n.portal||g.Z.getDefault();yield r._ensureLoadBeforeSave(),n.type=X,n.portal=y;const f={origin:"portal-item",url:null,messages:[],portal:y,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},d={layers:[r.write({},f)]};return yield Promise.all(f.resources.pendingOperations),yield r._validateAgainstJSONSchema(d,f,s),n.url=r.url,n.title||(n.title=r.title),r._updateTypeKeywords(n,s,H.newItem),yield y._signIn(),yield y.user.addItem({item:n,folder:s&&s.folder,data:d}),yield D(r.resourceReferences,f,null),r.portalItem=n,(0,A.D)(f),f.portalItem=n,n})()}_save(t){var e=this;return(0,c.Z)(function*(){const r=W(W({},q),t);e.portalItem||(V.error("_save(): requires the .portalItem property to be set"),yield Promise.reject(new m.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),e.portalItem.type!==X&&(V.error("_save(): Non-matching portal item type. Got "+e.portalItem.type+", expected "+X),yield Promise.reject(new m.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${X}"`))),yield e._ensureLoadBeforeSave();const s={origin:"portal-item",url:e.portalItem.itemUrl&&(0,I.mN)(e.portalItem.itemUrl),messages:[],portal:e.portalItem.portal||g.Z.getDefault(),portalItem:e.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[e.write({},s)]};return yield Promise.all(s.resources.pendingOperations),yield e._validateAgainstJSONSchema(n,s,r),e.portalItem.url=e.url,e.portalItem.title||(e.portalItem.title=e.title),e._updateTypeKeywords(e.portalItem,r,H.existingItem),yield e.portalItem.update({data:n}),yield D(e.resourceReferences,s,null),(0,A.D)(s),e.portalItem})()}_validateAgainstJSONSchema(t,e,r){return(0,c.Z)(function*(){let s=e.messages.filter(n=>"error"===n.type).map(n=>new m.Z(n.name,n.message,n.details));if(r&&r.validationOptions.ignoreUnsupported&&(s=s.filter(n=>"layer:unsupported"!==n.name&&"symbol:unsupported"!==n.name&&"symbol-layer:unsupported"!==n.name&&"property:unsupported"!==n.name&&"url:unsupported"!==n.name&&"scenemodification:unsupported"!==n.name)),r.validationOptions.enabled||se){const n=(yield o.e(5496).then(o.bind(o,15496))).validate(t,r.portalItemLayerType);if(n.length>0){const y=`Layer item did not validate:\n${n.join("\n")}`;if(V.error(`_validateAgainstJSONSchema(): ${y}`),"throw"===r.validationOptions.failPolicy){const f=n.map(d=>new m.Z("sceneservice:schema-validation",d)).concat(s);throw new m.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:f})}}}if(s.length>0)throw new m.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})})()}};return(0,u._)([(0,v.Cb)(a.id)],i.prototype,"id",void 0),(0,u._)([(0,v.Cb)({type:z.Z})],i.prototype,"spatialReference",void 0),(0,u._)([(0,P.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readSpatialReference",null),(0,u._)([(0,v.Cb)({type:Z.Z})],i.prototype,"fullExtent",void 0),(0,u._)([(0,P.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readFullExtent",null),(0,u._)([(0,v.Cb)({readOnly:!0,type:j.Z})],i.prototype,"heightModelInfo",void 0),(0,u._)([(0,v.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],i.prototype,"minScale",void 0),(0,u._)([(0,v.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],i.prototype,"maxScale",void 0),(0,u._)([(0,v.Cb)({readOnly:!0})],i.prototype,"version",void 0),(0,u._)([(0,P.r)("version",["store.version"])],i.prototype,"readVersion",null),(0,u._)([(0,v.Cb)({type:String,json:{read:{source:"copyrightText"}}})],i.prototype,"copyright",void 0),(0,u._)([(0,v.Cb)({type:String,json:{read:!1}})],i.prototype,"sublayerTitleMode",void 0),(0,u._)([(0,v.Cb)({type:String})],i.prototype,"title",void 0),(0,u._)([(0,P.r)("portal-item","title")],i.prototype,"readTitlePortalItem",null),(0,u._)([(0,P.r)("service","title",["name"])],i.prototype,"readTitleService",null),(0,u._)([(0,v.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],i.prototype,"layerId",void 0),(0,u._)([(0,v.Cb)(a.HQ)],i.prototype,"url",null),(0,u._)([(0,C.c)("url")],i.prototype,"writeUrl",null),(0,u._)([(0,v.Cb)()],i.prototype,"parsedUrl",null),(0,u._)([(0,v.Cb)({readOnly:!0})],i.prototype,"store",void 0),(0,u._)([(0,v.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],i.prototype,"rootNode",void 0),i=(0,u._)([(0,N.j)("esri.layers.mixins.SceneService")],i),i},k=-1e38,se=!1;var H,l;(l=H||(H={}))[l.existingItem=0]="existingItem",l[l.newItem=1]="newItem";const X="Scene Service",q={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var Q;!function(l){l[l.SAVE=0]="SAVE",l[l.SAVE_AS=1]="SAVE_AS"}(Q||(Q={}))},60595:(S,h,o)=>{o.d(h,{T:()=>_});var c=o(15861),u=o(84792),O=o(26584),m=o(62208);function _(b,U,I,v,w,B){return R.apply(this,arguments)}function R(){return(R=(0,c.Z)(function*(b,U,I,v,w,B){let P=null;if((0,m.pC)(I)){const A=`${b}/nodepages/`,Z=A+Math.floor(I.rootIndex/I.nodesPerPage);try{return{type:"page",rootPage:(yield(0,u.default)(Z,{query:{f:"json",token:v},responseType:"json",signal:B})).data,rootIndex:I.rootIndex,pageSize:I.nodesPerPage,lodMetric:I.lodSelectionMetricType,urlPrefix:A}}catch(j){(0,m.pC)(w)&&w.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",Z,j),P=j}}if(!U)return null;const N=`${b}/nodes/`,C=N+(U&&U.split("/").pop());try{return{type:"node",rootNode:(yield(0,u.default)(C,{query:{f:"json",token:v},responseType:"json",signal:B})).data,urlPrefix:N}}catch(A){throw new O.Z("sceneservice:root-node-missing","Root node missing.",{pageError:P,nodeError:A,url:C})}})).apply(this,arguments)}},10587:(S,h,o)=>{o.r(h),o.d(h,{addOrUpdateResource:()=>U,contentToBlob:()=>Z,fetchResources:()=>R,getSiblingOfSameType:()=>z,getSiblingOfSameTypeI:()=>M,removeAllResources:()=>B,removeResource:()=>v,splitPrefixFileNameAndExtension:()=>C});var c=o(15861),u=o(84792),O=o(26584),m=o(62208),_=o(21726);function R(a){return b.apply(this,arguments)}function b(){return(b=(0,c.Z)(function*(a,p={},g){yield a.load(g);const x=(0,_.v_)(a.itemUrl,"resources"),{start:T=1,num:$=10,sortOrder:K="asc",sortField:D="created"}=p,L={query:{start:T,num:$,sortOrder:K,sortField:D,token:a.apiKey},signal:(0,m.U2)(g,"signal")},E=yield a.portal._request(x,L);return{total:E.total,nextStart:E.nextStart,resources:E.resources.map(({created:J,size:Y,resource:G})=>({created:new Date(J),size:Y,resource:a.resourceFromPath(G)}))}})).apply(this,arguments)}function U(a,p,g,x){return I.apply(this,arguments)}function I(){return(I=(0,c.Z)(function*(a,p,g,x){if(!a.hasPath())throw new O.Z(`portal-item-resource-${p}:invalid-path`,"Resource does not have a valid path");const T=a.portalItem;yield T.load(x);const $=(0,_.v_)(T.userItemUrl,"add"===p?"addResources":"updateResources"),[K,D]=N(a.path),L=yield Z(g),E=new FormData;return K&&"."!==K&&E.append("resourcesPrefix",K),E.append("fileName",D),E.append("file",L,D),E.append("f","json"),(0,m.pC)(x)&&x.access&&E.append("access",x.access),yield T.portal._request($,{method:"post",body:E,signal:(0,m.U2)(x,"signal")}),a})).apply(this,arguments)}function v(a,p,g){return w.apply(this,arguments)}function w(){return(w=(0,c.Z)(function*(a,p,g){if(!p.hasPath())throw new O.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield a.load(g);const x=(0,_.v_)(a.userItemUrl,"removeResources");yield a.portal._request(x,{method:"post",query:{resource:p.path},signal:(0,m.U2)(g,"signal")}),p.portalItem=null})).apply(this,arguments)}function B(a,p){return P.apply(this,arguments)}function P(){return(P=(0,c.Z)(function*(a,p){yield a.load(p);const g=(0,_.v_)(a.userItemUrl,"removeResources");return a.portal._request(g,{method:"post",query:{deleteAll:!0},signal:(0,m.U2)(p,"signal")})})).apply(this,arguments)}function N(a){const p=a.lastIndexOf("/");return-1===p?[".",a]:[a.slice(0,p),a.slice(p+1)]}function C(a){const[p,g]=function A(a){const p=(0,_.Ml)(a);return(0,m.Wi)(p)?[a,""]:[a.slice(0,a.length-p.length-1),`.${p}`]}(a),[x,T]=N(p);return[x,T,g]}function Z(a){return j.apply(this,arguments)}function j(){return(j=(0,c.Z)(function*(a){return a instanceof Blob?a:(yield(0,u.default)(a.url,{responseType:"blob"})).data})).apply(this,arguments)}function z(a,p){if(!a.hasPath())return null;const[g,,x]=C(a.path);return a.portalItem.resourceFromPath((0,_.v_)(g,p+x))}function M(a,p){if(!a.hasPath())return null;const[g,,x]=C(a.path);return a.portalItem.resourceFromPath((0,_.v_)(g,p+x))}}}]);