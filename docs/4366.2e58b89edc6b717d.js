"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[4366],{4366:(b,w,e)=>{e.r(w),e.d(w,{default:()=>g});var y=e(15861),o=e(17626),u=e(62208),F=e(10699),f=e(32917),x=(e(63290),e(90912),e(85931),e(26584)),m=(e(8314),e(76898)),I=e(69759),l=e(77712),E=e(72642),Z=e(13812),n=e(96854),P=e(10023);const T=t=>{let a=class extends t{constructor(){super(...arguments),this.view=null}fetchPopupFeatures(i,r){var d=this;return(0,y.Z)(function*(){const{layer:v}=d;if(!i)throw new x.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:v});const{popupEnabled:p}=v,c=(0,P.V)(v,r);if(!p||(0,u.Wi)(c))throw new x.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:p,popupTemplate:c});const L=yield c.getRequiredFields(),R=new n.Z;R.timeExtent=d.timeExtent,R.geometry=i,R.outFields=L,R.outSpatialReference=i.spatialReference;const{resolution:C,spatialReference:H}=d.view,U="2d"===d.view.type?new E.Z(C,C,H):new E.Z(.5*C,.5*C,H),{returnTopmostRaster:V,showNoDataRecords:W}=c.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},j={returnDomainValues:!0,returnTopmostRaster:V,pixelSize:U,showNoDataRecords:W,signal:(0,u.pC)(r)?r.signal:null};return v.queryVisibleRasters(R,j).then(z=>z)})()}canResume(){var i;return!(!super.canResume()||null!=(i=this.timeExtent)&&i.isEmpty)}};return(0,o._)([(0,l.Cb)()],a.prototype,"layer",void 0),(0,o._)([(0,l.Cb)()],a.prototype,"suspended",void 0),(0,o._)([(0,l.Cb)(Z.qG)],a.prototype,"timeExtent",void 0),(0,o._)([(0,l.Cb)()],a.prototype,"view",void 0),a=(0,o._)([(0,m.j)("esri.views.layers.ImageryLayerView")],a),a};let D=class extends(T(I.Z)){constructor(){var t;super(...arguments),t=this,this.type="imagery-3d",this.redrawDebounced=(0,F.Ds)(function(){var a=(0,y.Z)(function*(i){t.redraw((r,d)=>t._redrawImage(r,d),i)});return function(i){return a.apply(this,arguments)}}(),2e3)}initialize(){this.handles.add([(0,f.gx)(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this.updatingHandles.addPromise(this.redrawDebounced()))]),this.updatingHandles.add(()=>{var t,a;return null==(a=null==(t=this.layer)?void 0:t.exportImageServiceParameters)?void 0:a.version},()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(()=>{var t;return null==(t=this.layer)?void 0:t.renderer},()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(()=>this.timeExtent,()=>this.updatingHandles.addPromise(this.refreshDebounced()))}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}getFetchOptions(){return{timeExtent:this.timeExtent}}processResult(t,a,i){var r=this;return(0,y.Z)(function*(){a.imageOrCanvasElement?t.image=a.imageOrCanvasElement:(t.image=document.createElement("canvas"),t.pixelData=a.pixelData,yield r._redrawImage(t,i))})()}_redrawImage(t,a){var i=this;return(0,y.Z)(function*(){if(!(t.image instanceof HTMLCanvasElement)||(0,u.Wi)(t.pixelData))throw new Error;const r=t.image,d=r.getContext("2d"),v=yield i.layer.applyRenderer(t.pixelData,{signal:a}),p=i.layer.applyFilter(v).pixelBlock;if((0,u.Wi)(p))throw new Error;r.width=p.width,r.height=p.height;const c=d.createImageData(p.width,p.height);c.data.set(p.getAsRGBA()),d.putImageData(c,0,0)})()}};D=(0,o._)([(0,m.j)("esri.views.3d.layers.ImageryLayerView3D")],D);const g=D},10023:(b,w,e)=>{e.d(w,{V:()=>M,e:()=>F});var y=e(15861),o=e(62208),u=e(36630);function F(s){return f.apply(this,arguments)}function f(){return(f=(0,y.Z)(function*(s,h=s.popupTemplate){var P,T;if((0,o.Wi)(h))return[];const x=yield h.getRequiredFields(s.fieldsIndex),{lastEditInfoEnabled:O}=h,{objectIdField:m,typeIdField:I,globalIdField:l,relationships:E}=s;if(x.includes("*"))return["*"];const Z=O?yield(0,u.CH)(s):[],n=(0,u.Q0)(s.fieldsIndex,[...x,...Z]);return I&&n.push(I),n&&m&&(null==(P=s.fieldsIndex)?void 0:P.has(m))&&!n.includes(m)&&n.push(m),n&&l&&(null==(T=s.fieldsIndex)?void 0:T.has(l))&&!n.includes(l)&&n.push(l),E&&E.forEach(D=>{var t;const{keyField:g}=D;n&&g&&(null==(t=s.fieldsIndex)?void 0:t.has(g))&&!n.includes(g)&&n.push(g)}),n})).apply(this,arguments)}function M(s,h){return s.popupTemplate?s.popupTemplate:(0,o.pC)(h)&&h.defaultPopupTemplateEnabled&&(0,o.pC)(s.defaultPopupTemplate)?s.defaultPopupTemplate:null}}}]);