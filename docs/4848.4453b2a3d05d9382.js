"use strict";var yn=Object.defineProperty,fn=Object.defineProperties,Mn=Object.getOwnPropertyDescriptors,Ji=Object.getOwnPropertySymbols,bn=Object.prototype.hasOwnProperty,Sn=Object.prototype.propertyIsEnumerable,ki=(gt,J,u)=>J in gt?yn(gt,J,{enumerable:!0,configurable:!0,writable:!0,value:u}):gt[J]=u,W=(gt,J)=>{for(var u in J||(J={}))bn.call(J,u)&&ki(gt,u,J[u]);if(Ji)for(var u of Ji(J))Sn.call(J,u)&&ki(gt,u,J[u]);return gt},H=(gt,J)=>fn(gt,Mn(J));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[4848],{15448:(gt,J,u)=>{u.d(J,{h:()=>s});let p=y=>({vnodeSelector:"",properties:void 0,children:void 0,text:y.toString(),domNode:null}),T=(y,d,it)=>{for(let Mt=0,z=d.length;Mt<z;Mt++){let f=d[Mt];Array.isArray(f)?T(y,f,it):null!=f&&!1!==f&&("string"==typeof f&&(f=p(f)),it.push(f))}};function s(y,d,it){if(Array.isArray(d))it=d,d=void 0;else if(d&&("string"==typeof d||d.hasOwnProperty("vnodeSelector"))||it&&("string"==typeof it||it.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let Mt,z;return it&&1===it.length&&"string"==typeof it[0]?Mt=it[0]:it&&(z=[],T(y,it,z),0===z.length&&(z=void 0)),{vnodeSelector:y,properties:d,children:z,text:""===Mt?void 0:Mt,domNode:null}}},64848:(gt,J,u)=>{u.r(J),u.d(J,{DrawGraphicTool3D:()=>Jt,ExtentTransformTool:()=>lt,GraphicMoveTool:()=>Tt,GraphicReshapeTool:()=>K,GraphicTransformTool:()=>rt});var p=u(17626),T=u(54024),s=u(62208),y=u(32917),d=u(77712),Mt=(u(90912),u(85931)),z=u(76898),f=u(84161),G=u(28093),V=u(60507),F=u(82706),Pt=u(23841),O=(u(63290),u(26584),u(8314)),X=u(15861),B=u(14517),mt=u(59213),ht=u(10699),k=u(84600),Z=u(67831),It=u(99770),ie=u(25748),Ze=u(41840),Ye=u(75775),xe=u(68371),ot=u(22463);const Ki={default:15,far:25};let Ot=class extends B.Z{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){var e=this;const t=(0,mt.vr)(function(){var n=(0,X.Z)(function*(a){const o=yield(0,Ze.ME)("esri/core/t9n/Units");(0,ht.k_)(a),e._messagesUnits=o});return function(a){return n.apply(this,arguments)}}()),i=()=>(0,s.yw)(this.context,n=>n.editGeometryOperations);this.addHandles([(0,y.YP)(()=>[(0,s.pC)(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(n=>(0,y.on)(i,n,()=>this._update())),(0,T.kB)(()=>t.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return(0,s.Wi)(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(e=>e.label.text)}}get _edgeDistancePixels(){return Ki[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if((0,s.Wi)(e))return void this._destroyUnusedLabels();const{components:t,geometry:i,coordinateHelper:n}=e.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const a=t.length;for(let o=0;o<a;++o){const r=[];if(t[o].iterateVertices(v=>{r.push(n.toXYZ(v.pos))}),0===o&&(0,s.pC)(this.stagedVertex)&&r.push(n.toXYZ(this.stagedVertex)),r.length<2)continue;const l=r[0],h=r[r.length-1];"polygon"===i.type&&r.length>2&&!(0,f.F)(l,h)&&r.push(l);const c=1===a&&!(0,ie.bu)(r,!1,!1);let g=qi,m=ta;this.toScreenPointArray(e,l,g);for(let v=1;v<r.length;++v){const S=r[v-1],b=r[v];this.toScreenPointArray(e,b,m),this._addLabel(e,S,g,b,m,c),[g,m]=[m,g]}}this._destroyUnusedLabels()}_addLabel(e,t,i,n,a,o){const{label:r}=this._getOrCreateLabel(e);if(!this.visible||(0,Z.k)(i,a)<3025)return void(r.visible=!1);const l=(0,s.pC)(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,V.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:h}=e.editGeometryOperations.data,c=(0,ot.MU)(t,n,h,l),g=this._messagesUnits,m=(0,Ye.R)(e.view);r.text=(0,s.pC)(g)&&(0,s.pC)(c)?(0,k.N9)(g,c,m):"",r.visible=!0;const v=a[0]-i[0],S=a[1]-i[1];o?(0,Z.s)(bt,-S,v):(0,Z.s)(bt,S,-v),(0,Z.f)(bt,bt),(0,Z.b)(bt,bt,this._edgeDistancePixels),(0,Z.l)(ue,i,a,.5),(0,Z.j)(ue,ue,bt),r.position=[ue[0],ue[1]],r.anchor=Math.abs(bt[0])>Math.abs(bt[1])?bt[0]>0?"left":"right":-bt[1]<0?"top":"bottom"}_getOrCreateLabel(e){var n;if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new xe.Z({fontSize:10,anchor:"center"});null==(n=e.view.overlay)||n.items.add(t);const i={label:t};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){(0,s.yw)(this.context,t=>{var i;return null==(i=t.view.overlay)?void 0:i.items.remove(e)}),e.destroy()}};(0,p._)([(0,d.Cb)()],Ot.prototype,"context",void 0),(0,p._)([(0,d.Cb)()],Ot.prototype,"stagedVertex",void 0),(0,p._)([(0,d.Cb)()],Ot.prototype,"visible",void 0),(0,p._)([(0,d.Cb)()],Ot.prototype,"edgeDistance",void 0),(0,p._)([(0,d.Cb)()],Ot.prototype,"updating",null),(0,p._)([(0,d.Cb)()],Ot.prototype,"_messagesUnits",void 0),(0,p._)([(0,d.Cb)()],Ot.prototype,"_edgeDistancePixels",null),Ot=(0,p._)([(0,z.j)("esri.views.interactive")],Ot);const bt=(0,It.a)(),ue=(0,It.a)(),qi=(0,Pt.s1)(),ta=(0,Pt.s1)();var ea=u(25858);let Ee=class extends Ot{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:i},n,a=(0,Pt.s1)()){const{spatialReference:o}=i.data.coordinateHelper;return(0,ea.RS)(n,o,t,e,oi),e.state.camera.projectToScreen(oi,a),a}};Ee=(0,p._)([(0,z.j)("esri.views.3d.interactive.SegmentLabels3D")],Ee);const oi=(0,G.c)();var ge=u(96813),_=u(87055),He=u(95390),wt=u(61885),ae=u(993),Ne=u(67709),Ce=u(55915),jt=u(5548),me=u(38114),ia=u(82755),Oe=u(23018),we=u(79112),si=u(79020),ri=u(27632),aa=u(6040),St=u(40723),na=u(64232),oa=u(16396),li=u(92222);class Qt extends ia.i{constructor(t){var i;super(t),this._attachmentOrigin=(0,me.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new wt.Z,this._geometry=null,this._width=1,this._color=(0,Ne.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,Ne.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=St.yD.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=t.view.spatialReference,this._laserline=new Oe.W({view:t.view}),this.applyProps(t),this.attached=null==(i=t.attached)||i}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(t){return{view:t,createResources:i=>this._createObject3DResources(i),destroyResources:i=>this._destroyExternalResources(i),recreateGeometry:(i,n)=>{i.geometries.length=0,this._recreateGeometry(n,i.material,i.geometries)}}}createDrapedResourceFactory(t){return{view:t,createResources:()=>this._createDrapedResources(),destroyResources:i=>this._destroyExternalResources(i),recreateGeometry:i=>{i.geometries=this._createRenderGeometriesDraped(i.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&(0,s.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(t){this._laserline.attached=this._laserlineAttached,t&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){(0,ae.g)(t,this._color)||((0,ae.c)(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){(0,ae.g)(t,this._innerColor)||((0,ae.c)(this._innerColor,t),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const i=(0,s.pC)(t)!==(0,s.pC)(this._stipplePattern);this._stipplePattern=t,i?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){t&&this._stippleOffColor&&(0,ae.g)(t,this._stippleOffColor)||(this._stippleOffColor=t?(0,Ne.c)(t):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(t){this._laserlineStyle=t,this._laserline.attached=this._laserlineAttached,(0,s.pC)(t)&&(this._laserline.style=t)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(t){this._laserlineEnabled!==t&&(this._laserlineEnabled=t,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get attachmentOrigin(){var n;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=null==(n=(0,s.WG)(this.object3dResources.resources))?void 0:n.geometries;if(!t||0===t.length)return null;(0,f.s)(ne,0,0,0);let i=0;for(const a of t)a.computeAttachmentOrigin(hi)&&((0,f.a)(ne,ne,hi),i++);return 0===i?null:((0,f.g)(ne,ne,1/i),this.view.renderCoordsHelper.fromRenderCoords(ne,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){(0,s.pC)(this.object3dResources.resources)&&this.object3dResources.resources.material.setParameters(this._materialParameters),(0,s.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return(0,s.pC)(this.geometry)&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===St.yD.OccludeAndTransparentStencil?St.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(t,i,n){this._createRenderGeometries(i,n);for(const a of n)t.addGeometry(a);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(t){t.geometries=[],t.material.dispose()}_createObject3DResources(t){const i=new li.U(this._materialParameters),n=new Array;return this._recreateGeometry(t,i,n),{material:i,geometries:n,forEach:a=>{a(i),n.forEach(a)}}}_createDrapedResources(){const t=new li.U(this._materialParameters);return{material:t,geometries:this._createRenderGeometriesDraped(t)}}_createRenderGeometriesDraped(t){const i=this.geometry;if((0,s.Wi)(i)||(0,s.Wi)(this.view.basemapTerrain.spatialReference))return[];const n=(0,ri.r)(i,this.view.basemapTerrain.spatialReference),a=[];for(const{position:o}of n.lines){const l=new na.z((0,si.Y)(t,{overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:o},removeDuplicateStartEnd:this._isClosed})),h=(0,jt.cS)(sa);(0,jt.G1)(h,o),(0,ae.s)(l.boundingSphere,.5*(h[0]+h[3]),.5*(h[1]+h[4]),0,.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]))),a.push(l)}return a}calculateMapBounds(t){if((0,s.Wi)(this.object3dResources.resources))return!1;const i=this.view.renderCoordsHelper;for(const n of this.object3dResources.resources.geometries){const a=n.vertexAttributes.get(oa.T.POSITION),o=(0,aa.bg)(a.data.length);(0,Ce.CM)(a.data,i.spatialReference,0,o,this.view.spatialReference,0,a.data.length/3),(0,jt.G1)(t,o)}return!0}_createRenderGeometries(t,i){var r;const n=this.geometry;if((0,s.Wi)(n))return;const a=(0,ri.V)(n,this.view.elevationProvider,this.view.renderCoordsHelper,we.o.fromElevationInfo(null!=(r=this.elevationInfo)?r:new F.Z({mode:(0,V.VW)(n,null)}))),o=new Array;for(const{position:l,mapPositions:h}of a.lines)i.push((0,si.Y)(t,{mapPositions:h,attributeData:{position:l},removeDuplicateStartEnd:this._isClosed})),o.push(l);this._laserline.pathVerticalPlane=o}}const sa=(0,jt.Ue)(),hi=(0,G.c)(),ne=(0,G.c)();var pi=u(11407),Be=u(81468);let pt=class extends wt.Z.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,p._)([(0,d.Cb)({constructOnly:!0})],pt.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)()],pt.prototype,"tracking",void 0),(0,p._)([(0,d.Cb)()],pt.prototype,"displaying",void 0),(0,p._)([(0,d.Cb)()],pt.prototype,"isDraped",void 0),pt=(0,p._)([(0,z.j)("esri.views.3d.layers.graphics.GraphicState")],pt);var ci=u(91306),ra=u(50204),di=u(52181);let Jt=class extends ci.T{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new F.Z({mode:e,offset:t})}normalizeCtorArgs(e){var t;if(!e.elevationInfo){const i=null==(t=e.hasZ)||t;return H(W({},e),{elevationInfo:(0,V.mF)(i)})}return e}initializeGraphic(e){const t=this._createGraphicState=new pt({graphic:e});return(0,T.AL)([this.view.maskOccludee(e),this.view.trackGraphicState(t),(0,y.YP)(()=>({element:this._outlineVisualElement,isDraped:t.isDraped}),({element:i,isDraped:n})=>{(0,s.yw)(i,a=>a.isDraped=n)},y.nn)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new ra.w({view:this.view,manipulators:this.manipulators,geometryType:(0,ci.I)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new di.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new di.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new ge._,segmentLabels:t?new Ee:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,s.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,V.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(e){const{view:t}=this;return(0,s.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),null):(this._activeVertexVisualElement=new pi.j({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:_.Xd.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=_.Xd.colorToVec4(_.Xd.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new He.V({view:t,extensionType:_.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:St.yD.OccludeAndTransparent}),_.Xd.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),(0,T.kB)(()=>{this._activeVertexVisualElement=(0,s.SC)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,s.SC)(this._verticalLineVisualElement)}))}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if((0,s.Wi)(t))return;const{renderCoordsHelper:i,elevationProvider:n}=this.view;(0,f.s)(oe,e[0],e[1],e[2]),ui.setFromElevationInfo(this.elevationInfo),oe[2]=(0,Be.w7)(oe,n,ui,i),i.toRenderCoords(oe,this.view.spatialReference,oe)?(t.setStartEndFromWorldDownAtLocation(oe),t.attached=!0):t.attached=!1}onOutlineChanged(e){if((0,s.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Qt({view:this.view,geometry:e,elevationInfo:t,isDraped:(0,s.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,V.Zz)(this.hasZ,t),attached:!1}),_.Xd.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),_.Xd.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,T.kB)(()=>{this._outlineVisualElement=(0,s.SC)(this._outlineVisualElement)})}onRegularVerticesChanged(e){return(0,s.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new pi.j({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:_.Xd.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,T.kB)(()=>{this._verticesVisualElement=(0,s.SC)(this._verticesVisualElement)}))}};(0,p._)([(0,d.Cb)({constructOnly:!0})],Jt.prototype,"elevationInfo",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Jt.prototype,"geometryType",void 0),(0,p._)([(0,d.Cb)()],Jt.prototype,"type",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Jt.prototype,"view",void 0),Jt=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Jt);const ui=new we.o,oe=(0,G.c)();var xt,e,I,la=u(46160),_e=u(80542),$=u(15572),N=u(19142),gi=u(69648),kt=u(95277),_t=u(21286),vt=u(45403);(e=xt||(xt={}))[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY",function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(I||(I={}));class mi{constructor(){this.grabbingState=xt.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=xt.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator((i,n)=>{if(n===I.TRANSLATE_Z&&(this.zManipulator=i),i instanceof vt.Z&&(i.selected&&(0===this.numSelected&&(this.firstSelected=i),this.numSelected++),(0,s.Wi)(this.firstGrabbedXY)&&i.grabbing&&n===I.TRANSLATE_XY&&(this.firstGrabbedXY=i)),i.grabbing)switch(this.grabbingState|=xt.ANY,n){case I.TRANSLATE_Z:this.grabbingState|=xt.Z;break;case I.TRANSLATE_XY:this.grabbingState|=xt.XY}})}}function ca(e,t,i){const{graphic:n,view:a}=e,o=[],r=(0,V.RL)(n),l="on-the-ground"===r.mode||!r.offset&&"absolute-height"!==r.mode,h=new mi,c=new He.V({view:a,extensionType:_.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:St.yD.OccludeAndTransparent});_.Xd.visualElements.pointGraphics.shadowStyle.apply(c);const g=(0,_t.Vl)(_.Xd.visualElements.heightPlaneAngleCutoff),m=new Oe.W({view:a,attached:!1,angleCutoff:g});_.Xd.visualElements.heightPlane.apply(m);let v=1,S=1;const b=()=>{if(h.update(e),!i.displaying||l&&(i.isDraped||!Fe(n)||!n.geometry.hasZ))return t.laserlineEnabled=!1,c.attached=!1,void(m.attached=!1);t.laserlineEnabled=!0;const D=h.grabbingState&xt.XY?_.Xd.visualElements.laserlineAlphaMultiplier:1;D!==v&&(v=D,_.Xd.visualElements.lineGraphics.shadowStyle.apply(t,D),_.Xd.visualElements.pointGraphics.shadowStyle.apply(c,D));const Y=h.grabbingState&xt.Z?_.Xd.visualElements.laserlineAlphaMultiplier:1;Y!==S&&(S=Y,_.Xd.visualElements.heightPlane.apply(m,Y)),function da(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,s.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,s.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(c,h),function ua(e,t,i,n){if(n.numSelected>0){(0,f.s)($t,0,0,0);let a=0;e.forEachManipulator((o,r)=>{r===I.TRANSLATE_XY&&o.selected&&o instanceof vt.Z&&((0,f.a)($t,$t,o.renderLocation),a++)}),a>0?(i.heightManifoldTarget=(0,f.g)($t,$t,1/a),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;(0,s.pC)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,$t)?(i.heightManifoldTarget=$t,i.attached=!0):i.attached=!1}}(e,t,m,h)};_.Xd.visualElements.zVerticalLine.apply(c),o.push(i.on("changed",b),(0,y.YP)(()=>i.displaying,b),t.events.on("attachment-origin-changed",b),(0,T.ed)(c),(0,T.ed)(m));const M=[],E=()=>{(0,T.AL)(M).remove(),M.length=0,e.forEachManipulator(D=>M.push(D.events.on("grab-changed",b))),e.forEachManipulator(D=>M.push(D.events.on("select-changed",b))),b()};return E(),o.push(e.onManipulatorsChanged(E),(0,T.iU)(()=>(0,T.AL)(M))),(0,T.AL)(o)}function Fe(e){return(0,s.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const $t=(0,G.c)();var _i=u(65401),ga=u(30693);function ma(e){const{view:t,graphic:i}=e,n=new pt({graphic:i}),a=[],o=function va(e,t,i){const{view:n,graphic:a}=e,o=new ga.L({view:n,geometry:je(a),elevationInfo:(0,V.RL)(a),attached:!1});return function ya(e,t,i,n){(function fa(e,t,i,n){const{view:a,graphic:o}=e;let r=null;const h=()=>{const c=je(o);(c=>{(0,s.pC)(r)&&(r.remove(),r=null),i.isDraped&&(0,s.pC)(c)&&(r=function Ma(e,t,i){(0,Ce.KC)(t,Et,e.elevationProvider.spatialReference);const a=Et[0],o=Et[1];return e.elevationProvider.on("elevation-change",r=>{(0,_i.jE)(r.extent,a,o)&&i()})}(a,c,()=>{t.geometry=c}))})(c),t.geometry=c};n.push(i.on("changed",h),(0,T.iU)(()=>r)),h()})(e,t,i,n),_.Xd.visualElements.pointGraphics.outline.apply(t),n.push((0,y.YP)(()=>i.displaying,()=>t.attached=i.displaying,y.nn))}(e,o,t,i),i.push((0,T.ed)(o)),o}(e,n,a);return function _a(e,t,i,n){const{view:a,graphic:o}=e,r=new He.V({view:a,extensionType:_.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:St.yD.OccludeAndTransparent});_.Xd.visualElements.zVerticalLine.apply(r);const l=new Oe.W({view:a,intersectsLineInfinite:!0,attached:!1});_.Xd.visualElements.pointGraphics.shadowStyle.apply(l);const h=(0,_t.Vl)(_.Xd.visualElements.heightPlaneAngleCutoff),c=new Oe.W({view:a,attached:!1,angleCutoff:h});_.Xd.visualElements.heightPlane.apply(c);const g=(0,V.RL)(e.graphic),m=we.o.fromElevationInfo(g),v="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,S=new mi;let b=1,M=1;const E=()=>{S.update(e);const D=je(o),Y=v&&(t.isDraped||(0,s.Wi)(D)||!D.hasZ);let tt=!0;if(!Y&&(0,s.pC)(D)){const L=(0,Be.w7)(D,a.elevationProvider,m,a.renderCoordsHelper);(0,f.s)(Et,D.x,D.y,L),(0,Ce.SH)(Et,D.spatialReference,Et,a.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation(Et),l.intersectsWorldUpAtLocation=Et}else tt=!1;const te=S.grabbingState&xt.Z?_.Xd.visualElements.laserlineAlphaMultiplier:1;te!==b&&(b=te,_.Xd.visualElements.heightPlane.apply(c,te));const dt=(0,jt.cS)(ba);!Y&&t.displaying&&n.calculateMapBounds(dt)&&(0,Ce.SH)((0,jt.KE)(dt,Et),a.spatialReference,Et,a.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=Et,c.attached=!0):c.attached=!1;const Zt=S.grabbingState&xt.XY?_.Xd.visualElements.laserlineAlphaMultiplier:1;Zt!==M&&(M=Zt,_.Xd.visualElements.pointGraphics.shadowStyle.apply(l,Zt));const Ue=tt&&t.displaying&&!Y;l.attached=Ue,r.attached=Ue};i.push((0,y.YP)(()=>[t.displaying,t.isDraped],E),t.on("changed",E)),e.forEachManipulator(D=>{i.push(D.events.on("grab-changed",E))}),i.push((0,T.ed)(l)),i.push((0,T.ed)(r)),i.push((0,T.ed)(c)),E()}(e,n,a,o),a.push(t.trackGraphicState(n)),{visualElement:o,remove(){(0,T.AL)(a).remove()}}}function je(e){const t=e.geometry;return(0,s.Wi)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const Et=(0,G.c)(),ba=(0,jt.Ue)();function Ae(e){switch((0,s.Wg)(e.graphic.geometry).type){case"point":case"mesh":return ma(e);case"polygon":case"polyline":return function ha(e){const{view:t,graphic:i}=e,n=new pt({graphic:i}),a=function pa(e,t){const{view:i,graphic:n}=e,a=new Qt({view:i,geometry:Fe(n)?n.geometry:null,elevationInfo:(0,V.RL)(n),attached:!1});_.Xd.visualElements.lineGraphics.shadowStyle.apply(a);const o=()=>{a.attached=t.displaying};_.Xd.visualElements.lineGraphics.outline.apply(a);const r=[(0,y.YP)(()=>t.displaying,o),(0,y.YP)(()=>t.isDraped,l=>{a.isDraped=l}),t.on("changed",()=>a.geometry=Fe(n)?n.geometry:null),(0,T.ed)(a)];return o(),{visualElement:a,remove:()=>(0,T.AL)(r).remove()}}(e,n),o=[a,ca(e,a.visualElement,n),t.maskOccludee(i),t.trackGraphicState(n)];return{visualElement:a.visualElement,remove:()=>(0,T.AL)(o).remove()}}(e);default:return null}}const Sa=[1,.5,0],fi=Math.ceil(70/3*2),Ta=5*Math.PI/12,Da=1*Math.PI/3;var re=u(72392);class ve{constructor(){this._available=!0}set location(t){this._forEachManipulator3D(i=>i.location=t)}set elevationAlignedLocation(t){this._forEachManipulator3D(i=>i.elevationAlignedLocation=t)}set elevationInfo(t){this._forEachManipulator3D(i=>i.elevationInfo=t)}get renderLocation(){let t;return this._forEachManipulator3D(i=>{t||(t=i.renderLocation)}),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D(i=>i.available=t)}get hovering(){return this.someManipulator(t=>t.hovering)}get grabbing(){return this.someManipulator(t=>t.grabbing)}get dragging(){return this.someManipulator(t=>t.dragging)}hasManipulator(t){return this.someManipulator(i=>i===t)}someManipulator(t){let i=!1;return this.forEachManipulator(n=>{!i&&t(n)&&(i=!0)}),i}_forEachManipulator3D(t){this.forEachManipulator((i,n)=>{i instanceof vt.Z&&t(i,n)})}}var wi=u(91558),j=u(28347),le=u(43703),w=u(26242),R=u(40345),yt=u(8859),A=u(75079);function Te(e,t,i,n){const a=e.graphic,o=(r,l)=>t({action:r,graphic:a,dxScreen:l.screenDeltaX,dyScreen:l.screenDeltaY});return i((r,l,h)=>(l.next(c=>("start"===c.action&&o("start",c),c)).next((0,A.a9)(a,n)).next(c=>{switch(c.action){case"start":case"update":(c.translationX||c.translationY||c.translationZ)&&o("update",c);break;case"end":o("end",c)}return c}),{steps:l,cancel:h=h.next((0,A.bD)(a)).next(c=>(o("end",{screenDeltaX:0,screenDeltaY:0}),c))}))}function Ai(e){if((0,s.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],n=t[1];return Math.atan2(n[1]-i[1],n[0]-i[0])}function De(e){if((0,s.Wi)(e)||(0,s.Wi)(e.axis))return 1;const{mapStart:t,mapEnd:i,axis:n}=e,a=[i.x-t.x,i.y-t.y];return a[0]*n[0]+a[1]*n[1]>0?1:-1}var ke=u(42743),st=u(57521),$e=u(92972),x=u(33786);class Ia extends ve{constructor(t){super(),this._handles=new re.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new wt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t}destroy(){this._handles=(0,s.SC)(this._handles),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:i}of this._arrowManipulatorInfos)t(i,I.TRANSLATE_XY)}createGraphicDragPipeline(t,i,n){const a=i.graphic,o=(0,V.RL)(a),r=(0,s.Wg)(a.geometry).spatialReference;return Te(i,n,l=>this.createDragPipeline((h,c,g,m,v)=>(({steps:c,cancel:g}=t(h,c,g,m,v)),l(h,c,g)),o,r,a),this._view.state.viewingMode)}createDragPipeline(t,i,n,a){return(0,T.AL)(this._arrowManipulatorInfos.map(({manipulator:o},r)=>(0,A.Xd)(o,(l,h,c,g,m)=>{const v=h.next(S=>H(W({},S),{manipulatorType:I.TRANSLATE_XY})).next((0,A.kY)(this._view,l.elevationAlignedLocation)).next((0,yt.G)(this._view,l.elevationAlignedLocation,i,n,a)).next((0,A.M2)(l.location,this.angle+(r+1)*Math.PI*.5)).next((0,A.zh)());t(l,v,c,g,m)})))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:i},n){const a=this._radius/70,o=54*a,r=o*Math.sqrt(3)/2,l=(0,st.DA)(this._opaqueMaterial,r,o/2,o/2,.02);(0,st.mx)(l,(0,j.f)(w.MP.get(),(0,f.s)(w.WM.get(),0,-r/3,0))),t.renderObjects=[new R.r(l,x.Q9.Focused),new R.r(l.instantiate({material:this._transparentMaterial}),x.Q9.Unfocused)],t.radius=r/3*2*1.2;const h=(0,j.b)(w.MP.get(),n*Math.PI/2),c=(0,j.f)(w.MP.get(),(0,f.s)(w.WM.get(),0,100*a,0));(0,j.m)(i,h,c)}_createManipulators(){for(let t=0;t<4;t++){const i=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(i)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,i=(0,j.d)(w.MP.get(),t,(0,G.f)(0,0,1));if((0,s.Wi)(i))return;const n=(0,j.E)(w.MP.get(),(0,f.s)(w.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,j.m)(w.MP.get(),n,i);for(const o of this._arrowManipulatorInfos){const r=(0,j.m)(w.MP.get(),a,o.transform);o.manipulator.modelTransform=r}}_createArrowManipulator(t){const i=new vt.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,G.f)(0,0,1)}}),n={manipulator:i,transform:(0,le.c)()};return this._updateArrowManipulator(n,t),this._handles.add(i.events.on("drag",a=>{this._updateAfterDrag&&"end"===a.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),n}_createMaterial(t=1){const i=wi.Z.toUnitRGBA(_.O9.main);return i[3]*=t,new $e.E({color:i,transparent:1!==t,cullFace:ke.Vr.Back,renderOccluded:St.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:t})=>t)}}}class La{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,s.pC)(this._lastDragEvent)&&(0,s.pC)(this._next)){const i=this._lastDragEvent.mapEnd,n=this._snap(this._lastDragEvent.screenEnd);(0,s.pC)(n)&&this._next.execute({action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===t?n:i,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd})}this._enabled=t}_snap(t){const i=(0,s.pC)(this._view)?this._view.toMap(t,{exclude:[]}):null;return(0,s.pC)(i)&&(0,s.pC)(this._view)&&(i.z=(0,V.Ou)(i,this._view,this._elevationInfo)),i}createDragEventPipelineStep(t,i){this._view=t,this._elevationInfo=i,this._lastDragEvent=null;const n=new A.hM;return this._next=n,[a=>{if(this._lastDragEvent="end"!==a.action?W({},a):null,this._enabled){const o=this._snap(a.screenEnd);return(0,s.pC)(o)?{action:a.action,mapStart:a.mapStart,mapEnd:o,screenStart:a.screenStart,screenEnd:a.screenEnd}:null}return{action:a.action,mapStart:a.mapStart,mapEnd:a.mapEnd,screenStart:a.screenStart,screenEnd:a.screenEnd}},n]}}class Va extends ve{constructor(t){super(),this._snapToScene=new La,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=70,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,I.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,i,n){const a=i.graphic,o=(0,V.RL)(a),r=(0,s.Wg)(a.geometry).spatialReference;return Te(i,n,l=>this.createDragPipeline((h,c,g,m,v)=>(({steps:c,cancel:g}=t(h,c,g,m,v)),l(h,c,g)),o,r,a),this._view.state.viewingMode)}createDragPipeline(t,i,n,a){const o=this._view;return(0,A.Xd)(this._manipulator,(r,l,h,c,g)=>{const m=l.next((0,A.kY)(o,r.elevationAlignedLocation)).next((0,yt.G)(o,r.elevationAlignedLocation,i,n,a)).next(...this._snapToScene.createDragEventPipelineStep(o,i)).next(v=>H(W({},v),{manipulatorType:I.TRANSLATE_XY})).next((0,A.zh)());t(r,m,h,c,g)})}_updateManipulatorTransform(){const t=(0,j.E)(w.MP.get(),(0,f.s)(w.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){this._manipulator=new vt.Z({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,G.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=(0,st.nb)(this._discMaterial,.02,1,128,(0,G.f)(0,0,1),(0,G.f)(0,0,0));t.transformation=(0,j.E)((0,le.c)(),(0,G.f)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new R.r(t,x.Q9.Focused),new R.r(t.instantiate({material:this._discMaterialTransparent}),x.Q9.Unfocused)],this._manipulator.radius=this._radius/70*80}_createMaterial(t=1){const i=wi.Z.toUnitRGBA(_.O9.main);return i[3]*=t,new $e.E({color:i,transparent:1!==t,cullFace:ke.Vr.Back,renderOccluded:St.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}var za=u(78260);class Xa extends ve{constructor(t){super(),this._radius=70,this.events=new wt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()})}forEachManipulator(t){t(this._manipulator,I.TRANSLATE_Z)}createGraphicDragPipeline(t,i,n){const a=(0,s.Wg)(i.graphic.geometry).spatialReference;return Te(i,n,o=>this.createDragPipeline((r,l,h,c,g)=>(({steps:l,cancel:h}=t(r,l,h,c,g)),o(r,l,h)),a),this._view.state.viewingMode)}createDragPipeline(t,i){const n=this._view;return(0,A.Xd)(this._manipulator,(a,o,r,l,h)=>{const c=o.next(g=>H(W({},g),{manipulatorType:I.TRANSLATE_Z})).next((0,yt.Sp)(n,a.renderLocation,i)).next((0,A.zh)());t(a,c,r,l,h)})}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._radius/70,i=_.Xd.zManipulator.height*t,n=_.Xd.zManipulator.coneHeight*t,a=_.Xd.zManipulator.coneWidth*t,o=_.Xd.zManipulator.width*t,r=[(0,G.f)(0,0,0),(0,G.f)(0,0,i)],l=[(0,G.f)(0,0,0),(0,G.f)(0,0,i+n)],c=(D=>{const Y=(0,le.c)();return(0,j.w)(Y,Y,[0,0,i]),(0,j.r)(Y,Y,Math.PI/2),Y})(),g=(D,Y)=>{const tt=(0,za._j)(_.Xd.zManipulator.color,Y);return[tt.r/255,tt.g/255,tt.b/255,_.Xd.zManipulator.color.a*D]},m=(0,N.EA)(g(1,.25),St.yD.Occlude),v=(0,N.EA)(g(1,0),St.yD.Occlude),S=(0,N.EA)(g(.7,0),_.Xd.zManipulator.renderOccluded),b=(0,N.EA)(g(.85,0),_.Xd.zManipulator.renderOccluded),M=(0,st.PD)(m,r,o/2,16,!1),E=(0,st.QL)(m,n,a/2,16,!1);E.transformation=c,this._manipulator.renderObjects=[new R.r(E,x.Q9.Unfocused),new R.r(M,x.Q9.Unfocused),new R.r(E.instantiate({material:v}),x.Q9.Focused),new R.r(M.instantiate({material:v}),x.Q9.Focused),new R.r(E.instantiate({material:S}),x.Q9.Unfocused),new R.r(M.instantiate({material:S}),x.Q9.Unfocused),new R.r(E.instantiate({material:b}),x.Q9.Focused),new R.r(M.instantiate({material:b}),x.Q9.Focused)],this._manipulator.radius=o/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){const t=new vt.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=i=>{const n=this._view.state.camera,a=Ti;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,a);const o=(0,f.j)(n.eye,a),r=n.computeRenderPixelSizeAtDist(o),l=(0,f.b)(he,a,n.eye);(0,f.n)(l,l);const h=Wa;this._view.renderCoordsHelper.worldUpAtPosition(Ti,h);const c=Math.abs((0,f.e)(l,h)),g=(0,f.f)(he,l,h),m=(0,f.f)(he,g,h),v=(0,_t.uZ)(c,.01,1),S=1-Math.sqrt(1-v*v)/v/n.fullWidth,M=_.Xd.zManipulator.width*(this._radius/70);(0,f.g)(m,(0,f.n)(m,m),(1/S-1)*o+r*M),i[12]-=he[0],i[13]-=he[1],i[14]-=he[2]},this._manipulator=t,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const Ti=(0,G.c)(),he=(0,G.c)(),Wa=(0,G.c)();class qt extends ve{constructor(t){super(),this._handles=new re.Z,this._interactive=!0;const{tool:i,view:n,snapToScene:a,radius:o}=t;this._view=n,this.xyManipulation=new Va({tool:i,view:n,snapToScene:a,radius:o}),this.xyAxisManipulation=new Ia({tool:i,view:n,radius:o}),this.zManipulation=new Xa({tool:i,view:n,radius:o}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(r=>this._handles.add(r.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,i,n){return(0,T.AL)([this.xyManipulation.createGraphicDragPipeline((a,o,r,l,h)=>t(C.XY,a,o,r,l,h),i,n),this.xyAxisManipulation.createGraphicDragPipeline((a,o,r,l,h)=>t(C.XY_AXIS,a,o,r,l,h),i,n),this.zManipulation.createGraphicDragPipeline((a,o,r,l,h)=>t(C.Z,a,o,r,l,h),i,n)])}createDragPipeline(t,i,n,a){return(0,T.AL)([this.xyManipulation.createDragPipeline((o,r,l,h,c)=>t(C.XY,o,r,l,h,c),i,n,a),this.xyAxisManipulation.createDragPipeline((o,r,l,h,c)=>t(C.XY_AXIS,o,r,l,h,c),i,n,a),this.zManipulation.createDragPipeline((o,r,l,h,c)=>t(C.Z,o,r,l,h,c),n)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator(i=>t(i,I.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(i=>t(i,I.TRANSLATE_XY)),this.zManipulation.forEachManipulator(i=>t(i,I.TRANSLATE_Z))}get _xyAxisVisible(){const t=this.xyManipulation.someManipulator(i=>i.focused)||this.xyAxisManipulation.someManipulator(i=>i.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,i=this.xyManipulation;if((0,O.Z)("esri-mobile"))return;const n=[];i.forEachManipulator(o=>n.push(o)),t.forEachManipulator(o=>n.push(o));const a=()=>{const o=[];this._xyAxisVisible||t.forEachManipulator(r=>o.push(r.disableDisplay())),this._handles.remove(Di),this._handles.add(o,Di)};for(const o of n)this._handles.add(o.events.on("focus-changed",a));this._view.inputManager&&this._handles.add((0,y.gx)(()=>{var o;return null==(o=this._view.inputManager)?void 0:o.latestPointerType},a)),a()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator(i=>{i.interactive=!t&&this._interactive||i.grabbing})}static radiusForSymbol(t){const i=(0,s.pC)(t)&&"point-3d"===t.type&&t.symbolLayers;return i&&i.length>0&&i.some(n=>"icon"===n.type)?fi:70}}const Di="disable-xy-axis-display";var C;!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(C||(C={}));var Ua=u(90585);class Ke extends ve{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,I.TRANSLATE_XY)}createGraphicDragPipeline(t){return Te(this._graphicState,t,i=>this.createDragPipeline(i),this._view.state.viewingMode)}createDragPipeline(t){const i=this._view,n=this._graphicState.graphic,a=(0,s.pC)(n.geometry)?n.geometry.spatialReference:null;return(0,A.Xd)(this._manipulator,(o,r,l,h,c)=>{const g=r.next((0,yt._y)(c,i,n,a)).next((0,A.AN)()).next((0,A.zh)());t(o,g,l,h,c)})}_createManipulator(){this._manipulator=new Ua.L({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})}}var Za=u(96064),Ge=u(22944),Re=u(26777),Yt=u(9997),Pe=u(9773),Ie=u(94009),ye=u(60358),at=u(31712),pe=u(71572);class Ya{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class Ha{constructor(t,i,n){this.dx=t,this.dy=i,this.allGraphics=n,this.type="graphic-move"}}class Gi{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}let Tt=class extends((0,_e.p)(wt.Z.EventedMixin(Ge.m))){constructor(e){super(e),this.graphics=new la.Z,this.enableZ=!0,this.tooltipOptions=new Yt.Z,this.type="move-3d",this._tooltip=null}initialize(){const{graphics:e,view:t}=this;this.addHandles([e.on("change",()=>this._refreshManipulators()),(0,y.YP)(()=>this.tooltipOptions.enabled,i=>{this._tooltip=i?new ye.u({view:t}):(0,s.SC)(this._tooltip)},y.tX)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,s.SC)(this._tooltip),this._moveManipulation=(0,s.SC)(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){var t;this.handles.removeAll(),null==(t=this._moveManipulation)||t.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter(i=>(0,Za.P)(i)===gi.e.SUPPORTED).map(i=>new Na(i));e.length&&(this._createManipulators(e),this._createVisualElements(e),this.handles.add(e.map(i=>this.view.trackGraphicState(i.state))),this._updateMoveManipulation(e))}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Ke({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator(n=>this.handles.add([n.events.on("immediate-click",a=>{this.emit("immediate-click",H(W({},a),{graphic:i.graphic})),a.stopPropagation()}),n.events.on("grab-changed",({action:a})=>{const{tooltipOptions:o,_tooltip:r}=this;(0,s.Wi)(r)||("start"===a?r.info=new at.$E({tooltipOptions:o}):r.clear())})])),this.handles.add(t.manipulationXY.createDragPipeline((n,a,o,r)=>this._buildDragEventPipeline(e,C.XY,n,a,o,r)))}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new qt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?qt.radiusForSymbol(e[0].graphic.symbol):70});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(o=>{this.handles.add(o.events.on("immediate-click",r=>{t.zManipulation.hasManipulator(o)||1!==this.graphics.length||this.emit("immediate-click",H(W({},r),{graphic:this.graphics.getItemAt(0)})),r.stopPropagation()}))});const i=o=>r=>{this.handles.add(r.events.on("focus-changed",({action:l})=>{const h=this._tooltip;(0,s.Wi)(h)||("focus"===l?this._updateMoveTooltip(e,o):h.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(i(C.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(C.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(C.Z));const n=()=>this._updateMoveManipulation(e);for(const o of e)this.handles.add([o.state.on("changed",n),(0,y.YP)(()=>o.state.displaying,n)]);const a=e[e.length-1];this.handles.add(a.state.on("changed",()=>this._updateMoveManipulationAngle(a))),this.handles.add(t.createDragPipeline((o,r,l,h,c)=>this._buildDragEventPipeline(e,o,r,l,h,c),(0,V.RL)(a.graphic),(0,s.Wg)(a.graphic.geometry).spatialReference,a.graphic)),this._updateMoveManipulationAngle(a)}_createVisualElements(e){for(const t of e){const n=Ae({view:this.view,graphic:t.graphic,forEachManipulator:a=>{var o;null==(o=t.manipulationXY)||o.forEachManipulator(a),this._moveManipulation.forEachManipulator(a)},onManipulatorsChanged:()=>(0,T.kB)()});(0,s.Wi)(n)||(t.geometryRepresentation=n.visualElement,t.geometryRepresentation instanceof Qt&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this._updateMoveManipulation(e)}),(0,y.YP)(()=>t.state.isDraped,()=>this._updateMoveManipulation(e))]),this.handles.add(n))}}_updateMoveManipulationAngle(e){this._moveManipulation.angle=Ai(e.graphic.geometry)}_updateMoveManipulation(e){const t=(0,me.Tx)(0,0,0,this.view.spatialReference);let i=0,n=!1;const a=this._moveManipulation;for(const l of e){if(!l.state.displaying)continue;const h=l.state.graphic;this.enableZ&&(0,kt.c)(h)&&(n=!0);const c=l.geometryRepresentation instanceof Qt&&!l.state.isDraped?l.geometryRepresentation.attachmentOrigin:(0,N.du)(this.view,h);if((0,s.pC)(c)){const{x:g,y:m,z:v}=c;t.x+=g,t.y+=m,v&&(null!=t.z||(t.z=0),t.z+=v),i++}}i>0?(t.x/=i,t.y/=i,null!=t.z||(t.z=0),t.z/=i,a.location=t,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=n):a.available=!1}_buildDragEventPipeline(e,t,i,n,a,o){const r=[],l=[];let h=null,c=null;const g=()=>{for(const m of r)m.dragging=!1;r.length=0,l.length=0,h=null,c=null,this._moveManipulation.interactive=!0};if(1===e.length&&t===C.XY){const m=e[0].graphic;({steps:n,cancel:a}=this._buildSnappingPipelineSteps(m,(0,V.RL)(m),n,a,o))}return a=a.next(m=>null==c?void 0:c(m)).next(()=>(this.emit("graphic-move-stop",new Gi(l)),this.destroyed||g(),null)),{steps:n=n.next(m=>{var v,S;if("start"===m.action){r.length=0,l.length=0;for(const b of e)b.dragging||(null==(v=b.manipulationXY)||!v.hasManipulator(i))&&(null==(S=b.manipulationXY)?void 0:S.grabbing)||(r.push(b),l.push(b.graphic),b.dragging=!0);if(0!==l.length&&(this._moveManipulation.interactive=!1,h=(0,A.oq)(l,this.view.state.viewingMode),c=(0,A.QY)(l),this.emit("graphic-move-start",new Ya(l)),this.destroyed))return null}return 0!==l.length?m:null}).next(m=>null==h?void 0:h(m)).next(m=>(this._updateMoveTooltip(e,t,m),m)).next(m=>{switch(m.action){case"start":case"update":if(m.translationX||m.translationY||m.translationZ){const v=this.view.toScreen(m.mapStart),S=this.view.toScreen(m.mapEnd);if(this.emit("graphic-move",new Ha(S.x-v.x,S.y-v.y,l)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Gi(l)),this.destroyed)return null;g()}return null}),cancel:a}}_updateMoveTooltip(e,t,i){const{tooltipOptions:n,_tooltip:a}=this;if((0,s.Wi)(a))return;a.clear();const o=0===e.length?"absolute-height":e[0].state.isDraped?"on-the-ground":"absolute-height";switch(t){case C.XY:a.info=new at.$E({tooltipOptions:n}),this._updateMoveTooltipDistance(a.info,i,(r,l)=>(0,ot.GQ)(r,l,o));break;case C.XY_AXIS:a.info=new at.in({tooltipOptions:n}),this._updateMoveTooltipDistance(a.info,i,(r,l)=>{const h=(0,ot.GQ)(r,l,o);return(0,$.bA)(h,De(i))});break;case C.Z:a.info=new at.QW({tooltipOptions:n}),this._updateMoveTooltipDistance(a.info,i,pe._e)}}_updateMoveTooltipDistance(e,t,i){if((0,s.pC)(t)&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,o=i(n,a);e.distance=(0,s.pC)(o)?o:$.yP}}_buildSnappingPipelineSteps(e,t,i,n,a){const o=e.geometry;if((0,s.Wi)(o)||"point"!==o.type&&"mesh"!==o.type)return{steps:i,cancel:n};const r=("point"===o.type?o:o.anchor).clone(),l=new Pe.N({elevationInfo:t,pointer:a,editGeometryOperations:Re.c.fromGeometry(r,this.view.state.viewingMode),visualizer:new ge._,excludeFeature:e}),h=this.snappingManager,{snappingStep:c,cancelSnapping:g}=(0,Ie.W)({snappingContext:l,snappingManager:h,updatingHandles:this.updatingHandles});return n=n.next(g),{steps:i=i.next(m=>(r.z=(0,V.vQ)(this.view,r,(0,V.RL)(e),{mode:"absolute-height",offset:0}),H(W({},m),{snapOrigin:l.coordinateHelper.pointToVector(r)}))).next(...c),cancel:n}}get test(){return{tooltip:this._tooltip}}};(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Tt.prototype,"view",void 0),(0,p._)([(0,d.Cb)()],Tt.prototype,"graphics",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Tt.prototype,"enableZ",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Yt.Z})],Tt.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Tt.prototype,"snappingManager",void 0),(0,p._)([(0,d.Cb)()],Tt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Tt.prototype,"updating",null),Tt=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Tt);class Na{constructor(t){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new pt({graphic:t})}get graphic(){return this.state.graphic}}var Ri=u(89557),Le=(u(29132),u(16730)),Ba=u(55214),ct=u(90014),Pi=u(86606),qe=u(86190);function Ii(e,t,i){return new qe.A(e,"on-the-ground"===i.mode?qe.v.XY:qe.v.XYZ,t,0)}function Li(e,t,i){const n=(0,G.c)();if(!e.renderCoordsHelper.toRenderCoords(t,n))return null;const a=Vi(e,t,(0,ct.mJ)(i.plane)),o=Vi(e,t,i.edgeDirection);if((0,s.Wi)(a)||(0,s.Wi)(o))return null;const r=(0,f.f)((0,G.c)(),a,o);return(0,ct.Yq)(n,r,(0,ct.Ue)())}function Vi(e,t,i){const n=(0,me.Tx)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),a=(0,G.c)(),o=(0,G.c)();return e.renderCoordsHelper.toRenderCoords(t,a)&&e.renderCoordsHelper.toRenderCoords(n,o)?(0,f.r)(o,a,o):null}var zi=u(85112),Lt=u(96926),Ve=u(62980);let Ht=class extends Ve.h{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=$.yP,this.area=null,this.totalLength=null}};(0,p._)([(0,d.Cb)()],Ht.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Ht.prototype,"distance",void 0),(0,p._)([(0,d.Cb)()],Ht.prototype,"area",void 0),(0,p._)([(0,d.Cb)()],Ht.prototype,"totalLength",void 0),Ht=(0,p._)([(0,z.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],Ht);var Qa=u(30174),Ja=u(63656),ka=u(65234);let Q=class extends(wt.Z.EventedMixin(_e.r)){constructor(e){super(e),this._vertexManipulatorMaterial=(0,N.EA)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.vertex.color),_.Xd.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,N.qJ)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.vertex.outlineColor),_.Xd.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,N.qJ)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.vertex.hoverOutlineColor),_.Xd.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,N.EA)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.edge.color),_.Xd.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,N.qJ)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.edge.outlineColor),_.Xd.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=(0,N.EA)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.edgeOffset.color),_.Xd.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,N.EA)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.edgeOffset.hoverColor),_.Xd.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=(0,N.EA)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.selected.color),_.Xd.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,N.qJ)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.selected.outlineColor),_.Xd.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,N.qJ)(_.Xd.colorToVec4(_.Xd.reshapeManipulators.selected.hoverOutlineColor),_.Xd.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._manipulatorHandles=new re.Z,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=U.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new pt({graphic:e});this._tooltip=new ye.u({view:t}),this.addHandles([(0,y.YP)(()=>i.displaying,n=>{for(const a of this._manipulatorInfos)a.manipulator.available=n}),(0,y.YP)(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:n,enabled:a,edgeOffsetEnabled:o})=>{(0,s.pC)(n)&&(n.visible=a,n.edgeDistance=o?"far":"default")},y.nn),(0,y.gx)(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),y.nn),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=(0,s.SC)(this._segmentLabels),this._tooltip=(0,s.SC)(this._tooltip),this._removeManipulators()}get inputGeometry(){return(0,s.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter(t=>t.manipulator.selected&&"vertex"===t.type);this._removeVertices(e)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,s.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,s.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if((0,s.Wi)(this._editGeometryOperations))return;const t=(0,V.RL)(this.graphic);for(const i of this._editGeometryOperations.data.components){const n=null==e?void 0:e.byComponentIndex.get(i.index);for(const a of i.vertices){const o=null==n?void 0:n.has(a.index);this._createVertexOrEdgeManipulator(a,t,o)}for(const a of i.edges)this._createVertexOrEdgeManipulator(a,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return(0,s.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return(0,s.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if((0,s.Wi)(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return(0,s.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if((0,s.Wi)(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return(0,s.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(e){const t={byComponentIndex:new Map};if((0,s.pC)(e)&&(0,s.pC)(this.inputGeometry)&&(0,ie.Pt)(e,this.inputGeometry))for(const i of this._manipulatorInfos)if("vertex"===i.type&&i.manipulator.selected){const{index:n,component:{index:a}}=i.handle,{byComponentIndex:o}=t,r=o.get(a)||new Set;r.add(n),o.set(a,r)}this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=(0,s.SC)(this._editGeometryOperations),this._segmentLabels=(0,s.SC)(this._segmentLabels),(0,s.Wi)(e)||(this._editGeometryOperations=Re.c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(t),this._segmentLabels=new Ee({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,V.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled})),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const n=[],a=this._manipulatorInfos.some(r=>"vertex"===r.type&&r.manipulator.selected),o=e===ce.SELECTED_OR_ALL&&a;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.grabbing||o&&!r.manipulator.selected||n.push(r),i++);if(0===n.length)return t;if(this._moveVertices(n,t),n.length===i){if(this._updateEventState(U.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(U.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e,0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(U.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:n}=e;if(!t&&!i&&!n)return;const a=[];for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected&&!o.manipulator.grabbing||o===e.info)&&a.push(o);this._moveVertices(a,e,Lt.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case U.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case U.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case U.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case U.MOVING:switch(this._reshapeEventState){case U.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case U.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case U.RESHAPING:switch(this._reshapeEventState){case U.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case U.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this;if(this._graphicMoveManipulation=new Ke({tool:e,view:t,graphicState:this._graphicState}),this.enableMoveGraphic){let n=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((a,o,r)=>{o.next(l=>this._trackNumDragging(l)).next(l=>("start"===l.action&&(n=(0,s.Wg)(this._editGeometryOperations).createUndoGroup()),l)).next(l=>this._perGraphicManipulatorDragAction(ce.ALL,l)).next(l=>(this._updateTranslateGraphicTooltip(C.XY,l),l)).next(l=>{"end"===l.action&&(this._tooltip.clear(),n=(0,s.hw)(n))}),r.next(()=>this._onDragCancel(!0,()=>n=(0,s.hw)(n)))})),this._graphicMoveManipulation.forEachManipulator(a=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!1)))}else this._graphicMoveManipulation.forEachManipulator(n=>{n.grabbable=!1,n.cursor=null});this._graphicMoveManipulation.forEachManipulator(n=>this._manipulatorHandles.add(n.events.on("immediate-click",a=>{this._manipulatorInfos.some(o=>o.manipulator.selected)?this._clearSelection():this.emit("immediate-click",H(W({},a),{graphic:this.graphic})),a.stopPropagation()})))}_createMoveManipulation(e){const{graphic:t,handles:i,tool:n,view:a}=this,o=this._graphicState;this._moveManipulation=new qt({tool:n,view:a,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&(0,kt.c)(t),snapToScene:!1,radius:qt.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator(h=>i.add([h.events.on("immediate-click",c=>{this._moveManipulation.zManipulation.hasManipulator(h)||this._manipulatorInfos.some(g=>g.manipulator.selected)||this.emit("immediate-click",H(W({},c),{graphic:t})),c.stopPropagation()}),this._watchAndUpdateGrabState(h,!1)]));const r=h=>c=>{i.add(c.events.on("focus-changed",({action:g})=>{"focus"===g&&this._tooltipOptions.enabled?this._updateTranslateTooltip(h):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(r(C.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(C.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(C.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const l=(0,s.Wg)(t.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline((h,c,g,m,v)=>{const{snappingStep:S,cancelSnapping:b}=(0,Ie.W)({predicate:M=>!!M.info,snappingManager:n.snappingManager,snappingContext:new Pe.N({editGeometryOperations:(0,s.Wg)(this._editGeometryOperations),elevationInfo:e,pointer:v,excludeFeature:t,visualizer:new ge._}),updatingHandles:this.updatingHandles,useZ:!1});return m=m.next(M=>(this._onDragCancel(),M)).next(b),{steps:g=g.next(M=>this._trackNumDragging(M)).next(M=>{const E=this._manipulatorInfos.filter(D=>"vertex"===D.type&&D.manipulator.selected);return M.manipulatorType===I.TRANSLATE_XY&&1===E.length?H(W({},M),{info:E[0],snapOrigin:E[0].handle.pos}):M}).next((0,A.BS)(this.view,e,t)).next(...S).next((0,A.AN)()).next(M=>this._perGraphicManipulatorDragAction(ce.SELECTED_OR_ALL,M)).next(M=>(this._updateTranslateTooltip(h,M),M)),cancel:m}},e,l,t),(0,y.YP)(()=>o.displaying,()=>this._updateMoveManipulationPosition(),y.nn),o.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),(0,y.YP)(()=>o.isDraped,h=>{this._updateMoveManipulationPosition();const c="align-move-manipulation";h?i.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),c):i.remove(c)},y.nn)])}_createVisualElements(){const{graphic:e,view:t}=this,i=Ae({view:t,graphic:e,forEachManipulator:n=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(n),this._moveManipulation.forEachManipulator(n);for(const a of this._manipulatorInfos)n(a.manipulator,I.TRANSLATE_XY)}},onManipulatorsChanged:n=>this.on("manipulators-changed",n)});(0,s.pC)(i)&&(this._outlineVisualElement=i.visualElement instanceof Qt?i.visualElement:null),(0,s.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=(0,V.RL)(this.graphic)){var S,b;const i=_.Xd.reshapeManipulators.edgeOffset,n=i.size/2,a=n+i.collisionPadding,o=n/a,r=o*Math.sqrt(3)/2;(0,s.Wi)(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=(0,st.DA)(this._edgeOffsetManipulatorMaterial,r,o/2,o/2,i.height,i.offset)),(0,s.Wi)(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=(0,st.DA)(this._edgeOffsetManipulatorMaterial,-r,o/2,o/2,i.height,-i.offset));const l=[new R.r(this._edgeOffsetManipulatorGeometryInside.instantiate(),x.Q9.Unfocused),new R.r(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),x.Q9.Focused),new R.r(this._edgeOffsetManipulatorGeometryOutside.instantiate(),x.Q9.Unfocused),new R.r(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),x.Q9.Focused)],h=new vt.Z({view:this.view,renderObjects:l,elevationInfo:"on-the-ground"!==t.mode||(0,Pi.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:a,available:!(!this.graphic.visible||null==(S=this.graphic.layer)||!S.visible),collisionType:{type:"disc",direction:(0,G.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),c=new vt.Z({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||null==(b=this.graphic.layer)||!b.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),g={manipulator:h,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:c,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(g,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(g);const m=[];for(const M of[g.handle.leftVertex,g.handle.rightVertex]){const E=this._getManipulatorInfoFromHandle(M);(0,s.pC)(E)&&m.push(E.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(g)))}g.locationUpdateHandle=(0,T.AL)(m),this._manipulatorHandles.add(g.locationUpdateHandle,h),this._manipulatorHandles.add([this._watchAndUpdateGrabState(h,!0),this._watchAndUpdateGrabState(c,!0)],h),this._manipulatorHandles.add((0,A.Xd)(h,this._createEdgeOffsetPipeline(g,t)),h),this._manipulatorHandles.add((0,A.Xd)(c,(M,E,D,Y)=>{if("touch"===Y)this._createEdgeOffsetPipeline(g,t)(M,E,D);else if(this.enableMoveGraphic){const tt=this.graphic,te=(0,s.pC)(tt.geometry)?tt.geometry.spatialReference:null;E.next(dt=>this._trackNumDragging(dt)).next((0,A.kY)(this.view,M.elevationAlignedLocation)).next((0,yt.G)(this.view,M.elevationAlignedLocation,t,te,tt)).next((0,A.zh)()).next((0,A.AN)()).next(dt=>this._perGraphicManipulatorDragAction(ce.ALL,dt)).next(dt=>(this._updateTranslateGraphicTooltip(C.XY,dt),dt)).next(dt=>{"end"===dt.action&&this._tooltip.clear()}),D.next(()=>this._onDragCancel(!M.metadata.deleting))}}),h);const v=M=>{this._manipulatorInfos.some(E=>E.manipulator.selected)?this._clearSelection():this.emit("immediate-click",H(W({},M),{graphic:this.graphic})),M.stopPropagation()};return this._manipulatorHandles.add([h.events.on("immediate-click",v),c.events.on("immediate-click",v),h.events.on("focus-changed",({action:M})=>{const E=this._tooltipOptions;if("focus"===M&&E.enabled){const D=this._tooltip.info=new Ht({tooltipOptions:E});this._updateTooltipAreaOrTotalLength(D)}else this._tooltip.clear()})],h),this._manipulatorInfos.push(g),this.manipulators.add(h),this.manipulators.add(c),this.emit("manipulators-changed"),g}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,n=e.edgeManipulator,a=()=>{e.visibilityHandle=(0,s.hw)(e.visibilityHandle);const o=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=(0,s.pC)(o)&&(0,s.pC)(r)&&function ja(e,t,i){const n=i.projectToRenderScreen(e,(0,Pt.J$)()),a=i.projectToRenderScreen(t,(0,Pt.J$)());return(0,s.pC)(n)&&(0,s.pC)(a)?(0,f.p)((0,f.b)(n,n,a)):0}(o.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!n.focused||l)&&(i.grabbable=!l,n.grabbable=!l,e.visibilityHandle=(0,T.AL)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,n.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",a),n.events.on("focus-changed",a),{remove:()=>{(0,s.hw)(e.visibilityHandle),n.metadata.deleting=!0,this.manipulators.remove(n)}}],i),a()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=(0,s.Wg)(this._editGeometryOperations).data,i=Li(this.view,e.manipulator.elevationAlignedLocation,Ii(t,e.handle,(0,s.Wg)(e.manipulator.elevationInfo))),n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if((0,s.Wi)(n)||(0,s.Wi)(a))return;const o=n.manipulator.renderLocation,r=a.manipulator.renderLocation,l=(0,s.pC)(i)?function Fa(e,t,i){const n=(0,ct.mJ)(e),a=(0,f.r)((0,G.c)(),t,i),o=(0,f.f)((0,G.c)(),a,n),r=(0,f.f)((0,G.c)(),a,o);return(0,le.f)(a[0],a[1],a[2],0,o[0],o[1],o[2],0,r[0],r[1],r[2],0,0,0,0,1)}(i,o,r):le.I;e.manipulator.modelTransform=l,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=l;const h=(0,f.l)((0,f.b)(ze,o,r))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-h,0,0],[h,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,n,a)=>{this._clearSelection();const{step:o,cleanup:r}=this._initializeEdgeOffset(e,t);n.next(l=>this._trackNumDragging(l)).next((0,A.kY)(this.view,i.elevationAlignedLocation)).next(o).next((0,yt.bB)(this.view)).next((0,yt.zP)(this.view,(0,s.Wg)(this._editGeometryOperations).data.spatialReference)).next((0,A.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next(l=>{"end"===l.action&&r()}),a.next(()=>{i.metadata.deleting||(r(),this._onDragCancel())})}}_initializeEdgeOffset(e,t){const i=(0,s.Wg)(this._editGeometryOperations),n=Ii(i.data.coordinateHelper,e.handle,t),a=i.createUndoGroup(),o=Li(this.view,e.manipulator.elevationAlignedLocation,n);if(n.requiresSplitEdgeLeft){const m=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);(0,s.pC)(m)&&this._splitEdgeManipulator(m,1)}if(n.requiresSplitEdgeRight){const m=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);(0,s.pC)(m)&&this._splitEdgeManipulator(m,0)}const r=()=>new Ba.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),l=new Qt({view:this.view,isDraped:this._graphicState.isDraped,geometry:r(),elevationInfo:e.elevationInfo,width:_.Xd.visualElements.lineGraphics.outline.width,color:_.Xd.colorToVec4(_.O9.main),attached:!0});let h;const c=()=>{this._cleanEdgeOffsetCollapsedEdges(e),h=(0,s.hw)(h)},g=this.on("undo",c);return h=(0,T.AL)([(0,T.ed)(l),(0,y.YP)(()=>this._graphicState.isDraped,m=>l.isDraped=m),this._graphicState.on("changed",()=>l.geometry=r()),a,g]),{step:m=>(0,s.Wi)(n)||(0,s.Wi)(o)?(c(),null):H(W({},m),{operation:n,plane:o}),cleanup:c}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||(0,s.Wi)(t.operation))return t;this._updateEventState(U.RESHAPING);const{mapDeltaX:i,mapDeltaY:n,mapDeltaZ:a}=t;return(i||n||a)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return(0,s.Wi)(t)||(0,s.Wi)(i)?e:("start"===e.action&&t.selectArrowFromStartPoint(i),H(W({},e),{signedDistance:t.signedDistanceToPoint(i)}))}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:n}=e,a=this._tooltip,o=this._tooltipOptions;if(!o.enabled||(0,s.Wi)(i))return a.clear(),e;let r=a.info;((0,s.Wi)(r)||"reshape-edge-offset"!==r.type)&&(r=a.info=new Ht({tooltipOptions:o}));const{coordinateHelper:l}=(0,s.Wg)(this._editGeometryOperations).data;return r.distance="end"===e.action?$.yP:function $a(e,t,i,n,a){if(e){const o=a.toXYZ(a.pointToVector(i)),r=(0,ct.nF)(n,o,w.WM.get()),l=(0,Ja.FB)(r,o,a.spatialReference);if((0,s.pC)(l))return(0,$.yG)(l.value*Math.sign(t),l.unit)}return(0,$.yG)(t*(0,Le.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*n.selectedArrow,t,n.plane,l),this._updateTooltipAreaOrTotalLength(r),e}}_cleanEdgeOffsetCollapsedEdges(e){var l,h;const t=null==(l=e.handle.leftVertex.leftEdge)?void 0:l.leftVertex,i=e.handle.leftVertex,n=null==(h=e.handle.rightVertex.rightEdge)?void 0:h.rightVertex,a=e.handle.rightVertex,o=(0,s.Wg)(this._editGeometryOperations).data.coordinateHelper,r=[];if(t&&o.distance(t.pos,i.pos)<ti){const c=this._getManipulatorInfoFromHandle(i);(0,s.pC)(c)&&r.push(c)}if(o.distance(i.pos,a.pos)<ti||n&&o.distance(n.pos,a.pos)<ti){const c=this._getManipulatorInfoFromHandle(a);(0,s.pC)(c)&&r.push(c)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=(0,V.RL)(this.graphic),i=!1){var l;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if((0,s.Wi)(this._vertexManipulatorGeometry)||(0,s.Wi)(this._vertexManipulatorOutlineGeometry)){const{size:h,outlineSize:c}=this._computeVertexManipulatorSizeAndOutline(_.Xd.reshapeManipulators.vertex);this._vertexManipulatorGeometry=(0,st.PI)(this._vertexManipulatorMaterial,h,16,16),this._vertexManipulatorOutlineGeometry=(0,st.PI)(this._vertexManipulatorOutlineMaterial,c,16,16)}if((0,s.Wi)(this._edgeManipulatorGeometry)||(0,s.Wi)(this._edgeManipulatorOutlineGeometry)){const{size:h,outlineSize:c}=this._computeVertexManipulatorSizeAndOutline(_.Xd.reshapeManipulators.edge);this._edgeManipulatorGeometry=(0,st.PI)(this._edgeManipulatorMaterial,h,16,16),this._edgeManipulatorOutlineGeometry=(0,st.PI)(this._edgeManipulatorOutlineMaterial,c,16,16)}const n=(0,s.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[new R.r(this._vertexManipulatorGeometry.instantiate(),Ct.Vertex|x.Q9.Unselected),new R.r(this._vertexManipulatorOutlineGeometry.instantiate(),Ct.Vertex|x.Q9.Unfocused|x.Q9.Unselected),new R.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Ct.Vertex|x.Q9.Focused|x.Q9.Unselected),new R.r(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),x.Q9.Selected),new R.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),x.Q9.Selected|x.Q9.Unfocused),new R.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),x.Q9.Selected|x.Q9.Focused)];this.enableMidpoints&&n.push(new R.r(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),Ct.Edge|x.Q9.Focused|x.Q9.Unselected),new R.r(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Ct.Edge|x.Q9.Focused|x.Q9.Unselected),new R.r(this._edgeManipulatorGeometry.instantiate(),Ct.Edge|x.Q9.Unfocused|x.Q9.Unselected),new R.r(this._edgeManipulatorOutlineGeometry.instantiate(),Ct.Edge|x.Q9.Unfocused|x.Q9.Unselected));const a=new vt.Z({view:this.view,renderObjects:n,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||null==(l=this.graphic.layer)||!l.visible),metadata:{deleting:!1}});a.selected=i,this._setTypeSpecificManipulatorSettings(a,e,t);const o="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(o),this.manipulators.add(a),this._updateManipulatorPosition(o),"edge"===o.type){const h=[];for(const c of[o.handle.leftVertex,o.handle.rightVertex]){const g=this._getManipulatorInfoFromHandle(c);(0,s.pC)(g)&&h.push(g.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(o)))}o.locationUpdateHandle=(0,T.AL)(h),this._manipulatorHandles.add(o.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const r=(0,A.Xd)(a,(h,c,g,m)=>{let v=null;const{snappingStep:S,cancelSnapping:b}=(0,Ie.W)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Pe.N({editGeometryOperations:(0,s.Wg)(this._editGeometryOperations),elevationInfo:t,pointer:m,excludeFeature:this.graphic,visualizer:new ge._}),updatingHandles:this.updatingHandles,useZ:!1});g=g.next(M=>(this._onDragCancel(!h.metadata.deleting,()=>v=(0,s.hw)(v)),M)).next(b),c.next(M=>this._trackNumDragging(M)).next(M=>{if("start"===M.action&&(v=(0,s.Wg)(this._editGeometryOperations).createUndoGroup()),"edge"===o.type){const E=this._splitEdgeManipulator(o);return H(W({},M),{info:E,snapOrigin:E.handle.pos})}return H(W({},M),{info:o,snapOrigin:o.handle.pos})}).next((0,A.kY)(this.view,h.elevationAlignedLocation)).next((0,yt.VG)(this.view,this.graphic,h.elevationAlignedLocation,h.location.spatialReference,this.graphic)).next((0,A.BS)(this.view,t,this.graphic)).next(...S).next((0,A.AN)()).next(M=>{this._perVertexManipulatorDragAction(M),"end"===M.action&&(v=(0,s.hw)(v)),this._updateTranslateVertexTooltip(h,C.XY,M)})});return this._manipulatorHandles.add([r,a.events.on("immediate-click",h=>this._manipulatorClickCallback(h,o)),a.events.on("select-changed",()=>{o.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),a.events.on("focus-changed",({action:h})=>{"focus"===h&&"edge"!==o.type?this._updateTranslateVertexTooltip(a,C.XY):this._tooltip.clear()})],a),this.emit("manipulators-changed"),o}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=(0,s.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),(0,s.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case U.NONE:break;case U.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case U.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(U.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Ct.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=_.Xd.reshapeManipulators.vertex.size/2+_.Xd.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=(0,s.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=Ct.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=_.Xd.reshapeManipulators.edge.size/2+_.Xd.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||(0,Pi.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>this._onGrabStateChanged(e,t,i.action,i.pointerType))}_onGrabStateChanged(e,t,i,n="mouse"){if(!this._recreatingManipulators){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(U.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==n||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(a=>{a.manipulator.interactive=a.manipulator.grabbing||!this._numGrabbing&&(0,s.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in a&&(a.edgeManipulator.interactive=a.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(a=>{a.interactive=a.grabbing||!this._numGrabbing}))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){(0,s.Wi)(e)||(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,Mt.e$)(this._manipulatorInfos,e),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if((0,s.Wi)(e))return;const t=(0,s.Wg)(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,fe),e.manipulator.grabbing&&(0,s.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),n=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if((0,s.Wi)(i)||(0,s.Wi)(n))return;const a=i.manipulator,o=n.manipulator;if((0,s.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const r=a.location,l=o.location,h=.5;e.manipulator.location=(0,me.Tx)(r.x+h*(l.x-r.x),r.y+h*(l.y-r.y),r.hasZ&&l.hasZ?0:void 0,t.data.spatialReference)}else(0,f.h)(ze,a.renderLocation,o.renderLocation,.5),e.manipulator.renderLocation=ze}}_splitEdgeManipulator(e,t=.5){const i=(0,s.Wg)(this._editGeometryOperations),n=(0,s.Wg)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle=(0,s.hw)(e.locationUpdateHandle);const a=(0,V.RL)(this.graphic);let o;this.enableEdgeOffset?(this._removeManipulator(e),o=this._createVertexOrEdgeManipulator(n)):(o=e,o.handle=n,o.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,a)),n.leftEdge&&this._createVertexOrEdgeManipulator(n.leftEdge),n.rightEdge&&this._createVertexOrEdgeManipulator(n.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(o),this.enableEdgeOffset||this._updateTranslateVertexTooltip(o.manipulator,C.XY),this._updateSelection(e.manipulator);const r=this._updateEventState(U.RESHAPING),l=i.data.coordinateHelper.vectorToArray(o.handle.pos),h=i.data.components.indexOf(n.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:h,vertexIndex:(0,s.Wg)(n.index)}],added:l}),r&&this._updateEventState(U.NONE),o}_updateMoveManipulationPosition(){const e=(0,f.s)(ze,0,0,0);let t=0,i=!1,n=null,a=null;for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected?(t++,(0,f.a)(e,e,o.manipulator.renderLocation),(0,s.Wi)(n)||o.selectedIndex>n.selectedIndex?(a=n,n=o):((0,s.Wi)(a)||o.selectedIndex>a.selectedIndex)&&(a=o)):i=!0);if(0===t){const o=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=o,this._moveManipulation.xyAxisManipulation.available=o,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=o,this._moveManipulation.zManipulation.available=o&&this.enableZShape&&(0,kt.c)(this.graphic),this._moveManipulation.angle=Ai((0,s.Wg)(this.graphic.geometry)),this._moveManipulation.radius=qt.radiusForSymbol(this.graphic.symbol)}else{const o=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=o,this._moveManipulation.xyAxisManipulation.available=o,this._moveManipulation.zManipulation.available=o&&this.enableZVertex&&(0,kt.c)(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=o&&1!==t;let r=0;if((0,s.pC)(n)){const l=n.handle.pos,h=(0,s.pC)(a)?a.handle.pos:n.handle.leftEdge&&n.handle.leftEdge.leftVertex?n.handle.leftEdge.leftVertex.pos:null,c=(0,s.Wi)(a)&&n.handle.rightEdge&&n.handle.rightEdge.rightVertex?n.handle.rightEdge.rightVertex.pos:null;h&&c?this._moveManipulation.xyAxisManipulation.available=!1:h?r=Xi(h,l):c&&(r=Xi(l,c))}this._moveManipulation.angle=r,this._moveManipulation.radius=fi}0!==t&&i?((0,f.g)(e,e,1/t),fe.spatialReference=(0,s.Wg)(this._editGeometryOperations).data.spatialReference,fe.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,fe),this._moveManipulation.elevationAlignedLocation=fe):(0,s.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,s.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,N.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){var n;const t=new Array,i=(0,s.Wg)(this._editGeometryOperations);for(const a of e)if("vertex"===a.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const o=i.removeVertices([a.handle]),r=(0,s.Wg)(null==(n=o.removedVertices)?void 0:n[0].createdEdge);r&&this._createVertexOrEdgeManipulator(r)}if(t.length>0){const a=t.map(r=>{const l=i.data.components.indexOf(r.component);return{coordinates:i.data.coordinateHelper.vectorToArray(r.pos),componentIndex:l,vertexIndex:(0,s.Wg)(r.index)}});this.outputGeometry=i.data.geometry;const o=this._updateEventState(U.RESHAPING);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:a.map(r=>r.coordinates),vertices:a}),this.destroyed)||o&&(this._updateEventState(U.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?Lt.O.NEW_STEP:Lt.O.ACCUMULATE_STEPS)){const n=(0,s.Wg)(this._editGeometryOperations);n.moveVertices(e.map(a=>a.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=n.data.geometry;for(const a of e)this._updateManipulatorPosition(a)}_offsetEdge(e,t){if((0,s.Wi)(t.operation)||(0,s.Wi)(t.signedDistance))return;const i=(0,s.Wg)(this._editGeometryOperations),n=t.operation.clone();n.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],n),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===zi.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===zi.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter(n=>"vertex"===n.type&&n.manipulator.selected);1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const n=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case C.XY:this._tooltip.info=new at.$E({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,(a,o)=>(0,ot.GQ)(a,o,n));break;case C.XY_AXIS:this._tooltip.info=new at.in({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,(a,o)=>{const r=(0,ot.GQ)(a,o,n);return(0,$.bA)(r,De(t))});break;case C.Z:this._tooltip.info=new at.QW({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,pe._e)}}_updateTranslateVertexTooltip(e,t,i){const n=this._tooltipOptions;if(!n.enabled)return;let a;const o=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case C.XY:a=new at.nk({tooltipOptions:n}),this._updateTranslateTooltipDistance(a,i,(l,h)=>(0,ot.GQ)(l,h,o)),this._updateTooltipAreaOrTotalLength(a);break;case C.XY_AXIS:a=new at.c1({tooltipOptions:n}),this._updateTranslateTooltipDistance(a,i,(l,h)=>{const c=(0,ot.GQ)(l,h,o);return(0,$.bA)(c,De(i))}),this._updateTooltipAreaOrTotalLength(a);break;case C.Z:a=new at.j({tooltipOptions:n}),this._updateTranslateTooltipDistance(a,i,pe._e)}const r=(0,pe.g1)(e.elevationAlignedLocation);(0,s.pC)(r)&&(a.elevation=W({mode:"absolute-height"},r)),this._tooltip.info=a}_updateTranslateTooltipDistance(e,t,i){if((0,s.pC)(t)&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,o=i(n,a);e.distance=(0,s.pC)(o)?o:$.yP}}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if((0,s.Wi)(t))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area="polygon"===t.type?(0,Qa.k)(t,i):null,e.totalLength="polyline"===t.type?(0,ot.Ul)(t,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function Xi(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,p._)([(0,d.Cb)()],Q.prototype,"_editGeometryOperations",void 0),(0,p._)([(0,d.Cb)()],Q.prototype,"_segmentLabels",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"tool",void 0),(0,p._)([(0,d.Cb)()],Q.prototype,"_tooltip",void 0),(0,p._)([(0,d.Cb)()],Q.prototype,"inputGeometry",null),(0,p._)([(0,d.Cb)()],Q.prototype,"outputGeometry",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],Q.prototype,"updating",null),(0,p._)([(0,d.Cb)()],Q.prototype,"manipulators",null),(0,p._)([(0,d.Cb)()],Q.prototype,"view",null),(0,p._)([(0,d.Cb)()],Q.prototype,"graphic",null),(0,p._)([(0,d.Cb)()],Q.prototype,"enableZShape",null),(0,p._)([(0,d.Cb)()],Q.prototype,"enableZVertex",null),(0,p._)([(0,d.Cb)()],Q.prototype,"enableMoveGraphic",null),(0,p._)([(0,d.Cb)()],Q.prototype,"enableMidpoints",null),(0,p._)([(0,d.Cb)()],Q.prototype,"enableEdgeOffset",null),(0,p._)([(0,d.Cb)()],Q.prototype,"_labelOptions",null),(0,p._)([(0,d.Cb)()],Q.prototype,"_tooltipOptions",null),Q=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Q);const fe=(0,me.Tx)(0,0,void 0,ka.Z.WGS84),ze=(0,G.c)(),ti=1e-6;var Ct,U,ce;(function(e){e.Vertex=x.jg.Custom1,e.Edge=x.jg.Custom2})(Ct||(Ct={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(U||(U={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(ce||(ce={}));var Wi=u(24959);let K=class extends(wt.Z.EventedMixin(Ge.m)){constructor(e){super(e),this._handles=new re.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Wi.Z,this.tooltipOptions=new Yt.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new Q({tool:this});this.addHandles([e.on("reshape",t=>{"reshape"===t.type&&this._onReshapeGeometryChanged(),this.emit("reshape",t)}),e.on("move",t=>{"move"===t.type&&this._onReshapeGeometryChanged(),this.emit("move",t)}),e.on("vertex-add",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)}),e.on("vertex-remove",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)}),e.on("immediate-click",t=>this.emit("immediate-click",t)),this.view.on("pointer-down",["Shift"],t=>t.stopPropagation()),(0,y.YP)(()=>this.graphic,()=>this._updateGraphic(),y.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,s.SC)(this._handles),this._reshapeOperation=(0,s.SC)(this._reshapeOperation)}get updating(){var e,t;return null!=(t=null==(e=this._reshapeOperation)?void 0:e.updating)&&t}_updateGeometry(){const e=(0,Ri.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,s.pC)(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,Ri.P)(this.graphic)!==gi.e.SUPPORTED)return;const e=(0,y.YP)(()=>{var t;return null==(t=this.graphic)?void 0:t.geometry},()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()},y.Z_);this._handles.add(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:e}=this._reshapeOperation;!(0,s.Wi)(this.graphic)&&e&&this._updateGeometryInternally(e.clone())}get canUndo(){var e;return null!=(e=this._reshapeOperation.canUndo)&&e}undo(){(0,s.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.undo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}get canRedo(){var e;return null!=(e=this._reshapeOperation.canRedo)&&e}redo(){(0,s.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.redo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,p._)([(0,d.Cb)()],K.prototype,"_reshapeOperation",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],K.prototype,"view",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],K.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],K.prototype,"enableZShape",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],K.prototype,"enableZVertex",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],K.prototype,"enableMoveGraphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],K.prototype,"enableMidpoints",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],K.prototype,"enableEdgeOffset",void 0),(0,p._)([(0,d.Cb)()],K.prototype,"type",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Wi.Z})],K.prototype,"labelOptions",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Yt.Z})],K.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],K.prototype,"snappingManager",void 0),(0,p._)([(0,d.Cb)()],K.prototype,"updating",null),(0,p._)([(0,d.Cb)()],K.prototype,"automaticManipulatorSelection",void 0),K=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],K);var Ka=u(72642),ei=u(59617),qa=u(23719),tn=u(50618),en=u(4794),Me=u(70562);let Vt=class extends Ve.h{constructor(e){super(e),this.type="transform-rotate",this.rotationType="geographic"}};(0,p._)([(0,d.Cb)()],Vt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Vt.prototype,"rotation",void 0),(0,p._)([(0,d.Cb)()],Vt.prototype,"rotationPrecision",void 0),(0,p._)([(0,d.Cb)()],Vt.prototype,"orientation",void 0),(0,p._)([(0,d.Cb)()],Vt.prototype,"orientationPrecision",void 0),(0,p._)([(0,d.Cb)()],Vt.prototype,"rotationType",void 0),Vt=(0,p._)([(0,z.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Vt);let Nt=class extends Ve.h{constructor(e){super(e),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};(0,p._)([(0,d.Cb)()],Nt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Nt.prototype,"scale",void 0),(0,p._)([(0,d.Cb)()],Nt.prototype,"size",void 0),(0,p._)([(0,d.Cb)()],Nt.prototype,"sizeUnit",void 0),(0,p._)([(0,d.Cb)()],Nt.prototype,"sizePrecision",void 0),Nt=(0,p._)([(0,z.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Nt);let ft=class extends Ve.h{constructor(e){super(e),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var P,de;(0,p._)([(0,d.Cb)()],ft.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"orientation",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"orientationEnabled",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"orientationPrecision",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"rotationType",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"size",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"sizeUnit",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"sizeEnabled",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"sizePrecision",void 0),ft=(0,p._)([(0,z.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],ft),function(e){e.ScaleIn=x.jg.Custom2,e.ScaleOut=x.jg.Custom3,e.RotateLeft=x.jg.Custom4,e.RotateRight=x.jg.Custom5,e.Unlocked=x.jg.Custom7,e.DelayedFocused=x.jg.Custom8,e.TouchInput=x.jg.Custom12}(P||(P={}));class an{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}constructor({adapter:t,tooltipOptions:i,mode:n,tool:a}){this._mode=null,this._handles=new re.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new wt.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>(0,s.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=a,this._mode=n,this._adapter=t,this._tooltipOptions=i,this._tooltip=new ye.u({view:a.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,y.gx)(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),y.nn))}destroy(){(0,s.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,s.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,s.SC)(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const i=(0,tn.A)({update:({deltaTime:n})=>{t.update(n)&&this.cancelActiveAnimation()}});this._activeAnimation=H(W({},t),{frameTask:i})}cancelActiveAnimation(){(0,s.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,s.SC)(this._activeAnimation))}forEachManipulator(t){t(this._ringManipulator,I.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const i=this.tool.graphicState.graphic,n=(0,A.Xd)(t,(a,o,r)=>{this._scaleRotateDragData=null;const l=this._adapter.startInteraction(),h={mode:"none",origin:(0,G.a)(a.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=h,this._updateDragState();const c=w.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(a.renderLocation,c),o.next((0,yt._N)(this.tool.view,(0,ct.Yq)(a.renderLocation,c,(0,ct.Ue)()))).next(g=>{const m=(0,ct.mJ)(g.plane),v=(0,N.Gd)(g.renderStart,g.renderEnd,h.origin,m),S=qa.Q4.shortestSignedDiff(h.angle,v);h.angleDir=(0,_t.uZ)(h.angleDir+S,-.3,.3),h.angle=v;const b=function nn(e,t){const i=(0,f.b)(w.WM.get(),t.renderStart,e.origin),n=(0,f.b)(w.WM.get(),t.renderEnd,e.origin),a=(0,f.l)(i),o=(0,f.l)(n);return 0===a?0:o/a}(h,g);if(h.scaleDir=(0,_t.uZ)(h.scaleDir+(b-this._adapter.scale),-.2,.2),this._onScaleChanged(),"none"===h.mode){const E=this._mode||function on(e,t,i,n){const{renderStart:a,renderEnd:o}=e,r=Xe(a,n,w.WM.get()),l=Xe(o,n,w.WM.get());if((0,f.d)(r,l)<100)return null;const h=(0,f.b)(w.WM.get(),a,i),c=(0,f.f)(w.WM.get(),h,(0,ct.mJ)(t)),g=a,m=(0,f.a)(w.WM.get(),g,c),v=Xe(i,n,w.WM.get()),S=r,b=Xe(m,n,w.WM.get()),M=(0,f.b)(w.WM.get(),b,S),E=(0,f.b)(w.WM.get(),r,v),D=(0,Me.re)(S,M),Y=(0,Me.re)(v,E);return(0,Me.Jk)(D,l)<(0,Me.Jk)(Y,l)?"rotate":"scale"}(g,g.plane,h.origin,this.tool.view.state.camera);if((0,s.pC)(E)){switch(E){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:i,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:i,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}h.mode=E}}switch(h.mode){case"rotate":l.state.angle=h.initialAngle+v;break;case"scale":l.state.scale=b,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),g.action){case"start":case"update":switch(h.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:i,angle:(0,_t.BV)(h.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:i,xScale:b,yScale:b})}break;case"end":switch(h.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:(0,_t.BV)(h.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:b,yScale:b})}}return"end"===g.action&&(this.startAnimation(Ui(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),l.done()),g}).next(this._updateTooltipPipelineStep(h)),r.next(()=>{if(l.cancel(),(0,s.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:1,yScale:1})}this.startAnimation(Ui(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([n,t.events.on("focus-changed",a=>{"focus"===a.action?this.startAnimation(function sn(e,t,i){let n=0,a=null;const o=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=o,n=0,t()},update:r=>(n+=r,null==a||!a()||n>=i.delayMs?de.STOP:de.CONTINUE),destroy:()=>{a&&(e.getFocused=a),t()}}}(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),t.events.on("immediate-click",a=>{a.stopPropagation()}),(0,y.YP)(()=>{var a;return null==(a=this.tool.graphicState)?void 0:a.displaying},a=>this._ringManipulator.available=a,y.nn)])}_updateTooltipPipelineStep(t){return i=>{const n=this._tooltipOptions;if(!n.enabled)return i;if("end"===i.action)return this._updateFocusTooltip(),i;const a=this._tooltip,o=this._tooltipOptions.visualVariables,r=(0,s.pC)(o)?o.size:null,l=(0,s.pC)(o)?o.rotation:null;switch(t.mode){case"scale":a.info=new Nt({tooltipOptions:n,scale:{value:this._adapter.scale},size:(0,$.yG)((0,s.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,s.pC)(r)?r.unit:null,sizePrecision:(0,s.pC)(r)?We(r.valueType):null});break;case"rotate":{const h=(0,s.pC)(l)?We(l.valueType):null,c=(0,s.pC)(l)?l.rotationType:"geographic";a.info=new Vt({tooltipOptions:n,rotation:(0,$.GJ)((0,s.Pt)(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:h,orientation:(0,$.GJ)(-this._adapter.angle,"radians","geographic"),orientationPrecision:h,rotationType:c})}}return i}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,i=(0,s.pC)(t)?t.rotation:null,n=(0,s.pC)(t)?t.size:null;this._tooltip.info=new ft({tooltipOptions:this._tooltipOptions,orientation:(0,$.GJ)(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:(0,s.pC)(i)?We(i.valueType):null,rotationType:(0,s.pC)(i)?i.rotationType:"geographic",size:(0,$.yG)((0,s.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,s.pC)(n)?n.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:(0,s.pC)(n)?We(n.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(P.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(P.Unlocked,!((0,s.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,s.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(P.ScaleIn|P.ScaleOut,!1),this._ringManipulator.updateStateEnabled(P.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(P.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(P.RotateLeft|P.RotateRight,!1),this._ringManipulator.updateStateEnabled(P.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(P.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(P.ScaleIn|P.ScaleOut|P.RotateLeft|P.RotateRight,!1)}_updateManipulatorTransform(){const t=(0,j.d)(w.MP.get(),this._adapter.angle,(0,G.f)(0,0,1));if((0,s.Wi)(t))return;const i=this.getScale(),n=(0,j.E)(w.MP.get(),(0,f.s)(w.WM.get(),i,i,i));this._ringManipulator.modelTransform=(0,j.m)(w.MP.get(),n,t)}_createRingManipulator(){const t=(L,Gt,Rt)=>{const Bt=[],Ft=Math.ceil(128*(Gt-L)/(2*Math.PI));for(let et=0;et<Ft+1;et++){const be=L+et*(Gt-L)/Ft;Bt.push((0,G.f)(Rt*Math.cos(be),Rt*Math.sin(be),0))}return Bt},i=L=>t(0,2*Math.PI,L),a=this._createMaterial(1),o=(L,Gt,Rt=a)=>(0,st.x2)(Rt,(L=>[[-L/2,0],[L/2,0],[L/2,.25],[-L/2,.25]])(Gt),L,[],[],!1),r=i(160),l=o(r,24),h={left:new Array,right:new Array},c=[];for(let L=0;L<2;L++){const Gt=L*Math.PI-Math.PI/4,Rt=Math.PI/2-Ta,Bt=Gt+Rt,Ft=Gt+Math.PI/2-Rt,et=t(Bt,Ft,190),be=o(et,9);c.push(et),c.push(t(Bt,Ft,201)),h.left.push(be),h.right.push(be.instantiate());for(let ai=0;ai<2;ai++){const ji=0===ai,ut=(0,le.c)();if(ji){(0,j.k)(ut,ut,[1,-1,1]),(0,j.e)(ut,ut,-Bt,[0,0,1]);const ee=Math.round(.2*(et.length-1));ut[12]=et[ee][0],ut[13]=et[ee][1],ut[14]=et[ee][2]}else{(0,j.e)(ut,ut,Ft,[0,0,1]);const ee=Math.round(.8*(et.length-1));ut[12]=et[ee][0],ut[13]=et[ee][1],ut[14]=et[ee][2]}const Qi=(0,st.DA)(a,60,0,23,.5);(0,st.mx)(Qi,ut),(ji?h.left:h.right).push(Qi)}}const g=[];for(let L=0;L<2;L++){const Gt=L*Math.PI-Math.PI/4,Rt=Math.PI/2-Da,Ft=Gt+Math.PI/2-Rt,et=t(Gt+Rt,Ft,213);g.push(o(et,9))}const m=this._createMaterial(.66),v=this._createMaterial(.5),S=this._createMaterial(.33),b=i(190),M=i(213),E=o(b,9,m),D=o(M,9,S),Y=i(130),tt=i(107),te=o(Y,9,m),dt=o(tt,9,S);let Zt=[new R.r(l,P.DelayedFocused),new R.r(l.instantiate({material:v}),x.Q9.None)];this._mode&&"scale"!==this._mode||(Zt=Zt.concat([...g.map(L=>new R.r(L,P.DelayedFocused|P.Unlocked)),new R.r(E,P.DelayedFocused|P.ScaleIn),new R.r(D,P.DelayedFocused|P.ScaleIn),new R.r(te,P.DelayedFocused|P.ScaleOut),new R.r(dt,P.DelayedFocused|P.ScaleOut)])),this._mode&&"rotate"!==this._mode||(Zt=Zt.concat([...h.right.map(L=>new R.r(L.instantiate(),P.DelayedFocused|P.Unlocked)),...h.left.map(L=>new R.r(L,P.DelayedFocused|P.RotateLeft)),...h.right.map(L=>new R.r(L,P.DelayedFocused|P.RotateRight))]));const Ue=[r,...c];return new vt.Z({view:this.tool.view,renderObjects:Zt,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,V.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:Ue,direction:(0,G.f)(0,0,1)}})}_createMaterial(t){const i=(0,en.b)([...Sa,t]);return new $e.E({color:i,transparent:1!==t,cullFace:ke.Vr.Back,renderOccluded:St.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:t=>this._ringIndicatorDelayMs=t,tooltip:this._tooltip}}}function Xe(e,t,i){return t.projectToScreen(e,ii),(0,f.s)(i,ii[0],ii[1],0)}function Ui(e,t){let i=null,n=1;const a=()=>n;return{start:()=>{n=e.getScale(),i=e.getScale,e.getScale=a,t()},update:o=>(n+=((n+1)/2-n)*Math.min(3*o,1),t(),Math.abs(n-1)<.01?de.STOP:de.CONTINUE),destroy:()=>{i&&(e.getScale=i),t()}}}function We(e){switch(e){case"integer":case"long":return 0;default:return null}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(de||(de={}));const ii=(0,Pt.s1)();var Zi=u(89586);function Yi(e){return(0,s.pC)(e.geometry)&&"mesh"===e.geometry.type?function rn(e){return(0,s.pC)(e.transform)?function hn(e,t){let i=t.clone(),n=null;return{undo:a=>{n=(0,s.pC)(e.transform)?e.transform.clone():null,e.transform=i,a.notifyGeometryChanged()},redo:a=>{i=(0,s.pC)(e.transform)?e.transform.clone():null,e.transform=n,a.notifyGeometryChanged()}}}(e,e.transform):function pn(e){let t,i=e.vertexAttributes.clonePositional();return{undo:n=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,n.notifyGeometryChanged()},redo:n=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,n.notifyGeometryChanged()}}}(e)}(e.geometry):function ln(e){let t=e.geometry,i=s.YP;return{undo(n){i=n.geometry,n.geometry=t},redo(n){t=n.geometry,n.geometry=i}}}(e)}let zt=class extends _e.r{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([(0,y.gx)(()=>(0,s.pC)(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null,({interactionState:e})=>{this._updateMeshRotation(e)},y.Z_),(0,y.gx)(()=>(0,s.pC)(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null,({interactionState:e})=>{this._updateMeshSize(e)},y.Z_)])}get angle(){const e=this.geometry.transform;if((0,s.Wi)(e))return 0;const t=(0,Zi.ZZ)(e.rotation)[2];return Math.abs(t)>.999999?(0,_t.Vl)((0,Zi.EU)(e.rotation))*Math.sign(t):0}get scale(){return(0,s.pC)(this._interactionState)?this._interactionState.scale:1}startInteraction(){const e=new Xt({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return Yi(this.graphic)}_updateMeshRotation(e){const t=this.geometry.anchor,i=this.viewingMode===ei.JY.Global,{angle:n,previousAngle:a}=e;this.geometry.rotate(0,0,(0,_t.BV)(n-a),{origin:t,geographic:i}),e.previousAngle=n,(0,s.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const t=this.geometry.anchor,i=this.viewingMode===ei.JY.Global,{scale:n,previousScale:a}=e;this.geometry.scale(n/a,{origin:t,geographic:i}),e.previousScale=n,(0,s.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};(0,p._)([(0,d.Cb)({constructOnly:!0})],zt.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],zt.prototype,"geometry",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],zt.prototype,"viewingMode",void 0),(0,p._)([(0,d.Cb)()],zt.prototype,"angle",null),(0,p._)([(0,d.Cb)()],zt.prototype,"scale",null),(0,p._)([(0,d.Cb)()],zt.prototype,"_interactionState",void 0),zt=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],zt);let Xt=class extends B.Z{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,p._)([(0,d.Cb)()],Xt.prototype,"angle",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"initialAngle",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"previousAngle",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"previousScale",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"scale",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"state",null),Xt=(0,p._)([(0,z.j)("InteractionState")],Xt);let q=class extends _e.r{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,y.gx)(()=>(0,s.pC)(this._interactionState)?this._interactionState.state:null,e=>{this._updateSymbol(e)},y.Z_))}get angle(){var e;return(0,s.pC)(this._interactionState)?this._interactionState.angle:(0,s.pC)(this._orientationReferenceSymbolLayer)?function cn(e){return-(0,_t.Vl)(e)}(null!=(e=this._orientationReferenceSymbolLayer.heading)?e:0):0}get scale(){return(0,s.pC)(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return(0,s.pC)(this._interactionState)?this._interactionState.initialAngle:0}get size(){const e=this._sizeReferenceSymbolLayer;if((0,s.Wi)(e))return null;const t=this.findLayerView(),i=this._graphicSymbol;if((0,s.Wi)(t)||(0,s.Wi)(i)||"point-3d"!==i.type)return null;const n=t.getSymbolLayerSize(i,e);if("size"in n&&(0,s.pC)(n.size))return n.size;const a=this.sizeAxis;return"width"in n&&(0,s.pC)(n.width)&&((0,s.Wi)(a)||"width"===a||"all"===a||"width-and-depth"===a)?n.width:"depth"in n&&(0,s.pC)(e.depth)&&((0,s.Wi)(a)||"depth"===a||"all"===a||"width-and-depth"===a)?n.depth:"height"in n&&(0,s.pC)(e.height)&&((0,s.Wi)(a)||"height"===a||"all"===a)?n.height:null}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,s.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find(t=>"object"===t.type)}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,s.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find(t=>"object"===t.type&&(0,s.pC)(t.heading))}get _graphicSymbol(){return(0,s.pC)(this.graphic)&&(0,s.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if((0,s.pC)(this._interactionState)||(0,s.Wi)(e)||(0,s.Wi)(t))return dn;const i=e.symbolLayers.map(l=>"object"===l.type?t.getSymbolLayerSize(e,l):null).toArray(),n=e.clone(),o=new Wt({originalSymbol:n,angle:this.angle,initialSizes:i});this._interactionState=o;const r=()=>{this._interactionState=null};return{state:o,done:r,cancel:()=>{this._graphicSymbol=n,r()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:i,initialSizes:n}){const a=this._graphicSymbol;if((0,s.Wi)(a)||"point-3d"!==a.type)return;const o=a.clone(),r=-(0,_t.BV)(t-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(i,o,(h,c,g)=>{const m=(0,s.Pt)(h.heading,0)+r;c.heading!==m&&(c.heading=m,l=!0);const v=n[g];if((0,s.pC)(v)&&"width"in v){v.width=this.sizeFilter(v.width),v.height=this.sizeFilter(v.height),v.depth=this.sizeFilter(v.depth);const S=v.width*e;c.width!==S&&(c.width=S,l=!0);const b=v.depth*e;c.depth!==b&&(c.depth=b,l=!0);const M=v.height*e;c.height!==M&&(c.height=M,l=!0)}}),l&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach((n,a)=>{const o=t.symbolLayers.getItemAt(a);"object"===n.type&&"object"===o.type&&i(n,o,a)})}};(0,p._)([(0,d.Cb)()],q.prototype,"angle",null),(0,p._)([(0,d.Cb)()],q.prototype,"scale",null),(0,p._)([(0,d.Cb)()],q.prototype,"relativeAngle",null),(0,p._)([(0,d.Cb)()],q.prototype,"initialAngle",null),(0,p._)([(0,d.Cb)()],q.prototype,"size",null),(0,p._)([(0,d.Cb)()],q.prototype,"sizeAxis",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],q.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)()],q.prototype,"_interactionState",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],q.prototype,"findLayerView",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],q.prototype,"sizeFilter",void 0),(0,p._)([(0,d.Cb)()],q.prototype,"_sizeReferenceSymbolLayer",null),(0,p._)([(0,d.Cb)()],q.prototype,"_orientationReferenceSymbolLayer",null),(0,p._)([(0,d.Cb)()],q.prototype,"_graphicSymbol",null),q=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],q);const dn={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Wt=class extends B.Z{get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};(0,p._)([(0,d.Cb)()],Wt.prototype,"originalSymbol",void 0),(0,p._)([(0,d.Cb)()],Wt.prototype,"angle",void 0),(0,p._)([(0,d.Cb)()],Wt.prototype,"initialAngle",void 0),(0,p._)([(0,d.Cb)()],Wt.prototype,"initialSizes",void 0),(0,p._)([(0,d.Cb)()],Wt.prototype,"scale",void 0),(0,p._)([(0,d.Cb)()],Wt.prototype,"state",null),Wt=(0,p._)([(0,z.j)("InteractionState")],Wt);let rt=class extends((0,_e.p)(wt.Z.EventedMixin(Ge.m))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Yt.Z,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new pt({graphic:e}),this.addHandles((0,y.YP)(()=>this.tooltipOptions.enabled,o=>{this._tooltip=o?new ye.u({view:t}):(0,s.SC)(this._tooltip)},y.tX)),this._moveManipulation=new qt({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&(0,kt.c)(e),radius:qt.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator(o=>this.handles.add(o.events.on("immediate-click",r=>{this.emit("immediate-click",H(W({},r),{graphic:e})),r.stopPropagation()})));const i=o=>r=>{this.handles.add(r.events.on("focus-changed",({action:l})=>{const h=this._tooltip;(0,s.Wi)(h)||("focus"===l?this._updateMoveTooltip(o):h.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(i(C.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(C.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(C.Z));const n=(0,V.RL)(e);this._moveManipulation.elevationInfo=n;const a=e.geometry;this._moveManipulation.createGraphicDragPipeline((o,r,l,h,c)=>{if((0,s.pC)(a)&&o===C.XY){const{snappingStep:g,cancelSnapping:m}=(0,Ie.W)({snappingContext:new Pe.N({elevationInfo:n,pointer:c,editGeometryOperations:Re.c.fromGeometry(new Ka.Z({spatialReference:a.spatialReference}),t.state.viewingMode),visualizer:new ge._,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});h=h.next(m),l=l.next((0,A.Mz)(this.view,n)).next(...g)}return{steps:l=l.next(g=>(this._updateMoveTooltip(o,g),g)),cancel:h}},this.graphicState,o=>{const{action:r,graphic:l,dxScreen:h,dyScreen:c}=o,g={graphic:l,dxScreen:h,dyScreen:c};switch(r){case"start":this.emit("graphic-translate-start",g),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",g);break;case"end":this.emit("graphic-translate-stop",g)}}),this._moveManipulation.angle=(0,s.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,y.YP)(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),(this.enableScaling||this.enableRotation)&&(this._scaleRotate=new an({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate",adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))),this.handles.add([Ae({view:this.view,graphic:this.graphic,forEachManipulator:o=>this._forEachManipulator(o),onManipulatorsChanged:()=>(0,T.kB)()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),(0,y.YP)(()=>t.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(o=>{o instanceof vt.Z&&this.handles.add(o.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=(0,s.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,s.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,s.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){(0,s.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return(0,s.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new zt({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new q({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find(e=>e.layer===this.graphic.layer),sizeAxis:(0,s.pC)(this.tooltipOptions.visualVariables)&&(0,s.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),(0,s.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return(0,y.YP)(()=>this.graphicState.displaying,e=>{this._forEachManipulator(t=>t.available=e),this._moveManipulation.zManipulation.available=e&&this.enableZ&&(0,kt.c)(this.graphic)})}_createGeometryUndoRecord(){return Yi(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this._moveManipulation.location=e,(0,s.pC)(this._scaleRotate)&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,(0,s.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){(0,s.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if((0,s.Wi)(this._scaleRotate))return;const e=this._scaleRotate.getScale();this._moveManipulation.displayScale=e}_updateMoveAngle(){this._moveManipulation.angle=this.view.state.viewingMode===ei.JY.Local||this.view.scale<1e6?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){(0,N.u2)(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(e,t){const{tooltipOptions:i,_tooltip:n}=this;if((0,s.Wi)(n))return;n.clear();const a=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case C.XY:n.info=new at.$E({tooltipOptions:i}),this._updateMoveTooltipDistance(n.info,t,(o,r)=>(0,ot.GQ)(o,r,a));break;case C.XY_AXIS:n.info=new at.in({tooltipOptions:i}),this._updateMoveTooltipDistance(n.info,t,(o,r)=>{const l=(0,ot.GQ)(o,r,a);return(0,$.bA)(l,De(t))});break;case C.Z:n.info=new at.QW({tooltipOptions:i}),this._updateMoveTooltipDistance(n.info,t,pe._e)}}_updateMoveTooltipDistance(e,t,i){if((0,s.pC)(t)&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,o=i(n,a);e.distance=(0,s.pC)(o)?o:$.yP}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,s.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:e=>(0,s.pC)(this._scaleRotate)?this._scaleRotate.test.setRingIndicatorDelayMs(e):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],rt.prototype,"view",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],rt.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],rt.prototype,"enableZ",void 0),(0,p._)([(0,d.Cb)()],rt.prototype,"enableRotation",void 0),(0,p._)([(0,d.Cb)()],rt.prototype,"enableScaling",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Yt.Z})],rt.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)()],rt.prototype,"graphicState",void 0),(0,p._)([(0,d.Cb)({value:!1})],rt.prototype,"snapToScene",null),(0,p._)([(0,d.Cb)({constructOnly:!0})],rt.prototype,"snappingManager",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],rt.prototype,"type",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],rt.prototype,"updating",null),rt=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],rt);var Ut=u(41743),nt=u(96298),un=u(25601);class gn{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,s.pC)(this._lastDragEvent)&&(0,s.pC)(this._next)){const i=H(W({},this._lastDragEvent),{action:"update"});t&&this._adjustScaleFactors(i),this._next.execute(i)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new A.hM;return this._next=t,[i=>(this._lastDragEvent="end"!==i.action?W({},i):null,this._enabled&&this._adjustScaleFactors(i),i),t]}_adjustScaleFactors(t){const i=(0,nt.J0)(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-i:i,t.factor2=t.factor2<0?-i:i}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}var mn=u(26046),Hi=u(15708),Dt=u(96792),Ni=u(51810);let lt=class extends(wt.Z.EventedMixin(Ge.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Yt.Z,this._preserveAspectRatio=new gn,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new re.Z,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=(0,Ut.a)(),this._mapBoundsStart=(0,Ut.a)(),this._zmax=0,this._sizeStart=null,this._displayBounds=(0,Ut.a)(),this._displayBoundsStart=(0,Ut.a)(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,It.a)(),this._endScale=(0,It.a)()}initialize(){const{view:e,graphic:t,manipulators:i,_handles:n}=this,a=this._graphicState=new pt({graphic:t});this._editGeometryOperations=Re.c.fromGeometry(t.geometry,e.state.viewingMode),this._graphicMoveManipulation=new Ke({tool:this,view:e,graphicState:a}),this._moveZManipulator=(0,nt.Pt)(e,nt.lX.CENTER_ON_CALLOUT),this._moveZManipulator.state|=nt.Df,n.add([this._createMoveXYGraphicDragPipeline(),(0,y.YP)(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._moveZManipulator,I.TRANSLATE_Z)),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map(g=>{const m=(0,nt.vw)(e,g);return n.add([(0,y.YP)(()=>this.enableScaling,()=>this._updateManipulatorAvailability(m,I.SCALE)),m.events.on("grab-changed",v=>this._onResizeGrab(v)),this._createResizeDragPipeline(m,g)]),m}),i.addMany(this._resizeManipulators),this._rotateManipulatorTexture=(0,un.O)(e.toolViewManager.textures),this._rotateManipulator=(0,N.Ju)(e,{texture:this._rotateManipulatorTexture.texture}),n.add([(0,y.YP)(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._rotateManipulator,I.ROTATE)),this._rotateManipulator.events.on("grab-changed",g=>{this._onRotateGrab(g)}),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const r=Ae({view:e,graphic:t,forEachManipulator:g=>this._forEachManipulator(g),onManipulatorsChanged:()=>(0,T.kB)()});(0,s.pC)(r)&&(this._outlineVisualElement=r.visualElement instanceof Qt?r.visualElement:null),(0,s.pC)(this._outlineVisualElement)&&n.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),n.add(r),n.add([a.on("changed",()=>this._onGeometryChanged()),(0,y.YP)(()=>a.displaying,()=>this._updateAllManipulatorAvailability()),(0,y.YP)(()=>a.isDraped,()=>this._graphicDrapedChanged(),y.nn),e.trackGraphicState(a)]);const l=e.pointsOfInterest;n.add((0,y.YP)(()=>null==l?void 0:l.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds())),this._forEachManipulator(g=>{n.add(g.events.on("grab-changed",()=>{this.grabbing=g.grabbing,this._updateAllManipulatorAvailability()}))}),this._forEachManipulator((g,m)=>{n.add(g.events.on("immediate-click",v=>{m===I.TRANSLATE_XY&&this.emit("immediate-click",H(W({},v),{graphic:t})),v.stopPropagation()}))}),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:e,view:t}=this,i=this._tooltip=new ye.u({view:t}),n=()=>{i.info=this._getUpdatedTooltipInfo()};e.add([this.on("graphic-translate-start",n),this.on("graphic-translate",n),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",a=>{this._startAngle=a.angle,n()}),this.on("graphic-rotate",a=>{this._endAngle=a.angle,n()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,n()}),this.on("graphic-scale-start",a=>{(0,Z.s)(this._startScale,a.xScale,a.yScale),(0,Z.s)(this._endScale,a.xScale,a.yScale),n()}),this.on("graphic-scale",a=>{(0,Z.s)(this._endScale,a.xScale,a.yScale),n()}),this.on("graphic-scale-stop",()=>{(0,Z.s)(this._startScale,0,0),(0,Z.s)(this._endScale,0,0),n()})]),this._forEachManipulator(a=>{e.add([a.events.on("focus-changed",n),a.events.on("grab-changed",n),a.events.on("drag",o=>{"cancel"===o.action?this._tooltip.clear():n()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some(e=>e.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=(0,s.Pt)(this._moveXYTooltipInfo,()=>new at.$E({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const e=this._moveZTooltipInfo=(0,s.Pt)(this._moveZTooltipInfo,()=>new at.QW({tooltipOptions:this.tooltipOptions})),t=this._moveUnit;if(this._moveZManipulator.dragging){const a=(0,pe.Cr)(this._mapBoundsStart.origin,this._mapBounds.origin,this.view.spatialReference);if((0,s.Wi)(a))return null;e.distance=a}else e.distance=(0,$.yG)(0,t);return e}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo=(0,s.Pt)(this._rotateTooltipInfo,()=>new Ni.c({tooltipOptions:this.tooltipOptions}));return e.angle=this._startAngle-this._endAngle,e}_computeScaleTooltipInfo(){const e=this.graphic.geometry;if((0,s.Wi)(e))return null;const t=this._scaleTooltipInfo=(0,s.Pt)(this._scaleTooltipInfo,()=>new Ni.p({tooltipOptions:this.tooltipOptions})),i=(0,Dt.NI)(this._mapBounds,this._zmax,e.spatialReference,this._graphicState.isDraped);return(0,s.Wi)(i)?null:(t.xSize=i[0],t.ySize=i[1],(0,s.pC)(this._sizeStart)&&this._resizeManipulators.some(n=>n.dragging)?(t.xScale=i[0].value/this._sizeStart[0].value,t.yScale=i[1].value/this._sizeStart[1].value):(t.xScale=1,t.yScale=1),t)}_graphicDrapedChanged(){this._handles.remove(Bi),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",e=>{(0,s.pC)(this._attachmentOrigin)&&(0,_i.jE)(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()}),Bi)}_updateAllManipulatorAvailability(){this._forEachManipulator((e,t)=>this._updateManipulatorAvailability(e,t))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof vt.Z){const n=this._graphicState.displaying,a=this.enableZ&&(0,kt.c)(this.graphic);switch(t){case I.ROTATE:e.available=n&&this.enableRotation;break;case I.SCALE:e.available=n&&(this.enableScaling||this.enableRotation||a),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?nt.Sc:nt.vc;break;case I.TRANSLATE_Z:e.available=n&&a;break;default:e.available=n}}}_forEachManipulator(e){this._graphicMoveManipulation.forEachManipulator(e),this._resizeManipulators.forEach(t=>e(t,I.SCALE)),e(this._rotateManipulator,I.ROTATE),e(this._moveZManipulator,I.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get _moveUnit(){return(0,s.Pt)((0,Le.j5)(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const e=this.graphic.geometry,t=this._editGeometryOperations.data,i=t.components[0].edges[0],n=(0,Z.a)(w.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,Z.f)(n,n);const a=(0,s.Pt)((0,N.du)(this.view,this.graphic),()=>{var h;return null==(h=e.extent)?void 0:h.center});let o=a?vn*this.view.pixelSizeAt(a):0;const r=this.view.spatialReference,l=e.spatialReference;r.equals(l)||(o*=(0,Le.c9)(r)/(0,Le.c9)(l)),(0,Dt.lv)(n,t,o,this._mapBounds),this._updateZMax()}_updateZMax(){var n;const e=this._editGeometryOperations.data;if(!e.geometry.hasZ)return void(this._zmax=0);const t=e.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of e.components)for(const o of a.vertices){const r=null!=(n=t.getZ(o.pos))?n:0;i=Math.max(r,i)}this._zmax=i}_updateDisplayBounds(){const{geometry:e}=this.graphic;if((0,s.Wi)(e))return;const{extent:t}=e;if(!t)return;const i=(0,s.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,s.pC)(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:(0,N.du)(this.view,this.graphic);this._attachmentOrigin=(0,s.Pt)(i,t.center);const n=(0,s.pC)(i)?i.z:(0,Be.w7)(this._mapBounds.origin,this.view.elevationProvider,we.o.fromElevationInfo((0,V.RL)(this.graphic)),this.view.renderCoordsHelper),a=(0,Ut.c)(this._mapBounds);a.origin[2]=null!=n?n:0,(0,Dt.ny)(a,this.view.renderCoordsHelper,e.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){var i;const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:null==(i=this._editGeometryOperations.data.geometry.extent)?void 0:i.center;return t?_n*this.view.pixelSizeAt(t):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline((e,t,i)=>this._applyGraphicMoveSteps(t,i,C.XY))}_createMoveZDragPipeline(){const e=this.view,t=this._editGeometryOperations.data.spatialReference;return(0,A.Xd)(this._moveZManipulator,(i,n,a)=>{const o=(0,G.a)(i.renderLocation),r=n.next((0,yt.Sp)(e,o,t)).next((0,A.zh)());this._applyGraphicMoveSteps(r,a,C.Z)})}_applyGraphicMoveSteps(e,t,i){const n=e.next(a=>("start"===a.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY})),a)).next((0,A.AN)()).next(this._moveDragUpdateGeometry()).next(a=>{var r,l;const o={graphic:this.graphic,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY};switch(a.action){case"start":case"update":(a.mapEnd.x-a.mapStart.x||a.mapEnd.y-a.mapStart.y||(null!=(r=a.mapEnd.z)?r:0)-(null!=(l=a.mapStart.z)?l:0))&&this.emit("graphic-translate",o);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",o)}return a}).next(a=>this._updateMoveTooltip(a,i));return t.next(()=>{(0,s.pC)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),n}_updateOperationStartProperties(){(0,Ut.c)(this._displayBounds,this._displayBoundsStart),(0,Ut.c)(this._mapBounds,this._mapBoundsStart),this._sizeStart=(0,s.Wi)(this.graphic.geometry)?null:(0,Dt.NI)(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return e=>{if((0,s.Wi)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const a of this._editGeometryOperations.data.components)t.push(...a.vertices);const n=this._editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,"start"===e.action?Lt.O.NEW_STEP:Lt.O.ACCUMULATE_STEPS);return(0,Dt.nn)(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_updateMoveTooltip(e,t){if(t===C.XY||t===C.XY_AXIS){const i=(0,ot.GQ)(e.mapStart,e.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");(0,s.pC)(i)&&(0,s.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=i)}return e}_onResizeGrab({action:e,screenPoint:t}){if("start"!==e||!t)return;const i=this._calculatePickRay(t);(0,ct.BR)(this._displayBounds.plane,i,w.WM.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return(0,A.Xd)(e,(i,n,a)=>{(0,s.Wi)(this.inputState)||(n.next(o=>("start"===o.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),o)).next((0,yt._N)(this.view,this._displayBoundsStart.plane)).next(o=>H(W({},o),{handle:t})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next(o=>{const r={graphic:this.graphic,xScale:o.factor1,yScale:o.factor2};switch(o.action){case"start":case"update":this.emit("graphic-scale",r);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",r)}return o}),a.next(()=>{(0,s.pC)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return e=>{const t=this._displayBoundsStart,i=e.handle.direction,n=this._displayBoundsMargin,a=this._displayBoundsMarginStart,o=(0,f.c)(w.WM.get(),t.origin);(0,f.z)(o,o,t.basis1,-i[0]),(0,f.z)(o,o,t.basis2,-i[1]);const r=(0,f.b)(w.WM.get(),e.renderEnd,o),l=(0,f.b)(w.WM.get(),e.renderStart,o),h=(0,nt.J0)(e.handle),c=(0,nt.Lw)(t),g=(0,nt.Lw)(this._displayBounds)/c,m=(v,S)=>{if(0===v)return 1;let b=(0,f.l)(S),M=.5*v*(0,f.e)(S,r)/b;const E=M<0?-1:1;h&&(M+=(b-.5*v*(0,f.e)(S,l)/b)*E*g);const D=b<1.5*a?1:Fi;return b=Math.max(b-a,Fi),E>0&&(M-=n),E*Math.max(E*(M/b),D)};return H(W({},e),{factor1:m(i[0],t.basis1),factor2:m(i[1],t.basis2)})}}_resizeDragUpdateGeometry(){return e=>{const t=(0,f.c)((0,G.c)(),this._mapBoundsStart.origin);(0,f.z)(t,t,this._mapBoundsStart.basis1,-e.handle.direction[0]),(0,f.z)(t,t,this._mapBoundsStart.basis2,-e.handle.direction[1]);const i=(0,Z.s)((0,It.a)(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);(0,Z.f)(i,i);const n=[];for(const r of this._editGeometryOperations.data.components)n.push(...r.vertices);const o=this._editGeometryOperations.scaleVertices(n,t,i,e.factor1,e.factor2,"start"===e.action?Lt.O.NEW_STEP:Lt.O.ACCUMULATE_STEPS,Hi.w.REPLACE);return(0,Ut.c)(this._mapBoundsStart,this._mapBounds),(0,Dt.nn)(o,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_onRotateGrab({action:e,screenPoint:t}){if("start"!==e||!t)return;const i=(0,nt.Rd)(this._displayBounds,this.view.renderCoordsHelper,nt.aZ.HEADING,(0,ct.Ue)()),n=this._calculatePickRay(t);(0,ct.BR)(i,n,w.WM.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:i})}_createRotateDragPipeline(e){return(0,A.Xd)(e,(t,i,n)=>{const a=this.inputState;(0,s.Wi)(a)||(i.next(o=>("start"===o.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),o)).next((0,yt._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next(o=>{const r={graphic:this.graphic,angle:(0,_t.BV)(o.rotateAngle)};switch(o.action){case"start":case"update":this.emit("graphic-rotate",r);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",r)}return o}),n.next(()=>{(0,s.pC)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(e){return t=>{const i=(0,ct.mJ)(e.rotatePlane),n=(0,N.Gd)(t.renderStart,t.renderEnd,this._displayBounds.origin,i);return H(W({},t),{rotateAxis:i,rotateAngle:n})}}_rotateDragUpdateGeometry(){return e=>{const t=(0,f.c)((0,G.c)(),this._mapBoundsStart.origin),i=[];for(const o of this._editGeometryOperations.data.components)i.push(...o.vertices);const a=this._editGeometryOperations.rotateVertices(i,t,e.rotateAngle,"start"===e.action?Lt.O.NEW_STEP:Lt.O.ACCUMULATE_STEPS,Hi.w.REPLACE);return(0,Ut.c)(this._mapBoundsStart,this._mapBounds),(0,Dt.nn)(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_calculatePickRay(e){const t=(0,Me.Ue)(),i=(0,Pt.md)(e);return(0,mn.u4)(this.view.state.camera,i,t),(0,f.n)(t.direction,t.direction),t}_updateManipulators(){if(!this.visible)return;const e=(0,nt.zY)(this._displayBounds,w.MP.get());(0,nt.A5)(this._rotateManipulator,e,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,e),this._resizeManipulators.forEach((t,i)=>{(0,nt.EC)(t,this._resizeHandles[i],e,this._displayBounds)})}_updateZMoveHandle(e,t){const i=this._displayBounds,n={basis:i.basis1,direction:-1,position:(0,f.b)(w.WM.get(),i.origin,i.basis1),edge:2},a=w.MP.get();(0,j.o)(a,t,n.edge*Math.PI/2),a[12]=0,a[13]=0,a[14]=0,e.modelTransform=a,e.renderLocation=n.position}_cancel(){const e=this._editGeometryOperations.lastOperation;(0,s.Wi)(e)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,Dt.mO)(e,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if((0,s.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,Dt.mO)((0,s.Wg)(e),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,Dt.nn)((0,s.Wg)(e),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],lt.prototype,"view",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],lt.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],lt.prototype,"enableZ",void 0),(0,p._)([(0,d.Cb)()],lt.prototype,"enableRotation",void 0),(0,p._)([(0,d.Cb)()],lt.prototype,"enableScaling",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Yt.Z})],lt.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)()],lt.prototype,"preserveAspectRatio",null),(0,p._)([(0,d.Cb)()],lt.prototype,"grabbing",void 0),(0,p._)([(0,d.Cb)()],lt.prototype,"inputState",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],lt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],lt.prototype,"_moveUnit",null),lt=(0,p._)([(0,z.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],lt);const Bi="draped-elevation-changes",_n=10,vn=80,Fi=1e-6},68371:(gt,J,u)=>{u.d(J,{Z:()=>ni});var p=u(17626),T=u(91558),s=u(14517),y=u(77712),Mt=(u(90912),u(85931),u(76898)),f=(u(50645),u(15448));u(62996);const V={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let F=class extends s.Z{get position(){return[this.x,this.y]}set position(O){this._set("x",O[0]),this._set("y",O[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const O=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${O}`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}constructor(O){super(O),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new T.Z([0,0,0,.6]),this.textColor=new T.Z([255,255,255]),this._textShadowSize=1}render(){return(0,f.h)("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(O){if(!this.visible)return;const X=O.font.replace(/^(.*?)px/,"");O.font=`${this.fontSize}px ${X}`;const B=this._padding,mt=this._borderRadius,ht=O.measureText(this.text).width,k=this.fontSize,Z=Pt[this.anchor];O.textAlign="center",O.textBaseline="middle";const It=ht+2*B,ie=k+2*B;this._roundedRect(O,this.x+Z.x*It,this.y+Z.y*ie,It,ie,mt),O.fillStyle=this.backgroundColor.toCss(!0),O.fill();const xe=this.x+(Z.x+.5)*It,ot=this.y+(Z.y+.5)*ie;this._renderTextShadow(O,this.text,xe,ot),O.fillStyle=this.textColor.toCss(!0),O.fillText(this.text,xe,ot)}_renderTextShadow(O,X,B,mt){O.lineJoin="miter",O.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/Se.length})`;const ht=this._textShadowSize;for(const[k,Z]of Se)O.fillText(X,B+ht*k,mt+ht*Z)}_roundedRect(O,X,B,mt,ht,k){O.beginPath(),O.moveTo(X,B+k),O.arcTo(X,B,X+k,B,k),O.lineTo(X+mt-k,B),O.arcTo(X+mt,B,X+mt,B+k,k),O.lineTo(X+mt,B+ht-k),O.arcTo(X+mt,B+ht,X+mt-k,B+ht,k),O.lineTo(X+k,B+ht),O.arcTo(X,B+ht,X,B+ht-k,k),O.closePath()}_cssClasses(){const O={"esri-text-overlay-item":!0};for(const X in V)O[V[X]]=this.anchor===X;return O}};(0,p._)([(0,y.Cb)()],F.prototype,"x",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"y",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"position",null),(0,p._)([(0,y.Cb)()],F.prototype,"text",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"fontSize",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"anchor",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"visible",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"backgroundColor",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"textColor",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"_textShadowSize",void 0),(0,p._)([(0,y.Cb)()],F.prototype,"_textShadowColor",null),(0,p._)([(0,y.Cb)()],F.prototype,"_textShadow",null),(0,p._)([(0,y.Cb)()],F.prototype,"_padding",null),(0,p._)([(0,y.Cb)()],F.prototype,"_borderRadius",null),F=(0,p._)([(0,Mt.j)("esri.views.overlay.TextOverlayItem")],F);const Pt={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},Se=[];for(let X=0;X<360;X+=22.5)Se.push([Math.cos(Math.PI*X/180),Math.sin(Math.PI*X/180)]);const ni=F}}]);