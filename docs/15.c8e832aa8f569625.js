"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[15],{59990:(D,u,r)=>{function l(s){var i;const a=s.layer;return"floorInfo"in a&&(null==(i=a.floorInfo)?void 0:i.floorField)&&"floors"in s.view?h(s.view.floors,a.floorInfo.floorField):null}function y(s,a){var i;return"floorInfo"in a&&(null==(i=a.floorInfo)?void 0:i.floorField)?h(s,a.floorInfo.floorField):null}function h(s,a){if(null==s||!s.length)return null;const i=s.filter(E=>""!==E).map(E=>`'${E}'`);return i.push("''"),`${a} IN (${i.join(",")}) OR ${a} IS NULL`}r.d(u,{c:()=>l,f:()=>y})},80015:(D,u,r)=>{r.r(u),r.d(u,{default:()=>w});var l=r(17626),y=r(88879),h=r(63290),s=r(62208),a=r(32917),i=r(77712),v=(r(85931),r(8314),r(90912),r(76898)),P=r(10410),F=r(98624),M=r(59990),c=r(84952),A=r(14341),p=r(52836),L=r(19702),f=r(3493),S=r(2694),g=r(22498),I=r(52565),U=r(94443),j=r(72537),R=r(41941),O=r(42964),W=r(89476),T=r(67966),K=r(40465),x=r(57610),B=r(41632),m=r(78465),Q=r(87091);const b=h.Z.getLogger("esri.views.3d.layers.SceneLayerView3D"),C=(0,T.v)();let o=class extends((0,A.N)((0,W.l)((0,K.i)((0,L.A)(m.Z))))){constructor(){super(...arguments),this.type="scene-layer-3d",this.lodFactor=1,this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._interactiveEditingSessions=new Map,this._queryEngine=null}get filter(){return this._get("filter")}set filter(e){this._set("filter",g.z.checkSupport(e)?e:null)}get viewFilter(){const e=this.filter;if((0,s.Wi)(e)&&(0,s.Wi)(this.layerFilter))return null;const t=this._get("viewFilter");return(0,s.Wi)(t)?new g.z({layerFilter:this.layerFilter,viewFilter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:n=>this._loadAsyncModule(n),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(n,_)=>this.addSqlFilter(n,_,this.logError)}):(t.viewFilter=this.filter,t.layerFilter=this.layerFilter,this.notifyChange("viewFilter"),t)}get requiredFields(){var e,t;return null!=(t=null==(e=this.fieldsHelper)?void 0:e.requiredFields)?t:[]}get floorFilterClause(){const e=(0,M.c)(this);return(0,s.pC)(e)?P.WhereClause.create(e,this.layer.fieldsIndex):null}get excludeObjectIdsSorted(){const e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((t,n)=>t-n):null}get lodCrossfadeinDuration(){var e,t;return null!=(t=null==(e=this.view)?void 0:e.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?t:0}get lodCrossfadeoutDuration(){var e,t;return null!=(t=null==(e=this.view)?void 0:e.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?t:0}get lodCrossfadeUncoveredDuration(){var e,t;return null!=(t=null==(e=this.view)?void 0:e.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?t:0}initialize(){this.fieldsHelper=new x.K({layerView:this}),this.updatingHandles.add(()=>this.layer.rangeInfos,e=>this._rangeInfosChanged(e),a.nn),this.updatingHandles.add(()=>this.layer.renderer,e=>this.updatingHandles.addPromise(this._rendererChange(e)),a.nn),this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this.filter,this.layer.filter,this.floorFilterClause,this.excludeObjectIdsSorted,(0,s.yw)(this.viewFilter,e=>[e.parsedWhereClause,e.parsedGeometry,e.sortedObjectIds])],()=>this._filterChange()),this.updatingHandles.add(()=>[this.filter,(0,s.yw)(this.viewFilter,e=>e.parsedGeometry)],()=>this._geometryFilterChange()),this.handles.add(this.layer.on("apply-edits",e=>this.updatingHandles.addPromise(e.result))),this.handles.add(this.layer.on("edits",e=>this._handleEdits(e)))}destroy(){this.fieldsHelper=(0,s.SC)(this.fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&b.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return(0,s.pC)(this.filter)?this.filter.createQuery(e):new c.Z(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null==t?void 0:t.signal).then(n=>{if(null==n||!n.features)return n;const _=this.layer;for(const d of n.features)d.layer=_,d.sourceLayer=_;return n})}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null==t?void 0:t.signal)}_ensureQueryEngine(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=(0,S.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new U.u({layerView:this,priority:Q.T8.FEATURE_QUERY_ENGINE,spatialIndex:new R.I({featureAdapter:new j.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:e}),toArray:()=>{const t=new Array;return this._forAllFeatures((n,_,d)=>(t.push({id:n,index:_,meta:d}),p.K.CONTINUE),null,p.u.ALL_IN_CLIPPING_AREA),t},forAllFeatures:(t,n)=>this._forAllFeatures((_,d,N)=>t({id:_,index:d,meta:N}),n,p.u.ALL_IN_CLIPPING_AREA),getFeatureExtent:e,sourceSpatialReference:(0,O.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e){const t=this._highlights;if(e instanceof c.Z){const{set:n,handle:_}=t.acquireSet();return this.queryObjectIds(e).then(d=>t.setFeatureIds(n,d)),_}return super.highlight(e)}createInteractiveEditSession(e){return(0,f.s)(this.attributeEditingContext,e)}_createLayerGraphic(e){const t=new y.Z(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}getFilters(){const e=super.getFilters(),t=this.excludeObjectIdsSorted;return(0,s.pC)(t)&&e.push(n=>(0,O.Yb)(t,!1,n)),this.floorFilterClause&&this.addSqlFilter(e,this.floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),(0,s.pC)(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}isUpdating(){return super.isUpdating()||this.layerFilterUpdating}_ensureQuery(e){return this._addDefinitionExpressionToQuery((0,s.Wi)(e)?this.createQuery():c.Z.from(e))}get attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:e=>this._forAllNodes(t=>(0,s.pC)(t)?e(t.node,t.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}_handleEdits(e){(0,f.Z)(this.attributeEditingContext,e)}get hasGeometryFilter(){const e=this.viewFilter;return(0,s.pC)(e)&&(0,s.pC)(e.parsedGeometry)}computeNodeFiltering(e){const t=this.viewFilter;return(0,s.Wi)(t)||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?I.U_.Unmodified:I.U_.Culled}};(0,l._)([(0,i.Cb)({aliasOf:"layer"})],o.prototype,"i3slayer",void 0),(0,l._)([(0,i.Cb)(B.q)],o.prototype,"updatingProgress",void 0),(0,l._)([(0,i.Cb)({type:F.Z})],o.prototype,"filter",null),(0,l._)([(0,i.Cb)({readOnly:!0})],o.prototype,"viewFilter",null),(0,l._)([(0,i.Cb)(C.requiredFields)],o.prototype,"requiredFields",null),(0,l._)([(0,i.Cb)(C.availableFields)],o.prototype,"availableFields",void 0),(0,l._)([(0,i.Cb)()],o.prototype,"fieldsHelper",void 0),(0,l._)([(0,i.Cb)()],o.prototype,"floorFilterClause",null),(0,l._)([(0,i.Cb)()],o.prototype,"excludeObjectIdsSorted",null),(0,l._)([(0,i.Cb)({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],o.prototype,"lodFactor",void 0),(0,l._)([(0,i.Cb)({readOnly:!0,aliasOf:"_controller.updatingProgress"})],o.prototype,"updatingProgressValue",void 0),o=(0,l._)([(0,v.j)("esri.views.3d.layers.SceneLayerView3D")],o);const w=o}}]);