"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[299],{19702:(x,M,t)=>{t.d(M,{A:()=>g});var p=t(15861),y=t(17626),D=t(54024),E=t(10699),v=t(32917),P=t(77712),c=(t(90912),t(85931),t(76898)),I=t(36947);const g=W=>{let r=class extends W{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(_){super.postscript(_),(0,I.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var _=this;return(0,p.Z)(function*(){const o=new AbortController,l=o.signal;_.handles.add((0,D.kB)(()=>o.abort())),yield(0,v.N1)(()=>{var f;return null==(f=_.view.defaultsFromMap)?void 0:f.heightModelInfoReady},l),(0,E.k_)(l);const m=(0,I.Wt)(_.layer,_.view.heightModelInfo,_.supportsHeightUnitConversion);if(m)throw m})()}canResume(){const _=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!_||!_.minScale||!_.maxScale||_.minScale>=_.maxScale)}getSuspendInfo(){const _=super.getSuspendInfo(),o=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return o&&o.minScale&&o.maxScale&&o.minScale<o.maxScale&&(_.outsideScaleRange=!0),_}};return(0,y._)([(0,P.Cb)()],r.prototype,"view",void 0),(0,y._)([(0,P.Cb)()],r.prototype,"slicePlaneEnabled",void 0),r=(0,y._)([(0,c.j)("esri.views.3d.layers.LayerView3D")],r),r}},19991:(x,M,t)=>{t.r(M),t.d(M,{default:()=>j});var d,s,p=t(15861),y=t(17626),E=(t(29132),t(26584)),v=t(72392),P=t(63290),a=t(62208),h=t(32917),c=t(77712),W=(t(90912),t(85931),t(76898)),r=t(84161),_=t(28093),o=t(55915),l=t(5548),m=t(37053),f=t(19702),w=t(40465),T=t(45611),A=t(57596),B=t(65234);(s=d||(d={}))[s.API=1]="API",s[s.VerboseAPI=2]="VerboseAPI",s[s.Error=3]="Error";const b=(0,_.c)(),U=(0,_.c)();let O=class extends((0,w.i)((0,f.A)(T.Z))){constructor(){super(...arguments),this._suspendedHandle=null,this._usedMemory=0,this._futureMemory=0,this.type="voxel-3d",this.slicePlaneEnabled=!1,this._wasmLayerId=-1,this._handles=new v.Z,this._dbgFlags=new Set}get baseUrl(){var s,e;return null!=(e=null==(s=this.layer.parsedUrl)?void 0:s.path)?e:""}get wasmLayerId(){return this._wasmLayerId}initialize(){var L;if(this._dbgFlags.add(d.Error),"local"!==this.view.viewingMode)throw new E.Z("voxel:unsupported-viewingMode","Voxel layers support local viewingMode only.",{});if(this.view._stage.renderView.renderingContext.type!==A.zO.WEBGL2)throw new E.Z("voxel:unsupported-context","Voxel layers are supported in WebGL2 rendering contexts only.",{});if(null==(L=this.view._stage.renderView.renderingContext.capabilities.colorBufferFloat)||!L.textureFloat)throw new E.Z("voxel:missing-color-buffer-float","Voxel layers require the WebGL2 extension EXT_color_buffer_float",{});if(!(0,m.fS)(this.layer.spatialReference,this.view.spatialReference))throw new E.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});const e=this.layer.currentVariableId,i=this.layer.getVolume(e),u=this.layer.getVariable(e);if((0,a.pC)(i)&&(0,a.pC)(u)){const S=i.dimensions[0],n=i.dimensions[1],V=i.zDimension;if(V>1){const F=S.size*n.size*i.dimensions[V].size;let R=1;switch(u.renderingFormat.type){case"Int16":case"UInt16":R=2;break;case"Int32":case"UInt32":case"Float32":R=4}this._futureMemory=R*F}}const C=this.view.addVoxelLayerViewToWasm(this).then(S=>{this._wasmLayerId=S,this._suspendedHandle=(0,h.YP)(()=>this.suspended,n=>{const V=this.view.voxelWasm;(0,a.pC)(V)&&V.setEnabled(this,!n)},h.nn),this._handles.add([(0,h.YP)(()=>this.layer.renderMode,n=>this._pushRenderModeToWasm(n)),(0,h.YP)(()=>this.layer.currentVariableId,n=>this._pushCurrentVariableIdToWasm(n)),(0,h.YP)(()=>this.layer.getSections(),n=>this._pushSectionsToWasm(n)),(0,h.YP)(()=>this.layer.getVariableStyles(),n=>this._pushVariableStylesToWasm(n)),(0,h.YP)(()=>this.layer.getVolumeStyles(),n=>this._pushVolumeStylesToWasm(n)),(0,h.YP)(()=>this.layer.enableDynamicSections,n=>this._pushEnableDynamicSectionsToWasm(n)),(0,h.YP)(()=>this.layer.enableIsosurfaces,n=>this._pushEnableIsosurfacesToWasm(n)),(0,h.YP)(()=>this.layer.enableSections,n=>this._pushEnableSectionsToWasm(n)),(0,h.YP)(()=>this.layer.enableSlices,n=>this._pushEnableSlicesToWasm(n)),(0,h.YP)(()=>this.slicePlaneEnabled,n=>this._pushAnalysisSliceToWasm(n,this.view.slicePlane)),(0,h.YP)(()=>this.view.slicePlane,n=>this._pushAnalysisSliceToWasm(this.slicePlaneEnabled,n))])}).catch(S=>{if(this.view.removeVoxelLayerViewFromWasm(this),this._wasmLayerId=-1,-1===S)throw new E.Z("voxel:addLayer-failure","The voxel layer description was invalid.",{});if(-2===S)throw new E.Z("voxel:addLayer-failure","The voxel layer web assembly module failed to download.",{})});this.addResolvingPromise(C)}destroy(){this.view.removeVoxelLayerViewFromWasm(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._handles=(0,a.SC)(this._handles)}isUpdating(){const s=this.view.voxelWasm;return!(this._wasmLayerId<0||!(0,a.pC)(s))&&s.isUpdating(this._wasmLayerId)}updatingFlagChanged(){this.notifyChange("updating")}getUsedMemory(){return this._usedMemory}getUnloadedMemory(){return this._futureMemory}ignoresMemoryFactor(){return!0}get performanceInfo(){return{nodes:0,displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null}}whenGraphicBounds(s,e){const i=s.attributes["Voxel.WorldPosition"];if(i){const u=(0,l.cS)(),C=JSON.parse(i);if((0,o.SH)(C,this.view.renderSpatialReference,U,this.view.spatialReference||B.Z.WGS84))return(0,l.pp)(u,U),Promise.resolve({boundingBox:u,screenSpaceObjects:[]})}return Promise.reject()}setUsedMemory(s){this._usedMemory=s,this._futureMemory=0}captureFrustum(){const s=this.view.voxelWasm;(0,a.pC)(s)&&s.captureFrustum()}toggleFullVolumeExtentDraw(){const s=this.view.voxelWasm;(0,a.pC)(s)&&s.toggleFullVolumeExtentDraw(this)}getLayerTimes(){let s=[];const e=this.view.voxelWasm;return(0,a.pC)(e)&&(s=e.getLayerTimes(this)),s}getCurrentLayerTimeIndex(){let s=0;const e=this.view.voxelWasm;return(0,a.pC)(e)&&(s=e.getCurrentLayerTimeIndex(this)),s}_pushRenderModeToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushRenderModeToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!")),(0,a.pC)(e)&&e.setRenderMode(this,s)||this._dbg(d.Error,"VoxelLayerView3D._pushRenderModeToWasm() failed!")}_pushSectionsToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushSectionsToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!")),(0,a.pC)(e)&&e.setStaticSections(this,s)||this._dbg(d.Error,"VoxelLayerView3D._pushSectionsToWasm() failed!")}_pushCurrentVariableIdToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushCurrentVariableIdToWasm() called!, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!")),(0,a.pC)(e)&&e.setCurrentVariable(this,s)||this._dbg(d.Error,"VoxelLayerView3D._pushCurrentVariableIdToWasm() failed!")}_pushVariableStylesToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushVariableStylesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let i=!1;(0,a.pC)(e)&&(i=e.setVariableStyles(this,s),i||this._dbg(d.Error,"VoxelLayerView3D._pushVariableStylesToWasm() failed!"))}_accountForEnableSlices(s,e){const i=(0,a.pC)(e)?e:this.layer.enableSlices;for(let u=0;u<s.length;++u){const C=s[u];for(const L of C.slices)L.enabled=L.enabled&&i}}_pushVolumeStylesToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushVolumeStylesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let i=!1;(0,a.pC)(e)&&(this._accountForEnableSlices(s,null),i=e.setVolumeStyles(this,s),i||this._dbg(d.Error,"VoxelLayerView3D._pushVolumeStylesToWasm() failed!"))}_pushAnalysisSliceToWasm(s,e){const i=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushAnalysisSliceToWasm() called, "+((0,a.pC)(i)?"have WASM":"don't have WASM!!!"));let u=!1;if((0,a.pC)(i)){if((0,a.pC)(e)){const C=e.origin;(0,r.f)(b,e.basis1,e.basis2),(0,r.n)(b,b),u=i.setAnalysisSlice(this,s,C,b)}else(0,r.s)(b,0,0,1),u=i.setAnalysisSlice(this,!1,b,b);u||this._dbg(d.Error,"VoxelLayerView3D._pushAnalysisSliceToWasm() failed!")}}_pushEnableDynamicSectionsToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushEnableDynamicSectionsToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let i=!1;(0,a.pC)(e)&&(i=e.setEnableDynamicSections(this,s),i||this._dbg(d.Error,"VoxelLayerView3D._pushEnableDynamicSectionsToWasm() failed!"))}_pushEnableSlicesToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushEnableSlicesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let i=!1;if((0,a.pC)(e)){const u=this.layer.getVolumeStyles();this._accountForEnableSlices(u,s),i=e.setVolumeStyles(this,u),i||this._dbg(d.Error,"VoxelLayerView3D._pushEnableSlicesToWasm() failed!")}}_pushEnableIsosurfacesToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushEnableIsosurfacesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let i=!1;(0,a.pC)(e)&&(i=e.setEnableIsosurfaces(this,s),i||this._dbg(d.Error,"VoxelLayerView3D._pushEnableIsosurfacesToWasm() failed!"))}_pushEnableSectionsToWasm(s){const e=this.view.voxelWasm;this._dbg(d.VerboseAPI,"VoxelLayerView3D._pushEnableSectionsToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let i=!1;(0,a.pC)(e)&&(i=e.setEnableSections(this,s),i||this._dbg(d.Error,"VoxelLayerView3D._pushEnableSectionsToWasm() failed!"))}whenGraphicAttributes(s,e){return(0,p.Z)(function*(){return s})()}_dbg(s,e){this._dbgFlags.has(s)&&(s===d.Error?P.Z.getLogger(this.declaredClass).error(e):P.Z.getLogger(this.declaredClass).warn(e))}};(0,y._)([(0,c.Cb)()],O.prototype,"layer",void 0),(0,y._)([(0,c.Cb)()],O.prototype,"baseUrl",null),(0,y._)([(0,c.Cb)({type:Boolean})],O.prototype,"slicePlaneEnabled",void 0),O=(0,y._)([(0,W.j)("esri.views.3d.layers.VoxelLayerView3D")],O);const j=O},45611:(x,M,t)=>{t.d(M,{Z:()=>_});var p=t(17626),y=t(14517),D=t(61885),E=t(80542),v=t(61996),P=t(63290),a=t(62208),h=t(60330),c=t(77712),W=(t(90912),t(85931),t(76898));let r=class extends((0,E.p)((0,v.IG)((0,h.v)(D.Z.EventedMixin(y.Z))))){constructor(o){super(o),this.layer=null,this.parent=null}initialize(){this.when().catch(o=>{if("layerview:create-error"!==o.name){const l=this.layer&&this.layer.id||"no id",m=this.layer&&this.layer.title||"no title";P.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${m}', id: '${l}')`,o)}})}get fullOpacity(){return(0,a.Pt)(this.get("layer.opacity"),1)*(0,a.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var o;return!this.suspended&&!0===(null==(o=this.layer)?void 0:o.legendEnabled)}get updating(){var o;return!!(null!=(o=this.updatingHandles)&&o.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var o;return!0===(null==(o=this.layer)?void 0:o.visible)}set visible(o){this._overrideIfSome("visible",o)}canResume(){var o,l,m;return this.visible&&(null==(o=this.layer)?void 0:o.loaded)&&!(null!=(l=this.parent)&&l.suspended)&&(null==(m=this.view)?void 0:m.ready)||!1}getSuspendInfo(){const o=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(o.viewNotReady=!0),this.layer&&this.layer.loaded||(o.layerNotLoaded=!0),this.visible||(o.layerInvisible=!0),o}isUpdating(){return!1}};(0,p._)([(0,c.Cb)()],r.prototype,"fullOpacity",null),(0,p._)([(0,c.Cb)()],r.prototype,"layer",void 0),(0,p._)([(0,c.Cb)()],r.prototype,"parent",void 0),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"suspended",null),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"suspendInfo",null),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"legendEnabled",null),(0,p._)([(0,c.Cb)({type:Boolean,readOnly:!0})],r.prototype,"updating",null),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"updatingProgress",null),(0,p._)([(0,c.Cb)()],r.prototype,"visible",null),(0,p._)([(0,c.Cb)()],r.prototype,"view",void 0),r=(0,p._)([(0,W.j)("esri.views.layers.LayerView")],r);const _=r},10023:(x,M,t)=>{t.d(M,{V:()=>P,e:()=>E});var p=t(15861),y=t(62208),D=t(36630);function E(a){return v.apply(this,arguments)}function v(){return(v=(0,p.Z)(function*(a,h=a.popupTemplate){var m,f;if((0,y.Wi)(h))return[];const c=yield h.getRequiredFields(a.fieldsIndex),{lastEditInfoEnabled:I}=h,{objectIdField:g,typeIdField:W,globalIdField:r,relationships:_}=a;if(c.includes("*"))return["*"];const o=I?yield(0,D.CH)(a):[],l=(0,D.Q0)(a.fieldsIndex,[...c,...o]);return W&&l.push(W),l&&g&&(null==(m=a.fieldsIndex)?void 0:m.has(g))&&!l.includes(g)&&l.push(g),l&&r&&(null==(f=a.fieldsIndex)?void 0:f.has(r))&&!l.includes(r)&&l.push(r),_&&_.forEach(w=>{var A;const{keyField:T}=w;l&&T&&(null==(A=a.fieldsIndex)?void 0:A.has(T))&&!l.includes(T)&&l.push(T)}),l})).apply(this,arguments)}function P(a,h){return a.popupTemplate?a.popupTemplate:(0,y.pC)(h)&&h.defaultPopupTemplateEnabled&&(0,y.pC)(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}}}]);