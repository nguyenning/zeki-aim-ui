"use strict";var pt=Object.defineProperty,_t=Object.defineProperties,mt=Object.getOwnPropertyDescriptors,tt=Object.getOwnPropertySymbols,yt=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable,it=(re,j,t)=>j in re?pt(re,j,{enumerable:!0,configurable:!0,writable:!0,value:t}):re[j]=t,ve=(re,j)=>{for(var t in j||(j={}))yt.call(j,t)&&it(re,t,j[t]);if(tt)for(var t of tt(j))ft.call(j,t)&&it(re,t,j[t]);return re},je=(re,j)=>_t(re,mt(j));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[8203],{46668:(re,j,t)=>{t.d(j,{a:()=>y});const x=2654435761,s=2246822519,L=3266489917,v=668265263,b=374761393;function a(W){const f=[];for(let u=0,p=W.length;u<p;u++){let E=W.charCodeAt(u);E<128?f.push(E):E<2048?f.push(192|E>>6,128|63&E):E<55296||E>=57344?f.push(224|E>>12,128|E>>6&63,128|63&E):(u++,E=65536+((1023&E)<<10|1023&W.charCodeAt(u)),f.push(240|E>>18,128|E>>12&63,128|E>>6&63,128|63&E))}return new Uint8Array(f)}class y{constructor(f){this._seed=f,this._totallen=0,this._bufs=[],this.init()}init(){return this._bufs=[],this._totallen=0,this}updateFloatArray(f){const u=[];for(const p of f)isNaN(p)?u.push("NaN"):u.push(p===1/0?"Infinity":p===-1/0?"-Infinity":0===p?"0":p.toString(16));this.update(a(u.join("")))}updateIntArray(f){const u=Int32Array.from(f);this.update(new Uint8Array(u.buffer))}updateUint8Array(f){this.update(Uint8Array.from(f))}updateWithString(f){return this.update(a(f))}update(f){return this._bufs.push(f),this._totallen+=f.length,this}digest(){const f=new Uint8Array(this._totallen);let u=0;for(const p of this._bufs)f.set(p,u),u+=p.length;return this.init(),this._xxHash32(f,this._seed)}_xxHash32(f,u=0){const p=f;let E=u+b&4294967295,A=0;if(p.length>=16){const o=[u+x+s&4294967295,u+s&4294967295,u+0&4294967295,u-x&4294967295],P=f,T=P.length-16;let B=0;for(A=0;(4294967280&A)<=T;A+=4){let se=o[B]+((P[A+0]+(P[A+1]<<8))*s+((P[A+2]+(P[A+3]<<8))*s<<16))&4294967295;se=se<<13|se>>>19,o[B]=(65535&se)*x+((se>>>16)*x<<16)&4294967295,B=B+1&3}E=(o[0]<<1|o[0]>>>31)+(o[1]<<7|o[1]>>>25)+(o[2]<<12|o[2]>>>20)+(o[3]<<18|o[3]>>>14)&4294967295}E=E+f.length&4294967295;const m=f.length-4;for(;A<=m;A+=4)E=E+((p[A+0]+(p[A+1]<<8))*L+((p[A+2]+(p[A+3]<<8))*L<<16))&4294967295,E=E<<17|E>>>15,E=(65535&E)*v+((E>>>16)*v<<16)&4294967295;for(;A<p.length;++A)E+=p[A]*b,E=E<<11|E>>>21,E=(65535&E)*x+((E>>>16)*x<<16)&4294967295;return E^=E>>>15,E=((65535&E)*s&4294967295)+((E>>>16)*s<<16),E^=E>>>13,E=((65535&E)*L&4294967295)+((E>>>16)*L<<16),E^=E>>>16,E<0?E+4294967296:E}}},88034:(re,j,t)=>{t.d(j,{H:()=>W,b:()=>y});var x=t(39523),s=t(49480),L=t(65787),v=t(17625),b=t(22355),a=t(35387);function y(f){const u=new b.kG;u.include(x.k),u.include(s.f);const{usesHalfFloat:p}=f;return u.fragment.uniforms.add([new a.A("densityMap",E=>E.densityMap),new a.A("tex",E=>E.colorRamp),new L.p("densityNormalizer",E=>1/(E.maxDensity-E.minDensity)),new L.p("minDensity",E=>E.minDensity)]),u.fragment.uniforms.add(new L.p("densityMultiplier",E=>3/(E.searchRadius*E.searchRadius*Math.PI))),p&&u.constants.add("compressionFactor","float",4),u.fragment.code.add(v.H`
    void main() {
      float density = texture2D(densityMap, uv).r * densityMultiplier${p?v.H` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      gl_FragColor = color;
    }
  `),u}const W=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}))},81768:(re,j,t)=>{t.d(j,{H:()=>y,b:()=>a});var x=t(2166),s=t(65787),L=t(17625),v=t(22355),b=t(16396);function a(W){const f=new v.kG,{vertex:u,fragment:p}=f;(0,x.Sv)(u,W);const{isAttributeDriven:E,usesHalfFloat:A}=W;return f.attributes.add(b.T.POSITION,"vec3"),f.attributes.add(b.T.UV0,"vec2"),E&&(f.attributes.add(b.T.FEATUREATTRIBUTE,"float"),f.varyings.add("attributeValue","float")),A&&f.constants.add("compressionFactor","float",.25),f.varyings.add("unitCirclePos","vec2"),u.uniforms.add(new s.p("radius",({resolutionForScale:m,searchRadius:o},{camera:P,screenToWorldRatio:T})=>2*o*(0===m?1:m/T)*P.pixelRatio/P.fullViewport[2])),u.code.add(L.H`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${b.T.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${E?L.H`attributeValue = ${b.T.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `),p.code.add(L.H`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${E?L.H` * attributeValue`:""} ${A?L.H` * compressionFactor`:""};
      gl_FragColor = vec4(density);
    }
  `),f}const y=Object.freeze(Object.defineProperty({__proto__:null,build:a},Symbol.toStringTag,{value:"Module"}))},23010:(re,j,t)=>{t.d(j,{g:()=>J});var x=t(15861),s=t(17626),L=t(14517),v=t(59213),b=t(46160),y=(t(8314),t(26584)),W=t(72392),f=t(58817),u=t(63290),p=t(62208),E=t(60330),A=t(10699),m=t(32917),o=t(77712),T=(t(90912),t(76898)),B=t(17760),S=t(38305),$=t(72469),Z=t(35082),te=t(60776),se=t(54984),ue=t(88879),ce=t(37118),he=t(9260),_e=t(69852),me=t(89673),Fe=t(21716),xe=t(23461);const G=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];class Re{constructor(h,I,X){this._loadingGraphics=new Map,this._loadedGraphics=new Map,this._pendingGraphics=new Map,this._dataExtentGraphic=null,this._enabled=!0,this._tileFetcher=h,this._view=X,this._tilingScheme=new xe.t(I),this._loadedSymbols=G.map(Q=>new me.Z(new he.Z({material:{color:[Q[0],Q[1],Q[2],.6]},outline:{color:"black",size:1}}))),this._loadingSymbols=[new me.Z(new he.Z({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this._pendingSymbols=[new me.Z(new he.Z({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this._dataExtentSymbol=new me.Z(new he.Z({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}destroy(){this.enabled=!1}get enabled(){return this._enabled}set enabled(h){this._enabled=h,this.update()}update(){this._enabled?(this._synchronizeMaps(this._loadingGraphics,{filter:h=>h.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:h=>!h.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:h=>!h.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(h=>{this._view.graphics.removeMany(h)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(h=>{this._view.graphics.removeMany(h)}),this._loadedGraphics.clear(),this._pendingGraphics.forEach(h=>{this._view.graphics.removeMany(h)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))}showDataExtent(h){if(this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null),(0,p.Wi)(h))return;const I=ce.Z.fromExtent(h);this._dataExtentGraphic=new ue.Z({geometry:I,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic)}_synchronizeMaps(h,I){const X=[];h.forEach((Q,Y)=>{const ne=this._tileFetcher.test.getFeatureTileById(Y);ne&&I.filter(ne)||(this._view.graphics.removeMany(Q),X.push(Y))}),X.forEach(Q=>h.delete(Q)),this._tileFetcher.test.forEachFeatureTile(Q=>{if(I.filter(Q)&&!h.has(Q.id)){const[Y,ne,fe]=Q.descriptor.lij;this._tilingScheme.ensureMaxLod(Y);const ee=this._tilingScheme.getExtentGeometry(Y,ne,fe),pe=[new ue.Z({geometry:ee,symbol:I.symbols[Y%I.symbols.length]}),new ue.Z({geometry:ee.center,symbol:new _e.Z({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new Fe.Z({text:`${Y}/${ne}/${fe}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];h.set(Q.id,pe),this._view.graphics.addMany(pe)}})}}var Te=t(93605);let J=class extends((0,E.v)(L.Z)){set extent(g){if((0,p.pC)(g)&&!g.spatialReference.equals(this.layerView.view.spatialReference))return void u.Z.getLogger(this.declaredClass).error("#extent=","extent needs to be in the same spatial reference as the view");const h=this._get("extent");if(h===g||(0,p.pC)(h)&&g&&h.equals(g))return;const I=(0,p.pC)(g)?g.clone():null;this._set("extent",I)}get updating(){return!!((0,p.pC)(this._tileFetcher)&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._watchUpdatingTracking&&this._watchUpdatingTracking.updating)}get updatingTotal(){return this.updating&&(0,p.pC)(this._tileFetcher)?this._tileFetcher.updatingTotal:0}get updatingRemaining(){return this.updating&&(0,p.pC)(this._tileFetcher)?this._tileFetcher.updatingRemaining:0}get expectedFeatureDiff(){return this.updating&&(0,p.pC)(this._tileFetcher)?this._tileFetcher.expectedFeatureDiff:0}get memoryForUnusedFeatures(){return(0,p.pC)(this._tileFetcher)?this._tileFetcher.memoryForUnusedFeatures:0}get maximumNumberOfFeaturesExceeded(){return!(!(0,p.pC)(this._tileFetcher)||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}get maximumNumberOfFeatures(){return(0,p.pC)(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0}set maximumNumberOfFeatures(g){g!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",g)}get hasMaximumNumberOfFeaturesOverride(){return this._isOverridden("maximumNumberOfFeatures")}get mode(){var Q,Y;const g=this.layerView.layer;if("feature"===g.type&&(0,p.pC)(g.infoFor3D))return"snapshot";if(!1===(null==(Y=null==(Q=this.layerView.view.qualitySettings)?void 0:Q.graphics3D)?void 0:Y.snapshotAvailable)||this.serviceDataCount===ie.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";const h=this.layerView.view,I=h&&h.featureTiles,X=I&&I.tilingScheme;if(g&&g.minScale&&this.serviceDataExtent&&X){const ne=this._approximateExtentSizeAtScale(g.minScale,X);if((this.serviceDataExtent.width/ne+this.serviceDataExtent.height/ne)/2>ie.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}get maxTotalSnapshotVertices(){const g=this._get("maxTotalSnapshotVertices")||0,h="snapshot"===this.mode&&(0,p.pC)(this._tileFetcher)&&this._tileFetcher.totalVertices||0;return Math.max(g,h)}_approximateExtentSizeAtScale(g,h){const I=this.layerView.view,X=Math.ceil((I.width/h.pixelSize+I.height/h.pixelSize)/2),Q=h.levels[0];return X*((Q.tileSize[0]/(Q.scale/g)+Q.tileSize[1]/(Q.scale/g))/2)}get tileDescriptors(){return"snapshot"===this.mode?new b.Z([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new b.Z}get test(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}constructor(g){super(g),this.type="feature-tile-3d",this._watchUpdatingTracking=new B.t,this.serviceDataExtent=null,this.serviceDataCount=ie.NO_SERVICE_DATA_COUNT,this.vertexLimitExceeded=!1,this.displayFeatureLimit=null,this._suspended=!1,this._tileFetcher=null,this._handles=new W.Z,this._fetchDataInfoPromise=null,this._fetchDataInfoAbortController=null,this._lifeCycleAbortController=new AbortController}initialize(){this._watchUpdatingTracking.add(()=>this.vertexLimitInfo,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this._lifeCycleAbortController.signal))),this._watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),m.nn),this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))}_verifyCapabilities(){var h;const g=this.layerView.layer;if("ogc-feature"!==g.type&&(null==(h=(0,$.S1)(g))||!h.operations.supportsQuery))throw new y.Z("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:g})}destroy(){this._cancelFetchServiceDataInfo(),this._tileFetcher=(0,p.SC)(this._tileFetcher),this._handles=(0,p.SC)(this._handles),this._tilesHandle=(0,p.hw)(this._tilesHandle),this._lifeCycleAbortController=(0,p.IM)(this._lifeCycleAbortController),this._watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)}suspend(){this._suspended||(this._suspended=!0,(0,p.pC)(this._tileFetcher)&&this._tileFetcher.suspend())}resume(){this._suspended&&(this._suspended=!1,(0,p.pC)(this._tileFetcher)&&this._tileFetcher.resume())}restart(){const g=()=>{(0,p.pC)(this._tileFetcher)&&this._tileFetcher.restart()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(g,g))}refetch(){const g=()=>{(0,p.pC)(this._tileFetcher)&&this._tileFetcher.refetch()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(g,g))}_initializeTileFetcher(){const g=this.layerView.view;if(!g)return;const h=(0,m.N1)(()=>{var I;return null==(I=g.featureTiles)?void 0:I.tilingScheme},this._lifeCycleAbortController.signal);this._watchUpdatingTracking.addPromise(h),h.then(()=>{const{layerView:I,tileDescriptors:X}=this,Q=I.layer,Y=new se.j({context:this.context,filterExtent:this.extent,tileDescriptors:X,features:this.graphics});this._tileFetcher=Y,this._suspended?this._tileFetcher.suspend():this._tileFetcher.resume();const ne=this.layerView.view.resourceController;ne&&this._handles.add((0,m.YP)(()=>ne.memoryController.memoryFactor,U=>Y.memoryFactor=U,m.tX));const fe="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;fe&&this._handles.add((0,m.YP)(()=>{var U,de,Ce;return null==(Ce=null==(de=null==(U=this.layerView.view)?void 0:U.qualitySettings)?void 0:de.graphics3D)?void 0:Ce[fe]},U=>Y.lodFactor=U||1,m.nn)),"ogc-feature"!==Q.type&&this._watchUpdatingTracking.add(()=>Q.createQueryVersion,()=>this._dataFilterChanged()),this._watchUpdatingTracking.add(()=>I.availableFields,(U,de)=>this._availableFieldsChanged(de,U)),this._watchUpdatingTracking.add(()=>I.requiredFields,(U,de)=>this._requiredFieldsChanged(de,U)),this._handles.add([Q.on("apply-edits",U=>this._applyEdits(U)),(0,m.YP)(()=>this.extent,U=>Y.filterExtent=U,m.Z_),(0,m.YP)(()=>this.tileDescriptors,U=>Y.tileDescriptors=U,m.Z_),(0,m.YP)(()=>this.maximumNumberOfFeatures,U=>{Y.maximumNumberOfFeatures=U,Y.useTileCount=this.serviceDataCount>U},m.tX),(0,m.YP)(()=>this.serviceDataCount,U=>Y.useTileCount=U>this.maximumNumberOfFeatures,m.tX),(0,m.YP)(()=>Te.Z.FEATURE_TILE_FETCH_SHOW_TILES,U=>{U&&Y&&!Y.debugger?(Y.debugger=new Re(Y,g.featureTiles.tilingScheme.toTileInfo(),g),Y.debugger.update()):!U&&this._tileFetcher&&Y.debugger&&(Y.debugger.destroy(),Y.debugger=null)},m.tX)]),this._supportsExceedsLimitQuery||this._watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this._lifeCycleAbortController.signal)))}).catch(()=>{})}_modeChanged(){switch(this.mode){case"tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:u.Z.getLogger(this.declaredClass).warn("Unhandled feature layer mode "+this.mode);case"snapshot":(0,p.pC)(this._tilesHandle)&&(this._tilesHandle.remove(),this._tilesHandle=null)}}_dataFilterChanged(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()}_applyEdits(g){(0,p.Wi)(this._tileFetcher)||this._tileFetcher.applyEdits(g).then(h=>{if(h){if(!this._lifeCycleAbortController)throw(0,A.zE)();(h.deletedFeatures.length||h.updatedFeatures.length||h.addedFeatures.length)&&this._watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(h=>{if(!(0,A.D_)(h))throw h})}_availableFieldsChanged(g,h){(0,p.pC)(this._tileFetcher)&&q(this._tileFetcher.availableFields,h)&&this.refetch()}_requiredFieldsChanged(g,h){(0,p.pC)(this._tileFetcher)&&q(this._tileFetcher.availableFields,h)&&this.restart()}_createVertexLimitExceededQuery(g){var X;const h=this.layerView.layer,I=h.createQuery();return I.outStatistics=[new te.Z({statisticType:"exceedslimit",maxVertexCount:g,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],null!=(X=h.capabilities)&&X.query.supportsCacheHint&&(I.cacheHint=!0),I}_createDataInfoQuery(){var I;const g=this.layerView.layer,h=g.createQuery();return h.outSpatialReference=this.layerView.view.spatialReference,null!=(I=g.capabilities)&&I.query.supportsCacheHint&&(h.cacheHint=!0),h}_fullExtentIsAccurate(){const g=this.layerView.layer;if(g.definitionExpression)return!1;switch(g.type){case"feature":case"oriented-imagery":return(0,S.M8)(g.url);case"csv":case"geojson":case"ogc-feature":case"wfs":return!0;default:return}}_updateServiceDataExtent(g){var h=this;return(0,x.Z)(function*(){try{yield h._tryUpdateServiceDataExtent(g)}catch(I){(0,A.D_)(I)||h._set("serviceDataExtent",(0,f.d9)(h.layerView.fullExtentInLocalViewSpatialReference))}})()}_tryUpdateServiceDataExtent(g){var h=this;return(0,x.Z)(function*(){var pe,U;const I=h.layerView,X=I.layer,Q=null!=(U=null==(pe=X.capabilities)?void 0:pe.query.supportsExtent)&&U,Y=(0,f.d9)(I.fullExtentInLocalViewSpatialReference),ne=X.fullExtent,fe=h._fullExtentIsAccurate();if(Q&&h.serviceDataCount<=ie.MAX_FEATURE_COUNT_FOR_EXTENT&&(!Y||!fe)&&"queryExtent"in X){const de=h._createDataInfoQuery(),Ce=yield X.queryExtent(de,{timeout:ie.QUERY_EXTENT_TIMEOUT,signal:g});h._set("serviceDataExtent",Ce.extent)}else if(Y)h._set("serviceDataExtent",Y);else if((0,p.pC)(ne)){const de="portalItem"in X?X.portalItem:null,Ce=yield(0,Z.projectGeometry)(ne,I.view.spatialReference,de,g);h._set("serviceDataExtent",Ce)}else h._set("serviceDataExtent",null)})()}_updateServiceDataCount(g){var h=this;return(0,x.Z)(function*(){const I=h.layerView.layer;if(!("queryFeatureCount"in I))return void h._set("serviceDataCount",ie.NO_SERVICE_DATA_COUNT);const X=yield(0,v.q6)(I.queryFeatureCount(h._createDataInfoQuery(),{timeout:ie.QUERY_STATISTICS_TIMEOUT,signal:g}));if(!0===X.ok)h._set("serviceDataCount",X.value);else{if((0,A.D_)(X.error))throw X.error;h._set("serviceDataCount",ie.NO_SERVICE_DATA_COUNT)}})()}get vertexLimitInfo(){if((0,p.Wi)(this.displayFeatureLimit)||(0,p.Wi)(this.displayFeatureLimit.averageSymbolComplexity))return null;const{averageSymbolComplexity:g,maximumTotalNumberOfPrimitives:h}=this.displayFeatureLimit,{primitivesPerCoordinate:I,primitivesPerFeature:X}=g,Q=this._get("vertexLimitInfo");return(0,p.Wi)(Q)||Q.maximumTotalNumberOfPrimitives!==h||Q.primitivesPerCoordinate!==I||Q.primitivesPerFeature!==X?{primitivesPerCoordinate:I,primitivesPerFeature:X,maximumTotalNumberOfPrimitives:h}:Q}get _supportsExceedsLimitQuery(){const g=this.layerView.layer;return null!=g.capabilities&&g.capabilities.operations&&g.capabilities.operations.supportsExceedsLimitStatistics}get _minimumNumberOfVerticesForGeometry(){switch(this.layerView.layer.geometryType){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return 0}}_updateVertexLimitExceeded(g,h){var I=this;return(0,x.Z)(function*(){const X=I.vertexLimitInfo;if((0,p.Wi)(X))return void I._set("vertexLimitExceeded",!1);const Y=I._minimumNumberOfVerticesForGeometry>1;if(!(X.primitivesPerFeature<=0||Y))return void I._set("vertexLimitExceeded",!1);const{primitivesPerFeature:ne,primitivesPerCoordinate:fe,maximumTotalNumberOfPrimitives:ee}=X;let pe;0!==ne&&(0,p.pC)(g)&&(yield g);const U=I.serviceDataCount,de=U!==ie.NO_SERVICE_DATA_COUNT;if(pe=Math.ceil(de?(ee-U*ne)/(fe||1):ee/(fe||1)),Y&&(pe=Math.min(pe,K)),de&&I._minimumNumberOfVerticesForGeometry*U>pe)return void I._set("vertexLimitExceeded",!0);if(!I._supportsExceedsLimitQuery)return void I._set("vertexLimitExceeded",I.maxTotalSnapshotVertices>pe);const Ce=yield(0,v.q6)(I.layerView.layer.queryFeatures(I._createVertexLimitExceededQuery(pe),{timeout:ie.QUERY_STATISTICS_TIMEOUT,signal:h}));if(!1===Ce.ok){if((0,A.D_)(Ce.error))throw Ce.error;return void I._set("vertexLimitExceeded",!1)}const be=Ce.value.features[0];I._set("vertexLimitExceeded",!(!be||!be.attributes||!be.attributes.exceedslimit))})()}_fetchServiceDataInfo(){var g=this;return(0,x.Z)(function*(){g._cancelFetchServiceDataInfo();let h=new AbortController;const I=h.signal,X=g._updateServiceDataCount(I),Q=(0,A.as)([X,g._updateVertexLimitExceeded(X,I)]),Y=Q.then(()=>g._updateServiceDataExtent(I)).catch(ne=>{(0,A.D_)(ne)||u.Z.getLogger(g.declaredClass).error("#fetchServiceDataInfo()",ne)}).then(()=>{Y===g._fetchDataInfoPromise&&(g._fetchDataInfoPromise=null,g._fetchDataInfoAbortController=null),h=null});return h&&(g._fetchDataInfoPromise=Y),g._fetchDataInfoAbortController=h,Q.then(()=>{},()=>{})})()}_cancelFetchServiceDataInfo(){const g=this._fetchDataInfoAbortController;g&&(this._fetchDataInfoAbortController=null,this._fetchDataInfoPromise=null,g.abort())}get debug(){return{storedFeatures:(0,p.pC)(this._tileFetcher)?this._tileFetcher.storedFeatures:0,totalFeatures:(0,p.pC)(this._tileFetcher)?this._tileFetcher.totalFeatures:0,totalVertices:(0,p.pC)(this._tileFetcher)?this._tileFetcher.totalVertices:0,missingTiles:(0,p.pC)(this._tileFetcher)?this._tileFetcher.missingTiles:0}}};(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"type",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],J.prototype,"graphics",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],J.prototype,"layerView",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],J.prototype,"context",void 0),(0,s._)([(0,o.Cb)()],J.prototype,"extent",null),(0,s._)([(0,o.Cb)()],J.prototype,"updating",null),(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"_watchUpdatingTracking",void 0),(0,s._)([(0,o.Cb)()],J.prototype,"updatingTotal",null),(0,s._)([(0,o.Cb)()],J.prototype,"updatingRemaining",null),(0,s._)([(0,o.Cb)()],J.prototype,"expectedFeatureDiff",null),(0,s._)([(0,o.Cb)()],J.prototype,"memoryForUnusedFeatures",null),(0,s._)([(0,o.Cb)()],J.prototype,"maximumNumberOfFeaturesExceeded",null),(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"serviceDataExtent",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"serviceDataCount",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"vertexLimitExceeded",void 0),(0,s._)([(0,o.Cb)()],J.prototype,"displayFeatureLimit",void 0),(0,s._)([(0,o.Cb)({type:Number})],J.prototype,"maximumNumberOfFeatures",null),(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"mode",null),(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"maxTotalSnapshotVertices",null),(0,s._)([(0,o.Cb)({readOnly:!0,dependsOn:["mode"]})],J.prototype,"tileDescriptors",null),(0,s._)([(0,o.Cb)()],J.prototype,"_tileFetcher",void 0),(0,s._)([(0,o.Cb)()],J.prototype,"_fetchDataInfoPromise",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],J.prototype,"vertexLimitInfo",null),J=(0,s._)([(0,T.j)("esri.layers.graphics.controllers.FeatureTileController3D")],J);const K=5e6;function q(g,h){if(!h)return!1;for(const I of h)if(!g.has(I))return!0;return!1}var ie,g;(g=ie||(ie={})).NO_SERVICE_DATA_COUNT=1/0,g.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,g.reset=function h(){g.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,g.QUERY_STATISTICS_TIMEOUT=12e3,g.QUERY_EXTENT_TIMEOUT=1e4},ie.reset()},61256:(re,j,t)=>{t.d(j,{H:()=>W});var x=t(8314),s=t(36592),L=t(65401);const b={minX:0,minY:0,maxX:0,maxY:0};class W{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new s.Q(9,(0,x.Z)("esri-csp-restrictions")?u=>({minX:u[0],minY:u[1],maxX:u[2],maxY:u[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const u=new Array(this._idByBounds.size);let p=0;this._idByBounds.forEach((E,A)=>{u[p++]=A}),this._indexInvalid=!1,this._index.clear(),this._index.load(u)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(u=>this._idByBounds.has(u))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const u=(0,L.cS)();for(const p of this._boundsById.values())p&&(u[0]=Math.min(p[0],u[0]),u[1]=Math.min(p[1],u[1]),u[2]=Math.max(p[2],u[2]),u[3]=Math.max(p[3],u[3]));return u}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(u){const p=this._boundsById.get(u);this._boundsById.delete(u),p&&(this._idByBounds.delete(p),this._indexInvalid||this._index.remove(p))}forEachInBounds(u,p){this._loadIndex(),function y(f,u,p){(function a(f){b.minX=f[0],b.minY=f[1],b.maxX=f[2],b.maxY=f[3]})(u),f.search(b,p)}(this._index,u,E=>p(this._idByBounds.get(E)))}get(u){return this._boundsById.get(u)}has(u){return this._boundsById.has(u)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(u,p){if(!this._indexInvalid){const E=this._boundsById.get(u);E&&(this._index.remove(E),this._idByBounds.delete(E))}this._boundsById.set(u,p),p&&(this._idByBounds.set(p,u),this._indexInvalid||(this._boundsToLoad.push(p),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(re,j,t)=>{t.d(j,{Z:()=>E});var x=t(26584),s=t(61885),L=t(63290),v=t(62208),b=t(5548),a=t(65401),y=t(82054),W=t(61256),f=t(92794),u=t(6185);const p=(0,b.Ue)();class E{constructor(m){this.geometryInfo=m,this._boundsStore=new W.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new s.Z,this.featureAdapter=f.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let m=0;return this._featuresById.forEach(o=>{(0,v.pC)(o.geometry)&&o.geometry.coords&&(m+=o.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:m/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(m){if((0,v.Wi)(this.fullBounds))return null;const[o,P,T,B]=this.fullBounds;return{xmin:o,ymin:P,xmax:T,ymax:B,spatialReference:(0,u.S2)(m)}}add(m){this._add(m),this._emitChanged()}addMany(m){for(const o of m)this._add(o);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(m){const o=this._featuresById.get(m);return o?(this._remove(o),this._emitChanged(),o):null}removeManyById(m){this._boundsStore.invalidateIndex();for(const o of m){const P=this._featuresById.get(o);P&&this._remove(P)}this._emitChanged()}forEachBounds(m,o){for(const P of m){const T=this._boundsStore.get(P.objectId);T&&o((0,b.JR)(p,T))}}getFeature(m){return this._featuresById.get(m)}has(m){return this._featuresById.has(m)}forEach(m){this._featuresById.forEach(o=>m(o))}forEachInBounds(m,o){this._boundsStore.forEachInBounds(m,P=>{o(this._featuresById.get(P))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let m=!1;this._featuresById.forEach((o,P)=>{this._markedIds.has(P)||(m=!0,this._remove(o))}),this._markedIds.clear(),m&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(m){if(!m)return;const o=m.objectId;if(null==o)return void L.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new x.Z("featurestore:invalid-feature","feature id is missing",{feature:m}));const P=this._featuresById.get(o);let T;if(this._markedIds.add(o),P?(m.displayId=P.displayId,T=this._boundsStore.get(o),this._boundsStore.delete(o)):(0,v.pC)(this.onFeatureAdd)&&this.onFeatureAdd(m),(0,v.Wi)(m.geometry)||!m.geometry.coords||!m.geometry.coords.length)return this._boundsStore.set(o,null),void this._featuresById.set(o,m);T=(0,y.$)((0,v.pC)(T)?T:(0,a.Ue)(),m.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,v.pC)(T)&&this._boundsStore.set(o,T),this._featuresById.set(o,m)}_remove(m){(0,v.pC)(this.onFeatureRemove)&&this.onFeatureRemove(m);const o=m.objectId;return this._markedIds.delete(o),this._boundsStore.delete(o),this._featuresById.delete(o),m}}},59990:(re,j,t)=>{function x(v){var a;const b=v.layer;return"floorInfo"in b&&(null==(a=b.floorInfo)?void 0:a.floorField)&&"floors"in v.view?L(v.view.floors,b.floorInfo.floorField):null}function s(v,b){var a;return"floorInfo"in b&&(null==(a=b.floorInfo)?void 0:a.floorField)?L(v,b.floorInfo.floorField):null}function L(v,b){if(null==v||!v.length)return null;const a=v.filter(y=>""!==y).map(y=>`'${y}'`);return a.push("''"),`${b} IN (${a.join(",")}) OR ${b} IS NULL`}t.d(j,{c:()=>x,f:()=>s})},78448:(re,j,t)=>{t.d(j,{R:()=>ct});var x=t(15861),s=t(17626),L=t(26584),v=t(62208),b=t(32917),a=t(77712),f=(t(90912),t(85931),t(76898)),u=t(84786),p=t(23010),E=t(96854),A=t(86606),m=t(13191),o=t(33816),P=t(34675),T=t(46348),B=t(27306),S=t(80542),$=t(54024),Z=t(63290),te=t(23841),se=t(84161),ue=t(28093),ce=t(55915),he=t(83137),_e=t(38114),me=t(82054),Fe=t(66385),xe=t(88071),G=t(3579),Re=t(36630),Te=t(36859),J=t(62600),n=t(98667),F=t(64835),z=t(94255),K=t(24425),q=t(59617),ie=t(19597),g=t(14411),h=t(17625),I=t(651),X=t(91056),Q=t(87601),Y=t(39114),ne=t(88569),fe=t(12407),ee=t(41528),pe=t(88034),U=t(67969),de=t(2078);class Ce extends h.K{constructor(){super(...arguments),this.colorRamp=null,this.densityMap=null,this.searchRadius=1,this.fieldTotal=0,this.minDensity=0,this.maxDensity=100}}class be extends X.A{constructor(C,l){super(C,l,()=>this.destroy())}initializeProgram(C){return new fe.$(C.rctx,be.shader.get().build(this.configuration),Y.i)}initializePipeline(){return(0,de.sm)({blending:ne.wu,colorWrite:de.BK,depthTest:null,depthWrite:null})}get primitiveType(){return U.MX.TRIANGLE_STRIP}}be.shader=new I.J(pe.H,()=>t.e(4194).then(t.bind(t,74194)));class Ue extends ee.W{constructor(){super(...arguments),this.usesHalfFloat=!1}}(0,s._)([(0,Q.o)()],Ue.prototype,"usesHalfFloat",void 0);var We=t(85775),He=t(55086),Ne=t(26906);let ge=class extends g.S{constructor(_){super(_),this.pixelRatio=1,this._colorRampData=new Uint8ClampedArray(4),this.type="draped-heatmap",this._heatmapParameters=new Ce}initialize(){this._densityMap=new We.X(this.rctx,{colorTarget:U.Lm.TEXTURE,depthStencilTarget:U.OU.NONE,width:0,height:0},{target:U.No.TEXTURE_2D,pixelFormat:this.pixelFormat,internalFormat:this.internalFormat,dataType:this.dataType,samplingMode:this.samplingMode,wrapMode:U.e8.CLAMP_TO_EDGE,width:0,height:0}),this._quad=(0,ie.ow)(this.rctx);const l=this._colorRampData;this._colorRamp=new He.x(this.rctx,{target:U.No.TEXTURE_2D,pixelFormat:U.VI.RGBA,dataType:U.Br.UNSIGNED_BYTE,samplingMode:U.cw.LINEAR,wrapMode:U.e8.CLAMP_TO_EDGE,width:l.length/4,height:1},l);const M=new Ue;M.usesHalfFloat=this.dataType!==U.Br.FLOAT,this._technique=new be({rctx:this.rctx,viewingMode:q.JY.Local},M),this._heatmapParameters.densityMap=this._densityMap.colorTexture,this.addHandles((0,b.YP)(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))}destroy(){this._technique=(0,v.RY)(this._technique),this._densityMap=(0,v.M2)(this._densityMap),this._quad=(0,v.M2)(this._quad),this._colorRamp=(0,v.M2)(this._colorRamp)}get searchRadius(){return this._heatmapParameters.searchRadius}set searchRadius(_){_!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=_,this.notifyChange("searchRadius"))}get minDensity(){return this._heatmapParameters.minDensity}set minDensity(_){_!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=_,this.notifyChange("minDensity"))}get maxDensity(){return this._heatmapParameters.maxDensity}set maxDensity(_){_!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=_,this.notifyChange("maxDensity"))}get fieldTotal(){return this._heatmapParameters.fieldTotal}set fieldTotal(_){this._heatmapParameters.fieldTotal=_,this.notifyChange("fieldTotal")}get colorRampData(){return this._colorRampData}set colorRampData(_){const{colorRamp:C}=this._heatmapParameters;if((0,v.pC)(C)&&_!==this._colorRampData){const c=_.length/4;c!==C.descriptor.width&&C.resize(c,1),C.setData(_)}this._colorRampData=_}get _colorRamp(){return this._heatmapParameters.colorRamp}set _colorRamp(_){this._heatmapParameters.colorRamp=_}get hasHighlights(){return!1}get hasWater(){return!1}get rendersOccluded(){return!1}render(_){const C=this._sortedMaterialRenderers;if(C.length<1)return;const l=this.rctx.getBoundFramebufferObject(),c=this.rctx.getViewport(),M=_.bindParameters,{pixelRatio:R}=this,w=Math.ceil(c.width*R),N=Math.ceil(c.height*R);this._densityMap.resize(w,N),this.rctx.bindFramebuffer(this._densityMap),this.rctx.setViewport(0,0,w,N),this.rctx.clear(U.lk.COLOR_BUFFER_BIT);let ae=!1;C.forAll(ye=>{ye.material.shouldRender(_)&&(ae=ye.render(_.output,M)||ae)}),this.rctx.bindFramebuffer(l),this.rctx.setViewport(c.x,c.y,c.width,c.height),ae&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,_.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,(0,Ne._V)(this._quad,"geometry")))}};(0,s._)([(0,a.Cb)()],ge.prototype,"searchRadius",null),(0,s._)([(0,a.Cb)()],ge.prototype,"minDensity",null),(0,s._)([(0,a.Cb)()],ge.prototype,"maxDensity",null),(0,s._)([(0,a.Cb)()],ge.prototype,"fieldTotal",null),(0,s._)([(0,a.Cb)()],ge.prototype,"pixelRatio",void 0),(0,s._)([(0,a.Cb)()],ge.prototype,"colorRampData",null),(0,s._)([(0,a.Cb)({constructOnly:!0})],ge.prototype,"dataType",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],ge.prototype,"samplingMode",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],ge.prototype,"pixelFormat",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],ge.prototype,"internalFormat",void 0),(0,s._)([(0,a.Cb)()],ge.prototype,"_colorRampData",void 0),ge=(0,s._)([(0,f.j)("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],ge);var Ke=t(41120),Ie=t(54840),e=t(64232),i=t(23147),r=t(16396),d=t(67831),O=t(99770),D=t(19625),V=t(13934),k=t(60881),oe=t(40723),Ee=t(5894),le=t(42037),Oe=t(81768);class Pe extends oe.Mt{constructor(){super(...arguments),this.searchRadius=128,this.resolutionForScale=0}}class Me extends X.A{initializeProgram(C){return new fe.$(C.rctx,Me.shader.get().build(this.configuration),Y.i)}initializePipeline(){return(0,de.sm)({blending:(0,de.if)(U.zi.ONE,U.zi.ONE,U.db.ADD),colorWrite:de.BK,depthTest:null,depthWrite:null})}destroy(){super.destroy()}}Me.shader=new I.J(Oe.H,()=>t.e(5795).then(t.bind(t,15795)));class Ae extends ee.W{constructor(){super(...arguments),this.isAttributeDriven=!1,this.usesHalfFloat=!1}}(0,s._)([(0,Q.o)()],Ae.prototype,"isAttributeDriven",void 0),(0,s._)([(0,Q.o)()],Ae.prototype,"usesHalfFloat",void 0);class rt extends Pe{constructor(){super(...arguments),this.isAttributeDriven=!1,this.usesHalfFloats=!1}}class Ye extends oe.F5{constructor(C){super(C,new rt),this._configuration=new Ae}requiresSlot(C,l){return C===Ee.r.DRAPED_MATERIAL&&l===V.H.Color}getConfiguration(){return this._configuration.isAttributeDriven=this.parameters.isAttributeDriven,this._configuration.usesHalfFloat=this.parameters.usesHalfFloats,this._configuration}createGLMaterial(C){return new at(C)}intersect(){}intersectDraped(C,l,c,M,R,w){const N=C.vertexAttributes.get(r.T.POSITION),{parameters:ae}=this,{searchRadius:ye}=ae,{screenToWorldRatio:De}=C,Le=ye*De+2*De,Ve=Le*Le,Qe=N.data.length/N.size;for(let Be=0;Be<Qe;Be++){const Se=Be*N.size,we=(0,d.s)(lt,N.data[Se],N.data[Se+1]);(0,d.k)(we,M)<Ve&&R(w.dist,w.normal,-1,!1)}}createBufferWriter(){return new nt(this.parameters.isAttributeDriven?ot:Xe)}}class at extends k.Z{beginSlot(C){return this.ensureTechnique(Me,C)}}class nt{constructor(C){this.vertexBufferLayout=C}allocate(C){return this.vertexBufferLayout.createBuffer(C)}elementCount(C){return C.indices.get(r.T.POSITION).length*Ze}write(C,l,c,M,R){(0,le.ho)(c.indices.get(r.T.POSITION),c.vertexAttributes.get(r.T.POSITION).data,C,M.position,R,Ze);const w=c.indices.get(r.T.POSITION).length,N=M.uv0;let ae=R;for(let De=0;De<w;++De)N.setValues(ae++,-1,-1),N.setValues(ae++,1,-1),N.setValues(ae++,1,1),N.setValues(ae++,1,1),N.setValues(ae++,-1,1),N.setValues(ae++,-1,-1);const ye=r.T.FEATUREATTRIBUTE in M?M.featureAttribute:null;ye&&(0,le.XW)(c.indices.get(r.T.FEATUREATTRIBUTE),c.vertexAttributes.get(r.T.FEATUREATTRIBUTE).data,ye,R,Ze)}}const Xe=(0,D.U$)().vec3f(r.T.POSITION).vec2f(r.T.UV0),ot=Xe.clone().f32(r.T.FEATUREATTRIBUTE),Ze=6,lt=(0,O.a)();var $e=t(93579);const Je="esri.views.3d.layers.support.HeatmapFeatureProcessor",Ge=Z.Z.getLogger(Je);let H=class extends S.r{constructor(_){super(_),this.type="heatmap",this.preferredUpdatePolicy=i.j.ASYNC,this.dataExtent=null,this.drapeSourceType=J.Lw.Features,this._renderGeometries=new Map,this._fieldTotal=0,this._drapeSourceRenderer=null,this._dataType=U.Br.HALF_FLOAT,this._pixelFormat=U.VI.RGBA,this.initializePromise=Promise.resolve()}initialize(){this._featureStore=new G.Z({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const{dataType:_,samplingMode:C,pixelFormat:l,internalFormat:c}=function ut(_,C){const{textureFloat:l,colorBufferFloat:c}=_.capabilities,M=null==l?void 0:l.textureFloat,R=null==l?void 0:l.textureFloatLinear,w=null==l?void 0:l.textureHalfFloat,N=null==l?void 0:l.textureHalfFloatLinear,ae=null==l?void 0:l.HALF_FLOAT,ye=null==c?void 0:c.textureFloat,De=null==c?void 0:c.textureHalfFloat,Le=null==c?void 0:c.floatBlend,Ve=(0,v.s3)(_.driverTest).floatBufferBlend.result;if(!M&&!w)throw new L.Z("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!ye&&!De)throw new L.Z("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(Le&&Ve||De))throw new L.Z("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(Ve?"":" This device claims support for EXT_float_blend, but does not actually support it."));const Be=w&&De,Se=R,we=N,qe=!(null==c||!c.R32F),et=!(null==c||!c.R16F);if(M&&ye&&Le&&Ve&&(Se||!we))return Se||C.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),{dataType:U.Br.FLOAT,samplingMode:Se?U.cw.LINEAR:U.cw.NEAREST,pixelFormat:qe?U.VI.RED:U.VI.RGBA,internalFormat:qe?U.lP.R32F:U.VI.RGBA};if(Be)return we||C.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),{dataType:ae,samplingMode:we?U.cw.LINEAR:U.cw.NEAREST,pixelFormat:et?U.VI.RED:U.VI.RGBA,internalFormat:et?U.lP.R16F:U.VI.RGBA};throw new L.Z("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(this._renderView.renderingContext,Ge);this._dataType=_,this._pixelFormat=l;const M=_!==U.Br.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,ge,je(ve({},this._rendererParameters),{dataType:_,samplingMode:C,pixelFormat:l,internalFormat:c})),this._material=new Ye({usesHalfFloats:M}),this._materialWithField=new Ye({usesHalfFloats:M,isAttributeDriven:!0}),this._filterVisibility=new n.n({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:R=>this._setAllFeaturesVisibility(R),clearFeaturesVisibility:()=>this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:R=>this._updateFeatureVisibilities(R)}}),this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,R=>this._onLoadedFeaturesChange(R),b.nn),this.updatingHandles.addWhen(()=>this._materialParameters,R=>this._forEachMaterial(w=>w.setParameters(R)),b.nn),this.updatingHandles.add(()=>this._rendererParameters,R=>this._drapeSourceRenderer.set(R)),this.updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},b.Z_),this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:R,numeric:w})=>{if((0,v.pC)(R)&&w){let N=0;this._featureStore.forEach(ae=>{var ye;return N+=null!=(ye=ae.attributes[R])?ye:0}),this._fieldTotal=N}else this._fieldTotal=this._featureStore.numFeatures},b.nn),this.handles.add([(0,b.YP)(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:R,field:w})=>{var N;R&&!w&&Ge.warn(`Heatmap renderer field '${R}' for layer '${null!=(N=this.layer.title)?N:this.layer.id}' not found`)}),(0,b.YP)(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:R,numeric:w})=>{var N;(0,v.pC)(R)&&!w&&Ge.warn(`Heatmap renderer field '${R.name}' for layer '${null!=(N=this.layer.title)?N:this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),(0,$.kB)(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])}destroy(){this._renderGeometries.clear(),this._material=(0,v.M2)(this._material),this._materialWithField=(0,v.M2)(this._materialWithField),this._featureStore.clear(),this._featureStore=null}get layer(){return this.owner.layer}get featureStore(){return this._featureStore}get updating(){return this.updatingHandles.updating||this.filterVisibility.updating}get updatingRemaining(){return 0}get suspendInfo(){return{}}get legendEnabled(){return!0}get filterVisibility(){return this._filterVisibility}get displayFeatureLimit(){var c,M,R,w,N,ae,ye;const _=null!=(N=null==(w=null==(R=null==(M=null==(c=this.owner)?void 0:c.view)?void 0:M.resourceController)?void 0:R.memoryController)?void 0:w.memoryFactor)?N:1,C=null==(ye=null==(ae=this.owner)?void 0:ae.view)?void 0:ye.qualitySettings,l=C?Math.ceil(C.heatmap.maxTotalNumberOfFeatures*_):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:l,maximumTotalNumberOfPrimitives:2*l,maximumNumberOfFeatures:l}}get hasZ(){return"hasZ"in this.layer&&this.layer.hasZ}get hasM(){return"hasM"in this.layer&&this.layer.hasM}get view(){return this.owner.view}get fullOpacity(){return this.owner.fullOpacity}get updatePolicy(){return this.owner.updatePolicy}get scaleVisibilitySuspended(){if(!this._isScaleRangeActive)return!1;const{minScale:_,maxScale:C}=this.layer.effectiveScaleRange,{scale:l}=this.view;return!(0,$e.rs)(l,null!=_?_:0,null!=C?C:0)}get usedMemory(){var M,R,w,N;const _=this.usedMemoryPerFeature*this._featureStore.numFeatures,C=this._pixelFormat===U.VI.RED?1:4,l=this._dataType===U.Br.FLOAT?4:2,c=null!=(N=Math.ceil((null!=(w=null==(R=null==(M=this._overlayRenderer)?void 0:M.overlays[0])?void 0:R.resolution)?w:0)*this._densityMapPixelRatio))?N:0;return c*c*C*l+_}get usedMemoryPerFeature(){const _=this._loadedPointGraphics.find(()=>!0);if((0,v.Wi)(_))return 0;const C=(0,B.f2)(_),l=(0,B.G3)();return 6*(0,B.do)([0,0,0],l)+6*(0,B.do)([0,0],l)+(this._heatmapRendererFieldIsNumeric?6*l:0)+C}get loadedFeatures(){return this._featureStore.numFeatures}get unprocessedMemoryEstimate(){return 0}get performanceInfo(){return{core:{visible:this._visibleFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}get renderer(){return this._heatmapRenderer}get _overlayRenderer(){return this.view.basemapTerrain.overlayManager.renderer}get _overlaySpatialReference(){return(0,v.Wg)(this._overlayRenderer.spatialReference)}get _rendererParameters(){return ve(ve(ve(ve({},this._radiusParameter),this._densityParameters),this._colorRampParameter),this._pixelRatioParameter)}get _materialParameters(){return ve(ve({},this._radiusParameter),this._resolutionForScaleParameter)}get _densityParameters(){const _=this._heatmapRenderer;if((0,v.Wi)(_))return null;const{minDensity:C,maxDensity:l}=_;return{minDensity:C,maxDensity:l,fieldTotal:this._fieldTotal}}get _radiusParameter(){return(0,v.yw)(this._heatmapRenderer,({radius:_})=>({searchRadius:(0,te.F2)(this._clampSearchRadius(_))}))}get _resolutionForScaleParameter(){return(0,v.yw)(this._heatmapRenderer,({referenceScale:_})=>({resolutionForScale:0===_?0:(0,he.dp)(_,this.view.spatialReference)}))}get _colorRampParameter(){return(0,v.yw)(this._heatmapRenderer,_=>({colorRampData:(0,Te.uI)(_.colorStops)}))}get _pixelRatioParameter(){return{pixelRatio:this._densityMapPixelRatio}}get _densityMapPixelRatio(){var C,l,c,M,R,w,N,ae;const _=null!=(R=null==(M=null==(c=null==(l=null==(C=this.owner)?void 0:C.view)?void 0:l.resourceController)?void 0:c.memoryController)?void 0:M.memoryFactor)?R:1;return(null!=(ae=null==(N=null==(w=this.owner)?void 0:w.view)?void 0:N.qualitySettings.heatmap.pixelRatio)?ae:1)*Math.sqrt(_)}get _renderView(){return this.view._stage.renderView}get _featuresArePoints(){return"point"===this.layer.geometryType}get _loadedPointGraphics(){return this.owner.loadedGraphics}get _heatmapRenderer(){const _=this.layer.renderer;return"heatmap"===(null==_?void 0:_.type)?_:null}get _heatmapRendererFieldName(){return(0,v.yw)(this._heatmapRenderer,_=>_.field)}get _heatmapRendererField(){return(0,v.yw)(this._heatmapRendererFieldName,_=>this.layer.fieldsIndex.get(_))}get _heatmapRendererFieldIsNumeric(){const _=this._heatmapRendererField;return!(0,v.Wi)(_)&&(0,Re.H7)(_)}get _isScaleRangeActive(){const{layer:_}=this;if(!("effectiveScaleRange"in _))return!1;const{minScale:C,maxScale:l}=_.effectiveScaleRange;return(0,$e.Av)(C,l)}get _visibleFeatures(){let _=0;return this._renderGeometries.forEach(C=>{C.visible&&++_}),_}whenGraphicBounds(){return(0,x.Z)(function*(){return null})()}computeAttachmentOrigin(){return null}highlight(){return ke}maskOccludee(){return ke}setObjectIdVisibility(){}refreshFilter(){this.filterVisibility.reapply()}_onLoadedFeaturesChange(_){if(!this._featuresArePoints)return;const{objectIdField:C}=this.layer;this._featureStore.removeManyById(_.removed.map(w=>(0,_e.MS)(w,C))),this._featureStore.addMany(_.added.map(w=>{const N=new Fe.u_((0,me.dd)(new xe.Z,w.geometry),w.attributes,(0,v.yw)(w.centroid,ae=>(0,me.dd)(new xe.Z,ae)),(0,_e.MS)(w,C));return N.displayId=w.uid,N}));const l=_.added,c=_.removed;this._fieldTotal+=this._computeFieldTotalChange(l,c);const M=(0,v.e8)(c,({uid:w})=>{const N=this._renderGeometries.get(w);return this._renderGeometries.delete(w),N}),R=l.map(w=>{const N=this._pointGraphicToRenderGeometry(w);return this._renderGeometries.set(w.uid,N),N});M.length>0&&this._drapeSourceRenderer.removeGeometries(M,Ie.T.REMOVE),R.length>0&&this._drapeSourceRenderer.addGeometries(R,Ie.T.ADD),(R.length>0||M.length>0)&&(this.filterVisibility.reapply(),this._renderView.requestRender())}_recreate(){if(!this._loadedPointGraphics)return;const _=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:_,removed:_})}_pointGraphicToRenderGeometry(_){var N;const C=this._heatmapRendererFieldName,l=(0,v.pC)(C)?this._materialWithField:this._material,c=(0,ue.c)();(0,ce.KC)(_.geometry,c,this._overlaySpatialReference),c[2]=F.Rn;const M=[[r.T.POSITION,new z.a(c,c.length)]],R=this._heatmapRendererFieldIsNumeric;(0,v.pC)(C)&&M.push([r.T.FEATUREATTRIBUTE,new z.a([R&&null!=(N=_.attributes[C])?N:0],1)]);const w=new e.z(new Ke.Z(l,M,null,null,K.U.Point),{layerUid:this.layer.uid,graphicUid:_.uid});return(0,se.c)(w.boundingSphere,c),w.visible=this.filterVisibility.defaultVisibility,w}_forEachMaterial(_){_(this._material),_(this._materialWithField)}_computeFieldTotalChange(_,C){if((0,v.Wi)(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return _.length-C.length;const l=this._heatmapRendererFieldName,c=(M,R)=>{var w;return M+(null!=(w=R.attributes[l])?w:0)};return _.reduce(c,0)-C.reduce(c,0)}_clampSearchRadius(_){return _>112&&Ge.warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer."),Math.min(_,112)}_updateFeatureVisibilities(_){const C=[];this._featureStore.forEach(({objectId:l,displayId:c})=>{const M=_(l),R=this._renderGeometries.get(c);R&&R.visible!==M&&(C.push(R),R.visible=M)}),this._drapeSourceRenderer.modifyGeometries(C,Ie.$.VISIBILITY)}_setAllFeaturesVisibility(_){const C=[];for(const l of this._renderGeometries.values())l.visible!==_&&(C.push(l),l.visible=_);this._drapeSourceRenderer.modifyGeometries(C,Ie.$.VISIBILITY)}get test(){return{visibleFeatureCount:this._visibleFeatures}}};(0,s._)([(0,a.Cb)()],H.prototype,"type",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],H.prototype,"owner",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"layer",null),(0,s._)([(0,a.Cb)()],H.prototype,"featureStore",null),(0,s._)([(0,a.Cb)()],H.prototype,"updating",null),(0,s._)([(0,a.Cb)()],H.prototype,"updatingRemaining",null),(0,s._)([(0,a.Cb)()],H.prototype,"suspendInfo",null),(0,s._)([(0,a.Cb)()],H.prototype,"legendEnabled",null),(0,s._)([(0,a.Cb)()],H.prototype,"filterVisibility",null),(0,s._)([(0,a.Cb)()],H.prototype,"displayFeatureLimit",null),(0,s._)([(0,a.Cb)()],H.prototype,"preferredUpdatePolicy",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"hasZ",null),(0,s._)([(0,a.Cb)()],H.prototype,"hasM",null),(0,s._)([(0,a.Cb)()],H.prototype,"dataExtent",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"view",null),(0,s._)([(0,a.Cb)()],H.prototype,"fullOpacity",null),(0,s._)([(0,a.Cb)()],H.prototype,"updatePolicy",null),(0,s._)([(0,a.Cb)()],H.prototype,"drapeSourceType",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"scaleVisibilitySuspended",null),(0,s._)([(0,a.Cb)()],H.prototype,"renderer",null),(0,s._)([(0,a.Cb)()],H.prototype,"_featureStore",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"_filterVisibility",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"_overlayRenderer",null),(0,s._)([(0,a.Cb)()],H.prototype,"_overlaySpatialReference",null),(0,s._)([(0,a.Cb)()],H.prototype,"_rendererParameters",null),(0,s._)([(0,a.Cb)()],H.prototype,"_materialParameters",null),(0,s._)([(0,a.Cb)()],H.prototype,"_densityParameters",null),(0,s._)([(0,a.Cb)()],H.prototype,"_radiusParameter",null),(0,s._)([(0,a.Cb)()],H.prototype,"_resolutionForScaleParameter",null),(0,s._)([(0,a.Cb)()],H.prototype,"_colorRampParameter",null),(0,s._)([(0,a.Cb)()],H.prototype,"_pixelRatioParameter",null),(0,s._)([(0,a.Cb)()],H.prototype,"_densityMapPixelRatio",null),(0,s._)([(0,a.Cb)()],H.prototype,"_renderGeometries",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"_material",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"_materialWithField",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"_renderView",null),(0,s._)([(0,a.Cb)()],H.prototype,"_featuresArePoints",null),(0,s._)([(0,a.Cb)()],H.prototype,"_loadedPointGraphics",null),(0,s._)([(0,a.Cb)()],H.prototype,"_heatmapRenderer",null),(0,s._)([(0,a.Cb)()],H.prototype,"_heatmapRendererFieldName",null),(0,s._)([(0,a.Cb)()],H.prototype,"_heatmapRendererField",null),(0,s._)([(0,a.Cb)()],H.prototype,"_heatmapRendererFieldIsNumeric",null),(0,s._)([(0,a.Cb)()],H.prototype,"_fieldTotal",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"_drapeSourceRenderer",void 0),(0,s._)([(0,a.Cb)()],H.prototype,"_isScaleRangeActive",null),H=(0,s._)([(0,f.j)(Je)],H);const ke=(0,$.kB)();var ht=t(89765),dt=t(87091);const ct=_=>{let C=class extends _{constructor(){super(...arguments),this.controller=null,this.updatePolicy=i.j.SYNC,this.suspendResumeExtentMode="computed",this.slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null,this.suspendResumeExtent=null,this._controllerCreated=!1,this.supportsHeightUnitConversion=!0,this._pendingController=null,this.queryEngine=null}initialize(){var l=this;const c=this.layer;if("isTable"in c&&c.isTable)return void this.addResolvingPromise(Promise.reject(new L.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:c})));this.addResolvingPromise(this._validateGeometryType()),this.updatingHandles.add(()=>this.layer.renderer,R=>this._recreateProcessor(R),b.nn),this.addResolvingPromise((0,x.Z)(function*(){const R=yield(0,ht.E)(l);l.fullExtentInLocalViewSpatialReference=R,yield l._initializeController()})()),this.updatingHandles.add(()=>this.updatePolicy,R=>this.processor.preferredUpdatePolicy=R);const M=()=>this.processor.featureStore;this.queryEngine=new P.q({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return M()},hasZ:this.hasZ,hasM:this.hasM},priority:dt.T8.FEATURE_QUERY_ENGINE}),this.notifyChange("updating")}destroy(){this._destroyPendingController(),this.controller=(0,v.SC)(this.controller),this._set("processor",(0,v.SC)(this.processor)),this.queryEngine=(0,v.SC)(this.queryEngine),this.loadedGraphics=null}_destroyPendingController(){this._pendingController=(0,v.SC)(this._pendingController)}get legendEnabled(){var l;return this.canResume()&&(null==(l=this.processor)?void 0:l.legendEnabled)}get graphics3DProcessor(){var l;return"graphics-3d"===(null==(l=this.processor)?void 0:l.type)?this.processor:null}get heatmapProcessor(){var l;return"heatmap"===(null==(l=this.processor)?void 0:l.type)?this.processor:null}get symbologySnappingSupported(){var c,M,R;const l=null==(M=null==(c=this.layer)?void 0:c.renderer)?void 0:M.getSymbols();return null!=(R=null==l?void 0:l.some(A.QL))&&R}getHit(l){var M;let c;return null==(M=this.loadedGraphics)||M.forEach(R=>{R.uid===l&&(c=(0,u.mW)(R,this.layer))}),c?{type:"graphic",graphic:c,layer:c.layer}:null}whenGraphicBounds(l,c){var M;return null==(M=this.processor)?void 0:M.whenGraphicBounds(l,c)}computeAttachmentOrigin(l,c){var M;return null==(M=this.processor)?void 0:M.computeAttachmentOrigin(l,c)}elevationAlignPointsInFeatures(l,c){var M=this;return(0,x.Z)(function*(){const R=M.graphics3DProcessor;if((0,v.Wi)(R))throw new L.Z("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return(0,m.W)(M.view,M.layer,w=>R.getGraphics3DGraphicByObjectId(w),l,c)})()}queryForSymbologySnapping(l,c){var M=this;return(0,x.Z)(function*(){return M.symbologySnappingSupported?(0,T.c)(M.graphics3DProcessor,l,c):{candidates:[],sourceCandidateIndices:[]}})()}queryFeatures(l,c){return this.queryEngine.executeQuery(this._ensureQuery(l),(0,v.U2)(c,"signal"))}queryObjectIds(l,c){return this.queryEngine.executeQueryForIds(this._ensureQuery(l),(0,v.U2)(c,"signal"))}queryFeatureCount(l,c){return this.queryEngine.executeQueryForCount(this._ensureQuery(l),(0,v.U2)(c,"signal"))}queryExtent(l,c){return this.queryEngine.executeQueryForExtent(this._ensureQuery(l),(0,v.U2)(c,"signal"))}_ensureQuery(l){return(0,v.Wi)(l)?this.createQuery():E.Z.from(l)}highlight(l){return this.processor.highlight(l,this.layer.objectIdField)}maskOccludee(l){return this.processor.maskOccludee(l)}canResume(){var l;return super.canResume()&&!(null!=(l=this.processor)&&l.scaleVisibilitySuspended)}getSuspendInfo(){const l=super.getSuspendInfo();return this.processor?ve(ve({},l),this.processor.suspendInfo):l}isUpdating(){var l,c,M;return!(!this.processor||this.processor.destroyed||this._controllerCreated&&(null==(l=this.controller)||!l.updating)&&(null==(M=null==(c=this.view)?void 0:c.basemapTerrain)?void 0:M.ready)&&!this.processor.updating)}_initializeController(){var l=this;return(0,x.Z)(function*(){const c=l.createController();l._pendingController=c,yield c.when(),l._setControllerWhenInitialized(c)})()}_setControllerWhenInitialized(l){var c=this;return(0,x.Z)(function*(){try{yield c.when()}catch(M){}c._controllerCreated=!0,c.notifyChange("updating"),c.isResolved()&&!c.destroyed?(yield(0,b.N1)(()=>{var M,R;return null==(R=null==(M=c.view)?void 0:M.basemapTerrain)?void 0:R.ready}),c.beforeSetController(l),c._pendingController=null,c.controller=l,c.loadedGraphics=l.graphics,c.notifyChange("updating")):c._destroyPendingController()})()}_updateClippingExtent(l){if(this.clippingExtent=l,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=l,!0}}_validateGeometryType(){var l=this;return(0,x.Z)(function*(){switch(l.layer.geometryType){case"multipatch":case"multipoint":throw new L.Z("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:l.layer.geometryType})}})()}_recreateProcessor(l){var N,ae;const c="heatmap"===(null==l?void 0:l.type),M="heatmap"===(null==(N=this.processor)?void 0:N.type),R=this.processor;if(R&&c===M)return;const w=c?new H({owner:this}):new o.Z({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:ye=>this._updateClippingExtent(ye)});this._set("processor",w),null==R||R.destroy(),null==(ae=this.queryEngine)||ae.clear(),this.addResolvingPromise(w.initializePromise)}_getResourceInfo(){var c,M;const l=this.controller instanceof p.g?this.controller:null;return ve({displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:null!=(c=null==l?void 0:l.maximumNumberOfFeatures)?c:-1,totalNumberOfFeatures:null!=(M=null==l?void 0:l.serviceDataCount)?M:-1,nodes:0},this.processor.performanceInfo)}get performanceInfo(){return this._getResourceInfo()}};return(0,s._)([(0,a.Cb)()],C.prototype,"loadedGraphics",void 0),(0,s._)([(0,a.Cb)()],C.prototype,"suspended",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"legendEnabled",null),(0,s._)([(0,a.Cb)()],C.prototype,"updating",void 0),(0,s._)([(0,a.Cb)()],C.prototype,"controller",void 0),(0,s._)([(0,a.Cb)()],C.prototype,"processor",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"updatePolicy",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"suspendResumeExtentMode",void 0),(0,s._)([(0,a.Cb)({type:Boolean})],C.prototype,"slicePlaneEnabled",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"suspendInfo",void 0),(0,s._)([(0,a.Cb)()],C.prototype,"graphics3DProcessor",null),(0,s._)([(0,a.Cb)()],C.prototype,"heatmapProcessor",null),(0,s._)([(0,a.Cb)()],C.prototype,"symbologySnappingSupported",null),C=(0,s._)([(0,f.j)("esri.views.3d.layers.FeatureLikeLayerView3D")],C),C}},19702:(re,j,t)=>{t.d(j,{A:()=>p});var x=t(15861),s=t(17626),L=t(54024),v=t(10699),b=t(32917),a=t(77712),f=(t(90912),t(85931),t(76898)),u=t(36947);const p=E=>{let A=class extends E{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(m){super.postscript(m),(0,u.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var m=this;return(0,x.Z)(function*(){const o=new AbortController,P=o.signal;m.handles.add((0,L.kB)(()=>o.abort())),yield(0,b.N1)(()=>{var B;return null==(B=m.view.defaultsFromMap)?void 0:B.heightModelInfoReady},P),(0,v.k_)(P);const T=(0,u.Wt)(m.layer,m.view.heightModelInfo,m.supportsHeightUnitConversion);if(T)throw T})()}canResume(){const m=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!m||!m.minScale||!m.maxScale||m.minScale>=m.maxScale)}getSuspendInfo(){const m=super.getSuspendInfo(),o=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return o&&o.minScale&&o.maxScale&&o.minScale<o.maxScale&&(m.outsideScaleRange=!0),m}};return(0,s._)([(0,a.Cb)()],A.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],A.prototype,"slicePlaneEnabled",void 0),A=(0,s._)([(0,f.j)("esri.views.3d.layers.LayerView3D")],A),A}},33816:(re,j,t)=>{t.d(j,{Z:()=>Re});var x=t(15861),s=t(17626),L=t(88879),v=t(46668),b=t(94573),a=t(80542),y=t(62208),W=t(10699),f=t(32917),u=t(77712),A=(t(90912),t(85931),t(76898)),m=t(84682),o=t(46367),P=t(32028),T=t(39256),B=t(96854),S=t(62600),$=t(80960),Z=t(8333),te=t(94991),se=t(83518),ue=t(14752),ce=t(67873),he=t(67225),_e=t(97445),me=t(98667),Fe=t(42743),xe=t(23147);let G=class extends a.r{constructor(n){super(n),this.type="graphics-3d",this._randomRotationRenderers=null,this.elevationFeatureExpressionEnabled=!1,this.scaleVisibilityEnabled=!1,this.filterVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this.elevationAlignmentEnabled=!1,this.timeExtentEnabled=!1,this.setUidToIdOnAdd=!0,this.dataExtent=null,this.drapeSourceType=S.Lw.Features,this.preferredUpdatePolicy=xe.j.ASYNC,this._suspendResumeExtent=null}initialize(){const n=this.owner,z=new Z.w({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:n.hasZ,hasM:n.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:K=>n.view.deconflictor.addGraphicsOwner(K),labeler:(K,q)=>n.view.labeler.addGraphicsOwner(K,q),elevationAlignment:this.elevationAlignmentEnabled?(K,q)=>new te.Z({graphicsCoreOwner:this,graphicsCore:K,queryGraphicUIDsInExtent:q,elevationProvider:n.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(K,q)=>new ce.Z({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:q,graphicsCore:K,basemapTerrain:n.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==n.layer.geometryType?K=>new me.n({context:ve({layerView:n},K)}):null,objectStates:K=>new ue.d(K)}});this._set("graphicsCore",z),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new se.Z({graphicsCoreOwner:this})),this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(K,q)=>{(0,m.Hg)(K,q)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}),this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo()),this.updatingHandles.add(()=>this.layer.labelingInfo,(K,q)=>{(0,m.Hg)(K,q)&&this.graphicsCore.updateLabelingInfo()}),this.updatingHandles.add(()=>this.preferredUpdatePolicy,K=>this.graphicsCore.preferredUpdatePolicy=K),this._set("initializePromise",this._initializeAsync()),this.updatingHandles.addPromise(this.initializePromise)}_initializeAsync(){var n=this;return(0,x.Z)(function*(){yield(0,W.U3)(n.graphicsCore.initializePromise);const F=n.owner;n.updatingHandles.add(()=>n.renderer,z=>n.updatingHandles.addPromise(n.graphicsCore.rendererChange(z))),n.updatingHandles.add(()=>F.fullOpacity,()=>n.graphicsCore.opacityChange()),n._setupSuspendResumeExtent(),n.updateClippingExtent&&(n.updatingHandles.add(()=>F.view.clippingArea,()=>n._updateClippingExtent()),n._updateClippingExtent()),n.graphicsCore.startCreateGraphics(),n.graphicsCore.labelsEnabled&&(yield(0,W.U3)(n.graphicsCore.updateLabelingInfo()))})()}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("frustumVisibility",(0,y.SC)(this.frustumVisibility)),this._set("graphicsCore",(0,y.SC)(this.graphicsCore)),this._set("owner",null)}get layer(){return this.owner.layer}get renderer(){const{renderer:n,objectIdField:F}=this.layer;if(!n||!F||"heatmap"===n.type||!n.visualVariables)return n;const z=n.visualVariables.findIndex(q=>"rotation"===q.type&&null!=q.valueExpression&&(0,P.v)(q.valueExpression)===F&&(null==q.axis||"heading"===q.axis)&&"geographic"===q.rotationType);if(z<0)return n;const K=n.clone();return K.visualVariables.splice(z,1),this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap),this._randomRotationRenderers.set(K,F),K}get scaleVisibility(){var n;return null==(n=this.graphicsCore)?void 0:n.scaleVisibility}get filterVisibility(){var n;return null==(n=this.graphicsCore)?void 0:n.filterVisibility}get elevationAlignment(){var n;return null==(n=this.graphicsCore)?void 0:n.elevationAlignment}get objectStates(){var n;return null==(n=this.graphicsCore)?void 0:n.objectStates}get suspendResumeExtentMode(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}get scaleVisibilitySuspended(){return(0,y.pC)(this.scaleVisibility)&&this.scaleVisibility.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return(0,y.Wi)(this.frustumVisibility)||!this.frustumVisibility.suspended}get suspendInfo(){const n={};return this.scaleVisibilitySuspended&&(n.outsideScaleRange=!0),(0,y.pC)(this.frustumVisibility)&&this.frustumVisibility.suspended&&(n.outsideOfView=!0),n}get updating(){var n,F;return!!((null==(n=this.graphicsCore)?void 0:n.updating)||(0,y.pC)(this.frustumVisibility)&&this.frustumVisibility.updating||(null==(F=this.updatingHandles)?void 0:F.updating))}get updatingRemaining(){var n,F;return null!=(F=null==(n=this.graphicsCore)?void 0:n.updatingRemaining)?F:0}get featureStore(){var n;return null==(n=this.graphicsCore)?void 0:n.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){var n;return null==(n=this.owner)?void 0:n.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){var n;return null==(n=this.graphicsCore)?void 0:n.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var n;return null==(n=this.graphicsCore)?void 0:n.graphics3DGraphicsByObjectID}get symbolUpdateType(){var n;return null==(n=this.graphicsCore)?void 0:n.symbolUpdateType}get displayFeatureLimit(){var ie;const n=this.view.resourceController.memoryController.memoryFactor,F=null==(ie=this.graphicsCore)?void 0:ie.displayFeatureLimit;if(1===n)return F;const z=Math.ceil(F.maximumNumberOfFeatures*n),K=Math.ceil(F.maximumTotalNumberOfFeatures*n),q=Math.ceil(F.minimumTotalNumberOfFeatures*n);return je(ve({},F),{maximumNumberOfFeatures:z,maximumTotalNumberOfFeatures:K,minimumTotalNumberOfFeatures:q})}get usedMemory(){var n,F;return null!=(F=null==(n=this.graphicsCore)?void 0:n.usedMemory)?F:0}get loadedFeatures(){var n,F;return null!=(F=null==(n=this.graphicsCore)?void 0:n.numberOfGraphics)?F:0}get usedMemoryPerFeature(){var n,F;return null!=(F=null==(n=this.graphicsCore)?void 0:n.usedMemoryPerGraphic)?F:0}get unprocessedMemoryEstimate(){var n,F;return null!=(F=null==(n=this.graphicsCore)?void 0:n.unprocessedMemoryEstimate)?F:0}get performanceInfo(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:(0,y.Wi)(this.frustumVisibility)||!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibilitySuspended}}maskOccludee(n){const{set:F,handle:z}=this.objectStates.acquireSet(Fe.V_.MaskOccludee,null);return this.objectStates.setUid(F,n.uid),z}highlight(n,F){if(n instanceof B.Z){const{set:z,handle:K}=this.objectStates.acquireSet(Fe.V_.Highlight,F);return this.owner.queryObjectIds(n).then(q=>this.objectStates.setObjectIds(z,q)),K}if("number"==typeof n||"string"==typeof n)return this.highlight([n],F);if(n instanceof L.Z)return this.highlight([n],F);if("toArray"in n&&(n=n.toArray()),Array.isArray(n)&&n.length>0){if(n[0]instanceof L.Z){const z=n;if(null==(0,_e.g)(this.layer.fieldsIndex,z[0].attributes,F)){const K=z.map(g=>g.uid),{set:q,handle:ie}=this.objectStates.acquireSet(Fe.V_.Highlight,null);return this.objectStates.setUids(q,K),ie}n=z.map(K=>(0,_e.g)(this.layer.fieldsIndex,K.attributes,F))}if("number"==typeof n[0]||"string"==typeof n[0]){const z=n,{set:K,handle:q}=this.objectStates.acquireSet(Fe.V_.Highlight,F);return this.objectStates.setObjectIds(K,z),q}}return J}resetObjectStates(){this.objectStates.reset()}whenGraphicBounds(n,F){var z;return null==(z=this.graphicsCore)?void 0:z.whenGraphicBounds(n,F)}computeAttachmentOrigin(n,F){var z;return null==(z=this.graphicsCore)?void 0:z.computeAttachmentOrigin(n,F)}notifyGraphicGeometryChanged(n){this.graphicsCore.notifyGraphicGeometryChanged(n)}notifyGraphicVisibilityChanged(n){this.graphicsCore.notifyGraphicVisibilityChanged(n)}getRenderingInfo(n,F,z){var q;const K=(0,T.Kb)(n,{renderer:F,arcade:z});if((0,y.pC)(K)&&K.color){const ie=K.color;ie[0]=ie[0]/255,ie[1]=ie[1]/255,ie[2]=ie[2]/255}if((0,y.pC)(K)&&(0,y.pC)(F)&&(null==(q=this._randomRotationRenderers)?void 0:q.has(F))){const ie=this._randomRotationRenderers.get(F),g=n.attributes[ie],h=new v.a(0);h.updateFloatArray([g]),h.updateUint8Array([173]),K.heading=8.381e-8*h.digest()}return K}getRenderingInfoAsync(n,F,z,K){return(0,T.xn)(n,ve({renderer:F,arcade:z},K))}getSymbolLayerSize(n,F){var z;return null==(z=this.graphicsCore)?void 0:z.getSymbolLayerSize(n,F)}setObjectIdVisibility(n,F){var z;null==(z=this.graphicsCore)||z.setObjectIdVisibility(n,F)}refreshFilter(){(0,y.pC)(this.filterVisibility)&&this.filterVisibility.reapply()}getGraphics3DGraphicByObjectId(n){var F;return null==(F=this.graphicsCore)?void 0:F.getGraphics3DGraphicByObjectId(n)}_updateClippingExtent(){const n=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(n,this.owner.view.spatialReference)&&(this.updateClippingExtent(n)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add((0,f.YP)(()=>this.suspendResumeExtentMode,()=>{switch(this.handles.remove(Te),this.suspendResumeExtentMode){case"computed":this.handles.add([(0,f.YP)(()=>this.graphicsCore.computedExtent,n=>this._updateSuspendResumeExtent(n),f.nn),(0,f.YP)(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],Te);break;case"data":this.handles.add([(0,f.gx)(()=>this.dataExtent,n=>this._updateSuspendResumeExtent(n),f.nn),(0,f.YP)(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent((0,y.Wg)(this.dataExtent)))],Te);break;default:(0,b.Bg)(this.suspendResumeExtentMode)}},f.nn))}_updateSuspendResumeExtent(n){this._suspendResumeExtentChanged(n?this._extentToSuspendResumeRect(n,this._suspendResumeExtent):null)}_extentToSuspendResumeRect(n,F){const z=this.owner.view.spatialReference;if(!n.spatialReference.equals(z)){if(!(0,o.Q8)(n,z))return;n=(0,o.iV)(n,z)}return(0,he.Go)(n,F,$.Z,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(n){(0,y.pC)(this.frustumVisibility)&&this.frustumVisibility.setExtent(n),(0,y.pC)(this.scaleVisibility)&&this.scaleVisibility.setExtent(n)}};(0,s._)([(0,u.Cb)()],G.prototype,"type",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"owner",void 0),(0,s._)([(0,u.Cb)()],G.prototype,"layer",null),(0,s._)([(0,u.Cb)()],G.prototype,"renderer",null),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"updateClippingExtent",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"elevationFeatureExpressionEnabled",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"graphicsCore",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"scaleVisibilityEnabled",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"filterVisibilityEnabled",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"frustumVisibilityEnabled",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"elevationAlignmentEnabled",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"timeExtentEnabled",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"setUidToIdOnAdd",void 0),(0,s._)([(0,u.Cb)()],G.prototype,"scaleVisibility",null),(0,s._)([(0,u.Cb)()],G.prototype,"filterVisibility",null),(0,s._)([(0,u.Cb)()],G.prototype,"elevationAlignment",null),(0,s._)([(0,u.Cb)({constructOnly:!0})],G.prototype,"frustumVisibility",void 0),(0,s._)([(0,u.Cb)()],G.prototype,"objectStates",null),(0,s._)([(0,u.Cb)()],G.prototype,"initializePromise",void 0),(0,s._)([(0,u.Cb)()],G.prototype,"suspendResumeExtentMode",null),(0,s._)([(0,u.Cb)()],G.prototype,"dataExtent",void 0),(0,s._)([(0,u.Cb)()],G.prototype,"scaleVisibilitySuspended",null),(0,s._)([(0,u.Cb)()],G.prototype,"suspended",null),(0,s._)([(0,u.Cb)()],G.prototype,"legendEnabled",null),(0,s._)([(0,u.Cb)()],G.prototype,"suspendInfo",null),(0,s._)([(0,u.Cb)()],G.prototype,"updating",null),(0,s._)([(0,u.Cb)()],G.prototype,"updatingRemaining",null),(0,s._)([(0,u.Cb)()],G.prototype,"featureStore",null),(0,s._)([(0,u.Cb)()],G.prototype,"view",null),(0,s._)([(0,u.Cb)()],G.prototype,"loadedGraphics",null),(0,s._)([(0,u.Cb)()],G.prototype,"fullOpacity",null),(0,s._)([(0,u.Cb)()],G.prototype,"filter",null),(0,s._)([(0,u.Cb)()],G.prototype,"slicePlaneEnabled",null),(0,s._)([(0,u.Cb)()],G.prototype,"drapeSourceType",void 0),(0,s._)([(0,u.Cb)()],G.prototype,"updatePolicy",null),(0,s._)([(0,u.Cb)()],G.prototype,"preferredUpdatePolicy",void 0),(0,s._)([(0,u.Cb)()],G.prototype,"displayFeatureLimit",null),G=(0,s._)([(0,A.j)("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],G);const Re=G,Te="suspendResumeExtentMode",J={remove(){},pause(){},resume(){}}},34675:(re,j,t)=>{t.d(j,{q:()=>P});var x=t(15861),s=t(17626),v=(t(29132),t(14517)),b=t(62208),a=t(77712),f=(t(90912),t(85931),t(76898)),u=t(2004),p=t(58175),E=t(17253),A=t(96854),m=t(71774);const o=p.q;let P=class extends v.Z{get layer(){return this.context.layer}get spatialReference(){return this.context.spatialReference}get _queryGeometryType(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}get defaultQueryJSON(){return new A.Z({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(T){super(T),this._dataQueryEngineInstance=null}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}executeQueryForIdSet(T,B,S){var $=this;return(0,x.Z)(function*(){return $._dataQueryEngine.executeQueryForIdSet($._ensureQueryJSON(T,B),S)})()}executeQueryForCount(T,B){var S=this;return(0,x.Z)(function*(){return S._dataQueryEngine.executeQueryForCount(S._ensureQueryJSON(T),B)})()}executeQueryForExtent(T,B){var S=this;return(0,x.Z)(function*(){const{count:$,extent:Z}=yield S._dataQueryEngine.executeQueryForExtent(S._ensureQueryJSON(T),B);return{count:$,extent:u.Z.fromJSON(Z)}})()}executeQueryForIds(T,B){var S=this;return(0,x.Z)(function*(){return S._dataQueryEngine.executeQueryForIds(S._ensureQueryJSON(T),B)})()}executeQueryForLatestObservations(T,B){var S=this;return(0,x.Z)(function*(){const $=yield S._dataQueryEngine.executeQueryForLatestObservations(S._ensureQueryJSON(T),B),Z=E.Z.fromJSON($);return Z.features.forEach(te=>{te.layer=S.layer,te.sourceLayer=S.layer}),Z})()}executeQuery(T,B){var S=this;return(0,x.Z)(function*(){const $=yield S._dataQueryEngine.executeQuery(S._ensureQueryJSON(T),B),Z=E.Z.fromJSON($);return Z.features.forEach(te=>{te.layer=S.layer,te.sourceLayer=S.layer}),Z})()}_ensureQueryJSON(T,B){let S=this.defaultQueryJSON;if((0,b.pC)(T)&&("outSpatialReference"in T&&!T.outSpatialReference&&(T.outSpatialReference=this.spatialReference),S=T.toJSON()),(0,b.pC)(B)){const $=B.geometries.map(Z=>Z.toJSON()).reduce((Z,te)=>(Z.rings=Z.rings.concat(te.rings),Z));S=je(ve({},S),{sceneFilter:je(ve({},B),{geometry:$})})}return S}_ensureDataQueryEngine(){var _e,me;if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const T="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,B=this.layer.objectIdField,S=m.M.toJSON(this._queryGeometryType),$=null!=(me=null==(_e=this.layer.fields)?void 0:_e.map(Fe=>Fe.toJSON()))?me:[],Z=this.priority,te=this.spatialReference.toJSON(),{hasZ:se,hasM:ue,featureStore:ce,scheduler:he}=this.context;return this._dataQueryEngineInstance=new o({hasZ:se,hasM:ue,geometryType:S,fields:$,timeInfo:T,spatialReference:te,objectIdField:B,featureStore:ce,scheduler:he,priority:Z}),this._dataQueryEngineInstance}};(0,s._)([(0,a.Cb)({constructOnly:!0})],P.prototype,"context",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],P.prototype,"priority",void 0),(0,s._)([(0,a.Cb)()],P.prototype,"layer",null),(0,s._)([(0,a.Cb)()],P.prototype,"spatialReference",null),(0,s._)([(0,a.Cb)()],P.prototype,"_queryGeometryType",null),(0,s._)([(0,a.Cb)()],P.prototype,"defaultQueryJSON",null),P=(0,s._)([(0,f.j)("esri.views.3d.layers.graphics.QueryEngine")],P)},13191:(re,j,t)=>{t.d(j,{W:()=>p});var x=t(15861),L=(t(29132),t(62208)),v=t(10699),b=t(38114),a=t(60507),y=t(81468),W=t(79112),f=t(74746),u=t(65234);function p(P,T,B,S,$){return E.apply(this,arguments)}function E(){return(E=(0,x.Z)(function*(P,T,B,S,$){const{elevationProvider:Z,renderCoordsHelper:te,spatialReference:se}=P,{elevationInfo:ue}=T,ce=(0,f.WI)(ue,!0),he=yield(0,f.kr)(ce,se,$);(0,v.k_)($);const _e=[],me=new Set,Fe=new Set;for(const{objectId:xe,points:G}of S){const Re=B(xe);if((0,L.Wi)(Re)){for(const J of G)_e.push(J[2]);me.add(xe)}else{Re.isDraped&&Fe.add(xe),A.setFromElevationInfo((0,a.Jn)(Re.graphic.geometry,ue)),A.updateFeatureExpressionInfoContext(he,Re.graphic,T),m.spatialReference=P.spatialReference;for(const{x:J,y:n,z:F}of G)m.x=J,m.y=n,m.z=null!=F?F:0,(0,y.qZ)(m,Z,A,te,o),_e.push(o.z)}}return{elevations:_e,drapedObjectIds:Fe,failedObjectIds:me}})).apply(this,arguments)}const A=new W.o,m=(0,b.Tx)(0,0,0,u.Z.WGS84),o=new y.Lm},46348:(re,j,t)=>{t.d(j,{c:()=>b});var x=t(15861),s=t(62208),L=t(10699),v=t(46679);function b(W,f,u){return a.apply(this,arguments)}function a(){return a=(0,x.Z)(function*(W,f,u){var te;if((0,s.Wi)(W)||0===f.candidates.length)return y;const p=null!=(te=W.graphics3DGraphicsByObjectID)?te:W.graphics3DGraphics,E=[],A=[],{renderer:m}=W,o=(0,s.pC)(m)&&"arcadeRequired"in m&&m.arcadeRequired?(0,v.LC)():null,P=function(){var se=(0,x.Z)(function*(ue,{graphic:ce,graphics3DSymbol:he}){const _e=yield o,me=yield W.getRenderingInfoAsync(ce,m,_e,{signal:u});return(0,s.Wi)(me)?[]:he.queryForSnapping(ue,B,me,u)});return function(ce,he){return se.apply(this,arguments)}}(),{candidates:T,spatialReference:B}=f;for(let se=0;se<T.length;++se){const ue=T[se],{objectId:ce}=ue,he="number"==typeof ce?null==p?void 0:p.get(ce):void 0;if((0,s.Wi)(he))continue;const{graphics3DSymbol:_e}=he;_e.symbologySnappingSupported&&(E.push(P(ue,he)),A.push(se))}if(0===E.length)return y;const S=yield Promise.all(E);(0,L.k_)(u);const $=[],Z=[];for(let se=0;se<S.length;++se){const ue=S[se],ce=A[se];for(const he of ue)$.push(he),Z.push(ce)}return{candidates:$,sourceCandidateIndices:Z}}),a.apply(this,arguments)}const y={candidates:[],sourceCandidateIndices:[]}},54984:(re,j,t)=>{t.d(j,{j:()=>ee,A:()=>de});var x=t(15861),s=t(17626),L=t(14517),v=t(72392),b=t(63290),a=t(88159),y=t(62208),W=t(10699),f=t(32917),u=t(50618),p=t(77712),A=(t(90912),t(85931)),m=t(76898),o=t(65401),P=t(38114),T=t(89621),B=t(96854),S=t(59617),Te=(t(27306),t(8314),t(65234),t(5548),t(21286),t(2004),t(21674),t(72854),t(72642),t(37118),t(55214),t(71774),t(36255),t(53639));class J{get isReferenced(){return 0!==this.versions.length}get isSingle(){return 1===this.versions.length&&1===this.versions[0].refCount}constructor(i,r){this._highestResolutionVersion=null,this.versions=[],this.ref(i,r)}ref(i,r){const d=this.feature;F.oldVersion=d,this.feature&&Object.defineProperty(i,"uid",{value:this.feature.uid,configurable:!0});for(const D of this.versions)if(D.resolution===r){D.refCount++;const V=this._highestResolutionVersion===D&&!(0,Te.f)(i,D.feature);return(V||this._highestResolutionVersion!==D)&&(D.feature=i),F.newVersion=V?i:d,F}const O={feature:i,resolution:r,refCount:1};return this.versions.push(O),!this._highestResolutionVersion||r<this._highestResolutionVersion.resolution?(F.newVersion=i,this._highestResolutionVersion=O):F.newVersion=d,F}unref(i){for(let r=0;r<this.versions.length;r++){const d=this.versions[r];if(d.resolution===i)return d.refCount--,F.oldVersion=this.feature,0===d.refCount&&(this.versions[r]=this.versions[this.versions.length-1],this.versions.length--,this._highestResolutionVersion===d&&(this._recalculateHighestResolutionVersion(),F.oldVersion=d.feature)),F.newVersion=this.feature,F}return null}get feature(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}_recalculateHighestResolutionVersion(){if(0===this.versions.length)return void(this._highestResolutionVersion=null);let i=this.versions[0];for(let r=1;r<this.versions.length;r++){const d=this.versions[r];d.resolution<i.resolution&&(i=d)}this._highestResolutionVersion=i}}class n{get isReferenced(){return 0!==this._refCount}get isSingle(){return 1===this._refCount}constructor(i){this._feature=i,this._refCount=1}ref(i){return++this._refCount,F.oldVersion=this._feature,this.feature&&Object.defineProperty(i,"uid",{value:this.feature.uid,configurable:!0}),(0,Te.f)(this._feature,i)||(this._feature=i),F.newVersion=this._feature,F}unref(){return F.oldVersion=this._feature,this._refCount>0&&(this._refCount--,!this.isReferenced)?(F.newVersion=null,F):(F.newVersion=this._feature,F)}get feature(){return this._feature}}const F={oldVersion:null,newVersion:null},K=new Set;class q{get displayingFeatures(){return this._displayingFeatures}set displayingFeatures(i){this._displayingFeatures=i,this.extentIncludingBorrowedFeatures=null}get perTileMaximumNumberOfFeaturesExceeded(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}get features(){return this._features}get featureLimit(){return this._featureLimit}set featureLimit(i){this._featureLimit!==i&&(this._featureLimit=i,this._estimatedUnusedSizeDirty=!0)}get availableFields(){return this._availableFields}setFeatures(i,r,d){this._availableFields=(0,y.Pt)(d,K),this._features=i,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,i&&i.length>0?(this._emptyFeatureRatio=r/(i.length+r),this._numVertices=i.reduce((O,D)=>O+(0,P.R3)(D.geometry),0)):(this._emptyFeatureRatio=0,this._numVertices=0)}get emptyFeatureRatio(){return this._emptyFeatureRatio}get numFeatures(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0}set numFeatures(i){this._numFeatures=i}get hasPreciseFeatureCount(){return this._numFeatures>ie}get needsFeatureCount(){return this._numFeatures===ie}get numVertices(){return this._numVertices}constructor(i){this.descriptor=i,this.fetchStatus=h.FETCH_NEEDED,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=ie,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=K,this._displayingFeatures=null,this.alive=!0,this.filtered=!1}get id(){return this.descriptor.id}get estimatedSize(){return this.updateMemoryEstimates(),this._estimatedSize}get estimatedUnusedSize(){return this._estimatedUnusedSize}updateMemoryEstimates(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(let i=0;i<this._features.length;++i){const r=(0,P.Xw)(this._features[i]);this._estimatedSize+=r,i>=this.featureLimit&&(this._estimatedUnusedSize+=r)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(let i=this.featureLimit;i<this._features.length;++i)this._estimatedUnusedSize+=(0,P.Xw)(this._features[i]);return!0}return!1}get isFetching(){return this.fetchStatus===h.FETCHING||this.fetchStatus===h.REFETCHING}get isRefetching(){return this.fetchStatus===h.REFETCHING}get needsFetching(){return this.fetchStatus===h.FETCH_NEEDED||this.fetchStatus===h.REFETCH_NEEDED}get needsRefetching(){return this.fetchStatus===h.REFETCH_NEEDED}get isFetched(){return this.fetchStatus===h.DONE||this.fetchStatus===h.FULL}resetFetching(){this.fetchStatus=this.fetchStatus===h.REFETCHING?h.REFETCH_NEEDED:h.FETCH_NEEDED}get needsDisplayUpdate(){return!!this._features&&!function I(e,i,r){if((0,y.Wi)(i)||(0,y.Wi)(e)||r!==i.length||r>e.length)return!1;for(let d=0;d<r;++d)if(e[d]!==i[d])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)}intersects(i){return!(!(0,y.Wi)(i)&&this.descriptor.extent)||((0,o.oJ)(i,X),(0,o.kK)(this.descriptor.extent,X))}intersectionIncludingBorrowed(i,r){const d=(0,y.pC)(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;return i||d?((0,y.pC)(i)?((0,o.oJ)(i,r),(0,o.jV)(r,d,r)):(0,o.JG)(r,d),r):((0,o.JG)(r,o.bd),r)}_shuffle(i){this._features.sort((r,d)=>(0,P.MS)(r,i)-(0,P.MS)(d,i)),(0,A.TV)(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0}reduceFeatures(i,r,d){if(i<=0)return!1;if(!this._features)return this.featureLimit=0,!1;let O=!1;this.featureLimit=Math.ceil(this.numFeatures*i),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===h.DONE&&this._features.length>0&&(this.fetchStatus=h.REFETCH_NEEDED,O=!0)),!this._shuffled&&i<1&&this._shuffle(d);const D=Math.max(this.featureLimit,Math.ceil(r*this.numFeatures));return this._features.length>D&&(this._features.length=D,this.featuresMissing=!0,this.fetchStatus===h.FULL&&(this.fetchStatus=h.DONE)),O}get cache(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}}set cache(i){this.requestController=null,this._availableFields=i.availableFields,this._features=i.features,this._numFeatures=i.numFeatures,this._emptyFeatureRatio=i.emptyFeatureRatio,this.fetchStatus=i.fetchStatus,this.featuresMissing=i.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0}}const ie=-1;var h,e;(e=h||(h={}))[e.FETCH_NEEDED=0]="FETCH_NEEDED",e[e.REFETCH_NEEDED=1]="REFETCH_NEEDED",e[e.FETCHING=2]="FETCHING",e[e.REFETCHING=3]="REFETCHING",e[e.DONE=4]="DONE",e[e.FULL=5]="FULL";const X=(0,o.Ue)();var Q=t(15076),Y=t(87091);const ne="esri.views.3d.layers.support.FeatureTileFetcher3D",fe=b.Z.getLogger(ne);let ee=class extends L.Z{set maximumNumberOfFeatures(e){e=e||1/0;const i=this._get("maximumNumberOfFeatures");e===i||e<1||(this._set("maximumNumberOfFeatures",e),this._maximumFeaturesUpdated(i,e))}set memoryFactor(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this._setDirty())}set lodFactor(e){this.lodFactor!==e&&(this._set("lodFactor",e),this._supportsResolution&&this.refetch())}get useTileCount(){return this._useTileCount&&(0,y.pC)(this.context.query.queryFeatureCount)}set useTileCount(e){this._useTileCount=e,this.notifyChange("useTileCount")}get memoryForUnusedFeatures(){let e=0;return this._featureTiles.forEach(i=>e+=i.estimatedUnusedSize),e}get totalVertices(){let e=0;return this._featureTiles.forEach(i=>e+=i.numVertices),e}get totalFeatures(){let e=0;return this._featureTiles.forEach(i=>e+=i.numFeatures),e}set filterExtent(e){if((0,y.pC)(e)&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))return void fe.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");const i=this._get("filterExtent");if(i===e||(0,y.pC)(i)&&e&&i.equals(e))return;const r=(0,y.pC)(e)?e.clone():null;this._set("filterExtent",r),this._reclip(r,i)}constructor(e){super(e),this._useTileCount=!1,this.updating=!1,this.running=!1,this.updatingTotal=0,this.updatingRemaining=0,this.expectedFeatureDiff=0,this.maximumNumberOfFeaturesExceeded=!1,this.maximumNumberOfFeaturesExceededThrottle=1e3,this._fullRatio=1,this._farRatio=1,this._changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},this._handles=new v.Z,this._frameTask=Y.sq,this._dirty=!1,this._featureTiles=new Map,this._displayingFeatureReferences=new Map,this._numDisplayingFeatureReferences=0,this._suspended=!0,this._pendingEdits=null}initialize(){this._handles.add((0,f.on)(()=>this.tileDescriptors,"change",()=>this._setDirty(),{onListenerAdd:()=>this._setDirty()})),this._objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?J:n;const e=this.context.scheduler;(0,y.pC)(e)&&(this._frameTask=e.registerTask(Y.T8.FEATURE_TILE_FETCHER,this)),this._setDirty()}destroy(){var e;this._frameTask.remove(),this._handles=(0,y.SC)(this._handles),this._featureTiles.forEach(i=>{this._cancelFetchTile(i),this._removeTile(i)}),this._featureTiles.clear(),this._displayingFeatureReferences.clear(),null==(e=this._pendingEdits)||e.controller.abort(),this._pendingEdits=null}get _paused(){return this._suspended||!!this._pendingEdits}restart(){this._featureTiles.forEach(e=>{this._cancelFetchTile(e),this._clearTile(e),this._resetFetchTile(e)}),(0,y.pC)(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}refetch(){this._featureTiles.forEach(e=>{this._cancelFetchTile(e),this._resetFetchTile(e)}),(0,y.pC)(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}suspend(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())}resume(){this._suspended&&(this._suspended=!1,this._unpause())}_pause(){this._paused&&(this._featureTiles.forEach(e=>this._cancelFetchTile(e)),this._updated())}_unpause(){this._paused||(this._setDirty(),this._updated())}get availableFields(){let e=null;return this._featureTiles.forEach(i=>{(0,y.Wi)(i.displayingFeatures)||0===i.displayingFeatures.length||((0,y.Wi)(e)?e=new Set(i.availableFields):e.forEach(r=>{i.availableFields.has(r)||(0,y.Wg)(e).delete(r)}))}),(0,y.pC)(e)?e:new Set}applyEdits(e){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const i=this._pendingEdits;i.count++;const r=i.edits.then(()=>e.result.catch(d=>{if((0,W.D_)(d))throw d;return null}).then(d=>d&&(this._applyEditsDeleteFeatures(d.deletedFeatures),this._applyEditsAddUpdateFeatures(d.addedFeatures,d.updatedFeatures,i.controller.signal).then(()=>d))).then(d=>(0==--i.count&&(this._pendingEdits===i&&(this._pendingEdits=null),(0,y.pC)(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated()),d)));return i.edits=r,this._updated(),r}_applyEditsDeleteFeatures(e){if(0===e.length)return;const i=this.context.globalIdField,r=i&&this.availableFields.has(i),d=new Set,O=this._objectIdField;e.forEach(({objectId:D,globalId:V})=>{if((!D||D<0)&&i){r||fe.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${i} to be included the layer's outFields for updates to be reflected in the view`);const k=this.features.find(oe=>oe.attributes&&oe.attributes[i]===V);k&&d.add((0,P.MS)(k,O))}else d.add(D)}),this._featureTiles.forEach(D=>{if(!D.features)return;const V=D.features.filter(k=>!d.has((0,P.MS)(k,this._objectIdField)));V.length!==D.features.length&&(D.setFeatures(V,0,D.availableFields),this._invalidateCounts())})}_applyEditsAddUpdateFeatures(e,i,r){var d=this;return(0,x.Z)(function*(){const O=[],D=new Set;if(e.forEach(k=>O.push(k.objectId)),i.forEach(k=>{O.push(k.objectId),D.add(k.objectId)}),0===O.length)return;const V=[];d._featureTiles.forEach(k=>{const oe=d._applyEditsAddUpdateTile(k,O,D,r);oe&&V.push(oe)}),yield(0,W.as)(V)})()}_applyEditsAddUpdateTile(e,i,r,d){var O=this;return(0,x.Z)(function*(){if(!e.features)return;const D=O._createQuery(e);D.resultType=void 0,D.cacheHint=!1,D.objectIds=i;const V=yield O._queryFeatures(D,d);let k=null;if(r.size>0){const oe=e.features.filter(Ee=>!r.has((0,P.MS)(Ee,O._objectIdField)));oe.length!==e.features.length&&(k=oe)}if(V.features.length>0){k||(k=e.features.slice());for(const oe of V.features)k.push(oe)}k&&(e.hasPreciseFeatureCount&&(e.numFeatures=Math.max(e.numFeatures,k.length)),e.setFeatures(k,0,We(e.availableFields,V.fields)),O._invalidateCounts())})()}_queryFeatures(e,i){return this.context.query.queryFeaturesDehydrated(e,{signal:i,timeout:Ke})}_setDirty(){this._dirty=!0,this._updated()}runTask(e){if(this._frameTask.processQueue(e),!this._dirty||!this.initialized)return;this._dirty=!1;const i=this._getListOfTiles();if(this._markTilesNotAlive(i),!e.run(()=>this._addTiles(i,e))||!e.run(()=>this._filterExtentTiles(i,e))||!e.run(()=>this._removeTiles(i,e))||e.done)return void this._setDirty();const r=this._sortTiles(i);e.run(()=>this._showTiles(r,e))&&e.run(()=>this._fetchTiles(r,e))&&e.run(()=>this._updateMemoryEstimates(r,e))||this._setDirty(),this._updated(),this.updating||this._updateMaximumNumberOfFeaturesExceeded()}_markTilesNotAlive(e){for(const i of e)i.alive=!1}_addTiles(e,i){return!this._suspended&&(this.tileDescriptors.forEach(r=>{const d=this._featureTiles.get(r.id);d?d.alive=!0:i.done||(e.push(this._addTile(r)),i.madeProgress())}),i.hasProgressed)}_filterExtentTiles(e,i){for(const r of e){if(i.done)break;r.alive&&(r.filtered=!r.intersects(this.filterExtent),r.filtered&&(this._clearTile(r),i.madeProgress()))}return i.hasProgressed}_removeTiles(e,i){for(let r=e.length-1;r>=0&&!i.done;r--){const d=e[r];d.alive||(this._removeTile(d),r!==e.length-1&&(e[r]=e[e.length-1]),e.pop(),i.madeProgress())}return i.hasProgressed}_sortTiles(e){return e.sort((i,r)=>{var d,O;return(null!=(d=i.descriptor.loadPriority)?d:0)-(null!=(O=r.descriptor.loadPriority)?O:0)}),e}_showTiles(e,i){const r=this._updateRatio(e),d=O=>{const D=this._fullRatio<1?r(O)*this._farRatio:1;return O.reduceFeatures(D,this.memoryFactor,this._objectIdField)&&this._setDirty(),this._showTile(O)};for(const O of e)if(!i.run(()=>d(O))){this._setDirty();break}return i.hasProgressed}_fetchTiles(e,i){if(this._paused)return!1;let r=!1;for(const d of e){if(!d.needsFetching)continue;const O=(0,y.pC)(this.context.memoryCache)?this.context.memoryCache.pop(d.id):null;if((0,y.pC)(O))d.cache=O,this._setDirty(),this._scheduleUpdated(),i.madeProgress();else{if(this._needsNumFeatures(d)){const D=new AbortController,V=this._fetchTileCount(d,D.signal);this._handleRequest(d,V,D,()=>d.numFeatures=-2),r=!0,i.madeProgress()}if(i.done)return!0}}if(r)return i.hasProgressed;for(const d of e)if(d.needsFetching){const O=new AbortController,D=this._fetchTile(d,O.signal);if(this._handleRequest(d,D,O,V=>{d.setFeatures([],0,null),this._invalidateCounts(),d.featuresMissing=!1,this.context.logFetchError(fe,V)}),i.madeProgress())return!0}return i.hasProgressed}_updateMemoryEstimates(e,i){return e.some(r=>!i.run(()=>r.updateMemoryEstimates())&&(this._setDirty(),!0)),i.hasProgressed}_reclip(e,i){if(!this.initialized)return;const r=new Array;this._featureTiles.forEach(d=>{(0,y.Wi)(d.displayingFeatures)||0===d.displayingFeatures.length||(d.intersectionIncludingBorrowed(i,Ne),d.intersectionIncludingBorrowed(e,ge),(0,o.fS)(Ne,ge)||r.push(d))}),this._refreshDisplayingFeatures(r),this._updated()}_refreshDisplayingFeatures(e){const i=new Set,r=this._changes.updates;for(const d of e)if(!(0,y.Wi)(d.displayingFeatures))for(const O of d.displayingFeatures){const D=(0,P.MS)(O,this._objectIdField);if(i.has(D))continue;i.add(D);const V=this._displayingFeatureReferences.get(D).feature;r.removes.push(V),r.adds.push(V)}this._applyChanges()}_updated(){let e=0;this._paused||this._featureTiles.forEach(r=>r.isFetching?++e:0);const i=this._dirty||!!this._pendingEdits||e>0;if(this._set("running",this._dirty),this._set("updating",i),i){let r=0,d=0,O=0,D=0,V=0;const k=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(le=>{if(++d,le.isFetching&&le.hasPreciseFeatureCount){const Oe=this._maximumFeaturesForTile(le)*(1-le.emptyFeatureRatio),Pe=(0,y.pC)(le.displayingFeatures)?le.displayingFeatures.length*k:0;V+=Oe-Pe}le.needsFetching?++D:le.numFeatures>0&&(++O,r+=le.numFeatures)}),D+=e;let oe=0,Ee=0;r?(Ee=r,oe=Math.min(D*r/O,r)):(Ee=d,oe=D),V=Math.min(this.maximumNumberOfFeatures-this.features.length,V),this._set("updatingTotal",Ee),this._set("updatingRemaining",oe),this._set("expectedFeatureDiff",V)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}_updateMaximumNumberOfFeaturesExceeded(){const e=(0,a.oE)(this._featureTiles,i=>i.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",e)}_updateRatio(e){const i=function U(e){let i=0;for(const r of e)r.features&&r.features.length>0&&r.alive&&(i=Math.max(i,r.descriptor.lij[0]));return i}(e),r=D=>1/(1<<Math.max(0,i-D.descriptor.lij[0]));let d=0,O=0;for(const D of e){const V=D.numFeatures;d+=V,O+=V*r(D)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/d),this._farRatio=this.maximumNumberOfFeatures/O,this._scheduleUpdated(),r}_maximumFeaturesUpdated(e,i){e!==i&&(i>e&&this._featureTiles.forEach(r=>{if(!r.featuresMissing)return;const d=this._maximumFeaturesForTile(r);r.features&&(r.features.length>=d||r.fetchStatus===h.FULL)||(this._cancelFetchTile(r),this._resetFetchTile(r))}),this._setDirty())}_addTile(e){const i=new q(e);return this._featureTiles.set(i.id,i),this._resetFetchTile(i),this._referenceDisplayingFeaturesFromRelatedTiles(i),i}_referenceDisplayingFeaturesFromRelatedTiles(e){const i=e.descriptor.resolution;this._featureTiles.forEach(r=>{if(!((0,y.Wi)(r.displayingFeatures)||e===r||e.descriptor.lij&&r.descriptor.lij&&!(0,Q.E9)(e.descriptor.lij,r.descriptor.lij))){(0,y.Wi)(e.displayingFeatures)&&(e.displayingFeatures=[]),e.descriptor.extent&&r.descriptor.extent&&((0,y.Wi)(e.extentIncludingBorrowedFeatures)&&(e.extentIncludingBorrowedFeatures=(0,o.d9)(e.descriptor.extent)),(0,o.jn)(e.extentIncludingBorrowedFeatures,r.descriptor.extent,e.extentIncludingBorrowedFeatures));for(const d of r.displayingFeatures){e.displayingFeatures.push(d);const O=this._displayingFeatureReferences.get((0,P.MS)(d,this._objectIdField));O.ref(O.feature,i),this._numDisplayingFeatureReferences++}}}),e.featureLimit=(0,y.pC)(e.displayingFeatures)?e.displayingFeatures.length:0}_removeTile(e){this._clearTile(e),this._featureTiles.delete(e.id)}_resetFetchTile(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=h.DONE):e.fetchStatus=h.FETCH_NEEDED}_cancelFetchTile(e){const i=e.requestController;(0,y.pC)(i)&&(e.requestController=null,e.resetFetching(),i.abort())}_fetchTileCount(e,i){var r=this;return(0,x.Z)(function*(){return e.numFeatures=yield r._fetchCount(e,i),r._updateRatio(r._getListOfTiles()),e.fetchStatus===h.REFETCHING?h.REFETCH_NEEDED:h.FETCH_NEEDED})()}_fetchTile(e,i){var r=this;return(0,x.Z)(function*(){const d=r._maximumFeaturesForTile(e);if(d<=0)return function be(e){return e.setFeatures([],0,null),e.featuresMissing=!1,h.DONE}(e);const O=r._getMaxRecordCount(e),D=Math.ceil(d/O);if(pe(e)||!r.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=d&&D>B.Z.MAX_MAX_RECORD_COUNT_FACTOR)return r._fetchPagedTile(e,i);const V=r._createQuery(e);if(V.maxRecordCountFactor=Math.ceil(d/O),e.isRefetching&&e.features&&e.features.length>0){const Oe=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/O);V.maxRecordCountFactor=Math.max(Oe+1,V.maxRecordCountFactor)}const{features:k,exceededTransferLimit:oe,fields:Ee}=yield r._queryFeatures(V,i),le=oe?V.maxRecordCountFactor>=B.Z.MAX_MAX_RECORD_COUNT_FACTOR?h.FULL:h.DONE:h.FULL;return yield r._frameTask.schedule(()=>{e.featuresMissing=k.length<e.numFeatures||!!oe;const Oe=r._removeEmptyFeatures(k);e.setFeatures(k,Oe,Ue(Ee))},i),(0,W.k_)(i),r._invalidateCounts(),le})()}_fetchCount(e,i){var r=this;return(0,x.Z)(function*(){return r.context.query.queryFeatureCount(r._createFeatureCountQuery(e),{signal:i})})()}_fetchPagedTile(e,i){var r=this;return(0,x.Z)(function*(){let d,O=0,D=0,V=0,k=r._maximumFeaturesForTile(e)-V;const oe=r._getMaxRecordCount(e);let Ee=null;for(;;){const le=r._createQuery(e),Oe=r._setPagingParameters(le,O,k,oe),{features:Pe,exceededTransferLimit:Me,fields:Ae}=yield r._queryFeatures(le,i);if(yield r._frameTask.schedule(()=>{Oe&&(O+=(0,y.Wg)(le.num)),V+=Pe.length,D+=r._removeEmptyFeatures(Pe),e.featuresMissing=O<e.numFeatures||!!Me,d=d?d.concat(Pe):Pe,Ee=We(Ee,Ae),e.setFeatures(d,D,Ee)},i),(0,W.k_)(i),r._invalidateCounts(),r._setDirty(),k=r._maximumFeaturesForTile(e)-V,!Oe||!Me||k<=0)return Me?h.DONE:h.FULL}})()}_createFeatureCountQuery(e){const i=this._createQuery(e);return this.context.capabilities.supportsCacheHint&&(i.resultType=void 0,i.cacheHint=!0),i}_createQuery(e){const i=this.context.createQuery(),r=e.descriptor.extent;return r&&(i.geometry=(0,o.HH)(r,this.context.tilingScheme.spatialReference)),this._setResolutionParams(i,e),this._useTileQuery(e)?i.resultType="tile":this.context.capabilities.supportsCacheHint&&(i.cacheHint=!0),i}_setPagingParameters(e,i,r,d){return!!this.context.capabilities.supportsPagination&&(e.start=i,r>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/d),e.num=Math.min(e.maxRecordCountFactor*d,r)):e.num=Math.min(d),!0)}_getEffectiveTileResolution(e){if(null==e.descriptor.resolution)return null;const i=this.context.viewingMode===S.JY.Global?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,i)/this.lodFactor}get _supportsResolution(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}_setResolutionParams(e,i){if(!this._supportsResolution)return;const r=this._getEffectiveTileResolution(i);null!=r&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new T.Z({mode:"view",originPosition:"upper-left",tolerance:r,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=r))}_removeEmptyFeatures(e){const i=e.length;for(let r=0;r<e.length;)(0,P.dF)(e[r].geometry)?++r:(e[r]=e[e.length-1],--e.length);return i-e.length}_needsNumFeatures(e){return this.useTileCount&&e.needsFeatureCount&&!pe(e)}_getMaxRecordCount(e){const{tileMaxRecordCount:i,maxRecordCount:r}=this.context;return this._useTileQuery(e)&&(0,y.pC)(i)&&i>0&&this.context.capabilities.supportsResultType?i:(0,y.pC)(r)&&r>0?r:He}_useTileQuery(e){return(!pe(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType}_handleRequest(e,i,r,d){e.fetchStatus=e.needsRefetching?h.REFETCHING:h.FETCHING,e.requestController=r;let O=!1;i.then(D=>{e.requestController=null,e.fetchStatus=D}).catch(D=>{e.requestController===r&&(e.requestController=null,e.fetchStatus=h.DONE),(0,W.D_)(D)?O=!0:d(D)}).then(()=>{O||this._setDirty(),this._scheduleUpdated()})}_scheduleUpdated(){this._handles&&!this._handles.has("scheduleUpdated")&&this._handles.add((0,u.Os)(()=>{this._handles.remove("scheduleUpdated"),this._updated()}),"scheduleUpdated")}_showTile(e){if((0,y.pC)(e.displayingFeatures)&&!e.needsDisplayUpdate)return!1;const i=e.features;if(0===e.featureLimit||!i){const V=(0,y.pC)(e.displayingFeatures)&&e.displayingFeatures.length>0;return this._hideTileFeatures(e),e.displayingFeatures=[],V}const r=e.descriptor.resolution,d=this._changes.updates,O=this._changes.adds,D=Math.min(e.featureLimit,i.length);e.featureLimit=D;for(let V=0;V<D;++V){const k=i[V],oe=(0,P.MS)(k,this._objectIdField),Ee=this._displayingFeatureReferences.get(oe);if(Ee){const le=Ee.ref(k,r);le.oldVersion!==le.newVersion&&(le.oldVersion&&d.removes.push(le.oldVersion),le.newVersion&&d.adds.push(le.newVersion))}else this._displayingFeatureReferences.set(oe,new this.FeatureReferenceClass(k,r)),O.push(k);this._numDisplayingFeatureReferences++}return this._hideTileFeatures(e),this._applyChanges(),e.displayingFeatures=i.slice(0,D),!0}_hideTile(e){this._cancelFetchTile(e),this._hideTileFeatures(e)}_hideTileFeatures(e){if((0,y.Wi)(e.displayingFeatures))return;const i=this._changes.updates,r=this._changes.removes;for(const d of e.displayingFeatures){const O=(0,P.MS)(d,this._objectIdField),D=this._displayingFeatureReferences.get(O);if(!D)continue;const V=D.unref(e.descriptor.resolution);this._numDisplayingFeatureReferences--,V?V.oldVersion!==V.newVersion&&(null==V.newVersion?(this._displayingFeatureReferences.delete(O),V.oldVersion&&r.push(V.oldVersion)):(i.adds.push(V.newVersion),V.oldVersion&&i.removes.push(V.oldVersion))):console.error("Hiding unreferenced feature")}this._applyChanges(),e.displayingFeatures=null}_applyChanges(){const e=this._changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);const i=this._changes.adds,r=this._changes.removes,d=Math.min(i.length,r.length);let O=0;for(;O<d;){const D=Math.min(O+Ie,d);this.features.addMany(i.slice(O,D)),this.features.removeMany(r.slice(O,D)),O=D}i.length>d&&this.features.addMany(0===O?i:i.slice(O)),r.length>d&&this.features.removeMany(0===O?r:r.slice(O)),i.length=0,r.length=0}_clearTile(e){this._hideTile(e),e.features&&(0,y.pC)(this.context.memoryCache)&&this.context.memoryCache.put(e.id,e.cache,16+e.estimatedSize),e.setFeatures(null,0,null),this._invalidateCounts()}_invalidateCounts(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")}_getListOfTiles(){return Array.from(this._featureTiles.values())}get storedFeatures(){return this._getListOfTiles().reduce((e,i)=>e+(i.features?i.features.length:0),0)}get missingTiles(){return Array.from(this._featureTiles.values()).reduce((e,i)=>e+(i.needsFetching||i.isFetching?1:0),0)}_maximumFeaturesForTile(e){const i=e.hasPreciseFeatureCount?e.numFeatures:1/0;return Math.min(Math.ceil((e.hasPreciseFeatureCount?i:this.maximumNumberOfFeatures)*(this._fullRatio<1?this._farRatio:1)/(1-e.emptyFeatureRatio)),i)}get test(){return{process:e=>this.runTask(e),getFeatureTileById:e=>this._featureTiles.get(e),forEachFeatureTile:e=>this._featureTiles.forEach(e)}}};function pe(e){return"dummy-tile-full-extent"===e.id}function de(e){const i=e.capabilities.query;return{supportsMultipleResolutions:Ce(e),supportsPagination:!(!i||!i.supportsPagination),supportsResultType:!(!i||!i.supportsResultType),supportsCacheHint:!(!i||!i.supportsCacheHint),supportsQuantization:!(!i||!i.supportsQuantization),supportsQuantizationEditMode:!(!i||!i.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!i||!i.supportsMaxRecordCountFactor),supportsFormatPBF:!(!i||!i.supportsFormatPBF)}}function Ce(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function Ue(e){return(0,y.Wi)(e)?new Set:new Set(e.map(i=>i.name))}function We(e,i){if((0,y.Wi)(e)||(0,y.Wi)(i))return Ue(i);const r=new Set;for(const{name:d}of i)e.has(d)&&r.add(d);return r}(0,s._)([(0,p.Cb)({constructOnly:!0})],ee.prototype,"features",void 0),(0,s._)([(0,p.Cb)()],ee.prototype,"tileDescriptors",void 0),(0,s._)([(0,p.Cb)({value:1/0})],ee.prototype,"maximumNumberOfFeatures",null),(0,s._)([(0,p.Cb)({value:1})],ee.prototype,"memoryFactor",null),(0,s._)([(0,p.Cb)({value:1})],ee.prototype,"lodFactor",null),(0,s._)([(0,p.Cb)()],ee.prototype,"useTileCount",null),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"updating",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"running",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"updatingTotal",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"updatingRemaining",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"expectedFeatureDiff",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"memoryForUnusedFeatures",null),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"maximumNumberOfFeaturesExceeded",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],ee.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"totalVertices",null),(0,s._)([(0,p.Cb)({readOnly:!0})],ee.prototype,"totalFeatures",null),(0,s._)([(0,p.Cb)()],ee.prototype,"filterExtent",null),(0,s._)([(0,p.Cb)({constructOnly:!0})],ee.prototype,"context",void 0),ee=(0,s._)([(0,m.j)(ne)],ee);const He=2e3,Ne=(0,o.Ue)(),ge=(0,o.Ue)(),Ke=6e5,Ie=200},98667:(re,j,t)=>{t.d(j,{n:()=>T});var x=t(15861),s=t(17626),L=t(59213),v=t(80542),b=t(63290),a=t(62208),y=t(10699),W=t(32917),f=t(77712),E=(t(90912),t(85931),t(76898)),A=t(98624),m=t(59990),o=t(34675),P=t(87091);let T=class extends v.r{constructor(B){var S;super(B),S=this,this._updateTask=null,this._frameTask=null,this._queryEngine=null,this._updateRequested=!0,this._updateVisibility=function(){var $=(0,x.Z)(function*(Z){if((0,a.Wi)(S._compositedFeatureFilter)&&(0,a.Wi)(S._sceneFilter)||0===S.context.getFeatureCount())return S._frameTask.schedule(()=>S.clear(),Z);try{const te=yield S._queryEngine.executeQueryForIdSet(S._compositedFeatureFilter,S._sceneFilter,Z);return S._frameTask.schedule(()=>{S.context.updateFeatureVisibilities(se=>te.has(se))},Z)}catch(te){return(0,y.r9)(te),b.Z.getLogger(S.declaredClass).warn(`FeatureFilter query failed: ${te}`,{error:te}),S._frameTask.schedule(()=>{S.context.setAllFeaturesVisibility(!0)},Z)}});return function(Z){return $.apply(this,arguments)}}()}initialize(){const B=P.T8.FILTER_VISIBILITY,{layer:S,view:$}=this._layerView,{featureStore:Z}=this.context;this._queryEngine=new o.q({context:{spatialReference:$.spatialReference,layer:S,scheduler:$.resourceController.scheduler,featureStore:Z,hasM:"hasM"in this._layerView&&this._layerView.hasM,hasZ:"hasZ"in this._layerView&&this._layerView.hasZ},priority:B}),this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(B,this),this.updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),W.nn)}destroy(){this._updateRequested=!1,this.handles.removeAll(),this.updatingHandles.removeAll(),this.clear(),this._updateTask=(0,a.IM)(this._updateTask),this._frameTask=(0,a.hw)(this._frameTask),this._queryEngine=(0,a.SC)(this._queryEngine),this._set("context",null)}get updating(){return this.running||this.updatingHandles.updating||(0,a.pC)(this._updateTask)&&!this._updateTask.finished}get running(){return this._updateRequested||this._frameTask.updating}get defaultVisibility(){return(0,a.Wi)(this._compositedFeatureFilter)&&(0,a.Wi)(this._sceneFilter)}get _featureFilter(){return"filter"in this._layerView?this._layerView.filter:null}get _sceneFilter(){return"layerFilter"in this._layerView?this._layerView.layerFilter:null}get _floorFilter(){return(0,m.c)(this._layerView)}get _timeExtent(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}get _compositedFeatureFilter(){const{_featureFilter:B,_timeExtent:S,_floorFilter:$}=this;if((0,a.Wi)(S)&&(0,a.Wi)($))return B;const Z=(0,a.pC)(B)?B.clone():new A.Z;if((0,a.pC)(S)&&(Z.timeExtent=(0,a.pC)(Z.timeExtent)?Z.timeExtent.intersection(S):S),(0,a.pC)($)){const te=(0,a.Wi)(Z.where)||""===Z.where;Z.where=te?$:`(${Z.where}) AND (${$})`}return Z}get _layerView(){return this.context.layerView}reapply(){this._updateRequested=!0}clear(){this._queryEngine.clear(),this.context.clearFeaturesVisibility()}runTask(B){this._updateRequested&&(this._updateTask=(0,a.IM)(this._updateTask),this._updateTask=(0,L.vr)(this._updateVisibility),this._updateRequested=!1,B.madeProgress()),this._frameTask.processQueue(B)}};(0,s._)([(0,f.Cb)({constructOnly:!0})],T.prototype,"context",void 0),(0,s._)([(0,f.Cb)()],T.prototype,"updating",null),(0,s._)([(0,f.Cb)()],T.prototype,"running",null),(0,s._)([(0,f.Cb)()],T.prototype,"defaultVisibility",null),(0,s._)([(0,f.Cb)()],T.prototype,"_featureFilter",null),(0,s._)([(0,f.Cb)()],T.prototype,"_sceneFilter",null),(0,s._)([(0,f.Cb)()],T.prototype,"_floorFilter",null),(0,s._)([(0,f.Cb)()],T.prototype,"_timeExtent",null),(0,s._)([(0,f.Cb)()],T.prototype,"_compositedFeatureFilter",null),(0,s._)([(0,f.Cb)()],T.prototype,"_layerView",null),(0,s._)([(0,f.Cb)()],T.prototype,"_updateTask",void 0),(0,s._)([(0,f.Cb)()],T.prototype,"_updateRequested",void 0),T=(0,s._)([(0,E.j)("esri.views.3d.layers.support.FeatureVisibilityFilter")],T)},97445:(re,j,t)=>{function x(L,v,b){if(!b||null==v)return null;if(!L)return function s(L,v){const b=v.toLowerCase();for(const a in L)if(a.toLowerCase()===b)return L[a];return null}(v,b);const a=L.get(b);return a?v[a.name]:null}t.d(j,{g:()=>x})},89765:(re,j,t)=>{t.d(j,{E:()=>v});var x=t(62208),s=t(46367),L=t(35082);function v(b){const a=b.view.spatialReference,y=b.layer.fullExtent,W=(0,x.pC)(y)&&y.spatialReference;if((0,x.Wi)(y)||!W)return Promise.resolve(null);if(W.equals(a))return Promise.resolve(y.clone());const f=(0,s.iV)(y,a);return(0,x.pC)(f)?Promise.resolve(f):b.view.state.isLocal?(0,L.projectGeometry)(y,a,b.layer.portalItem).then(u=>!b.destroyed&&u?u:null).catch(()=>null):Promise.resolve(null)}},36967:(re,j,t)=>{t.d(j,{g:()=>v});var x=t(61885),s=t(73234),L=t(28862);class v extends x.Z{constructor(){super(...arguments),this._set=new Set}clear(){if(this._set.size>0){const a=this.toArray();this._set.clear(),this.emit("after-changes",{type:s.y.REMOVE}),this.emit("change",{added:[],removed:a})}}get length(){return this._set.size}addMany(a){if(0!==a.length){for(const y of a)this._set.add(y);this.emit("after-changes",{type:s.y.ADD}),this.emit("change",{added:a,removed:[]})}}remove(a){this._set.delete(a)&&(this.emit("after-changes",{type:s.y.REMOVE}),this.emit("change",{added:[],removed:[a]}))}removeMany(a){const y=[];for(const W of a)this._set.delete(W)&&y.push(W);y.length>0&&(this.emit("after-changes",{type:s.y.REMOVE}),this.emit("change",{added:[],removed:y}))}toArray(){return[...this._set]}find(a){let y;return(0,L.f)(this._set,W=>!!a(W)&&(y=W,!0)),y}forEach(a){this._set.forEach(y=>a(y))}}},45611:(re,j,t)=>{t.d(j,{Z:()=>m});var x=t(17626),s=t(14517),L=t(61885),v=t(80542),b=t(61996),a=t(63290),y=t(62208),W=t(60330),f=t(77712),E=(t(90912),t(85931),t(76898));let A=class extends((0,v.p)((0,b.IG)((0,W.v)(L.Z.EventedMixin(s.Z))))){constructor(o){super(o),this.layer=null,this.parent=null}initialize(){this.when().catch(o=>{if("layerview:create-error"!==o.name){const P=this.layer&&this.layer.id||"no id",T=this.layer&&this.layer.title||"no title";a.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${T}', id: '${P}')`,o)}})}get fullOpacity(){return(0,y.Pt)(this.get("layer.opacity"),1)*(0,y.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var o;return!this.suspended&&!0===(null==(o=this.layer)?void 0:o.legendEnabled)}get updating(){var o;return!!(null!=(o=this.updatingHandles)&&o.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var o;return!0===(null==(o=this.layer)?void 0:o.visible)}set visible(o){this._overrideIfSome("visible",o)}canResume(){var o,P,T;return this.visible&&(null==(o=this.layer)?void 0:o.loaded)&&!(null!=(P=this.parent)&&P.suspended)&&(null==(T=this.view)?void 0:T.ready)||!1}getSuspendInfo(){const o=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(o.viewNotReady=!0),this.layer&&this.layer.loaded||(o.layerNotLoaded=!0),this.visible||(o.layerInvisible=!0),o}isUpdating(){return!1}};(0,x._)([(0,f.Cb)()],A.prototype,"fullOpacity",null),(0,x._)([(0,f.Cb)()],A.prototype,"layer",void 0),(0,x._)([(0,f.Cb)()],A.prototype,"parent",void 0),(0,x._)([(0,f.Cb)({readOnly:!0})],A.prototype,"suspended",null),(0,x._)([(0,f.Cb)({readOnly:!0})],A.prototype,"suspendInfo",null),(0,x._)([(0,f.Cb)({readOnly:!0})],A.prototype,"legendEnabled",null),(0,x._)([(0,f.Cb)({type:Boolean,readOnly:!0})],A.prototype,"updating",null),(0,x._)([(0,f.Cb)({readOnly:!0})],A.prototype,"updatingProgress",null),(0,x._)([(0,f.Cb)()],A.prototype,"visible",null),(0,x._)([(0,f.Cb)()],A.prototype,"view",void 0),A=(0,x._)([(0,E.j)("esri.views.layers.LayerView")],A);const m=A}}]);