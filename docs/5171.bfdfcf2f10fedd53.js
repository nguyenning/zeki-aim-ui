"use strict";var ze=Object.defineProperty,Je=Object.defineProperties,qe=Object.getOwnPropertyDescriptors,Re=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,Ee=(Y,K,c)=>K in Y?ze(Y,K,{enumerable:!0,configurable:!0,writable:!0,value:c}):Y[K]=c,le=(Y,K)=>{for(var c in K||(K={}))He.call(K,c)&&Ee(Y,c,K[c]);if(Re)for(var c of Re(K))Xe.call(K,c)&&Ee(Y,c,K[c]);return Y},Ie=(Y,K)=>Je(Y,qe(K));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[5171],{90512:(Y,K,c)=>{c.d(K,{Z:()=>z});var p=c(15861);class z{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(L,C,B){this._layerById[C]=B,this._layerByName[L]=B}featureSetByName(L,C=!0,B=["*"]){var M=this;return(0,p.Z)(function*(){return void 0===M._layerByName[L]?null:M._layerByName[L]})()}featureSetById(L,C=!0,B=["*"]){var M=this;return(0,p.Z)(function*(){return void 0===M._layerById[L]?null:M._layerById[L]})()}castToText(L=!1){return"object, FeatureSetCollection"}}},85171:(Y,K,c)=>{c.r(K),c.d(K,{constructAssociationMetaDataFeatureSetFromUrl:()=>Be,constructFeatureSet:()=>se,constructFeatureSetFromPortalItem:()=>Ve,constructFeatureSetFromRelationship:()=>Ue,constructFeatureSetFromUrl:()=>he,convertToFeatureSet:()=>Qe,createFeatureSetCollectionFromMap:()=>Ge,createFeatureSetCollectionFromService:()=>Ke,initialiseMetaDataCache:()=>je});var p=c(15861),z=c(84792),q=c(90512),L=c(53997),C=c(88879),B=c(47562),M=c(52724),v=c(95896),g=c(49086),R=c(91510),Z=c(57366),f=c(77132),d=c(83947),b=c(45333),s=c(47982),S=c(10410);class P{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new P;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,n){const r=new P;r.field=e;const l=S.WhereClause.create(t,n),a=function D(x){if("function"===x.parseTree.type){if(0===x.parseTree.args.value.length)return{name:x.parseTree.name,expr:null};if(x.parseTree.args.value.length>1)throw new s.eS(s.f.MissingStatisticParameters);const e=S.WhereClause.create((0,d.XF)(x.parseTree.args.value[0],f.Bj.Standardised,x.parameters),x.fieldsIndex);return{name:x.parseTree.name,expr:e}}return null}(l);if(null===a)throw new s.eS(s.f.UnsupportedSqlFunction,{function:""});const o=a.name.toUpperCase().trim();if("MIN"===o){if(r.typeofstat="MIN",r.workingexpr=a.expr,null===l)throw new s.eS(s.f.InvalidFunctionParameters,{function:"min"})}else if("MAX"===o){if(r.typeofstat="MAX",r.workingexpr=a.expr,null===l)throw new s.eS(s.f.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===o)r.typeofstat="COUNT",r.workingexpr=a.expr;else if("STDEV"===o){if(r.typeofstat="STDDEV",r.workingexpr=a.expr,null===l)throw new s.eS(s.f.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===o){if(r.typeofstat="SUM",r.workingexpr=a.expr,null===l)throw new s.eS(s.f.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===o){if(r.typeofstat="AVG",r.workingexpr=a.expr,null===l)throw new s.eS(s.f.InvalidFunctionParameters,{function:o})}else if("AVG"===o){if(r.typeofstat="AVG",r.workingexpr=a.expr,null===l)throw new s.eS(s.f.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==o)throw new s.eS(s.f.UnsupportedSqlFunction,{function:o});if(r.typeofstat="VAR",r.workingexpr=a.expr,null===l)throw new s.eS(s.f.InvalidFunctionParameters,{function:"var"})}return r}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var T=c(50011),m=c(65234),u=c(36255),y=c(60466);function F(x){if(!x)return"COUNT";switch(x.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class I extends g.Z{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var t=this;return(0,p.Z)(function*(){if(null===t._wset){const n=yield t._getFilteredSet("",null,null,null,e);return t._wset=n,t._wset}return t._wset})()}_isInFeatureSet(){return f.dj.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,n=1;const r=this._parent?this._parent.getFieldsIndex():new y.Z([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let a=!1;for(let o=0;o<this._config.groupbyfields.length;o++)if(this._config.groupbyfields[o].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}if(!1===a)for(let o=0;o<this._config.statsfields.length;o++)if(this._config.statsfields[o].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}!1===a?t=!0:(this.objectIdField="ROW__ID"+n.toString(),n++)}for(const a of this._config.statsfields){const o=new P;o.field=a.name,o.tofieldname=a.name,o.workingexpr=a.expression instanceof S.WhereClause?a.expression:S.WhereClause.create(a.expression,r),o.typeofstat=F(a.statistic),this._decodedStatsfield.push(o)}this._decodedGroupbyfield=[];for(const a of this._config.groupbyfields){const o={name:a.name,singlefield:null,tofieldname:a.name,expression:a.expression instanceof S.WhereClause?a.expression:S.WhereClause.create(a.expression,r)};this._decodedGroupbyfield.push(o)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const a of this._parent.fields)e[a.name.toUpperCase()]=1;this.types=null}else this.geometryType=f.Qk.point,this.typeIdField="",this.types=null,this.spatialReference=new m.Z({wkid:4326});this.fields=[];const l=new P;l.field=this._nextUniqueName(e),l.tofieldname=this.objectIdField,l.workingexpr=S.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),l.typeofstat="MIN",this._decodedStatsfield.push(l);for(const a of this._decodedGroupbyfield){const o=new u.Z;if(a.name=this._nextUniqueName(e),o.name=a.tofieldname,o.alias=o.name,(0,d.y5)(a.expression)){const i=this._parent.getField((0,d.zR)(a.expression,f.Bj.Standardised));if(!i)throw new s.EN(s.H9.AggregationFieldNotFound);a.name=i.name,a.singlefield=i.name,this.phsyicalgroupbyfields.push(i.name),o.type=i.type}else{o.type=this._convertToEsriFieldType((0,d.DT)(a.expression,this._parent.fields));const i=new u.Z;i.name=a.name,i.alias=i.name,this.phsyicalgroupbyfields.push(a.name),this._adaptedFields.push(new M.yN(i,a.expression)),this._candosimplegroupby=!1}this.fields.push(o)}if(this._adaptedFields.length>0)for(const a of this._parent.fields)this._adaptedFields.push(new M.$X(a));for(let a=0;a<this._decodedStatsfield.length;a++){const o=new u.Z;let i=null;const h=this._decodedStatsfield[a];h.field=this._nextUniqueName(e),h.tofieldname===this.objectIdField&&(this._internalObjectIdField=h.field),o.name=h.tofieldname,o.alias=o.name;const _=null!==h.workingexpr&&(0,d.y5)(h.workingexpr)?(0,d.zR)(h.workingexpr,f.Bj.Standardised):"";switch(this._decodedStatsfield[a].typeofstat){case"SUM":if(""!==_){if(i=this._parent.getField(_),!i)throw new s.EN(s.H9.AggregationFieldNotFound);o.type=i.type}else o.type="double";break;case"MIN":case"MAX":if(""!==_){if(i=this._parent.getField(_),!i)throw new s.EN(s.H9.AggregationFieldNotFound);o.type=i.type}else o.type="double";break;case"COUNT":o.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==_&&(i=this._parent.getField(_),!i))throw new s.EN(s.H9.AggregationFieldNotFound);o.type="double"}this.fields.push(o)}}_canDoAggregates(){return(0,p.Z)(function*(){return!1})()}_getFeatures(e,t,n,r){var l=this;return(0,p.Z)(function*(){const a=l._maxQuery;return!0===l._checkIfNeedToExpandKnownPage(e,a)?(yield l._expandPagedSet(e,a,0,0,r),l._getFeatures(e,t,n,r)):"success"})()}_getFilteredSet(e,t,n,r,l){var a=this;return(0,p.Z)(function*(){if(""!==e)return new R.Z([],[],!0,null);let o=null;const i={ordered:!1,nowhereclause:!1};if(yield a._ensureLoaded(),null!==n)for(let _=0;_<a._decodedStatsfield.length;_++)if(!0===(0,d.hq)(n,a._decodedStatsfield[_].tofieldname)){i.nowhereclause=!0,n=null;break}if(null!==r){i.ordered=!0;for(let _=0;_<a._decodedStatsfield.length;_++)if(!0===r.scanForField(a._decodedStatsfield[_].tofieldname)){r=null,i.ordered=!1;break}if(null!==r)for(const _ of a._decodedGroupbyfield)if(null===_.singlefield&&!0===r.scanForField(_.tofieldname)){r=null,i.ordered=!1;break}}if(!1!==a._candosimplegroupby&&(yield a._parent._canDoAggregates(a.phsyicalgroupbyfields,a._decodedStatsfield,"",null,null))){let _=null;n&&(_=a._reformulateWhereClauseWithoutGroupByFields(n));let E=null;r&&(E=a._reformulateOrderClauseWithoutGroupByFields(r));const N=yield a._parent._getAggregatePagesDataSourceDefinition(a.phsyicalgroupbyfields,a._decodedStatsfield,"",null,_,E,a._internalObjectIdField);return a._checkCancelled(l),o=!0===i.nowhereclause?new R.Z(N._candidates.slice(0).concat(N._known.slice(0)),[],!0===i.ordered&&N._ordered,a._clonePageDefinition(N.pagesDefinition)):new R.Z(N._candidates.slice(0),N._known.slice(0),!0===i.ordered&&N._ordered,a._clonePageDefinition(N.pagesDefinition)),o}let h=a._parent;if(a._adaptedFields.length>0&&(h=new M.Xx({parentfeatureset:a._parent,adaptedFields:a._adaptedFields,extraFilter:null})),!0===i.nowhereclause)o=new R.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:a._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new v.Z({parentfeatureset:h,orderbyclause:new Z.Z(a.phsyicalgroupbyfields.join(",")+","+a._parent.objectIdField+" ASC")})}});else{let _=h;if(null!==n){let E=null;n&&(E=a._reformulateWhereClauseWithoutGroupByFields(n)),_=new L.Z({parentfeatureset:_,whereclause:E})}o=new R.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:a._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new v.Z({parentfeatureset:_,orderbyclause:new Z.Z(a.phsyicalgroupbyfields.join(",")+","+a._parent.objectIdField+" ASC")})}})}return o})()}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,d.bB)(e,t.tofieldname,(0,d.zR)(t.workingexpr,f.Bj.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,d.bB)(e,t.tofieldname,(0,d.zR)(t.expression,f.Bj.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const n of this._decodedGroupbyfield)n.tofieldname!==n.name&&t.push({field:n.tofieldname,newfield:n.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,n){var r=this;return(0,p.Z)(function*(){return!0===r._checkIfNeedToExpandCandidatePage(e,r._maxQuery)?(yield r._expandPagedSet(e,r._maxQuery,0,0,n),r._refineSetBlock(e,t,n)):(r._checkCancelled(n),r._refineKnowns(e,t),e)})()}_expandPagedSet(e,t,n,r,l){return this._expandPagedSetFeatureSet(e,t,n,r,l)}_getPhysicalPage(e,t,n){var r=this;return(0,p.Z)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return r._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,n,[]);const l=yield r._getAgregagtePhysicalPage(e,t,n);for(const a of l){const o={geometry:a.geometry,attributes:{}};for(const i of r._decodedGroupbyfield)o.attributes[i.tofieldname]=a.attributes[i.name];for(const i of r._decodedStatsfield)o.attributes[i.tofieldname]=a.attributes[i.field];r._featureCache[o.attributes[r.objectIdField]]=new C.Z(o)}return l.length})()}_sequentialGetPhysicalItem(e,t,n,r){return new Promise((l,a)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(n)),!0===e.pagesDefinition.internal.fullyResolved||0===t?l(r.length):this._nextAggregateItem(e,t,n,r,o=>{l(null===o?r.length:this._sequentialGetPhysicalItem(e,t-=1,n,r))},a)})}_nextAggregateItem(e,t,n,r,l,a){try{(0,B.W)(e.pagesDefinition.internal.iterator.next()).then(o=>{if(null===o)if(null!==e.pagesDefinition.internal.workingItem){const i=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);r.push(i),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(i.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,l(null)}else e.pagesDefinition.internal.fullyResolved=!0,l(null);else{const i=this._generateAggregateHash(o);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[o],id:i};else{if(i!==e.pagesDefinition.internal.workingItem.id){const h=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return r.push(h),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(h.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[o],id:i},void l(h)}e.pagesDefinition.internal.workingItem.features.push(o)}this._nextAggregateItem(e,t,n,r,l,a)}},a)}catch(o){a(o)}}_calculateFieldStat(e,t,n){const r=[];for(let l=0;l<e.features.length;l++)if(null!==t.workingexpr){const a=t.workingexpr.calculateValue(e.features[l]);null!==a&&r.push(a)}else r.push(null);switch(t.typeofstat){case"MIN":n.attributes[t.tofieldname]=(0,b.tj)("min",r,-1);break;case"MAX":n.attributes[t.tofieldname]=(0,b.tj)("max",r,-1);break;case"SUM":n.attributes[t.tofieldname]=(0,b.tj)("sum",r,-1);break;case"COUNT":n.attributes[t.tofieldname]=r.length;break;case"VAR":n.attributes[t.tofieldname]=(0,b.tj)("var",r,-1);break;case"STDDEV":n.attributes[t.tofieldname]=(0,b.tj)("stddev",r,-1);break;case"AVG":n.attributes[t.tofieldname]=(0,b.tj)("avg",r,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const r of this._decodedGroupbyfield){const l=r.singlefield?e.features[0].attributes[r.singlefield]:r.expression.calculateValue(e.features[0]);t.attributes[r.tofieldname]=l}for(const r of this._decodedStatsfield)this._calculateFieldStat(e,r,t);const n=[];for(let r=0;r<this._decodedStatsfield.length;r++)n.push(this._calculateFieldStat(e,this._decodedStatsfield[r],t));return this._featureCache[t.attributes[this.objectIdField]]=new C.Z({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const n of this._decodedGroupbyfield){const r=n.singlefield?e.attributes[n.singlefield]:n.expression.calculateValue(e);t+=null==r?":":":"+r.toString()}return(0,T.F)(t,T.M.String)}_stat(){return(0,p.Z)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,p.Z)(function*(){return null})()}static registerAction(){g.Z._featuresetFunctions.groupby=function(e,t){return new I({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var w=c(3482),V=c(79429),j=c(22386),U=c(24263),W=c(91179),O=c(80415),G=c(82054),ve=(c(26584),c(8314),c(63290),c(15283),c(2865)),be=(c(59318),c(85931),c(21726),c(16730),c(37053),c(20477)),Te=c(17253),ie=c(96854),xe=(c(87183),c(67736),c(90463)),Oe=(c(29132),c(24865)),we=c(67010),Pe=(c(93555),c(6871),c(98558)),De=c(60776),Ne=c(6729);class oe extends g.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,this._cachedDateMetaData={},e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return f.tI}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,f.hd)(e.toJSON());return(0,T.F)(t,T.M.String)}loadImpl(){var e=this;return(0,p.Z)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){var e;if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields&&(1!==this._layer.outFields.length||"*"!==this._layer.outFields[0])){const t=[];for(const n of this.fields)if("oid"===n.type)t.push(n);else for(const r of this._layer.outFields)if(r.toLowerCase()===n.name.toLowerCase()){t.push(n);break}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],n=[];for(const r of this.fields)if("oid"===r.type)t.push(r),n.push(r.name);else for(const l of this._overrideFields)if(l.toLowerCase()===r.name.toLowerCase()){t.push(r),n.push(r.name);break}this.fields=t,this._overrideFields=n}if(this._layer.source&&this._layer.source.sourceJSON){const t=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=f.Bj.StandardisedNoInterval,null!=t&&t>=10.61&&(this._databaseType=f.Bj.Standardised)):null!=t&&(t>=10.5&&(this._databaseType=f.Bj.StandardisedNoInterval,this._requestStandardised=!0),t>=10.61&&(this._databaseType=f.Bj.Standardised))}this.objectIdField=this._layer.objectIdField;for(const t of this.fields)"global-id"===t.type&&(this.globalIdField=t.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=null!=(e=this._layer.typeIdField)?e:"",this.types=this._layer.types}_isInFeatureSet(){return f.dj.InFeatureSet}_refineSetBlock(e){return(0,p.Z)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,p.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const n=yield t._getFilteredSet("",null,null,null,e);return t._wset=n,n}return t._wset})()}_runDatabaseProbe(e){var t=this;return(0,p.Z)(function*(){yield t._ensureLoaded();const n=new ie.Z;t.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),n.where=e.replace("OBJECTID",t._layer.objectIdField);try{return yield t._layer.queryObjectIds(n),!0}catch(r){return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){var n,r;const t=null==(r=null==(n=this._layer)?void 0:n.capabilities)?void 0:r.query;return!e.outStatistics&&!0===(null==t?void 0:t.supportsFormatPBF)&&!0===(null==t?void 0:t.supportsQuantizationEditMode)}queryPBF(e){var t=this;return(0,p.Z)(function*(){e.quantizationParameters={mode:"edit"};const n=yield(0,be.qp)(t._layer.parsedUrl,e,new Pe.J({}));return Te.Z.fromJSON((0,G.cn)(n.data)).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}nativeCapabilities(){var e;return{title:null!=(e=this._layer.title)?e:"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){const n="execute"===t?ve.e:"executeForCount"===t?xe.P:Oe.G,r="execute"===t&&this.pbfSupportedForQuery(e);let l=null;if(this.recentlyUsedQueries){const a=this.convertQueryToLruCacheKey(e);l=this.recentlyUsedQueries.getFromCache(a),null===l&&(l=!0!==r?n(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(a,l),l=l.catch(o=>{var i;throw null==(i=this.recentlyUsedQueries)||i.removeFromCache(a),o}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===l&&(l=!0!==r?n(this._layer.parsedUrl.path,e):this.queryPBF(e)),l}_getFilteredSet(e,t,n,r,l){var a=this;return(0,p.Z)(function*(){const o=yield a.databaseType();if(a.isTable()&&t&&null!==e&&""!==e)return new R.Z([],[],!0,null);if(a._canUsePagination())return a._getFilteredSetUsingPaging(e,t,n,r,l);let i="",h=!1;null!==r&&a._layer.capabilities&&a._layer.capabilities.query&&!0===a._layer.capabilities.query.supportsOrderBy&&(i=r.constructClause(),h=!0);const _=new ie.Z;a.datesInUnknownTimezone&&(_.timeReferenceUnknownClient=!0),_.where=null===n?null===t?"1=1":"":(0,d.zR)(n,o),a._requestStandardised&&(_.sqlFormat="standard"),_.spatialRelationship=a._makeRelationshipEnum(e),_.outSpatialReference=a.spatialReference,_.orderByFields=""!==i?i.split(","):null,_.geometry=null===t?null:t,_.relationParameter=a._makeRelationshipParam(e);let E=yield a.executeQuery(_,"executeForIds");return null===E&&(E=[]),a._checkCancelled(l),new R.Z([],E,h,null)})()}_expandPagedSet(e,t,n,r,l){return this._expandPagedSetFeatureSet(e,t,n,r,l)}_getFilteredSetUsingPaging(e,t,n,r,l){var a=this;return(0,p.Z)(function*(){var Q;let o="",i=!1;null!==r&&a._layer.capabilities&&a._layer.capabilities.query&&!0===a._layer.capabilities.query.supportsOrderBy&&(o=r.constructClause(),i=!0);const h=yield a.databaseType();let _=null===n?null===t?"1=1":"":(0,d.zR)(n,h);a._layer.definitionExpression&&a._useDefinitionExpression&&(_=""!==_?"(("+a._layer.definitionExpression+") AND ("+_+"))":a._layer.definitionExpression);let E=a._maxQueryRate();const N=null==(Q=a._layer.capabilities)?void 0:Q.query.maxRecordCount;null!=N&&N<E&&(E=N);let k=null;if(!0===a._pageJustIds)k=new R.Z([],["GETPAGES"],i,{spatialRel:a._makeRelationshipEnum(e),relationParam:a._makeRelationshipParam(e),outFields:a._layer.objectIdField,resultRecordCount:E,resultOffset:0,geometry:null===t?null:t,where:_,orderByFields:o,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let X=!0;!0===a._removeGeometry&&(X=!1);const H=null!==a._overrideFields?a._overrideFields:a._fieldsIncludingObjectId(a._layer.outFields?a._layer.outFields:["*"]);k=new R.Z([],["GETPAGES"],i,{spatialRel:a._makeRelationshipEnum(e),relationParam:a._makeRelationshipParam(e),outFields:H.join(","),resultRecordCount:E,resultOffset:0,geometry:null===t?null:t,where:_,orderByFields:o,returnGeometry:X,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield a._expandPagedSet(k,E,0,1,l),k})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,n){var r=this;return(0,p.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,a=l,o=e.pagesDefinition.internal.lastPage,i=new ie.Z;r._requestStandardised&&(i.sqlFormat="standard"),r.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.spatialRelationship=e.pagesDefinition.spatialRel,i.relationParameter=e.pagesDefinition.relationParam,i.outFields=e.pagesDefinition.outFields.split(","),i.num=e.pagesDefinition.resultRecordCount,i.start=e.pagesDefinition.internal.lastPage,i.geometry=e.pagesDefinition.geometry,i.where=e.pagesDefinition.where,i.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,i.returnGeometry=e.pagesDefinition.returnGeometry,i.outSpatialReference=r.spatialReference;const h=yield r.executeQuery(i,"execute");if(r._checkCancelled(n),e.pagesDefinition.internal.lastPage!==o)return"done";const _=r._layer.objectIdField;for(let E=0;E<h.features.length;E++)e.pagesDefinition.internal.set[a+E]=h.features[E].attributes[_];if(!1===r._pageJustIds)for(let E=0;E<h.features.length;E++)r._featureCache[h.features[E].attributes[_]]=h.features[E];return(void 0===h.exceededTransferLimit&&h.features.length!==e.pagesDefinition.resultRecordCount||!1===h.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+h.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let n=!1;for(const r of t)if(r.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}return!1===n&&t.push(this.objectIdField),t}_getFeatures(e,t,n,r){var l=this;return(0,p.Z)(function*(){const a=[];if(-1!==t&&void 0===l._featureCache[t]&&a.push(t),!0===l._checkIfNeedToExpandKnownPage(e,l._maxProcessingRate()))return yield l._expandPagedSet(e,l._maxProcessingRate(),0,0,r),l._getFeatures(e,t,n,r);let o=0;for(let E=e._lastFetchedIndex;E<e._known.length;E++){if(e._lastFetchedIndex+=1,o++,void 0===l._featureCache[e._known[E]]){let N=!1;if(null!=l._layer._mode){const k=l._layer._mode;if(void 0!==k._featureMap[e._known[E]]){const Q=k._featureMap[e._known[E]];null!==Q&&(N=!0,l._featureCache[e._known[E]]=Q)}}if(!1===N&&(e._known[E]!==t&&a.push(e._known[E]),a.length>=l._maxProcessingRate()-1))break}if(o>=n&&0===a.length)break}if(0===a.length)return"success";const i=new ie.Z;l._requestStandardised&&(i.sqlFormat="standard"),l.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.objectIds=a,i.outFields=null!==l._overrideFields?l._overrideFields:l._fieldsIncludingObjectId(l._layer.outFields?l._layer.outFields:["*"]),i.returnGeometry=!0,!0===l._removeGeometry&&(i.returnGeometry=!1),i.outSpatialReference=l.spatialReference;const h=yield l.executeQuery(i,"execute");if(l._checkCancelled(r),void 0!==h.error)throw new s.EN(s.H9.RequestFailed,{reason:h.error});const _=l._layer.objectIdField;for(let E=0;E<h.features.length;E++)l._featureCache[h.features[E].attributes[_]]=h.features[E];return"success"})()}_getDistinctPages(e,t,n,r,l,a,o,i,h){var _=this;return(0,p.Z)(function*(){var te,$;yield _._ensureLoaded();const E=yield _.databaseType();let N=n.parseTree.column;const k=null!=(te=_._layer.fields)?te:[];for(let ee=0;ee<k.length;ee++)if(k[ee].name.toLowerCase()===N.toLowerCase()){N=k[ee].name;break}const Q=new ie.Z;_._requestStandardised&&(Q.sqlFormat="standard"),_.datesInUnknownTimezone&&(Q.timeReferenceUnknownClient=!0);let X=null===a?null===l?"1=1":"":(0,d.zR)(a,E);_._layer.definitionExpression&&_._useDefinitionExpression&&(X=""!==X?"(("+_._layer.definitionExpression+") AND ("+X+"))":_._layer.definitionExpression),Q.where=X,Q.spatialRelationship=_._makeRelationshipEnum(r),Q.relationParameter=_._makeRelationshipParam(r),Q.geometry=null===l?null:l,Q.returnDistinctValues=!0,Q.returnGeometry=!1,Q.outFields=[N];const H=yield _.executeQuery(Q,"execute");if(_._checkCancelled(h),!H.hasOwnProperty("features"))throw new s.EN(s.H9.InvalidStatResponse);let re=!1;for(let ee=0;ee<k.length;ee++)if(k[ee].name===N){"date"===k[ee].type&&(re=!0);break}for(let ee=0;ee<H.features.length;ee++){if(re){const ne=H.features[ee].attributes[N];i.push(null!==ne?new Date(ne):ne)}else i.push(H.features[ee].attributes[N]);if(i.length>=o)break}return 0===H.features.length?i:H.features.length===(null==($=_._layer.capabilities)?void 0:$.query.maxRecordCount)&&i.length<o?{calculated:!0,result:yield _._getDistinctPages(e+H.features.length,t,n,r,l,a,o,i,h)}:i})()}_distinctStat(e,t,n,r,l,a,o){var i=this;return(0,p.Z)(function*(){return{calculated:!0,result:yield i._getDistinctPages(0,e,t,n,r,l,a,[],o)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,t,n,r){var l=this;return(0,p.Z)(function*(){const a=yield l.databaseType(),o=new ie.Z;if(l._requestStandardised&&(o.sqlFormat="standard"),l.isTable()&&n&&null!==t&&""!==t)return{calculated:!0,result:0};let i=null===r?null===n?"1=1":"":(0,d.zR)(r,a);return l._layer.definitionExpression&&l._useDefinitionExpression&&(i=""!==i?"(("+l._layer.definitionExpression+") AND ("+i+"))":l._layer.definitionExpression),o.where=i,l.datesInUnknownTimezone&&(o.timeReferenceUnknownClient=!0),o.where=i,o.spatialRelationship=l._makeRelationshipEnum(t),o.relationParameter=l._makeRelationshipParam(t),o.geometry=null===n?null:n,o.returnGeometry=!1,{calculated:!0,result:yield l.executeQuery(o,"executeForCount")}})()}_stats(e,t,n,r,l,a,o){var i=this;return(0,p.Z)(function*(){var ee;yield i._ensureLoaded();const h=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsSqlExpression,_=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsStatistics,E=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsDistinct;if("count"===e)return E?i._countstat(e,n,r,l):{calculated:!1};if(!1===_||!1===(0,d.y5)(t)&&!1===h||!1===t.isStandardized)return""!==n||null!==l?{calculated:!1}:i._manualStat(e,t,a,o);if("distinct"===e)return!1===E?""!==n||null!==l?{calculated:!1}:i._manualStat(e,t,a,o):i._distinctStat(e,t,n,r,l,a,o);const N=yield i.databaseType();if(i.isTable()&&r&&null!==n&&""!==n)return{calculated:!0,result:null};const k=new ie.Z;i._requestStandardised&&(k.sqlFormat="standard");let Q=null===l?null===r?"1=1":"":(0,d.zR)(l,N);i._layer.definitionExpression&&i._useDefinitionExpression&&(Q=""!==Q?"(("+i._layer.definitionExpression+") AND ("+Q+"))":i._layer.definitionExpression),k.where=Q,k.spatialRelationship=i._makeRelationshipEnum(n),k.relationParameter=i._makeRelationshipParam(n),k.geometry=null===r?null:r,i.datesInUnknownTimezone&&(k.timeReferenceUnknownClient=!0);const X=new De.Z;X.statisticType=(0,b.g3)(e),X.onStatisticField=(0,d.zR)(t,N),X.outStatisticFieldName="ARCADE_STAT_RESULT",k.returnGeometry=!1;let H="ARCADE_STAT_RESULT";k.outStatistics=[X];const re=yield i.executeQuery(k,"execute");if(!re.hasOwnProperty("features")||0===re.features.length)throw new s.EN(s.H9.InvalidStatResponse);let te=!1;const $=null!=(ee=re.fields)?ee:[];for(let ne=0;ne<$.length;ne++)if("ARCADE_STAT_RESULT"===$[ne].name.toUpperCase()){H=$[ne].name,"date"===$[ne].type&&(te=!0);break}if(te){let ne=re.features[0].attributes[H];return null!==ne&&(ne=new Date(re.features[0].attributes[H])),{calculated:!0,result:ne}}return{calculated:!0,result:re.features[0].attributes[H]}})()}_stat(e,t,n,r,l,a,o){return this._stats(e,t,n,r,l,a,o)}_canDoAggregates(e,t){var n=this;return(0,p.Z)(function*(){var o,i;yield n._ensureLoaded();let r=!1;const l=null==(o=n._layer.capabilities)?void 0:o.query,a=!0===(null==l?void 0:l.supportsSqlExpression);if(null!=l&&!0===l.supportsStatistics&&!0===l.supportsOrderBy&&(r=!0),r)for(let h=0;h<t.length-1;h++)(!1===(null==(i=t[h].workingexpr)?void 0:i.isStandardized)||!1===(0,d.y5)(t[h].workingexpr)&&!1===a)&&(r=!1);return!1!==r})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,n,r,l,a,o){var i=this;return(0,p.Z)(function*(){var re;yield i._ensureLoaded();const h=yield i.databaseType();let _="",E=!1,N=!1;null!==a&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(_=a.constructClause(),N=!0),i._layer.capabilities&&i._layer.capabilities.query&&!1===i._layer.capabilities.query.supportsPagination&&(N=!1,E=!0,_=i._layer.objectIdField);const k=[];for(let te=0;te<t.length;te++){const $=new De.Z;$.onStatisticField=null!==t[te].workingexpr?(0,d.zR)(t[te].workingexpr,h):"",$.outStatisticFieldName=t[te].field,$.statisticType=t[te].toStatisticsName(),k.push($)}""===_&&(_=e.join(","));let Q=i._maxQueryRate();const X=null==(re=i._layer.capabilities)?void 0:re.query.maxRecordCount;null!=X&&X<Q&&(Q=X);let H=null===l?null===r?"1=1":"":(0,d.zR)(l,h);return i._layer.definitionExpression&&i._useDefinitionExpression&&(H=""!==H?"(("+i._layer.definitionExpression+") AND ("+H+"))":i._layer.definitionExpression),new R.Z([],["GETPAGES"],N,{groupbypage:!0,spatialRel:i._makeRelationshipEnum(n),relationParam:i._makeRelationshipParam(n),outFields:["*"],useOIDpagination:E,generatedOid:o,resultRecordCount:Q,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:k,geometry:null===r?null:r,where:H,orderByFields:_,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,t,n){var r=this;return(0,p.Z)(function*(){let l=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(l=""!==l?"("+l+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const a=e.pagesDefinition.internal.lastRetrieved,o=a,i=e.pagesDefinition.internal.lastPage,h=new ie.Z;if(r._requestStandardised&&(h.sqlFormat="standard"),h.where=l,h.spatialRelationship=e.pagesDefinition.spatialRel,h.relationParameter=e.pagesDefinition.relationParam,h.outFields=e.pagesDefinition.outFields,h.outStatistics=e.pagesDefinition.outStatistics,h.geometry=e.pagesDefinition.geometry,h.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,h.num=e.pagesDefinition.resultRecordCount,h.start=e.pagesDefinition.internal.lastPage,h.returnGeometry=e.pagesDefinition.returnGeometry,r.datesInUnknownTimezone&&(h.timeReferenceUnknownClient=!0),h.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,r.isTable()&&h.geometry&&h.spatialRelationship)return[];const _=yield r.executeQuery(h,"execute");if(r._checkCancelled(n),!_.hasOwnProperty("features"))throw new s.EN(s.H9.InvalidStatResponse);const E=[];if(e.pagesDefinition.internal.lastPage!==i)return[];for(let N=0;N<_.features.length;N++)e.pagesDefinition.internal.set[o+N]=_.features[N].attributes[e.pagesDefinition.generatedOid];for(let N=0;N<_.features.length;N++)E.push(new C.Z({attributes:_.features[N].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===_.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=_.features[_.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===_.exceededTransferLimit&&_.features.length!==e.pagesDefinition.resultRecordCount||!1===_.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+_.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,E})()}static create(e,t,n,r,l){const a=new O.default({url:e,outFields:null===t?["*"]:t});return new oe({layer:a,spatialReference:n,lrucache:r,interceptor:l})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,f.US)(this._layer.parsedUrl.path)}queryAttachments(e,t,n,r,l){var a=this;return(0,p.Z)(function*(){const o=a._layer.capabilities;if((null==o?void 0:o.data.supportsAttachment)&&(null==o?void 0:o.operations.supportsQueryAttachments)){const i={objectIds:[e],returnMetadata:l};(t&&t>0||n&&n>0)&&(i.size=[t&&t>0?t:0,n&&n>0?n:t+1]),r&&r.length>0&&(i.attachmentTypes=r),a.featureSetQueryInterceptor&&a.featureSetQueryInterceptor.preLayerQueryCallback({layer:a._layer,query:i,method:"attachments"});const h=yield a._layer.queryAttachments(i),_=[];return h&&h[e]&&h[e].forEach(E=>{const N=a._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+E.id.toString();let k=null;l&&E.exifInfo&&(k=Ne.Z.convertJsonToArcade(E.exifInfo,"system",!0)),_.push(new j.Z(E.id,E.name,E.contentType,E.size,N,k))}),_}return[]})()}queryRelatedFeatures(e){var t=this;return(0,p.Z)(function*(){var l;const n={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:null==(l=e.outFields)?void 0:l.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(n.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(n.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(n.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(n.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(n.outSR=JSON.stringify(e.outSpatialReference.toJSON())),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preRequestCallback({layer:t._layer,queryPayload:n,method:"relatedrecords",url:t._layer.parsedUrl.path+"/queryRelatedRecords"});const r=yield(0,z.default)(t._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:n});if(r.data){const a={},o=r.data;if(o&&o.relatedRecordGroups){const i=o.spatialReference;for(const h of o.relatedRecordGroups){const _=h.objectId,E=[];for(const N of h.relatedRecords){N.geometry&&(N.geometry.spatialReference=i);const k=new C.Z({geometry:N.geometry?(0,W.im)(N.geometry):null,attributes:N.attributes});E.push(k)}a[_]={features:E,exceededTransferLimit:!0===o.exceededTransferLimit}}}return a}throw new s.EN(s.H9.InvalidRequest)})()}getFeatureByObjectId(e,t){var n=this;return(0,p.Z)(function*(){const r=new ie.Z;r.outFields=t,r.returnGeometry=!1,r.outSpatialReference=n.spatialReference,r.where=n.objectIdField+"="+e.toString(),n.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),n.featureSetQueryInterceptor&&n.featureSetQueryInterceptor.preLayerQueryCallback({layer:n._layer,query:r,method:"execute"});const l=yield(0,ve.e)(n._layer.parsedUrl.path,r);return 1===l.features.length?l.features[0]:null})()}getIdentityUser(){var e=this;return(0,p.Z)(function*(){var n;yield e.load();const t=null==(n=U.id)?void 0:n.findCredential(e._layer.url);return t?t.userId:null})()}getOwningSystemUrl(){var e=this;return(0,p.Z)(function*(){var l;yield e.load();const t=null==(l=U.id)?void 0:l.findServerInfo(e._layer.url);if(t)return t.owningSystemUrl;let n=e._layer.url;const r=n.toLowerCase().indexOf("/rest/services");if(n=r>-1?n.substring(0,r):n,n){n+="/rest/info";try{const a=yield(0,z.default)(n,{query:{f:"json"}});let o="";return a.data&&a.data.owningSystemUrl&&(o=a.data.owningSystemUrl),o}catch(a){return""}}return""})()}getDataSourceFeatureSet(){var t,n,r,l;const e=new oe({layer:this._layer,spatialReference:null!=(t=this.spatialReference)?t:void 0,outFields:null!=(n=this._overrideFields)?n:void 0,includeGeometry:!this._removeGeometry,lrucache:null!=(r=this.recentlyUsedQueries)?r:void 0,interceptor:null!=(l=this.featureSetQueryInterceptor)?l:void 0});return e._useDefinitionExpression=!1,e}get preferredTimeReference(){var e,t,n;return void 0===this._cachedDateMetaData.preferredTimeReference&&(this._cachedDateMetaData.preferredTimeReference=null!=(n=null==(t=null==(e=this._layer)?void 0:e.preferredTimeReference)?void 0:t.toJSON())?n:null),this._cachedDateMetaData.preferredTimeReference}get dateFieldsTimeReference(){var e,t,n;return void 0===this._cachedDateMetaData.dateFieldsTimeReference&&(this._cachedDateMetaData.dateFieldsTimeReference=null!=(n=null==(t=null==(e=this._layer)?void 0:e.dateFieldsTimeReference)?void 0:t.toJSON())?n:null),this._cachedDateMetaData.dateFieldsTimeReference}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone}get editFieldsInfo(){var e,t,n;return void 0===this._cachedDateMetaData.editFieldsInfo&&(this._cachedDateMetaData.editFieldsInfo=null!=(n=null==(t=null==(e=this._layer)?void 0:e.editFieldsInfo)?void 0:t.toJSON())?n:null),this._cachedDateMetaData.editFieldsInfo}get timeInfo(){var e,t,n;return void 0===this._cachedDateMetaData.timeInfo&&(this._cachedDateMetaData.timeInfo=null!=(n=null==(t=null==(e=this._layer)?void 0:e.timeInfo)?void 0:t.toJSON())?n:null),this._cachedDateMetaData.timeInfo}}var Le=c(16776);class Ze extends g.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return f.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,p.Z)(function*(){var t;return yield Promise.all([e._layer.load(),null==(t=e._relatedLayer)?void 0:t.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],n=[];for(const r of this.fields)if("oid"===r.type)t.push(r),n.push(r.name);else for(const l of this._overrideFields)if(l.toLowerCase()===r.name.toLowerCase()){t.push(r),n.push(r.name);break}this.fields=t,this._overrideFields=n}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types}databaseType(){var e=this;return(0,p.Z)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return f.dj.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,p.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const n=yield t._getFilteredSet("",null,null,null,e);return t._wset=n,n}return t._wset})()}_changeFeature(e){const t={};for(const n of this.fields)t[n.name]=e.attributes[n.name];return new C.Z({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,n,r,l){var a=this;return(0,p.Z)(function*(){var te;if(yield a.databaseType(),a.isTable()&&t&&null!==e&&""!==e)return new R.Z([],[],!0,null);const o=a._layer.nativeCapabilities();if(!1===o.canQueryRelated)return new R.Z([],[],!0,null);if((null==(te=o.capabilities)?void 0:te.queryRelated)&&o.capabilities.queryRelated.supportsPagination)return a._getFilteredSetUsingPaging(e,t,n,r,l);let i="",h=!1;null!==r&&o.capabilities&&o.capabilities.queryRelated&&!0===o.capabilities.queryRelated.supportsOrderBy&&(i=r.constructClause(),h=!0);const _=new we.default;_.objectIds=[a._findObjectId];const E=null!==a._overrideFields?a._overrideFields:a._fieldsIncludingObjectId(a._relatedLayer.fields?a._relatedLayer.fields.map($=>$.name):["*"]);_.outFields=E,_.relationshipId=a.relationship.id,_.where="1=1";let N=!0;!0===a._removeGeometry&&(N=!1),_.returnGeometry=N,a._requestStandardised&&(_.sqlFormat="standard"),_.outSpatialReference=a.spatialReference,_.orderByFields=""!==i?i.split(","):null;const k=yield o.source.queryRelatedFeatures(_);a._checkCancelled(l);const Q=k[a._findObjectId]?k[a._findObjectId].features:[],X=[];for(let $=0;$<Q.length;$++)a._featureCache[Q[$].attributes[a._relatedLayer.objectIdField]]=Q[$],X.push(Q[$].attributes[a._relatedLayer.objectIdField]);const H=t&&null!==e&&""!==e,re=null!=n;return new R.Z(H||re?X:[],H||re?[]:X,h,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let n=!1;for(const r of t)if(r.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}return!1===n&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,n,r,l){var a=this;return(0,p.Z)(function*(){var te,$;let o="",i=!1;const h=a._layer.nativeCapabilities();null!==r&&h&&(null==(te=h.capabilities)?void 0:te.queryRelated)&&!0===h.capabilities.queryRelated.supportsOrderBy&&(o=r.constructClause(),i=!0),yield a.databaseType();let E=a._maxQueryRate();const N=null==($=h.capabilities)?void 0:$.query.maxRecordCount;null!=N&&N<E&&(E=N);const k=t&&null!==e&&""!==e,Q=null!=n;let X=null,H=!0;!0===a._removeGeometry&&(H=!1);const re=null!==a._overrideFields?a._overrideFields:a._fieldsIncludingObjectId(a._relatedLayer.fields?a._relatedLayer.fields.map(ee=>ee.name):["*"]);return X=new R.Z(k||Q?["GETPAGES"]:[],k||Q?[]:["GETPAGES"],i,{outFields:re.join(","),resultRecordCount:E,resultOffset:0,objectIds:[a._findObjectId],where:"1=1",orderByFields:o,returnGeometry:H,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield a._expandPagedSet(X,E,0,0,l),X})()}_expandPagedSet(e,t,n,r,l){return this._expandPagedSetFeatureSet(e,t,n,r,l)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,n){var r=this;return(0,p.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,a=l,o=e.pagesDefinition.internal.lastPage,i=r._layer.nativeCapabilities(),h=new we.default;!0===r._requestStandardised&&(h.sqlFormat="standard"),h.relationshipId=r.relationship.id,h.objectIds=e.pagesDefinition.objectIds,h.resultOffset=e.pagesDefinition.internal.lastPage,h.resultRecordCount=e.pagesDefinition.resultRecordCount,h.outFields=e.pagesDefinition.outFields.split(","),h.where=e.pagesDefinition.where,h.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,h.returnGeometry=e.pagesDefinition.returnGeometry,h.outSpatialReference=r.spatialReference;const _=yield i.source.queryRelatedFeatures(h);if(r._checkCancelled(n),e.pagesDefinition.internal.lastPage!==o)return 0;const E=_[r._findObjectId]?_[r._findObjectId].features:[];for(let k=0;k<E.length;k++)e.pagesDefinition.internal.set[a+k]=E[k].attributes[r._relatedLayer.objectIdField];for(let k=0;k<E.length;k++)r._featureCache[E[k].attributes[r._relatedLayer.objectIdField]]=E[k];return E.length!==e.pagesDefinition.resultRecordCount&&(!_[r._findObjectId]||!1===_[r._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+E.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,E.length})()}_getFeatures(e,t,n,r){var l=this;return(0,p.Z)(function*(){const a=[];-1!==t&&void 0===l._featureCache[t]&&a.push(t);const o=l._maxQueryRate();if(!0===l._checkIfNeedToExpandKnownPage(e,o))return yield l._expandPagedSet(e,o,0,0,r),l._getFeatures(e,t,n,r);let i=0;for(let h=e._lastFetchedIndex;h<e._known.length&&(i++,i<=n&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[h]&&void 0===l._featureCache[e._known[h]]&&(e._known[h]!==t&&a.push(e._known[h]),a.length>n)))&&!(i>=n&&0===a.length);h++);if(0===a.length)return"success";throw new s.EN(s.H9.MissingFeatures)})()}_refineSetBlock(e,t,n){return(0,p.Z)(function*(){return e})()}_stat(e,t,n,r,l,a,o){return(0,p.Z)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,t,n,r,l){return(0,p.Z)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,n,r,l){return this._relatedLayer.queryAttachments(e,t,n,r,l)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeReference(){var e,t;return null!=(t=null==(e=this._relatedLayer)?void 0:e.preferredTimeReference)?t:null}get dateFieldsTimeReference(){var e,t;return null!=(t=null==(e=this._relatedLayer)?void 0:e.dateFieldsTimeReference)?t:null}get datesInUnknownTimezone(){var e;return null==(e=this._relatedLayer)?void 0:e.datesInUnknownTimezone}get editFieldsInfo(){var e,t;return null!=(t=null==(e=this._relatedLayer)?void 0:e.editFieldsInfo)?t:null}get timeInfo(){var e,t;return null!=(t=null==(e=this._relatedLayer)?void 0:e.timeInfo)?t:null}}var J=c(53791),Ae=c(55463);function je(){null===J.Z.applicationCache&&(J.Z.applicationCache=new J.Z)}function de(x,e){return ce.apply(this,arguments)}function ce(){return(ce=(0,p.Z)(function*(x,e){if(J.Z.applicationCache){const t=J.Z.applicationCache.getLayerInfo(x);if(t){const l=yield t;return new O.default({url:x,outFields:e,sourceJSON:l})}const n=new O.default({url:x,outFields:e}),r=(0,p.Z)(function*(){return yield n.load(),n.sourceJSON})();if(J.Z.applicationCache){J.Z.applicationCache.setLayerInfo(x,r);try{return yield r,n}catch(l){throw J.Z.applicationCache.clearLayerInfo(x),l}}return yield r,n}return new O.default({url:x,outFields:e})})).apply(this,arguments)}function he(x,e,t,n,r){return fe.apply(this,arguments)}function fe(){return(fe=(0,p.Z)(function*(x,e,t,n,r,l=null){return se(yield de(x,["*"]),e,t,n,r,l)})).apply(this,arguments)}function se(x,e=null,t=null,n=!0,r=null,l=null){const a={layer:x,spatialReference:e,outFields:t,includeGeometry:n,lrucache:r,interceptor:l};return!0===x._hasMemorySource()?new Le.Z(a):new oe(a)}function ke(x){return _e.apply(this,arguments)}function _e(){return(_e=(0,p.Z)(function*(x){if(null!==J.Z.applicationCache){const t=J.Z.applicationCache.getLayerInfo(x);if(null!==t)return t}const e=(0,p.Z)(function*(){const t=yield(0,z.default)(x,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==J.Z.applicationCache){J.Z.applicationCache.setLayerInfo(x,e);try{return yield e}catch(t){throw J.Z.applicationCache.clearLayerInfo(x),t}}return e})).apply(this,arguments)}function Me(x,e){return pe.apply(this,arguments)}function pe(){return(pe=(0,p.Z)(function*(x,e){const t="QUERYDATAELEMTS:"+e.toString()+":"+x;if(null!==J.Z.applicationCache){const r=J.Z.applicationCache.getLayerInfo(t);if(null!==r)return r}const n=(0,p.Z)(function*(){const r=yield(0,z.default)(x+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(r.data){const l=r.data;if(l.layerDataElements&&l.layerDataElements[0])return l.layerDataElements[0]}throw new s.EN(s.H9.DataElementsNotFound)})();if(null!==J.Z.applicationCache){J.Z.applicationCache.setLayerInfo(t,n);try{return yield n}catch(r){throw J.Z.applicationCache.clearLayerInfo(t),r}}return n})).apply(this,arguments)}function Ce(x){return ye.apply(this,arguments)}function ye(){return(ye=(0,p.Z)(function*(x){if(null!==J.Z.applicationCache){const t=J.Z.applicationCache.getLayerInfo(x);if(null!==t)return t}const e=(0,p.Z)(function*(){const t=yield(0,z.default)(x,{responseType:"json",query:{f:"json"}});if(t.data){const n=t.data;return n.layers||(n.layers=[]),n.tables||(n.tables=[]),n}return{layers:[],tables:[]}})();if(null!==J.Z.applicationCache){J.Z.applicationCache.setLayerInfo(x,e);try{return yield e}catch(t){throw J.Z.applicationCache.clearLayerInfo(x),t}}return e})).apply(this,arguments)}function Be(x,e){return ge.apply(this,arguments)}function ge(){return(ge=(0,p.Z)(function*(x,e){const t={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},n=yield Ce(x);if(t.metadata=n,n.controllerDatasetLayers&&null!=n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(const a of n.layers)t.layerNameLkp[a.id]=a.name;if(n.tables)for(const a of n.tables)t.layerNameLkp[a.id]=a.name;const r=n.controllerDatasetLayers.utilityNetworkLayerId;t.networkId=r;const l=yield Me(x,r);if(l){t.queryelem=l,t.queryelem&&t.queryelem.dataElement&&void 0!==t.queryelem.dataElement.schemaGeneration&&(t.unVersion=t.queryelem.dataElement.schemaGeneration),t.lkp={},t.queryelem.dataElement.domainNetworks||(t.queryelem.dataElement.domainNetworks=[]);for(const o of t.queryelem.dataElement.domainNetworks){for(const i of o.edgeSources?o.edgeSources:[]){const h={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]?t.layerNameLkp[i.layerId]:null};h.className&&(t.lkp[h.className]=h)}for(const i of o.junctionSources?o.junctionSources:[]){const h={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]?t.layerNameLkp[i.layerId]:null};h.className&&(t.lkp[h.className]=h)}}if(t.queryelem.dataElement.terminalConfigurations)for(const o of t.queryelem.dataElement.terminalConfigurations)for(const i of o.terminals)t.terminals.push({terminalId:i.terminalId,terminalName:i.terminalName});const a=yield ke(x+"/"+r);if(a.systemLayers&&null!=a.systemLayers.associationsTableId){const o=[];t.unVersion>=4&&(o.push("STATUS"),o.push("PERCENTALONG"));let i=yield he(x+"/"+a.systemLayers.associationsTableId.toString(),e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...o],!1,null,null);return yield i.load(),t.unVersion>=4&&(i=i.filter(S.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",i.getFieldsIndex())),yield i.load()),{lkp:t.lkp,associations:i,unVersion:t.unVersion,terminals:t.terminals}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}})).apply(this,arguments)}function Ue(x,e,t){return me.apply(this,arguments)}function me(){return(me=(0,p.Z)(function*(x,e,t,n=null,r=null,l=!0,a=null,o=null){let i=x.serviceUrl();if(!i)return null;i="/"===i.charAt(i.length-1)?i+e.relatedTableId.toString():i+"/"+e.relatedTableId.toString();const h=yield he(i,n,r,l,a,o);return new Ze({layer:x,relatedLayer:h,relationship:e,objectId:t,spatialReference:n,outFields:r,includeGeometry:l,lrucache:a,interceptor:o})})).apply(this,arguments)}L.Z.registerAction(),I.registerAction(),v.Z.registerAction(),w.Z.registerAction(),V.Z.registerAction();class We extends q.Z{constructor(e,t=null,n=null,r=null){super(),this._map=e,this._overridespref=t,this._lrucache=n,this._interceptor=r,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,n=null){const r=se(e,this._overridespref,null===n?["*"]:n,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:r,opitem:e,includeGeometry:t,outFields:JSON.stringify(n)}),r}featureSetByName(e,t=!0,n=null){var r=this;return(0,p.Z)(function*(){if(void 0!==r._map.loaded&&void 0!==r._map.load&&!1===r._map.loaded)return yield r._map.load(),r.featureSetByName(e,t,n);null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const l=JSON.stringify(n);for(let o=0;o<r._instantLayers.length;o++){const i=r._instantLayers[o];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===l)return r._instantLayers[o].featureset}const a=r._map.allLayers.find(o=>o instanceof O.default&&o.title===e);if(a)return r._makeAndAddFeatureSet(a,t,n);if(r._map.tables){const o=r._map.tables.find(i=>!!(i.title&&i.title===e||i.title&&i.title===e));if(o){if(o instanceof O.default)return r._makeAndAddFeatureSet(o,t,n);if(!o._materializedTable){const i=o.outFields?o:Ie(le({},o),{outFields:["*"]});o._materializedTable=new O.default(i)}return yield o._materializedTable.load(),r._makeAndAddFeatureSet(o._materializedTable,t,n)}}return null})()}featureSetById(e,t=!0,n=["*"]){var r=this;return(0,p.Z)(function*(){if(void 0!==r._map.loaded&&void 0!==r._map.load&&!1===r._map.loaded)return yield r._map.load(),r.featureSetById(e,t,n);null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const l=JSON.stringify(n);for(let o=0;o<r._instantLayers.length;o++){const i=r._instantLayers[o];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===l)return r._instantLayers[o].featureset}const a=r._map.allLayers.find(o=>o instanceof O.default&&o.id===e);if(a)return r._makeAndAddFeatureSet(a,t,n);if(r._map.tables){const o=r._map.tables.find(i=>i.id===e);if(o){if(o instanceof O.default)return r._makeAndAddFeatureSet(o,t,n);if(!o._materializedTable){const i=Ie(le({},o),{outFields:["*"]});o._materializedTable=new O.default(i)}return yield o._materializedTable.load(),r._makeAndAddFeatureSet(o._materializedTable,t,n)}}return null})()}}class Fe extends q.Z{constructor(e,t=null,n=null,r=null){super(),this._url=e,this._overridespref=t,this._lrucache=n,this._interceptor=r,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,n=null){const r=se(e,this._overridespref,null===n?["*"]:n,t,this._lrucache);return this._instantLayers.push({featureset:r,opitem:e,includeGeometry:t,outFields:JSON.stringify(n)}),r}_loadMetaData(){var e=this;return(0,p.Z)(function*(){const t=yield Ce(e._url);return e.metadata=t,t})()}load(){return this._loadMetaData()}clone(){return new Fe(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(e,t=!0,n=null){var r=this;return(0,p.Z)(function*(){null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const l=JSON.stringify(n);for(let i=0;i<r._instantLayers.length;i++){const h=r._instantLayers[i];if(h.opitem.title===e&&h.includeGeometry===t&&h.outFields===l)return r._instantLayers[i].featureset}const a=yield r._loadMetaData();let o=null;for(const i of a.layers?a.layers:[])i.name===e&&(o=i);if(!o)for(const i of a.tables?a.tables:[])i.name===e&&(o=i);if(o){const i=yield de(r._url+"/"+o.id,["*"]);return r._makeAndAddFeatureSet(i,t,n)}return null})()}featureSetById(e,t=!0,n=["*"]){var r=this;return(0,p.Z)(function*(){null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const l=JSON.stringify(n);e=null!=e?e.toString():"";for(let i=0;i<r._instantLayers.length;i++){const h=r._instantLayers[i];if(h.opitem.id===e&&h.includeGeometry===t&&h.outFields===l)return r._instantLayers[i].featureset}const a=yield r._loadMetaData();let o=null;for(const i of a.layers?a.layers:[])null!=i.id&&i.id.toString()===e&&(o=i);if(!o)for(const i of a.tables?a.tables:[])null!=i.id&&i.id.toString()===e&&(o=i);if(o){const i=yield de(r._url+"/"+o.id,["*"]);return r._makeAndAddFeatureSet(i,t,n)}return null})()}}function Ge(x,e,t=null,n=null){return new We(x,e,t,n)}function Ke(x,e,t=null,n=null){return new Fe(x,e,t,n)}function Qe(x,e,t,n,r){if(null===x)return null;if(x instanceof O.default){switch(e){case"datasource":return se(x,r,x.outFields,!0,t,n).getDataSourceFeatureSet();case"parent":case"root":return se(x,r,x.outFields,!0,t,n)}return null}if(x instanceof g.Z)switch(e){case"datasource":return x.getDataSourceFeatureSet();case"parent":return x;case"root":return x.getRootFeatureSet()}return null}function Ve(x,e,t,n,r,l,a){return Se.apply(this,arguments)}function Se(){return(Se=(0,p.Z)(function*(x,e,t,n,r,l,a,o=null){var h;if(J.Z.applicationCache){const _=J.Z.applicationCache.getLayerInfo(x+":"+l.url);if(_){const E=yield _;return se(new O.default({url:(0,f.US)(E.url)+"/"+e,outFields:["*"]}),t,n,r,a,o)}}const i=new Ae.default({id:x,portal:l}).load();J.Z.applicationCache&&J.Z.applicationCache.setLayerInfo(x+":"+l.url,i);try{const _=yield i;return se(new O.default({url:(0,f.US)(null!=(h=_.url)?h:"")+"/"+e,outFields:["*"]}),t,n,r,a,o)}catch(_){throw J.Z.applicationCache&&J.Z.applicationCache.clearLayerInfo(x+":"+l.url),_}})).apply(this,arguments)}},52724:(Y,K,c)=>{c.d(K,{$X:()=>b,QP:()=>s,TO:()=>S,Xx:()=>P,yN:()=>D});var p=c(15861),z=c(88879),q=c(91365),L=c(27187),C=c(47982),B=c(49086),M=c(91510),v=c(77132),g=c(83947),R=c(62208),Z=c(10410),f=c(65234);class d{constructor(m){this.field=m,this.sqlRewritable=!1}postInitialization(m,u){}}class b extends d{constructor(m){super(m),this.sqlRewritable=!0}extractValue(m){return m.attributes[this.field.name]}rewriteSql(m){return{rewritten:this.sqlRewritable,where:m}}}class s extends d{constructor(m,u,y){super((0,v.JW)(m)),this.originalField=m,this.sqlRewritable=!0,this.field.name=u,this.field.alias=y}rewriteSql(m,u){return{rewritten:this.sqlRewritable,where:(0,g.bB)(m,this.field.name,this.originalField.name,u.getFieldsIndex())}}extractValue(m){return m.attributes[this.originalField.name]}}let S=(()=>{class T extends d{constructor(u,y,F){super(u),this.codefield=y,this.lkp=F,this.reverseLkp={};for(const I in F)this.reverseLkp[F[I]]=I;this.sqlRewritable=!0}rewriteSql(u,y){const F=this.evaluateNodeToWhereClause(u.parseTree,v.Bj.Standardised,this.field.name,this.codefield instanceof Z.WhereClause?(0,g.zR)(this.codefield,v.Bj.Standardised):this.codefield,u.parameters);return F.includes(T.BADNESS)?{rewritten:!1,where:u}:{rewritten:this.sqlRewritable,where:Z.WhereClause.create(F,(0,R.s3)(y._parent).getFieldsIndex())}}evaluateNodeToWhereClause(u,y,F=null,I=null,w){let V,j,U,W;switch(u.type){case"interval":return(0,g.TE)(this.evaluateNodeToWhereClause(u.value,y,F,I,w),u.qualifier,u.op);case"case-expression":{let O=" CASE ";"simple"===u.format&&(O+=this.evaluateNodeToWhereClause(u.operand,y,F,T.BADNESS,w));for(let G=0;G<u.clauses.length;G++)O+=" WHEN "+this.evaluateNodeToWhereClause(u.clauses[G].operand,y,F,T.BADNESS,w)+" THEN "+this.evaluateNodeToWhereClause(u.clauses[G].value,y,F,T.BADNESS,w);return null!==u.else&&(O+=" ELSE "+this.evaluateNodeToWhereClause(u.else,y,F,T.BADNESS,w)),O+=" END ",O}case"parameter":{const O=w[u.value.toLowerCase()];if("string"==typeof O)return"'"+O.toString().replace(/'/g,"''")+"'";if(O instanceof Date)return(0,g.oX)(O,y,null);if(O instanceof q.iG)return(0,g.mA)(O,y,null);if(O instanceof Array){const G=[];for(let A=0;A<O.length;A++)"string"==typeof O[A]?G.push("'"+O[A].toString().replace(/'/g,"''")+"'"):O[A]instanceof Date?G.push((0,g.oX)(O[A],y,null)):G.push(O[A]instanceof q.iG?(0,g.mA)(O[A],y,null):O[A].toString());return G}return O.toString()}case"expression-list":j=[];for(const O of u.value)j.push(this.evaluateNodeToWhereClause(O,y,F,I,w));return j;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(u.expr,y,F,T.BADNESS,w)+" ) ";case"binary-expression":switch(u.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" AND "+this.evaluateNodeToWhereClause(u.right,y,F,I,w)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" OR "+this.evaluateNodeToWhereClause(u.right,y,F,I,w)+") ";case"IS":if("null"!==u.right.type)throw new C.eS(C.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" IS NULL )";case"ISNOT":if("null"!==u.right.type)throw new C.eS(C.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" IS NOT NULL )";case"IN":if(V=[],"expression-list"===u.right.type){if("column-reference"===u.left.type&&u.left.column.toUpperCase()===this.field.name.toUpperCase()){const O=[];let G=!0;for(const A of u.right.value){if("string"!==A.type){G=!1;break}if(void 0===this.lkp[A.value]){G=!1;break}O.push(this.lkp[A.value].toString())}if(G)return" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" IN ("+O.join(",")+")) "}return V=this.evaluateNodeToWhereClause(u.right,y,F,I,w)," ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" IN ("+V.join(",")+")) "}return W=this.evaluateNodeToWhereClause(u.right,y,F,I,w),W instanceof Array?" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" IN ("+W.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" IN ("+W+")) ";case"NOT IN":if(V=[],"expression-list"===u.right.type){if("column-reference"===u.left.type&&u.left.column.toUpperCase()===this.field.name.toUpperCase()){const O=[];let G=!0;for(const A of u.right.value){if("string"!==A.type){G=!1;break}if(void 0===this.lkp[A.value]){G=!1;break}O.push(this.lkp[A.value].toString())}if(G)return" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" NOT IN ("+O.join(",")+")) "}return V=this.evaluateNodeToWhereClause(u.right,y,F,I,w)," ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" NOT IN ("+V.join(",")+")) "}return W=this.evaluateNodeToWhereClause(u.right,y,F,I,w),W instanceof Array?" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" NOT IN ("+W.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(u.left,y,F,I,w)+" NOT IN ("+W+")) ";case"BETWEEN":return U=this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)," ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" BETWEEN "+U[0]+" AND "+U[1]+" ) ";case"NOTBETWEEN":return U=this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)," ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" NOT BETWEEN "+U[0]+" AND "+U[1]+" ) ";case"LIKE":return""!==u.escape?" ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" LIKE "+this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)+" ESCAPE '"+u.escape+"') ":" ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" LIKE "+this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)+") ";case"NOT LIKE":return""!==u.escape?" ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" NOT LIKE "+this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)+" ESCAPE '"+u.escape+"') ":" ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" NOT LIKE "+this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)+") ";case"<>":case"=":if("column-reference"===u.left.type&&"string"===u.right.type){if(u.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[u.right.value.toString()])return" ("+I+" "+u.operator+" "+this.lkp[u.right.value.toString()].toString()+") "}else if("column-reference"===u.right.type&&"string"===u.left.type&&u.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[u.right.value.toString()].toString()+" "+u.operator+" "+I+") ";return" ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" "+u.operator+" "+this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(u.left,y,F,T.BADNESS,w)+" "+u.operator+" "+this.evaluateNodeToWhereClause(u.right,y,F,T.BADNESS,w)+") "}case"null":return"null";case"boolean":return!0===u.value?"1":"0";case"string":return"'"+u.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return(0,g.oX)(u.value,y,null);case"number":return u.value.toString();case"current-time":return(0,g.vR)("date"===u.mode,y);case"column-reference":return F&&F.toLowerCase()===u.column.toLowerCase()?"("+I+")":u.column;case"data-type":return u.value;case"function":{const O=this.evaluateNodeToWhereClause(u.args,y,F,T.BADNESS,w);return(0,g.fz)(u.name,O,y)}}throw new C.eS(C.f.UnsupportedSyntax,{node:u.type})}extractValue(u){return this.codefield instanceof Z.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(u)]:this.reverseLkp[u.attributes[this.codefield]]}}return T.BADNESS="_!!!_BAD_LKP_!!!!",T})();class D extends d{constructor(m,u){super(m),this._sql=u}rewriteSql(m,u){return{rewritten:!0,where:(0,g.bB)(m,this.field.name,(0,g.zR)(this._sql,v.Bj.Standardised),u.getFieldsIndex())}}extractValue(m){return this._sql.calculateValueCompiled(m)}}class P extends B.Z{static findField(m,u){for(const y of m)if(y.name.toLowerCase()===u.toString().toLowerCase())return y;return null}constructor(m){super(m),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=m.extraFilter,this._parent=m.parentfeatureset,this._maxProcessing=30,this.adaptedFields=m.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new f.Z({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=v.Qk.point,this.typeIdField="",this.types=null),this.fields=[];for(const m of this.adaptedFields)m.postInitialization(this,this._parent),this.fields.push(m.field)}_getSet(m){var u=this;return(0,p.Z)(function*(){var y;if(null===u._wset){yield u._ensureLoaded();let F=null;return F=u._extraFilter?yield u._getFilteredSet("",null,null,null,m):yield null==(y=u._parent)?void 0:y._getSet(m),u._checkCancelled(m),(0,R.O3)(F),u._wset=new M.Z(F._candidates.slice(0),F._known.slice(0),F._ordered,u._clonePageDefinition(F.pagesDefinition)),u._wset}return u._wset})()}_isInFeatureSet(m){return(0,R.s3)(this._parent)._isInFeatureSet(m)}_getFeatures(m,u,y,F){var I=this;return(0,p.Z)(function*(){var O,G;const w=[];-1!==u&&void 0===I._featureCache[u]&&w.push(u);const V=I._maxQueryRate();if(!0===I._checkIfNeedToExpandKnownPage(m,V))return yield I._expandPagedSet(m,V,0,0,F),I._getFeatures(m,u,y,F);let j=0;for(let A=m._lastFetchedIndex;A<m._known.length&&(j++,j<=y&&(m._lastFetchedIndex+=1),!(void 0===I._featureCache[m._known[A]]&&(m._known[A]!==u&&w.push(m._known[A]),w.length>=V)));A++);if(0===w.length)return"success";m=new M.Z([],w,m._ordered,null);const U=Math.min(w.length,y);yield null==(O=I._parent)?void 0:O._getFeatures(m,-1,U,F),I._checkCancelled(F);const W=[];for(let A=0;A<U;A++){const ae=null==(G=I._parent)?void 0:G._featureFromCache(w[A]);void 0!==ae&&W.push({geometry:ae.geometry,attributes:ae.attributes,id:w[A]})}for(const A of W){const ae=[];for(const ue of I.adaptedFields)ae[ue.field.name]=ue.extractValue(A);I._featureCache[A.id]=new z.Z({attributes:ae,geometry:(0,L.r1)(A.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,p.Z)(function*(){throw new C.EN(C.H9.NeverReach)})()}_getFilteredSet(m,u,y,F,I){var w=this;return(0,p.Z)(function*(){let V=!1;const j=w._reformulateWithoutAdaptions(y);V=j.cannot,y=j.where;let U=!1;if(null!==F){U=!0;const G=[];for(const A of w.adaptedFields)if(!(A instanceof b)&&!0===F.scanForField(A.field.name)){if(!(A instanceof s)){F=null,U=!1;break}G.push({field:A.field.name,newfield:A.originalField.name})}F&&G.length>0&&(F=F.replaceFields(G))}null!==y?null!==w._extraFilter&&(y=(0,g.$e)(w._extraFilter,y)):y=w._extraFilter,yield w._ensureLoaded();const W=yield(0,R.s3)(w._parent)._getFilteredSet(m,u,y,F,I);let O;return w._checkCancelled(I),O=!0===V?new M.Z(W._candidates.slice(0).concat(W._known.slice(0)),[],!0===U&&W._ordered,w._clonePageDefinition(W.pagesDefinition)):new M.Z(W._candidates.slice(0),W._known.slice(0),!0===U&&W._ordered,w._clonePageDefinition(W.pagesDefinition)),O})()}_reformulateWithoutAdaptions(m){const u={cannot:!1,where:m};if(null!==m)for(const y of this.adaptedFields)if(!0===(0,g.hq)(m,y.field.name)){const F=y.rewriteSql(m,this);if(!0!==F.rewritten){u.cannot=!0,u.where=null;break}u.where=F.where}return u}_stat(m,u,y,F,I,w,V){var j=this;return(0,p.Z)(function*(){let U=!1,W=j._reformulateWithoutAdaptions(u);if(U=W.cannot,u=W.where,W=j._reformulateWithoutAdaptions(I),U=U||W.cannot,null!==(I=W.where)?null!==j._extraFilter&&(I=(0,g.$e)(j._extraFilter,I)):I=j._extraFilter,!0===U)return null===I&&""===y&&null===F?j._manualStat(m,u,w,V):{calculated:!1};const O=yield(0,R.s3)(j._parent)._stat(m,u,y,F,I,w,V);return!1===O.calculated?null===I&&""===y&&null===F?j._manualStat(m,u,w,V):{calculated:!1}:O})()}_canDoAggregates(m,u,y,F,I){var w=this;return(0,p.Z)(function*(){if(null===w._parent)return!1;for(let U=0;U<m.length;U++)for(const W of w.adaptedFields)if(m[U].toLowerCase()===W.field.name.toLowerCase()&&!(W instanceof b))return!1;const V=[];for(let U=0;U<u.length;U++){const W=u[U];if(null!==W.workingexpr){const O=w._reformulateWithoutAdaptions(W.workingexpr);if(O.cannot)return!1;const G=W.clone();G.workingexpr=O.where,V.push(G)}else V.push(W)}const j=w._reformulateWithoutAdaptions(I);return!j.cannot&&(null!==(I=j.where)?null!==w._extraFilter&&(I=(0,g.$e)(w._extraFilter,I)):I=w._extraFilter,w._parent._canDoAggregates(m,V,y,F,I))})()}_getAggregatePagesDataSourceDefinition(m,u,y,F,I,w,V){var j=this;return(0,p.Z)(function*(){if(null===j._parent)throw new C.EN(C.H9.NeverReach);const U=[];for(let O=0;O<u.length;O++){const G=u[O];if(null!==G.workingexpr){const A=j._reformulateWithoutAdaptions(G.workingexpr);if(A.cannot)throw new C.EN(C.H9.NeverReach);const ae=G.clone();ae.workingexpr=A.where,U.push(ae)}else U.push(G)}const W=j._reformulateWithoutAdaptions(I);if(W.cannot)throw new C.EN(C.H9.NeverReach);return null!==(I=W.where)?null!==j._extraFilter&&(I=(0,g.$e)(j._extraFilter,I)):I=j._extraFilter,j._parent._getAggregatePagesDataSourceDefinition(m,U,y,F,I,w,V)})()}}},53997:(Y,K,c)=>{c.d(K,{Z:()=>R});var p=c(15861),z=c(47982),q=c(49086),L=c(91510),C=c(77132),B=c(83947),M=c(10699),v=c(10410),g=c(65234);class R extends q.Z{constructor(f){super(f),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=f.parentfeatureset,f.whereclause instanceof v.WhereClause?(this._whereclause=f.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=f.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new g.Z({wkid:4326}),this.geometryType=C.Qk.point)}_getSet(f){var d=this;return(0,p.Z)(function*(){if(null===d._wset){yield d._ensureLoaded();const b=yield d._parent._getFilteredSet("",null,d._whereclause,null,f);return d._checkCancelled(f),d._wset=null!==d._whereClauseFunction?new L.Z(b._candidates.slice(0).concat(b._known.slice(0)),[],b._ordered,d._clonePageDefinition(b.pagesDefinition)):new L.Z(b._candidates.slice(0),b._known.slice(0),b._ordered,d._clonePageDefinition(b.pagesDefinition)),d._wset}return d._wset})()}_isInFeatureSet(f){var b;let d=null==(b=this._parent)?void 0:b._isInFeatureSet(f);return d===C.dj.NotInFeatureSet?d:(d=this._idstates[f],void 0===d?C.dj.Unknown:d)}_getFeature(f,d,b){return this._parent._getFeature(f,d,b)}_getFeatures(f,d,b,s){return this._parent._getFeatures(f,d,b,s)}_featureFromCache(f){return this._parent._featureFromCache(f)}executeWhereClause(f){var d,b;return null!=(b=null==(d=this._whereclause)?void 0:d.testFeature(f))&&b}executeWhereClauseDeferred(f){var d=this;return(0,p.Z)(function*(){if(null!==d._whereClauseFunction){const b=d._whereClauseFunction(f);return(0,M.y8)(b),b}return d.executeWhereClause(f)})()}_fetchAndRefineFeatures(f,d,b){var s=this;return(0,p.Z)(function*(){var T,m,u;const S=new L.Z([],f,!1,null),D=Math.min(d,f.length);if(yield null==(T=s._parent)?void 0:T._getFeatures(S,-1,D,b),s._checkCancelled(b),null==s._whereClauseFunction){for(let y=0;y<D;y++){const F=null==(m=s._parent)?void 0:m._featureFromCache(f[y]);s._idstates[f[y]]=!0===s.executeWhereClause(F)?C.dj.InFeatureSet:C.dj.NotInFeatureSet}return"success"}const P=[];for(let y=0;y<D;y++){const F=null==(u=s._parent)?void 0:u._featureFromCache(f[y]);P.push(yield s.executeWhereClauseDeferred(F))}for(let y=0;y<d;y++)s._idstates[f[y]]=!0===P[y]?C.dj.InFeatureSet:C.dj.NotInFeatureSet;return"success"})()}_getFilteredSet(f,d,b,s,S){var D=this;return(0,p.Z)(function*(){null!==D._whereClauseFunction||(null!==b?null!==D._whereclause&&(b=(0,B.$e)(D._whereclause,b)):b=D._whereclause),yield D._ensureLoaded();const P=yield D._parent._getFilteredSet(f,d,b,s,S);let T;return D._checkCancelled(S),T=null!==D._whereClauseFunction?new L.Z(P._candidates.slice(0).concat(P._known.slice(0)),[],P._ordered,D._clonePageDefinition(P.pagesDefinition)):new L.Z(P._candidates.slice(0),P._known.slice(0),P._ordered,D._clonePageDefinition(P.pagesDefinition)),T})()}_stat(f,d,b,s,S,D,P){var T=this;return(0,p.Z)(function*(){if(null!==T._whereClauseFunction)return null===S&&""===b&&null===s?T._manualStat(f,d,D,P):{calculated:!1};let m=T._whereclause;null!==S&&null!==T._whereclause&&(m=(0,B.$e)(T._whereclause,S));const u=yield T._parent._stat(f,d,b,s,m,D,P);return!1===u.calculated?null===S&&""===b&&null===s?T._manualStat(f,d,D,P):{calculated:!1}:u})()}_canDoAggregates(f,d,b,s,S){var D=this;return(0,p.Z)(function*(){return null===D._whereClauseFunction&&(null!==S?null!==D._whereclause&&(S=(0,B.$e)(D._whereclause,S)):S=D._whereclause,null!==D._parent&&D._parent._canDoAggregates(f,d,b,s,S))})()}_getAggregatePagesDataSourceDefinition(f,d,b,s,S,D,P){var T=this;return(0,p.Z)(function*(){if(null===T._parent)throw new z.EN(z.H9.NeverReach);return null!==S?null!==T._whereclause&&(S=(0,B.$e)(T._whereclause,S)):S=T._whereclause,T._parent._getAggregatePagesDataSourceDefinition(f,d,b,s,S,D,P)})()}static registerAction(){q.Z._featuresetFunctions.filter=function(f){if("function"==typeof f)return new R({parentfeatureset:this,whereclause:f});let d=null;return f instanceof v.WhereClause&&(d=f),new R({parentfeatureset:this,whereclause:d})}}}},95896:(Y,K,c)=>{c.d(K,{Z:()=>M});var p=c(15861),z=c(47562),q=c(47982),L=c(49086),C=c(91510),B=c(57366);class M extends L.Z{constructor(g){super(g),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=g.orderbyclause,this._parent=g.parentfeatureset}_getSet(g){var R=this;return(0,p.Z)(function*(){if(null===R._wset){yield R._ensureLoaded();const Z=yield R._getFilteredSet("",null,null,R._orderbyclause,g);return R._checkCancelled(g),R._wset=Z,R._wset}return R._wset})()}manualOrderSet(g,R){var Z=this;return(0,p.Z)(function*(){var b;const f=yield Z.getIdColumnDictionary(g,[],-1,R);null==(b=Z._orderbyclause)||b.order(f);const d=new C.Z([],[],!0,null);for(let s=0;s<f.length;s++)d._known.push(f[s].id);return d})()}getIdColumnDictionary(g,R,Z,f){var d=this;return(0,p.Z)(function*(){if(Z<g._known.length-1){const b=d._maxQueryRate();if("GETPAGES"===g._known[Z+1])return yield(0,z.W)(d._parent._expandPagedSet(g,b,0,0,f)),d.getIdColumnDictionary(g,R,Z,f);let s=Z+1;const S=[];for(;s<g._known.length&&"GETPAGES"!==g._known[s];)S.push(g._known[s]),s++;Z+=S.length;const D=yield(0,z.W)(d._parent._getFeatureBatch(S,f));d._checkCancelled(f);for(const P of D)R.push({id:P.attributes[d.objectIdField],feature:P});return d.getIdColumnDictionary(g,R,Z,f)}return g._candidates.length>0?(yield(0,z.W)(d._refineSetBlock(g,d._maxProcessingRate(),f)),d._checkCancelled(f),d.getIdColumnDictionary(g,R,Z,f)):R})()}_isInFeatureSet(g){return this._parent._isInFeatureSet(g)}_getFeatures(g,R,Z,f){return this._parent._getFeatures(g,R,Z,f)}_featureFromCache(g){if(void 0===this._featureCache[g]){const R=this._parent._featureFromCache(g);return void 0===R?void 0:null===R?null:(this._featureCache[g]=R,R)}return this._featureCache[g]}_fetchAndRefineFeatures(){return(0,p.Z)(function*(){throw new q.EN(q.H9.NeverReach)})()}_getFilteredSet(g,R,Z,f,d){var b=this;return(0,p.Z)(function*(){yield b._ensureLoaded();const s=yield b._parent._getFilteredSet(g,R,Z,null===f?b._orderbyclause:f,d);b._checkCancelled(d);const S=new C.Z(s._candidates.slice(0),s._known.slice(0),s._ordered,b._clonePageDefinition(s.pagesDefinition));let D=!0;if(s._candidates.length>0&&(D=!1),!1===S._ordered){let P=yield b.manualOrderSet(S,d);return!1===D&&(null===R&&null===Z||(P=new C.Z(P._candidates.slice(0).concat(P._known.slice(0)),[],P._ordered,b._clonePageDefinition(P.pagesDefinition)))),P}return S})()}static registerAction(){L.Z._featuresetFunctions.orderBy=function(g){return""===g?this:new M({parentfeatureset:this,orderbyclause:new B.Z(g)})}}}},79429:(Y,K,c)=>{c.d(K,{Z:()=>B});var p=c(15861),z=c(47982),q=c(49086),L=c(91510),C=c(77132);class B extends q.Z{constructor(v){super(v),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=v.topnum,this._parent=v.parentfeatureset}_getSet(v){var g=this;return(0,p.Z)(function*(){if(null===g._wset){yield g._ensureLoaded();const R=yield g._parent._getSet(v);return g._wset=new L.Z(R._candidates.slice(0),R._known.slice(0),!1,g._clonePageDefinition(R.pagesDefinition)),g._setKnownLength(g._wset)>g._topnum&&(g._wset._known=g._wset._known.slice(0,g._topnum)),g._setKnownLength(g._wset)>=g._topnum&&(g._wset._candidates=[]),g._wset}return g._wset})()}_setKnownLength(v){return v._known.length>0&&"GETPAGES"===v._known[v._known.length-1]?v._known.length-1:v._known.length}_isInFeatureSet(v){const g=this._parent._isInFeatureSet(v);if(g===C.dj.NotInFeatureSet)return g;const R=this._idstates[v];return R===C.dj.InFeatureSet||R===C.dj.NotInFeatureSet?R:g===C.dj.InFeatureSet&&void 0===R?this._countedin<this._topnum?(this._idstates[v]=C.dj.InFeatureSet,this._countedin++,C.dj.InFeatureSet):(this._idstates[v]=C.dj.NotInFeatureSet,C.dj.NotInFeatureSet):C.dj.Unknown}_expandPagedSet(v,g,R,Z,f){var d=this;return(0,p.Z)(function*(){if(null===d._parent)throw new z.EN(z.H9.NotImplemented);if(g>d._topnum&&(g=d._topnum),d._countedin>=d._topnum&&v.pagesDefinition.internal.set.length<=v.pagesDefinition.resultOffset){let s=v._known.length;return s>0&&"GETPAGES"===v._known[s-1]&&(v._known.length=s-1),s=v._candidates.length,s>0&&"GETPAGES"===v._candidates[s-1]&&(v._candidates.length=s-1),"success"}const b=yield d._parent._expandPagedSet(v,g,R,Z,f);return d._setKnownLength(v)>d._topnum&&(v._known.length=d._topnum),d._setKnownLength(v)>=d._topnum&&(v._candidates.length=0),b})()}_getFeatures(v,g,R,Z){var f=this;return(0,p.Z)(function*(){const d=[],b=f._maxQueryRate();if(!0===f._checkIfNeedToExpandKnownPage(v,b))return yield f._expandPagedSet(v,b,0,0,Z),f._getFeatures(v,g,R,Z);-1!==g&&void 0===f._featureCache[g]&&d.push(g);let s=0;for(let P=v._lastFetchedIndex;P<v._known.length&&(s++,s<=R&&(v._lastFetchedIndex+=1),!(void 0===f._featureCache[v._known[P]]&&(v._known[P]!==g&&d.push(v._known[P]),d.length>b)));P++);if(0===d.length)return"success";const S=new L.Z([],d,!1,null),D=Math.min(d.length,R);yield f._parent._getFeatures(S,-1,D,Z);for(let P=0;P<D;P++){const T=f._parent._featureFromCache(d[P]);void 0!==T&&(f._featureCache[d[P]]=T)}return"success"})()}_getFilteredSet(v,g,R,Z,f){var d=this;return(0,p.Z)(function*(){yield d._ensureLoaded();const b=yield d._getSet(f);return new L.Z(b._candidates.slice(0).concat(b._known.slice(0)),[],!1,d._clonePageDefinition(b.pagesDefinition))})()}_refineKnowns(v,g){let R=0,Z=null;const f=[];for(let d=0;d<v._candidates.length;d++){const b=this._isInFeatureSet(v._candidates[d]);if(b===C.dj.InFeatureSet){if(v._known.push(v._candidates[d]),R+=1,null===Z?Z={start:d,end:d}:Z.end===d-1?Z.end=d:(f.push(Z),Z={start:d,end:d}),v._known.length>=this._topnum)break}else if(b===C.dj.NotInFeatureSet)null===Z?Z={start:d,end:d}:Z.end===d-1?Z.end=d:(f.push(Z),Z={start:d,end:d}),R+=1;else if(b===C.dj.Unknown)break;if(R>=g)break}null!==Z&&f.push(Z);for(let d=f.length-1;d>=0;d--)v._candidates.splice(f[d].start,f[d].end-f[d].start+1);this._setKnownLength(v)>this._topnum&&(v._known=v._known.slice(0,this._topnum)),this._setKnownLength(v)>=this._topnum&&(v._candidates=[])}_stat(){return(0,p.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,p.Z)(function*(){return!1})()}static registerAction(){q.Z._featuresetFunctions.top=function(v){return new B({parentfeatureset:this,topnum:v})}}}},16776:(Y,K,c)=>{c.d(K,{Z:()=>d});var p=c(15861),z=c(88879),q=c(47982),L=c(49086),C=c(91510),B=c(77132),M=c(83947),v=c(21674),g=c(80415),R=c(41638),Z=c(36255),f=c(96854);class d extends L.Z{constructor(s){super(s),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,s.spatialReference&&(this.spatialReference=s.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=s.layer,this._wset=null,!0===s.isTable&&(this._forceIsTable=!0),void 0!==s.outFields&&(this._overrideFields=s.outFields),void 0!==s.includeGeometry&&(this._removeGeometry=!1===s.includeGeometry)}_maxQueryRate(){return B.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var s=this;return(0,p.Z)(function*(){return!0===s._layer.loaded?(s._initialiseFeatureSet(),s):(yield s._layer.load(),s._initialiseFeatureSet(),s)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields&&(1!==this._layer.outFields.length||"*"!==this._layer.outFields[0])){const s=[];for(const S of this.fields)if("oid"===S.type)s.push(S);else for(const D of this._layer.outFields)if(D.toLowerCase()===S.name.toLowerCase()){s.push(S);break}this.fields=s}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const s=[],S=[];for(const D of this.fields)if("oid"===D.type)s.push(D),S.push(D.name);else for(const P of this._overrideFields)if(P.toLowerCase()===D.name.toLowerCase()){s.push(D),S.push(D.name);break}this.fields=s,this._overrideFields=S}this.objectIdField=this._layer.objectIdField;for(const s of this.fields)"global-id"===s.type&&(this.globalIdField=s.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=B.Bj.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return B.dj.InFeatureSet}_candidateIdTransform(s){return s}_getSet(s){var S=this;return(0,p.Z)(function*(){if(null===S._wset){yield S._ensureLoaded();const D=yield S._getFilteredSet("",null,null,null,s);return S._wset=D,D}return S._wset})()}_changeFeature(s){const S={};for(const D of this.fields)S[D.name]=s.attributes[D.name];return new z.Z({geometry:!0===this._removeGeometry?null:s.geometry,attributes:S})}_getFilteredSet(s,S,D,P,T){var m=this;return(0,p.Z)(function*(){let u="",y=!1;if(null!==P&&(u=P.constructClause(),y=!0),m.isTable()&&S&&null!==s&&""!==s)return new C.Z([],[],!0,null);const F=new f.Z;F.where=null===D?null===S?"1=1":"":(0,M.zR)(D,B.Bj.Standardised),F.spatialRelationship=m._makeRelationshipEnum(s),F.outSpatialReference=m.spatialReference,F.orderByFields=""!==u?u.split(","):null,F.geometry=null===S?null:S,F.returnGeometry=!0,F.relationParameter=m._makeRelationshipParam(s);const I=yield m._layer.queryFeatures(F);if(null===I)return new C.Z([],[],y,null);m._checkCancelled(T);const w=[];return I.features.forEach(V=>{const j=V.attributes[m._layer.objectIdField];w.push(j),m._featureCache[j]=m._changeFeature(V)}),new C.Z([],w,y,null)})()}_makeRelationshipEnum(s){if(s.includes("esriSpatialRelRelation"))return"relation";switch(s){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return s}_makeRelationshipParam(s){return s.includes("esriSpatialRelRelation")?s.split(":")[1]:""}_queryAllFeatures(){var s=this;return(0,p.Z)(function*(){if(s._wset)return s._wset;const S=new f.Z;if(S.where="1=1",yield s._ensureLoaded(),s._layer.source&&s._layer.source.items){const T=[];return s._layer.source.items.forEach(m=>{const u=m.attributes[s._layer.objectIdField];T.push(u),s._featureCache[u]=s._changeFeature(m)}),s._wset=new C.Z([],T,!1,null),s._wset}const D=yield s._layer.queryFeatures(S),P=[];return D.features.forEach(T=>{const m=T.attributes[s._layer.objectIdField];P.push(m),s._featureCache[m]=s._changeFeature(T)}),s._wset=new C.Z([],P,!1,null),s._wset})()}_getFeatures(s,S,D){var P=this;return(0,p.Z)(function*(){const T=[];-1!==S&&void 0===P._featureCache[S]&&T.push(S);for(let m=s._lastFetchedIndex;m<s._known.length&&(s._lastFetchedIndex+=1,!(void 0===P._featureCache[s._known[m]]&&(s._known[m]!==S&&T.push(s._known[m]),T.length>D)));m++);if(0===T.length)return"success";throw new q.EN(q.H9.MissingFeatures)})()}_refineSetBlock(s){return(0,p.Z)(function*(){return s})()}_stat(){return(0,p.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,p.Z)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(s){const S={};for(const D in s)S[D]=s[D];return S}nativeCapabilities(){var s;return{title:null!=(s=this._layer.title)?s:"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(s,S){let D=s.layerDefinition.objectIdField;const P=s.layerDefinition.typeIdField?s.layerDefinition.typeIdField:"",T=[];if(s.layerDefinition.types)for(const j of s.layerDefinition.types)T.push(R.Z.fromJSON(j));let m=s.layerDefinition.geometryType;void 0===m&&(m=s.featureSet.geometryType||"");let u=s.featureSet.features;const y=S.toJSON();if(""===D||void 0===D){let j=!1;for(const U of s.layerDefinition.fields)if("oid"===U.type||"esriFieldTypeOID"===U.type){D=U.name,j=!0;break}if(!1===j){let U="FID",W=!0,O=0;for(;W;){let A=!0;for(const ae of s.layerDefinition.fields)if(ae.name===U){A=!1;break}!0===A?W=!1:(O++,U="FID"+O.toString())}s.layerDefinition.fields.push({type:"esriFieldTypeOID",name:U,alias:U});const G=[];for(let A=0;A<u.length;A++)G.push({geometry:s.featureSet.features[A].geometry,attributes:s.featureSet.features[A].attributes?this._cloneAttr(s.featureSet.features[A].attributes):{}}),G[A].attributes[U]=A;u=G,D=U}}const F=[];for(const j of s.layerDefinition.fields)F.push(j instanceof Z.Z?j:Z.Z.fromJSON(j));let I=m;switch(I||(I=""),I){case"esriGeometryPoint":I="point";break;case"esriGeometryPolyline":I="polyline";break;case"esriGeometryPolygon":I="polygon";break;case"esriGeometryExtent":I="extent";break;case"esriGeometryMultipoint":I="multipoint";break;case"":case"esriGeometryNull":I="esriGeometryNull"}if("esriGeometryNull"!==I)for(const j of u)j.geometry&&!(j.geometry instanceof v.Z)&&(j.geometry.type=I,void 0===j.geometry.spatialReference&&(j.geometry.spatialReference=y));else for(const j of u)j.geometry&&(j.geometry=null);const w={outFields:["*"],source:u,fields:F,types:T,typeIdField:P,objectIdField:D,spatialReference:S};""!==I&&"esriGeometryNull"!==I&&null!==I&&(w.geometryType=I);const V=new g.default(w);return new d({layer:V,spatialReference:S,isTable:null===I||""===I||"esriGeometryNull"===I})}queryAttachments(){return(0,p.Z)(function*(){return[]})()}getFeatureByObjectId(s){var S=this;return(0,p.Z)(function*(){const D=new f.Z;D.where=S.objectIdField+"="+s.toString();const P=yield S._layer.queryFeatures(D);return 1===P.features.length?P.features[0]:null})()}getOwningSystemUrl(){return(0,p.Z)(function*(){return""})()}getIdentityUser(){return(0,p.Z)(function*(){return""})()}get preferredTimeReference(){var s,S,D;return null!=(D=null==(S=null==(s=this._layer)?void 0:s.preferredTimeReference)?void 0:S.toJSON())?D:null}get dateFieldsTimeReference(){var s,S,D;return null!=(D=null==(S=null==(s=this._layer)?void 0:s.dateFieldsTimeReference)?void 0:S.toJSON())?D:null}get datesInUnknownTimezone(){var s;return null==(s=this._layer)?void 0:s.datesInUnknownTimezone}get editFieldsInfo(){var s,S,D;return null!=(D=null==(S=null==(s=this._layer)?void 0:s.editFieldsInfo)?void 0:S.toJSON())?D:null}get timeInfo(){var s,S,D;return null!=(D=null==(S=null==(s=this._layer)?void 0:s.timeInfo)?void 0:S.toJSON())?D:null}}},57366:(Y,K,c)=>{function p(q,L){return q===L?0:null===q?-1:null===L?1:q<L?-1:1}c.d(K,{Z:()=>z});class z{constructor(L){const C=L.split(",");this._fields=[],this._directions=[];for(let B=0;B<C.length;B++){const M=C[B].match(/\S+/g);this._fields.push(M[0]),2===M.length?"asc"===M[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let L="";for(let C=0;C<this._fields.length;C++)0!==C&&(L+=","),L+=this._fields[C],L+=1===this._directions[C]?" ASC":" DESC";return L}order(L){L.sort((C,B)=>{for(let M=0;M<this._fields.length;M++){const v=this.featureValue(C.feature,this._fields[M],M),g=this.featureValue(B.feature,this._fields[M],M);let R=0;if(R=1===this._directions[M]?p(v,g):-1*p(v,g),0!==R)return R}return 0})}scanForField(L){for(let C=0;C<this._fields.length;C++)if(this._fields[C].toLowerCase().trim()===L.toLowerCase().trim())return!0;return!1}replaceFields(L){let C="";for(let B=0;B<this._fields.length;B++){0!==B&&(C+=",");let M=this._fields[B];for(const v of L)if(M.toLowerCase()===v.field.toLowerCase()){M=v.newfield;break}C+=M,C+=1===this._directions[B]?" ASC":" DESC"}return new z(C)}featureValue(L,C,B){const M=L.attributes[C];if(void 0!==M)return M;for(const v in L.attributes)if(C.toLowerCase()===v.toLowerCase())return this._fields[B]=v,L.attributes[v];return null}}},90463:(Y,K,c)=>{c.d(K,{P:()=>C});var p=c(15861),z=c(2618),q=c(20477),L=c(96854);function C(M,v,g){return B.apply(this,arguments)}function B(){return(B=(0,p.Z)(function*(M,v,g){const R=(0,z.en)(M);return(0,q.hH)(R,L.Z.from(v),le({},g)).then(Z=>Z.data.count)})).apply(this,arguments)}},24865:(Y,K,c)=>{c.d(K,{G:()=>C});var p=c(15861),z=c(2618),q=c(20477),L=c(96854);function C(M,v,g){return B.apply(this,arguments)}function B(){return(B=(0,p.Z)(function*(M,v,g){const R=(0,z.en)(M);return(0,q.Ev)(R,L.Z.from(v),le({},g)).then(Z=>Z.data.objectIds)})).apply(this,arguments)}}}]);