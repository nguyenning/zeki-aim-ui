"use strict";var De=Object.defineProperty,Ve=Object.defineProperties,Te=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,le=(N,g,e)=>g in N?De(N,g,{enumerable:!0,configurable:!0,writable:!0,value:e}):N[g]=e,Q=(N,g)=>{for(var e in g||(g={}))Ze.call(g,e)&&le(N,e,g[e]);if(ae)for(var e of ae(g))Ae.call(g,e)&&le(N,e,g[e]);return N},ee=(N,g)=>Ve(N,Te(g));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[1955],{59990:(N,g,e)=>{function o(S){var a;const x=S.layer;return"floorInfo"in x&&(null==(a=x.floorInfo)?void 0:a.floorField)&&"floors"in S.view?D(S.view.floors,x.floorInfo.floorField):null}function F(S,x){var a;return"floorInfo"in x&&(null==(a=x.floorInfo)?void 0:a.floorField)?D(S,x.floorInfo.floorField):null}function D(S,x){if(null==S||!S.length)return null;const a=S.filter(t=>""!==t).map(t=>`'${t}'`);return a.push("''"),`${x} IN (${a.join(",")}) OR ${x} IS NULL`}e.d(g,{c:()=>o,f:()=>F})},13410:(N,g,e)=>{e.d(g,{FN:()=>S,QV:()=>D,ac:()=>a});var o=e(62208),F=e(31283);function D(t,m,s){return m.flatten(({sublayers:n})=>n).length!==t.length||!!t.some(n=>n.originIdOf("minScale")>s||n.originIdOf("maxScale")>s||n.originIdOf("renderer")>s||n.originIdOf("labelingInfo")>s||n.originIdOf("opacity")>s||n.originIdOf("labelsVisible")>s||n.originIdOf("source")>s)||!x(t,m)}function S(t,m,s){return!!t.some(y=>{const n=y.source;return!(!n||"map-layer"===n.type&&n.mapLayerId===y.id&&((0,o.Wi)(n.gdbVersion)||n.gdbVersion===s))||y.originIdOf("renderer")>F.s3.SERVICE||y.originIdOf("labelingInfo")>F.s3.SERVICE||y.originIdOf("opacity")>F.s3.SERVICE||y.originIdOf("labelsVisible")>F.s3.SERVICE})||!x(t,m)}function x(t,m){if(!t||!t.length||(0,o.Wi)(m))return!0;const s=m.slice().reverse().flatten(({sublayers:c})=>c&&c.toArray().reverse()).map(c=>c.id).toArray();if(t.length>s.length)return!1;let y=0;const n=s.length;for(const{id:c}of t){for(;y<n&&s[y]!==c;)y++;if(y>=n)return!1}return!0}function a(t){return!!t&&t.some(m=>null!=m.minScale||m.layerDefinition&&null!=m.layerDefinition.minScale)}},22264:(N,g,e)=>{function o(a,t){return t?"xoffset"in t&&t.xoffset?Math.max(a,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(a,Math.abs(t.yoffset||0)):a:a}function D(a,t){return"number"==typeof a?a:a&&a.stops&&a.stops.length?function F(a){let t=0,m=0;for(let s=0;s<a.length;s++){const y=a[s].size;"number"==typeof y&&(t+=y,m++)}return t/m}(a.stops):t}function x(a){const t=a&&a.renderer,m="touch"===(a&&a.event&&a.event.pointerType)?9:6;if(!t)return m;const s="visualVariables"in t?function S(a,t){if(!t)return a;const m=t.filter(c=>"size"===c.type).map(c=>{const{maxSize:l,minSize:L}=c;return(D(l,a)+D(L,a))/2});let s=0;const y=m.length;if(0===y)return a;for(let c=0;c<y;c++)s+=m[c];const n=Math.floor(s/y);return Math.max(n,a)}(m,t.visualVariables):m;if("simple"===t.type)return o(s,t.symbol);if("unique-value"===t.type){let y=s;return t.uniqueValueInfos.forEach(n=>{y=o(y,n.symbol)}),y}if("class-breaks"===t.type){let y=s;return t.classBreakInfos.forEach(n=>{y=o(y,n.symbol)}),y}return s}e.d(g,{k:()=>x})},81955:(N,g,e)=>{e.r(g),e.d(g,{default:()=>Re});var o=e(17626),D=(e(63290),e(90912)),x=(e(85931),e(8314)),t=(e(82255),e(76898)),m=e(69759),s=e(15861),y=e(26584),n=e(62208),c=e(10699),l=e(77712),L=e(2004),G=e(83137),U=e(13812),z=e(14772),B=e(59990),X=e(22264),H=e(84792),ue=e(13924),_=e(2618),pe=e(95737),te=e(91179),ye=e(13410);const re=p=>p.spatialReference.wkid||JSON.stringify(p.spatialReference);function fe(p,i){const{dpi:u,gdbVersion:f,geometry:r,geometryPrecision:h,height:j,layerOption:R,mapExtent:E,maxAllowableOffset:d,returnFieldName:C,returnGeometry:v,returnUnformattedValues:b,returnZ:V,spatialReference:Z,timeExtent:A,tolerance:P,width:J}=p.toJSON(),{dynamicLayers:O,layerDefs:M,layerIds:T}=function de(p){var Z,A;const{mapExtent:i,floors:u,width:f,sublayers:r,layerIds:h,layerOption:j,gdbVersion:R}=p,E=null==(A=null==(Z=null==r?void 0:r.find(P=>null!=P.layer))?void 0:Z.layer)?void 0:A.serviceSublayers,d="popup"===j,C={},v=(0,G.yZ)({extent:i,width:f,spatialReference:null==i?void 0:i.spatialReference}),b=[],V=P=>{if(P.visible&&(0===v||(0===P.minScale||v<=P.minScale)&&(0===P.maxScale||v>=P.maxScale)))if(P.sublayers)P.sublayers.forEach(V);else{if(!1===(null==h?void 0:h.includes(P.id))||d&&(!P.popupTemplate||!P.popupEnabled))return;b.unshift(P)}};if(null==r||r.forEach(V),r&&!b.length)C.layerIds=[];else{const P=(0,ye.FN)(b,E,R),J=b.map(O=>{const M=(0,B.f)(u,O);return O.toExportImageJSON(M)});if(P)C.dynamicLayers=JSON.stringify(J);else{if(r){let M=b.map(({id:T})=>T);h&&(M=M.filter(T=>h.includes(T))),C.layerIds=M}else null!=h&&h.length&&(C.layerIds=h);const O=function me(p,i){const u=!(null==p||!p.length),f=i.filter(r=>null!=r.definitionExpression||u&&null!=r.floorInfo);return f.length?f.map(r=>{const h=(0,B.f)(p,r),j=(0,pe._)(h,r.definitionExpression);return{id:r.id,definitionExpression:j}}):null}(u,b);if((0,n.pC)(O)&&O.length){const M={};for(const T of O)T.definitionExpression&&(M[T.id]=T.definitionExpression);Object.keys(M).length&&(C.layerDefs=JSON.stringify(M))}}}return C}(p),K=i&&(0,n.pC)(i.geometry)?i.geometry:null,w={geometryPrecision:h,maxAllowableOffset:d,returnFieldName:C,returnGeometry:v,returnUnformattedValues:b,returnZ:V,tolerance:P},W=K&&K.toJSON()||r;if(w.imageDisplay=`${J},${j},${u}`,f&&(w.gdbVersion=f),W&&(delete W.spatialReference,w.geometry=JSON.stringify(W),w.geometryType=(0,te.Ji)(W)),Z?w.sr=Z.wkid||JSON.stringify(Z):W&&W.spatialReference?w.sr=re(W):E&&E.spatialReference&&(w.sr=re(E)),w.time=A?[A.start,A.end].join(","):null,E){const{xmin:we,ymin:Fe,xmax:Ue,ymax:Ne}=E;w.mapExtent=`${we},${Fe},${Ue},${Ne}`}return M&&(w.layerDefs=M),O&&!M&&(w.dynamicLayers=O),w.layers="popup"===R?"visible":R,T&&!O&&(w.layers+=`:${T.join(",")}`),w}var Y,ce=e(29132),he=e(97478),ne=e(86810),ge=e(65234);let I=Y=class extends ne.wq{constructor(p){super(p),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}static from(p){return(0,D.TJ)(Y,p)}};(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],I.prototype,"dpi",void 0),(0,o._)([(0,l.Cb)()],I.prototype,"floors",void 0),(0,o._)([(0,l.Cb)({type:String,json:{write:!0}})],I.prototype,"gdbVersion",void 0),(0,o._)([(0,l.Cb)({types:ce.qM,json:{read:te.im,write:!0}})],I.prototype,"geometry",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],I.prototype,"geometryPrecision",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],I.prototype,"height",void 0),(0,o._)([(0,l.Cb)({type:[Number],json:{write:!0}})],I.prototype,"layerIds",void 0),(0,o._)([(0,l.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],I.prototype,"layerOption",void 0),(0,o._)([(0,l.Cb)({type:L.Z,json:{write:!0}})],I.prototype,"mapExtent",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],I.prototype,"maxAllowableOffset",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],I.prototype,"returnFieldName",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],I.prototype,"returnGeometry",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],I.prototype,"returnM",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],I.prototype,"returnUnformattedValues",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],I.prototype,"returnZ",void 0),(0,o._)([(0,l.Cb)({type:ge.Z,json:{write:!0}})],I.prototype,"spatialReference",void 0),(0,o._)([(0,l.Cb)()],I.prototype,"sublayers",void 0),(0,o._)([(0,l.Cb)({type:he.Z,json:{write:!0}})],I.prototype,"timeExtent",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],I.prototype,"tolerance",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],I.prototype,"width",void 0),I=Y=(0,o._)([(0,t.j)("esri.rest.support.IdentifyParameters")],I);const oe=I;var se=e(88879),ve=e(68653),xe=e(99433),be=e(71774);let $=class extends ne.wq{constructor(p){super(p),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(p,i){return se.Z.fromJSON({attributes:Q({},i.attributes),geometry:Q({},i.geometry)})}writeFeature(p,i){if(!p)return;const{attributes:u,geometry:f}=p;u&&(i.attributes=Q({},u)),(0,n.pC)(f)&&(i.geometry=f.toJSON(),i.geometryType=be.P$.toJSON(f.type))}};(0,o._)([(0,l.Cb)({type:String,json:{write:!0}})],$.prototype,"displayFieldName",void 0),(0,o._)([(0,l.Cb)({type:se.Z})],$.prototype,"feature",void 0),(0,o._)([(0,ve.r)("feature",["attributes","geometry"])],$.prototype,"readFeature",null),(0,o._)([(0,xe.c)("feature")],$.prototype,"writeFeature",null),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],$.prototype,"layerId",void 0),(0,o._)([(0,l.Cb)({type:String,json:{write:!0}})],$.prototype,"layerName",void 0),$=(0,o._)([(0,t.j)("esri.rest.support.IdentifyResult")],$);const Ie=$;function k(){return(k=(0,s.Z)(function*(p,i,u){const f=(i=Oe(i)).geometry?[i.geometry]:[],r=(0,_.en)(p);return r.path+="/identify",(0,ue.aX)(f).then(h=>{const j=fe(i,{geometry:h&&h[0]}),R=(0,_.cv)(Q(ee(Q({},r.query),{f:"json"}),j)),E=(0,_.lA)(R,u);return(0,H.default)(r.path,E).then(Pe).then(d=>Ce(d,i.sublayers))})})).apply(this,arguments)}function Pe(p){const i=p.data;i.results=i.results||[];const u={results:[]};return u.results=i.results.map(f=>Ie.fromJSON(f)),u}function Oe(p){return oe.from(p)}function Ce(p,i){if(null==i||!i.length)return p;const u=new Map;i.forEach(function f(r){u.set(r.id,r),r.sublayers&&r.sublayers.forEach(f)});for(const r of p.results)r.feature.sourceLayer=u.get(r.layerId);return p}var Me=e(46679),ie=e(10023);const je=p=>{let i=class extends p{initialize(){this.exportImageParameters=new z.R({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var u;return null==(u=this.exportImageParameters)||u.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}fetchPopupFeatures(u,f){var r=this;return(0,s.Z)(function*(){var R,E,d,C,v,b;const{layer:h}=r;if(!u)throw new y.Z("mapimagelayer:fetchPopupFeatures","Nothing to fetch without area",{layer:h});const j=null==(d=null==(E=null==(R=r.layer.capabilities)?void 0:R.operations)?void 0:E.supportsQuery)||d;if(!((null==(b=null==(v=null==(C=r.layer.capabilities)?void 0:C.operations)?void 0:v.supportsIdentify)||b)&&r.layer.version>=10.5||j))throw new y.Z("mapimagelayer:fetchPopupFeatures-not-supported","query operation is disabled for this service",{layer:h});return j?r._fetchPopupFeaturesUsingQueries(u,f):r._fetchPopupFeaturesUsingIdentify(u,f)})()}canResume(){var u;return!(!super.canResume()||null!=(u=this.timeExtent)&&u.isEmpty)}_fetchPopupFeaturesUsingIdentify(u,f){var r=this;return(0,s.Z)(function*(){const h=yield r._createIdentifyParameters(u,f);if((0,n.Wi)(h))return[];const{results:j}=yield function Ee(p,i,u){return k.apply(this,arguments)}(r.layer.parsedUrl,h);return j.map(R=>R.feature)})()}_createIdentifyParameters(u,f){var r=this;return(0,s.Z)(function*(){var P,J;const{floors:h,spatialReference:j,scale:R}=r.view,E=(0,n.pC)(f)?f.event:null,d=yield r._collectPopupProviders(r.layer.sublayers,R,f);if(!d.length)return null;yield Promise.all(d.map(({sublayer:O})=>O.load().catch(()=>{})));const C=Math.min((0,x.Z)("mapimagelayer-popup-identify-max-tolerance"),r.layer.allSublayers.reduce((O,M)=>M.renderer?(0,X.k)({renderer:M.renderer,event:E}):O,2)),v=r.createFetchPopupFeaturesQueryGeometry(u,C),b=(0,G.dp)(R,j),V=Math.round(v.width/b),Z=new L.Z({xmin:v.center.x-b*V,ymin:v.center.y-b*V,xmax:v.center.x+b*V,ymax:v.center.y+b*V,spatialReference:v.spatialReference}),A=!1===(null==(J=null==(P=r.layer.capabilities)?void 0:P.operations)?void 0:J.supportsQuery)||(yield new Promise(O=>{let M=!1;Promise.all(d.map(function(){var T=(0,s.Z)(function*({popupTemplate:K}){if(K){const w=yield r._loadArcadeModules(K);if(M)return;(null==w?void 0:w.arcadeUtils.hasGeometryOperations(K))&&(M=!0,O(!0))}});return function(K){return T.apply(this,arguments)}}())).finally(()=>O(!1))}));return new oe({floors:h,gdbVersion:r.layer.gdbVersion,geometry:u,height:V,layerOption:"popup",mapExtent:Z,maxAllowableOffset:A?0:b,returnGeometry:!0,spatialReference:j,sublayers:r.layer.sublayers,timeExtent:r.timeExtent,tolerance:C,width:V})})()}_fetchPopupFeaturesUsingQueries(u,f){var r=this;return(0,s.Z)(function*(){const h=yield r._collectPopupProviders(r.layer.sublayers,r.view.scale,f),j=(0,n.pC)(f)?f.event:null,R=h.map(function(){var E=(0,s.Z)(function*({sublayer:d,popupTemplate:C}){var A,P;yield d.load().catch(()=>{});const v=d.createQuery(),b=(0,X.k)({renderer:d.renderer,event:j}),V=r.createFetchPopupFeaturesQueryGeometry(u,b);if(v.geometry=V,v.outFields=yield(0,ie.e)(d,C),"floors"in r.view){const J=null==(P=null==(A=r.view)?void 0:A.floors)?void 0:P.clone(),O=(0,B.f)(J,d);(0,n.pC)(O)&&(v.where=v.where?`(${v.where}) AND (${O})`:O)}const Z=yield r._loadArcadeModules(C);return Z&&Z.arcadeUtils.hasGeometryOperations(C)||(v.maxAllowableOffset=V.width/b),(yield d.queryFeatures(v)).features});return function(d){return E.apply(this,arguments)}}());return(yield(0,c.as)(R)).reduce((E,d)=>d.value?[...E,...d.value]:E,[]).filter(E=>null!=E)})()}_collectPopupProviders(u,f,r){return(0,s.Z)(function*(){const h=[],j=function(){var E=(0,s.Z)(function*(d){if(d.visible&&(0===d.minScale||f<=d.minScale)&&(0===d.maxScale||f>=d.maxScale))if(d.sublayers)d.sublayers.forEach(j);else if(d.popupEnabled){const b=(0,ie.V)(d,ee(Q({},r),{defaultPopupTemplateEnabled:!1}));(0,n.pC)(b)&&h.unshift({sublayer:d,popupTemplate:b})}});return function(C){return E.apply(this,arguments)}}(),R=u.toArray().reverse().map(j);return yield Promise.all(R),h})()}_loadArcadeModules(u){var f;if((null==(f=u.expressionInfos)?void 0:f.length)||Array.isArray(u.content)&&u.content.some(r=>"expression"===r.type))return(0,Me.LC)()}};return(0,o._)([(0,l.Cb)()],i.prototype,"exportImageParameters",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"exportImageVersion",null),(0,o._)([(0,l.Cb)()],i.prototype,"layer",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"suspended",void 0),(0,o._)([(0,l.Cb)(U.qG)],i.prototype,"timeExtent",void 0),i=(0,o._)([(0,t.j)("esri.views.layers.MapImageLayerView")],i),i};var Se=e(94672);let q=class extends(je(m.Z)){constructor(){super(...arguments),this.type="map-image-3d"}initialize(){this.updatingHandles.add(()=>this.exportImageVersion,()=>this.updatingHandles.addPromise(this.refreshDebounced()))}createFetchPopupFeaturesQueryGeometry(p,i){return(0,Se.K)(p,i,this.view)}getFetchOptions(){return{timeExtent:this.timeExtent}}};q=(0,o._)([(0,t.j)("esri.views.3d.layers.MapImageLayerView3D")],q);const Re=q},10023:(N,g,e)=>{e.d(g,{V:()=>a,e:()=>S});var o=e(15861),F=e(62208),D=e(36630);function S(t){return x.apply(this,arguments)}function x(){return(x=(0,o.Z)(function*(t,m=t.popupTemplate){if((0,F.Wi)(m))return[];const s=yield m.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:y}=m,{objectIdField:n,typeIdField:c,globalIdField:l,relationships:L}=t;if(s.includes("*"))return["*"];const G=y?yield(0,D.CH)(t):[],U=(0,D.Q0)(t.fieldsIndex,[...s,...G]);return c&&U.push(c),U&&n&&t.fieldsIndex.has(n)&&!U.includes(n)&&U.push(n),U&&l&&t.fieldsIndex.has(l)&&!U.includes(l)&&U.push(l),L&&L.forEach(z=>{const{keyField:B}=z;U&&B&&t.fieldsIndex.has(B)&&!U.includes(B)&&U.push(B)}),U})).apply(this,arguments)}function a(t,m){return t.popupTemplate?t.popupTemplate:(0,F.pC)(m)&&m.defaultPopupTemplateEnabled&&(0,F.pC)(t.defaultPopupTemplate)?t.defaultPopupTemplate:null}},94672:(N,g,e)=>{e.d(g,{D:()=>t,K:()=>a}),e(29132);var F=e(62208),D=e(16730),S=e(22264),x=e(2004);function a(s,y,n,c=new x.Z){let l;if("2d"===n.type)l=y*n.resolution;else if("3d"===n.type){const X=n.overlayPixelSizeInMapUnits(s),H=n.basemapSpatialReference;l=(0,F.pC)(H)&&!H.equals(n.spatialReference)?(0,D.c9)(H)/(0,D.c9)(n.spatialReference):y*X}const L=s.x-l,G=s.y-l,U=s.x+l,z=s.y+l,{spatialReference:B}=n;return c.xmin=Math.min(L,U),c.ymin=Math.min(G,z),c.xmax=Math.max(L,U),c.ymax=Math.max(G,z),c.spatialReference=B,c}function t(s,y,n){const c=n.toMap(s);return!(0,F.Wi)(c)&&a(c,(0,S.k)(),n,m).intersects(y)}const m=new x.Z}}]);