"use strict";var $n=Object.defineProperty,qn=Object.defineProperties,ts=Object.getOwnPropertyDescriptors,da=Object.getOwnPropertySymbols,es=Object.prototype.hasOwnProperty,is=Object.prototype.propertyIsEnumerable,ua=(gt,X,c)=>X in gt?$n(gt,X,{enumerable:!0,configurable:!0,writable:!0,value:c}):gt[X]=c,H=(gt,X)=>{for(var c in X||(X={}))es.call(X,c)&&ua(gt,c,X[c]);if(da)for(var c of da(X))is.call(X,c)&&ua(gt,c,X[c]);return gt},F=(gt,X)=>qn(gt,ts(X));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[2327],{15448:(gt,X,c)=>{c.d(X,{h:()=>o});let p=f=>({vnodeSelector:"",properties:void 0,children:void 0,text:f.toString(),domNode:null}),G=(f,d,O)=>{for(let x=0,k=d.length;x<k;x++){let C=d[x];Array.isArray(C)?G(f,C,O):null!=C&&!1!==C&&("string"==typeof C&&(C=p(C)),O.push(C))}};function o(f,d,O){if(Array.isArray(d))O=d,d=void 0;else if(d&&("string"==typeof d||d.hasOwnProperty("vnodeSelector"))||O&&("string"==typeof O||O.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let x,k;return O&&1===O.length&&"string"==typeof O[0]?x=O[0]:O&&(k=[],G(f,O,k),0===k.length&&(k=void 0)),{vnodeSelector:f,properties:d,children:k,text:""===x?void 0:x,domNode:null}}},22264:(gt,X,c)=>{function p(O,x){return x?"xoffset"in x&&x.xoffset?Math.max(O,Math.abs(x.xoffset)):"yoffset"in x&&x.yoffset?Math.max(O,Math.abs(x.yoffset||0)):O:O}function o(O,x){return"number"==typeof O?O:O&&O.stops&&O.stops.length?function G(O){let x=0,k=0;for(let C=0;C<O.length;C++){const w=O[C].size;"number"==typeof w&&(x+=w,k++)}return x/k}(O.stops):x}function d(O){const x=O&&O.renderer,k="touch"===(O&&O.event&&O.event.pointerType)?9:6;if(!x)return k;const C="visualVariables"in x?function f(O,x){if(!x)return O;const k=x.filter(T=>"size"===T.type).map(T=>{const{maxSize:Mt,minSize:Gt}=T;return(o(Mt,O)+o(Gt,O))/2});let C=0;const w=k.length;if(0===w)return O;for(let T=0;T<w;T++)C+=k[T];const Q=Math.floor(C/w);return Math.max(Q,O)}(k,x.visualVariables):k;if("simple"===x.type)return p(C,x.symbol);if("unique-value"===x.type){let w=C;return x.uniqueValueInfos.forEach(Q=>{w=p(w,Q.symbol)}),w}if("class-breaks"===x.type){let w=C;return x.classBreakInfos.forEach(Q=>{w=p(w,Q.symbol)}),w}return C}c.d(X,{k:()=>d})},82327:(gt,X,c)=>{c.r(X),c.d(X,{DrawGraphicTool3D:()=>Ht,ExtentTransformTool:()=>ft,GraphicMoveTool:()=>Bt,GraphicReshapeTool:()=>ot,GraphicTransformTool:()=>yt});var p=c(17626),G=c(54024),o=c(62208),f=c(32917),d=c(77712),x=(c(85931),c(8314)),C=(c(90912),c(76898)),w=c(60507),Q=c(82706),T=c(23841),A=(c(63290),c(82255),c(28093)),D=c(15861),L=c(14517),j=c(10699),rt=c(84600),I=c(16730),E=c(67831),_t=c(99770),u=c(84161),nt=c(25748),lt=c(41840),st=c(68371),tt=c(22463);const oe={default:15,far:25};let ht=class extends L.Z{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){var e=this;const t=(0,j.vr)(function(){var a=(0,D.Z)(function*(n){const s=yield(0,lt.ME)("esri/core/t9n/Units");(0,j.k_)(n),e._messagesUnits=s});return function(n){return a.apply(this,arguments)}}()),i=()=>(0,o.yw)(this.context,a=>a.editGeometryOperations);this.own([(0,f.YP)(()=>[(0,o.pC)(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(a=>(0,f.on)(i,a,()=>this._update())),(0,G.kB)(()=>t.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return(0,o.Wi)(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(e=>e.label.text)}}get _edgeDistancePixels(){return oe[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if((0,o.Wi)(e))return void this._destroyUnusedLabels();const{components:t,geometry:i,coordinateHelper:a}=e.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const n=t.length;for(let s=0;s<n;++s){const r=[];if(t[s].iterateVertices(m=>{r.push(a.toXYZ(m.pos))}),0===s&&(0,o.pC)(this.stagedVertex)&&r.push(a.toXYZ(this.stagedVertex)),r.length<2)continue;const l=r[0],h=r[r.length-1];"polygon"===i.type&&r.length>2&&!(0,u.z)(l,h)&&r.push(l);const g=1===n&&!(0,nt.bu)(r,!1,!1);let v=ai,_=ga;this.toScreenPointArray(e,l,v);for(let m=1;m<r.length;++m){const b=r[m-1],M=r[m];this.toScreenPointArray(e,M,_),this._addLabel(e,b,v,M,_,g),[v,_]=[_,v]}}this._destroyUnusedLabels()}_addLabel(e,t,i,a,n,s){const{label:r}=this._getOrCreateLabel(e);if(!this.visible||(0,E.s)(i,n)<3025)return void(r.visible=!1);const l=(0,o.pC)(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,w.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:h}=e.editGeometryOperations.data,g=(0,tt.MU)(t,a,h,l),v=this._messagesUnits,_=(0,I.RG)(e.view);r.text=(0,o.pC)(v)&&(0,o.pC)(g)?(0,rt.N9)(v,g,_):"",r.visible=!0;const m=n[0]-i[0],b=n[1]-i[1];s?(0,E.a)(pt,-b,m):(0,E.a)(pt,b,-m),(0,E.i)(pt,pt),(0,E.f)(pt,pt,this._edgeDistancePixels),(0,E.l)(re,i,n,.5),(0,E.b)(re,re,pt),r.position=[re[0],re[1]],r.anchor=Math.abs(pt[0])>Math.abs(pt[1])?pt[0]>0?"left":"right":-pt[1]<0?"top":"bottom"}_getOrCreateLabel(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new st.Z({fontSize:10,anchor:"center"});e.view.overlay.items.add(t);const i={label:t};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){(0,o.yw)(this.context,t=>t.view.overlay.items.remove(e)),e.destroy()}};(0,p._)([(0,d.Cb)()],ht.prototype,"context",void 0),(0,p._)([(0,d.Cb)()],ht.prototype,"stagedVertex",void 0),(0,p._)([(0,d.Cb)()],ht.prototype,"visible",void 0),(0,p._)([(0,d.Cb)()],ht.prototype,"edgeDistance",void 0),(0,p._)([(0,d.Cb)()],ht.prototype,"updating",null),(0,p._)([(0,d.Cb)()],ht.prototype,"_messagesUnits",void 0),(0,p._)([(0,d.Cb)()],ht.prototype,"_edgeDistancePixels",null),ht=(0,p._)([(0,C.j)("esri.views.interactive")],ht);const pt=(0,_t.a)(),re=(0,_t.a)(),ai=(0,T.s1)(),ga=(0,T.s1)();var ma=c(25858);let Ue=class extends ht{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:i},a,n=(0,T.s1)()){const{spatialReference:s}=i.data.coordinateHelper;return(0,ma.RS)(a,s,t,e,bi),e.state.camera.projectToScreen(bi,n),n}};Ue=(0,p._)([(0,C.j)("esri.views.3d.interactive.SegmentLabels3D")],Ue);const bi=(0,A.c)();var Ae=c(96813),zt=c(91558),ni=c(78260),Si=c(4794),Ze=c(95390),it=c(40723),si=c(54889);const P={main:new zt.Z([255,127,0]),selected:new zt.Z([255,255,255]),staged:new zt.Z([12,207,255]),outline:new zt.Z([0,0,0,.5]),selectedOutline:new zt.Z([255,255,255])};function we(e,t){const i=e.clone();return i.a*=t,i}function va(e,t){const i=e.clone(),a=(0,ni._Y)(i);a.s*=t;const n=(0,ni.xr)(a);return i.r=n.r,i.g=n.g,i.b=n.b,i}function Ot(e,t){if(t)for(const i in t)e[i]=t[i]}class _a{constructor(t){this.color=P.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=it.yD.Opaque,Ot(this,t)}}class oi{constructor(t){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=P.main,this.outlineColor=P.outline,this.renderOccluded=it.yD.Opaque,this.hoverOutlineColor=P.selectedOutline,Ot(this,t)}apply(t,i){const a=this[t];i.setParameters({color:$t(a),transparent:"color"!==t||a.a<1,renderOccluded:this.renderOccluded})}}class ya{constructor(t){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=we(P.main,.5),this.hoverColor=P.main,this.renderOccluded=it.yD.Transparent,this.minSquaredEdgeLength=900,Ot(this,t)}apply(t,i){const a=this[t];i.setParameters({color:$t(a),transparent:a.a<1,renderOccluded:this.renderOccluded})}}class fa{constructor(t){this.vertex=new oi({color:P.main,outlineColor:P.outline}),this.edge=new oi({color:va(we(P.main,2/3),.5),outlineColor:we(P.outline,.5),size:8,collisionPadding:8}),this.selected=new oi({color:P.selected,outlineColor:P.outline}),this.edgeOffset=new ya,Ot(this,t)}}class ri{constructor(t){this.color=P.selected,this.width=1.5,this.stipplePattern=(0,si.z5)(5),this.stippleOffColor=P.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=P.selected,this.renderOccluded=it.yD.OccludeAndTransparent,Ot(this,t)}apply(t){t.color=$t(this.color),t.width=this.width,t.stipplePattern=this.stipplePattern,t.stippleOffColor=$t(this.stippleOffColor),t.falloff=this.falloff,t.innerWidth=this.innerWidth,t.innerColor=$t(this.innerColor),t.renderOccluded=this.renderOccluded}}class Ma{constructor(t){this.color=P.selected,this.size=4,this.outlineSize=1,this.outlineColor=P.outline,this.shape="square",Ot(this,t)}apply(t){t.color=$t(this.color),t.size=this.size,t.outlineSize=this.outlineSize,t.outlineColor=$t(this.outlineColor),t.primitive=this.shape}}class Ne{constructor(t){this.innerColor=P.selected,this.innerWidth=1,this.glowColor=P.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=P.main,Ot(this,t)}apply(t,i=1){const a={glowColor:zt.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:zt.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*i,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in t?t.style=a:t.laserlineStyle=a}}class ba{constructor(t){this.outline=new ri({color:P.outline,renderOccluded:it.yD.OccludeAndTransparentStencil,stippleOffColor:P.selected,stipplePattern:(0,si.z5)(5),width:1.5,innerWidth:0}),this.staged=new ri({color:P.selected,renderOccluded:it.yD.OccludeAndTransparentStencil,innerColor:P.staged,stippleOffColor:P.outline,stipplePattern:(0,si.z5)(5),width:1.5}),this.shadowStyle=new Ne({globalAlpha:.3,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:1}),Ot(this,t)}}class Sa{constructor(t){this.outline=new Ma({color:P.selected,outlineColor:P.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Ne({globalAlpha:.3,glowColor:P.main,glowFalloff:1.5,glowWidth:6,innerColor:P.selected,innerWidth:1,radius:2}),Ot(this,t)}}class xa extends ri{constructor(t){super(),this.extensionType=Ze.n.GROUND_RAY,Ot(this,t)}}class Ca{constructor(t){this.lineGraphics=new ba,this.pointGraphics=new Sa,this.heightPlane=new Ne({globalAlpha:.3,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:1}),this.heightBox=new Ne({globalAlpha:.3,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:0,heightFillColor:P.main}),this.zVerticalLine=new xa({color:we(P.main,.5),falloff:2,innerColor:we(P.selected,0),renderOccluded:it.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:Ze.n.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,Ot(this,t)}}function $t(e){return(0,Si.b)(zt.Z.toUnitRGBA(e))}const y=new class Ea{constructor(t){this.visualElements=new Ca,this.reshapeManipulators=new fa,this.zManipulator=new _a,Ot(this,t)}colorToVec4(t){return $t(t)}};var Wt=c(61885),Ut=c(993),li=c(67709),Be=c(55915),le=c(5548),Te=c(38114),Oa=c(61996),Aa=c(62600),ve=c(42743),xi=c(54840);class wa{constructor(t){this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return(0,o.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(t){t!==this._attached&&(this._attached=t,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?(0,o.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,o.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var n;this._destroyResources();const t=this.resourceFactory.createResources(),i=new _e({view:this.resourceFactory.view}),a=null==(n=this.resourceFactory.view.basemapTerrain)?void 0:n.overlayManager;this._resources={layerView:new _e({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},a&&(this._resources.drapeSourceRenderer=a.registerGeometryDrapeSource(i)),this._syncGeometriesToRenderer()}_destroyResources(){var i;if((0,o.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const t=null==(i=this.resourceFactory.view.basemapTerrain)?void 0:i.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,o.Wi)(this._resources)||(0,o.Wi)(this._resources.drapeSourceRenderer)||!this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,xi.$.Geometry.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,o.Wi)(this._resources)||(0,o.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,xi.$.Geometry.UPDATE),this._resources.geometriesAdded=!0)}}let _e=class extends((0,Oa.IG)(L.Z)){constructor(e){super(e),this.drapeSourceType=Aa.L.Features,this.updatePolicy=ve.jq.SYNC}};(0,p._)([(0,d.Cb)({constructOnly:!0})],_e.prototype,"view",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],_e.prototype,"drapeSourceType",void 0),_e=(0,p._)([(0,C.j)("DrapedVisualElementLayerView")],_e);var Ye=c(23018),Ta=c(94375),He=c(79112),qt=c(44014),Da=c(36848),Ra=c(53855),hi=c(16396),Ci=c(92222);class he{constructor(t){this.view=null,this._attachmentOrigin=(0,Te.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new Wt.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,li.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,li.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=it.yD.OccludeAndTransparentStencil,this.resources=new Ta.O({view:t.view,createResources:a=>this._createResources(a),recreateGeometry:(a,n)=>(a.geometries.length=0,this._recreateGeometry(n,a.material,a.geometries),a.geometries)}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new wa({view:t.view,createResources:()=>this._createDrapedResources(),recreateGeometry:a=>{a.geometries=this._createRenderGeometriesDraped(a.material),this._attachmentOriginChanged()}});let i=!0;this._laserline=new Ye.W({view:t.view});for(const a in t)a in this?"attached"===a?i=t[a]:this[a]=t[a]:console.error("Cannot set unknown property",a);this.attached=i}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(t){t!==this._isDraped&&(this._isDraped=t,this._updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&(0,o.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(t){this.resources.visible=t,this.drapedResources.visible=t,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(t){this._updateAttached(t)}_updateAttached(t){this.resources.attached=!this.isDraped&&t,this.drapedResources.attached=this.isDraped&&t,this._laserline.attached=this.laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){(0,Ut.g)(t,this._color)||((0,Ut.c)(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){(0,Ut.g)(t,this._innerColor)||((0,Ut.c)(this._innerColor,t),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const i=(0,o.pC)(t)!==(0,o.pC)(this._stipplePattern);this._stipplePattern=t,i?this.resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){t&&this._stippleOffColor&&(0,Ut.g)(t,this._stippleOffColor)||(this._stippleOffColor=t?(0,li.a)(t):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(t){this._laserlineStyle=t,this._laserline.attached=this.laserlineAttached,(0,o.pC)(t)&&(this._laserline.style=t)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(t){this._laserlineEnabled!==t&&(this._laserlineEnabled=t,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=(0,o.pC)(this.resources.resources)?this.resources.resources.geometries:null;if(!t||0===t.length)return null;(0,u.s)(ye,0,0,0);let i=0;for(const a of t){const n=a.vertexAttributes.get(hi.T.POSITION),s=a.indices.get(hi.T.POSITION),r=(0,o.Wg)(this.resources.resources).material.isClosed(n.data,s);(0,Da.qZ)(n,s,r,Ei)&&((0,u.a)(ye,ye,Ei),i++)}return 0===i?null:((0,u.g)(ye,ye,1/i),this.view.renderCoordsHelper.fromRenderCoords(ye,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){(0,o.pC)(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),(0,o.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}get isClosed(){return(0,o.pC)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===it.yD.OccludeAndTransparentStencil?it.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(t,i,a){const n=this._createRenderGeometries();for(const s of n)t.addGeometry(s,i),a.push(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(t){const i=new Ci.U(this.materialParameters),a=[];return this._recreateGeometry(t,i,a),{material:i,geometries:a,forEach:n=>{n(i),a.forEach(n)}}}_createDrapedResources(){const t=new Ci.U(this.materialParameters);return{material:t,geometries:this._createRenderGeometriesDraped(t)}}_createRenderGeometriesDraped(t){const i=this.geometry;if((0,o.Wi)(i))return[];const a=(0,qt.rm)(i,this.view.basemapTerrain.spatialReference),n=[];for(const{position:s}of a.lines){const l=new Ra.z((0,qt.YU)({overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this.isClosed?qt.NW.REMOVE:qt.NW.KEEP}),t),h=(0,le.cS)(Ga);(0,le.G1)(h,s),(0,Ut.s)(l.boundingSphere,.5*(h[0]+h[3]),.5*(h[1]+h[4]),0,.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]))),n.push(l)}return n}calculateMapBounds(t){if((0,o.Wi)(this.resources.resources))return!1;const i=this.view.renderCoordsHelper;for(const a of this.resources.resources.geometries){const n=a.vertexAttributes.get(hi.T.POSITION),s=new Float64Array(n.data.length);(0,Be.CM)(n.data,i.spatialReference,0,s,this.view.spatialReference,0,n.data.length/3),(0,le.G1)(t,s)}return!0}_createRenderGeometries(){var s;const t=this.geometry;if((0,o.Wi)(t))return[];const i=(0,qt.VP)(t,this.view.elevationProvider,this.view.renderCoordsHelper,He.o.fromElevationInfo(null!=(s=this.elevationInfo)?s:new Q.ZP({mode:(0,w.VW)(t,null)}))),a=[],n=[];for(const{position:r,mapPosition:l}of i.lines)a.push((0,qt.YU)({overlayInfo:null,attributeData:{position:r,mapPosition:l},removeDuplicateStartEnd:this.isClosed?qt.NW.REMOVE:qt.NW.KEEP})),n.push(r);return this._laserline.pathVerticalPlane=n,a}}const Ga=(0,le.Ue)(),Ei=(0,A.c)(),ye=(0,A.c)();var Pa=c(53928),Ia=c(92690),mt=c(57521),Oi=c(81040);class Ai extends Pa._{constructor(t){super(t),this.view=null,this._renderOccluded=it.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=y.colorToVec4(y.reshapeManipulators.vertex.color),this._size=y.reshapeManipulators.vertex.size,this._outlineColor=y.colorToVec4(y.reshapeManipulators.vertex.outlineColor),this._outlineSize=y.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(t){this._vertices=t,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(t){this._spatialReference=t,this.recreateGeometry()}get color(){return this._color}set color(t){(0,Ut.g)(t,this._color)||((0,Ut.c)(this._color,t),this._updateMaterial())}get size(){return this._size}set size(t){t!==this._size&&(this._size=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){(0,Ut.g)(t,this._outlineColor)||((0,Ut.c)(this._outlineColor,t),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}_createRenderGeometries(){const t=this.vertices;if((0,o.Wi)(t)||0===t.length)return[];const n=(0,Ia.VP)(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,He.o.fromElevationInfo(this.elevationInfo)),s=[],r=n.numVertices,l=n.position;for(let h=0;h<r;++h){const g=(0,u.s)(La,l[3*h+0],l[3*h+1],l[3*h+2]),v=wi(.5,g),_=wi(.5,g);s.push({vertexGeometry:v,vertexOutlineGeometry:_})}return s}createGeometries(t){const i=this._createRenderGeometries();for(const{vertexGeometry:a,vertexOutlineGeometry:n}of i)t.addGeometry(a,this.vertexMaterial),t.addGeometry(n,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new Oi.Q(F(H({},this.vertexMaterialParameters),{writeDepth:!0,cullFace:ve.Vr.Back,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new Oi.Q(F(H({},this.vertexOutlineMaterialParameters),{transparent:!0,writeDepth:!0,cullFace:ve.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(t){t(this.vertexMaterial),t(this.vertexOutlineMaterial)}}const La=(0,A.c)();function wi(e,t){return mt.Z.createSphereGeometry(e,16,16,{offset:t})}let bt=class extends Wt.Z.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,p._)([(0,d.Cb)({constructOnly:!0})],bt.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)()],bt.prototype,"tracking",void 0),(0,p._)([(0,d.Cb)()],bt.prototype,"displaying",void 0),(0,p._)([(0,d.Cb)()],bt.prototype,"isDraped",void 0),bt=(0,p._)([(0,C.j)("esri.views.3d.layers.graphics.GraphicState")],bt);var Ti=c(34921),Va=c(97233),Di=c(52181),je=c(24959),Zt=c(94309);let Ht=class extends Ti.T{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.labelOptions=new je.Z,this.tooltipOptions=new Zt.Z,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Q.ZP({mode:e,offset:t})}normalizeCtorArgs(e){var t;if(!e.elevationInfo){const i=null==(t=e.hasZ)||t;return F(H({},e),{elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}})}return e}initializeGraphic(e){const t=this._createGraphicState=new bt({graphic:e});return(0,G.AL)([this.view.maskOccludee(e),this.view.trackGraphicState(t),(0,f.YP)(()=>({element:this._outlineVisualElement,isDraped:t.isDraped}),({element:i,isDraped:a})=>{(0,o.yw)(i,n=>n.isDraped=a)},f.nn)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new Va.w({view:this.view,manipulators:this.manipulators,geometryType:(0,Ti.I)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Di.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Di.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Ae._,segmentLabels:t?new Ue:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,o.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,w.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(e){return(0,o.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new Ai({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:y.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=y.colorToVec4(y.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,(0,G.kB)(()=>{this._activeVertexVisualElement=(0,o.SC)(this._activeVertexVisualElement)}))}onOutlineChanged(e){if((0,o.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new he({view:this.view,geometry:e,elevationInfo:t,isDraped:(0,o.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,w.Zz)(this.hasZ,t),attached:!1}),y.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),y.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,G.kB)(()=>{this._outlineVisualElement=(0,o.SC)(this._outlineVisualElement)})}onRegularVerticesChanged(e){return(0,o.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new Ai({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:y.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,G.kB)(()=>{this._verticesVisualElement=(0,o.SC)(this._verticesVisualElement)}))}};(0,p._)([(0,d.Cb)({constructOnly:!0})],Ht.prototype,"elevationInfo",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Ht.prototype,"geometryType",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:je.Z})],Ht.prototype,"labelOptions",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Zt.Z})],Ht.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)()],Ht.prototype,"type",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Ht.prototype,"view",void 0),Ht=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Ht);var U,e,za=c(46160),De=c(80542),$=c(19142),Ri=c(69648);(e=U||(U={}))[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE";var Pt,pe=c(95277),At=c(21286),wt=c(45403);!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(Pt||(Pt={}));class Gi{constructor(){this.grabbingState=Pt.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=Pt.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator((i,a)=>{if(a===U.TRANSLATE_Z&&(this.zManipulator=i),i instanceof wt.Z&&(i.selected&&(0===this.numSelected&&(this.firstSelected=i),this.numSelected++),(0,o.Wi)(this.firstGrabbedXY)&&i.grabbing&&a===U.TRANSLATE_XY&&(this.firstGrabbedXY=i)),i.grabbing)switch(this.grabbingState|=Pt.ANY,a){case U.TRANSLATE_Z:this.grabbingState|=Pt.Z;break;case U.TRANSLATE_XY:this.grabbingState|=Pt.XY}})}}function Za(e,t,i){const{graphic:a,view:n}=e,s=[],r=(0,w.RL)(a),l="on-the-ground"===r.mode||!r.offset&&"absolute-height"!==r.mode,h=new Gi,g=new Ze.V({view:n,extensionType:y.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:it.yD.OccludeAndTransparent});y.visualElements.pointGraphics.shadowStyle.apply(g);const v=(0,At.Vl)(y.visualElements.heightPlaneAngleCutoff),_=new Ye.W({view:n,attached:!1,angleCutoff:v});y.visualElements.heightPlane.apply(_);let m=1,b=1;const M=()=>{if(h.update(e),!i.displaying||l&&(i.isDraped||!pi(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,g.attached=!1,void(_.attached=!1);t.laserlineEnabled=!0;{const W=h.grabbingState&Pt.XY?y.visualElements.laserlineAlphaMultiplier:1;W!==m&&(m=W,y.visualElements.lineGraphics.shadowStyle.apply(t,W),y.visualElements.pointGraphics.shadowStyle.apply(g,W))}{const W=h.grabbingState&Pt.Z?y.visualElements.laserlineAlphaMultiplier:1;W!==b&&(b=W,y.visualElements.heightPlane.apply(_,W))}(function Na(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,o.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,o.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(g,h),function Ba(e,t,i,a){if(a.numSelected>0){(0,u.s)(ce,0,0,0);let n=0;e.forEachManipulator((s,r)=>{r===U.TRANSLATE_XY&&s.selected&&s instanceof wt.Z&&((0,u.a)(ce,ce,s.renderLocation),n++)}),n>0?(i.heightManifoldTarget=(0,u.g)(ce,ce,1/n),i.attached=!0):i.attached=!1}else{const n=t.attachmentOrigin;(0,o.pC)(n)&&e.view.renderCoordsHelper.toRenderCoords(n,ce)?(i.heightManifoldTarget=ce,i.attached=!0):i.attached=!1}}(e,t,_,h)};y.visualElements.zVerticalLine.apply(g),s.push(i.on("changed",M),(0,f.YP)(()=>i.displaying,M),t.events.on("attachment-origin-changed",M),(0,G.ed)(g),(0,G.ed)(_));const z=[],N=()=>{(0,G.AL)(z).remove(),z.length=0,e.forEachManipulator(W=>z.push(W.events.on("grab-changed",M))),e.forEachManipulator(W=>z.push(W.events.on("select-changed",M))),M()};return N(),s.push(e.onManipulatorsChanged(N),(0,G.iU)(()=>(0,G.AL)(z))),(0,G.AL)(s)}function pi(e){return(0,o.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const ce=(0,A.c)();var Pi=c(65401),Ya=c(30693),Ii=c(81468);function Ha(e){const{view:t,graphic:i}=e,a=new bt({graphic:i}),n=[],s=function Fa(e,t,i){const{view:a,graphic:n}=e,s=new Ya.L({view:a,geometry:ci(n),elevationInfo:(0,w.RL)(n),attached:!1});return function Xa(e,t,i,a){(function Qa(e,t,i,a){const{view:n,graphic:s}=e;let r=null;const h=()=>{const g=ci(s);(g=>{(0,o.pC)(r)&&(r.remove(),r=null),i.isDraped&&(0,o.pC)(g)&&(r=function Ka(e,t,i){(0,Be.KC)(t,It,e.elevationProvider.spatialReference);const n=It[0],s=It[1];return e.elevationProvider.on("elevation-change",r=>{(0,Pi.jE)(r.extent,n,s)&&i()})}(n,g,()=>{t.geometry=g}))})(g),t.geometry=g};a.push(i.on("changed",h),(0,G.iU)(()=>r)),h()})(e,t,i,a),y.visualElements.pointGraphics.outline.apply(t),a.push((0,f.YP)(()=>i.displaying,()=>t.attached=i.displaying,f.nn))}(e,s,t,i),i.push((0,G.ed)(s)),s}(e,a,n);return function ja(e,t,i,a){const{view:n,graphic:s}=e,r=new Ze.V({view:n,extensionType:y.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:it.yD.OccludeAndTransparent});y.visualElements.zVerticalLine.apply(r);const l=new Ye.W({view:n,intersectsLineInfinite:!0,attached:!1});y.visualElements.pointGraphics.shadowStyle.apply(l);const h=(0,At.Vl)(y.visualElements.heightPlaneAngleCutoff),g=new Ye.W({view:n,attached:!1,angleCutoff:h});y.visualElements.heightPlane.apply(g);const v=(0,w.RL)(e.graphic),_=He.o.fromElevationInfo(v),m="on-the-ground"===v.mode||!v.offset&&"absolute-height"!==v.mode,b=new Gi;let M=1,z=1;const N=()=>{b.update(e);const W=ci(s),B=m&&(t.isDraped||(0,o.Wi)(W)||!W.hasZ);let xt=!0;if(!B&&(0,o.pC)(W)){const J=(0,Ii.w7)(W,n.elevationProvider,_,n.renderCoordsHelper);(0,u.s)(It,W.x,W.y,J),(0,Be.SH)(It,W.spatialReference,It,n.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation(It),l.intersectsWorldUpAtLocation=It}else xt=!1;const Ve=b.grabbingState&Pt.Z?y.visualElements.laserlineAlphaMultiplier:1;Ve!==M&&(M=Ve,y.visualElements.heightPlane.apply(g,Ve));const ze=(0,le.cS)(ka);!B&&t.displaying&&a.calculateMapBounds(ze)&&(0,Be.SH)((0,le.KE)(ze,It),n.spatialReference,It,n.renderCoordsHelper.spatialReference)?(g.heightManifoldTarget=It,g.attached=!0):g.attached=!1;const Jt=b.grabbingState&Pt.XY?y.visualElements.laserlineAlphaMultiplier:1;Jt!==z&&(z=Jt,y.visualElements.pointGraphics.shadowStyle.apply(l,Jt));const ii=xt&&t.displaying&&!B;l.attached=ii,r.attached=ii};i.push((0,f.YP)(()=>[t.displaying,t.isDraped],N),t.on("changed",N)),e.forEachManipulator(W=>{i.push(W.events.on("grab-changed",N))}),i.push((0,G.ed)(l)),i.push((0,G.ed)(r)),i.push((0,G.ed)(g)),N()}(e,a,n,s),n.push(t.trackGraphicState(a)),{visualElement:s,remove(){(0,G.AL)(n).remove()}}}function ci(e){const t=e.geometry;return(0,o.Wi)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const It=(0,A.c)(),ka=(0,le.Ue)();function Fe(e){switch((0,o.Wg)(e.graphic.geometry).type){case"point":case"mesh":return Ha(e);case"polygon":case"polyline":return function Wa(e){const{view:t,graphic:i}=e,a=new bt({graphic:i}),n=function Ua(e,t){const{view:i,graphic:a}=e,n=new he({view:i,geometry:pi(a)?a.geometry:null,elevationInfo:(0,w.RL)(a),attached:!1});y.visualElements.lineGraphics.shadowStyle.apply(n);const s=()=>{n.attached=t.displaying};y.visualElements.lineGraphics.outline.apply(n);const r=[(0,f.YP)(()=>t.displaying,s),(0,f.YP)(()=>t.isDraped,l=>{n.isDraped=l}),t.on("changed",()=>n.geometry=pi(a)?a.geometry:null),(0,G.ed)(n)];return s(),{visualElement:n,remove:()=>(0,G.AL)(r).remove()}}(e,a),s=[n,Za(e,n.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:n.visualElement,remove:()=>(0,G.AL)(s).remove()}}(e);default:return null}}const Ja=[1,.5,0],zi=Math.ceil(70/3*2),sn=5*Math.PI/12,on=1*Math.PI/3;var Me=c(72392);class Re{constructor(){this._available=!0}set location(t){this._forEachManipulator3D(i=>i.location=t)}set elevationAlignedLocation(t){this._forEachManipulator3D(i=>i.elevationAlignedLocation=t)}set elevationInfo(t){this._forEachManipulator3D(i=>i.elevationInfo=t)}get renderLocation(){let t;return this._forEachManipulator3D(i=>{t||(t=i.renderLocation)}),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D(i=>i.available=t)}get hovering(){return this.someManipulator(t=>t.hovering)}get grabbing(){return this.someManipulator(t=>t.grabbing)}get dragging(){return this.someManipulator(t=>t.dragging)}hasManipulator(t){return this.someManipulator(i=>i===t)}someManipulator(t){let i=!1;return this.forEachManipulator(a=>{!i&&t(a)&&(i=!0)}),i}_forEachManipulator3D(t){this.forEachManipulator((i,a)=>{i instanceof wt.Z&&t(i,a)})}}var q=c(28347),be=c(43703),S=c(26242),Tt=c(8859),V=c(75079);function Xe(e,t,i,a){const n=e.graphic,s=(r,l)=>t({action:r,graphic:n,dxScreen:l.screenDeltaX,dyScreen:l.screenDeltaY});return i((r,l,h)=>{const g=l.next(v=>("start"===v.action&&s("start",v),v)).next((0,V.a9)(n,a)).next(v=>{switch(v.action){case"start":case"update":(v.translationX||v.translationY||v.translationZ)&&s("update",v);break;case"end":s("end",v)}return v});return h.next((0,V.bD)(n)).next(()=>{s("end",{screenDeltaX:0,screenDeltaY:0})}),g})}function ji(e){if((0,o.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}var gi=c(92972),R=c(33786);class pn extends Re{constructor(t){super(),this._handles=new Me.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new Wt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._handles=(0,o.SC)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:i}of this._arrowManipulatorInfos)t(i,U.TRANSLATE_XY)}createGraphicDragPipeline(t,i,a){const n=i.graphic,s=(0,w.RL)(n),r=(0,o.Wg)(n.geometry).spatialReference;return Xe(i,a,l=>this.createDragPipeline((h,g,v,_,m)=>l(h,t(h,g,v,_,m),v),s,r,n),this._view.state.viewingMode)}createDragPipeline(t,i,a,n){return(0,G.AL)(this._arrowManipulatorInfos.map(({manipulator:s},r)=>(0,V.Xd)(s,(l,h,g,v,_)=>{const m=h.next(b=>F(H({},b),{manipulatorType:U.TRANSLATE_XY})).next((0,V.kY)(this._view,l.elevationAlignedLocation)).next((0,Tt.G)(this._view,l.elevationAlignedLocation,i,a,n)).next((0,V.M2)(l.location,this.angle+(r+1)*Math.PI*.5)).next((0,V.zh)());t(l,m,g,v,_)})))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:i},a){const n=this._radius/70,s=54*n,r=s*Math.sqrt(3)/2,l=mt.Z.createExtrudedTriangle(r,s/2,s/2,.02);mt.Z.transformInPlace(l,(0,q.f)(S.MP.get(),(0,u.s)(S.WM.get(),0,-r/3,0))),t.renderObjects=[{geometry:l,material:this._opaqueMaterial,stateMask:R.Q9.Focused},{geometry:l,material:this._transparentMaterial,stateMask:R.Q9.Unfocused}],t.radius=r/3*2*1.2;const h=(0,q.b)(S.MP.get(),a*Math.PI/2),g=(0,q.f)(S.MP.get(),(0,u.s)(S.WM.get(),0,100*n,0));(0,q.m)(i,h,g)}_createManipulators(){for(let t=0;t<4;t++){const i=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(i)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,i=(0,q.d)(S.MP.get(),t,(0,A.f)(0,0,1));if((0,o.Wi)(i))return;const a=(0,q.u)(S.MP.get(),(0,u.s)(S.WM.get(),this.displayScale,this.displayScale,this.displayScale)),n=(0,q.m)(S.MP.get(),a,i);for(const s of this._arrowManipulatorInfos){const r=(0,q.m)(S.MP.get(),n,s.transform);s.manipulator.modelTransform=r}}_createArrowManipulator(t){const i=new wt.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,A.f)(0,0,1)}}),a={manipulator:i,transform:(0,be.c)()};return this._updateArrowManipulator(a,t),this._handles.add(i.events.on("drag",n=>{this._updateAfterDrag&&"end"===n.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),a}_createMaterial(t=1){const i=zt.Z.toUnitRGBA(P.main);return i[3]*=t,new gi.E({color:i,transparent:1!==t,cullFace:ve.Vr.Back,renderOccluded:it.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:t})=>t)}}}class cn{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new V.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,o.pC)(this.lastDragEvent)){const i=this.lastDragEvent.mapEnd,a=this._snap(this.lastDragEvent.screenEnd);(0,o.pC)(a)&&this.next.execute({action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===t?a:i,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd})}this._enabled=t}_snap(t){const i=(0,o.pC)(this.view)?this.view.toMap(t,{exclude:[]}):null;return(0,o.pC)(i)&&(0,o.pC)(this.view)&&(i.z=(0,w.Ou)(i,this.view,this.elevationInfo)),i}createDragEventPipelineStep(t,i){return this.view=t,this.elevationInfo=i,this.lastDragEvent=null,a=>{if(this.lastDragEvent="end"!==a.action?H({},a):null,this._enabled){const n=this._snap(a.screenEnd);return(0,o.pC)(n)?{action:a.action,mapStart:a.mapStart,mapEnd:n,screenStart:a.screenStart,screenEnd:a.screenEnd}:null}return{action:a.action,mapStart:a.mapStart,mapEnd:a.mapEnd,screenStart:a.screenStart,screenEnd:a.screenEnd}}}}class dn extends Re{constructor(t){super(),this._snapToScene=new cn,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=70,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,U.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,i,a){const n=i.graphic,s=(0,w.RL)(n),r=(0,o.Wg)(n.geometry).spatialReference;return Xe(i,a,l=>this.createDragPipeline((h,g,v,_,m)=>l(h,t(h,g,v,_,m),v),s,r,n),this._view.state.viewingMode)}createDragPipeline(t,i,a,n){const s=this._view;return(0,V.Xd)(this._manipulator,(r,l,h,g,v)=>{const _=l.next((0,V.kY)(s,r.elevationAlignedLocation)).next((0,Tt.G)(s,r.elevationAlignedLocation,i,a,n)).next(this._snapToScene.createDragEventPipelineStep(s,i),this._snapToScene.next).next(m=>F(H({},m),{manipulatorType:U.TRANSLATE_XY})).next((0,V.zh)());t(r,_,h,g,v)})}_updateManipulatorTransform(){const t=(0,q.u)(S.MP.get(),(0,u.s)(S.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){this._manipulator=new wt.Z({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,A.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=mt.Z.createCylinderGeometry(.02,1,128,(0,A.f)(0,0,1),(0,A.f)(0,0,0)),i=(0,q.u)((0,be.c)(),(0,A.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:t,material:this._discMaterial,transform:i,stateMask:R.Q9.Focused},{geometry:t,material:this._discMaterialTransparent,transform:i,stateMask:R.Q9.Unfocused}],this._manipulator.radius=this._radius/70*80}_createMaterial(t=1){const i=zt.Z.toUnitRGBA(P.main);return i[3]*=t,new gi.E({color:i,transparent:1!==t,cullFace:ve.Vr.Back,renderOccluded:it.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}class un extends Re{constructor(t){super(),this._radius=70,this.events=new Wt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()})}forEachManipulator(t){t(this._manipulator,U.TRANSLATE_Z)}createGraphicDragPipeline(t,i,a){const n=(0,o.Wg)(i.graphic.geometry).spatialReference;return Xe(i,a,s=>this.createDragPipeline((r,l,h,g,v)=>s(r,t(r,l,h,g,v),h),n),this._view.state.viewingMode)}createDragPipeline(t,i){const a=this._view;return(0,V.Xd)(this._manipulator,(n,s,r,l,h)=>{const g=s.next(v=>F(H({},v),{manipulatorType:U.TRANSLATE_Z})).next((0,Tt.Sp)(a,n.renderLocation,i)).next((0,V.zh)());t(n,g,r,l,h)})}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._radius/70,i=y.zManipulator.height*t,a=y.zManipulator.coneHeight*t,n=y.zManipulator.coneWidth*t,s=y.zManipulator.width*t,r=[(0,A.f)(0,0,0),(0,A.f)(0,0,i)],l=mt.Z.createTubeGeometry(r,s/2,16,!1),h=mt.Z.createConeGeometry(a,n/2,16,!1),g=[(0,A.f)(0,0,0),(0,A.f)(0,0,i+a)],_=(W=>{const B=(0,be.c)();return(0,q.j)(B,B,[0,0,i]),(0,q.r)(B,B,Math.PI/2),B})(),m=(W,B)=>{const xt=(0,ni._j)(y.zManipulator.color,B);return[xt.r/255,xt.g/255,xt.b/255,y.zManipulator.color.a*W]},b=(0,$.EA)(m(1,.25),it.yD.Occlude),M=(0,$.EA)(m(1,0),it.yD.Occlude),z=(0,$.EA)(m(.7,0),y.zManipulator.renderOccluded),N=(0,$.EA)(m(.85,0),y.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:h,transform:_,material:b,stateMask:R.Q9.Unfocused},{geometry:l,material:b,stateMask:R.Q9.Unfocused},{geometry:h,transform:_,material:M,stateMask:R.Q9.Focused},{geometry:l,material:M,stateMask:R.Q9.Focused},{geometry:h,transform:_,material:z,stateMask:R.Q9.Unfocused},{geometry:l,material:z,stateMask:R.Q9.Unfocused},{geometry:h,transform:_,material:N,stateMask:R.Q9.Focused},{geometry:l,material:N,stateMask:R.Q9.Focused}],this._manipulator.radius=s/2+2,this._manipulator.collisionType={type:"line",paths:[g]}}_createManipulator(){const t=new wt.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=i=>{const a=this._view.state.camera,n=Fi;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,n);const s=(0,u.j)(a.eye,n),r=a.computeRenderPixelSizeAtDist(s),l=(0,u.b)(Se,n,a.eye);(0,u.n)(l,l);const h=gn;this._view.renderCoordsHelper.worldUpAtPosition(Fi,h);const g=Math.abs((0,u.e)(l,h)),v=(0,u.f)(Se,l,h),_=(0,u.f)(Se,v,h),m=(0,At.uZ)(g,.01,1),b=1-Math.sqrt(1-m*m)/m/a.fullWidth,z=y.zManipulator.width*(this._radius/70);(0,u.g)(_,(0,u.n)(_,_),(1/b-1)*s+r*z),i[12]-=Se[0],i[13]-=Se[1],i[14]-=Se[2]},this._manipulator=t,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const Fi=(0,A.c)(),Se=(0,A.c)(),gn=(0,A.c)();class ue extends Re{constructor(t){super(),this._handles=new Me.Z,this._angleDeferred=null,this._interactive=!0;const{tool:i,view:a,snapToScene:n,radius:s}=t;this._view=a,this.xyManipulation=new dn({tool:i,view:a,snapToScene:n,radius:s}),this.xyAxisManipulation=new pn({tool:i,view:a,radius:s}),this.zManipulation=new un({tool:i,view:a,radius:s}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(r=>{this._handles.add(r.events.on("grab-changed",()=>this._updateManipulatorInteractivity()))})}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,i,a){return(0,G.AL)([this.xyManipulation.createGraphicDragPipeline((n,s,r,l,h)=>t(Y.XY,n,s,r,l,h),i,a),this.xyAxisManipulation.createGraphicDragPipeline((n,s,r,l,h)=>t(Y.XY_AXIS,n,s,r,l,h),i,a),this.zManipulation.createGraphicDragPipeline((n,s,r,l,h)=>t(Y.Z,n,s,r,l,h),i,a)])}createDragPipeline(t,i,a,n){return(0,G.AL)([this.xyManipulation.createDragPipeline((s,r,l,h,g)=>t(Y.XY,s,r,l,h,g),i,a,n),this.xyAxisManipulation.createDragPipeline((s,r,l,h,g)=>t(Y.XY_AXIS,s,r,l,h,g),i,a,n),this.zManipulation.createDragPipeline((s,r,l,h,g)=>t(Y.Z,s,r,l,h,g),a)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this._angleDeferred=null,this.xyAxisManipulation.angle=t}set angleDeferred(t){this.xyAxisVisible?this.angle=t():this._angleDeferred=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator(i=>t(i,U.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(i=>t(i,U.TRANSLATE_XY)),this.zManipulation.forEachManipulator(i=>t(i,U.TRANSLATE_Z))}get xyAxisVisible(){const t=this.xyManipulation.someManipulator(i=>i.focused)||this.xyAxisManipulation.someManipulator(i=>i.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,i=this.xyManipulation;if((0,x.Z)("esri-mobile"))return;const a=[];i.forEachManipulator(s=>a.push(s)),t.forEachManipulator(s=>a.push(s));const n=()=>{const s=[];this.xyAxisVisible?(0,o.pC)(this._angleDeferred)&&(this.angle=this._angleDeferred()):t.forEachManipulator(r=>s.push(r.disableDisplay())),this._handles.remove(Xi),this._handles.add(s,Xi)};for(const s of a)this._handles.add(s.events.on("focus-changed",n));this._view.inputManager&&this._handles.add((0,f.gx)(()=>{var s;return null==(s=this._view.inputManager)?void 0:s.latestPointerType},n)),n()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator(i=>{i.interactive=!t&&this._interactive||i.grabbing})}static radiusForSymbol(t){const i=(0,o.pC)(t)&&"point-3d"===t.type&&t.symbolLayers;return i&&i.length>0&&i.some(a=>"icon"===a.type)?zi:70}}const Xi="disable-xy-axis-display";var Y;!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(Y||(Y={}));var mn=c(90585);class mi extends Re{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,U.TRANSLATE_XY)}createGraphicDragPipeline(t){return Xe(this._graphicState,t,i=>this.createDragPipeline(i),this._view.state.viewingMode)}createDragPipeline(t){const i=this._view,a=this._graphicState.graphic,n=(0,o.pC)(a.geometry)?a.geometry.spatialReference:null;return(0,V.Xd)(this._manipulator,(s,r,l,h,g)=>{const v=r.next((0,Tt._y)(g,i,a,n)).next((0,V.AN)()).next((0,V.zh)());t(s,v,l,h,g)})}_createManipulator(){this._manipulator=new mn.L({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})}}var vn=c(96064),Qe=c(22944),Ke=c(26777),ke=c(9773),Je=c(94009),Ge=c(23786),at=c(15572),jt=c(62980);let Dt=class extends jt.h{constructor(e){super(e),this.type="translate-graphic",this.distance=at.yP}};(0,p._)([(0,d.Cb)()],Dt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Dt.prototype,"distance",void 0),Dt=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],Dt);let Lt=class extends jt.h{constructor(e){super(e),this.type="translate-z",this.distance=at.yP}};(0,p._)([(0,d.Cb)()],Lt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Lt.prototype,"distance",void 0),Lt=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.TranslateZTooltipInfo")],Lt);let te=class extends jt.h{constructor(e){super(e),this.type="translate-vertex",this.distance=at.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,p._)([(0,d.Cb)()],te.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],te.prototype,"distance",void 0),(0,p._)([(0,d.Cb)()],te.prototype,"elevation",void 0),(0,p._)([(0,d.Cb)()],te.prototype,"area",void 0),(0,p._)([(0,d.Cb)()],te.prototype,"totalLength",void 0),te=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],te);var xe=c(71572);class _n{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class yn{constructor(t,i,a){this.dx=t,this.dy=i,this.allGraphics=a,this.type="graphic-move"}}class Qi{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}let Bt=class extends((0,De.p)(Wt.Z.EventedMixin(Qe.m))){constructor(e){super(e),this.graphics=new za.Z,this.enableZ=!0,this.tooltipOptions=new Zt.Z,this.type="move-3d",this._snappingPipeline=new Je.n,this._tooltip=null}initialize(){const{graphics:e,view:t}=this;this.own([e.on("change",()=>this._refreshManipulators()),(0,f.YP)(()=>this.tooltipOptions.enabled,i=>{this._tooltip=i?new Ge.u({view:t}):(0,o.SC)(this._tooltip)},f.tX)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,o.SC)(this._tooltip),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter(t=>(0,vn.P)(t)===Ri.e.SUPPORTED).map(t=>new fn(t));e.length&&(this._createManipulators(e),this._createVisualElements(e),this.handles.add(e.map(t=>this.view.trackGraphicState(t.state))),this._updateMoveManipulation(e))}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new mi({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator(a=>this.handles.add([a.events.on("immediate-click",n=>{this.emit("immediate-click",F(H({},n),{graphic:i.graphic})),n.stopPropagation()}),a.events.on("grab-changed",({action:n})=>{const{tooltipOptions:s,_tooltip:r}=this;(0,o.Wi)(r)||("focus"===n?r.info=new Dt({tooltipOptions:s}):r.clear())})])),this.handles.add(t.manipulationXY.createDragPipeline((a,n,s,r)=>this._buildDragEventPipeline(e,Y.XY,a,n,s,r)))}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new ue({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?ue.radiusForSymbol(e[0].graphic.symbol):70});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((n,s)=>{this.handles.add(n.events.on("immediate-click",r=>{t.zManipulation.hasManipulator(n)||1!==this.graphics.length||this.emit("immediate-click",F(H({},r),{graphic:this.graphics.getItemAt(0)})),r.stopPropagation()})),s===U.TRANSLATE_XY&&this.handles.add(n.events.on("focus-changed",({action:r})=>{const{tooltipOptions:l,_tooltip:h}=this;(0,o.Wi)(h)||("focus"===r?h.info=new Dt({tooltipOptions:l}):h.clear())})),s===U.TRANSLATE_Z&&this.handles.add(n.events.on("focus-changed",({action:r})=>{const{tooltipOptions:l,_tooltip:h}=this;(0,o.Wi)(h)||("focus"===r?h.info=new Lt({tooltipOptions:l}):h.clear())}))});const i=()=>this._updateMoveManipulation(e);for(const n of e)this.handles.add([n.state.on("changed",i),(0,f.YP)(()=>n.state.displaying,i)]);const a=e[e.length-1];this.handles.add(a.state.on("changed",()=>this._updateMoveManipulationAngle(a))),this.handles.add(t.createDragPipeline((n,s,r,l,h)=>this._buildDragEventPipeline(e,n,s,r,l,h),(0,w.RL)(a.graphic),(0,o.Wg)(a.graphic.geometry).spatialReference,a.graphic)),this._updateMoveManipulationAngle(a)}_createVisualElements(e){for(const t of e){const a=Fe({view:this.view,graphic:t.graphic,forEachManipulator:n=>{t.manipulationXY.forEachManipulator(n),this._moveManipulation.forEachManipulator(n)},onManipulatorsChanged:()=>(0,G.kB)()});(0,o.Wi)(a)||(t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof he&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this._updateMoveManipulation(e)}),(0,f.YP)(()=>t.state.isDraped,()=>this._updateMoveManipulation(e))]),this.handles.add(a))}}_updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>ji(e.graphic.geometry)}_updateMoveManipulation(e){const t=(0,Te.Tx)(0,0,0,this.view.spatialReference);let i=0,a=!1;const n=this._moveManipulation;for(const s of e){if(!s.state.displaying)continue;const r=s.state.graphic;this.enableZ&&(0,pe.c)(r)&&(a=!0);const l=s.geometryRepresentation instanceof he&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:(0,$.du)(this.view,r);(0,o.pC)(l)&&(t.x+=l.x,t.y+=l.y,t.z+=l.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,n.location=t,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=a):n.available=!1}_buildDragEventPipeline(e,t,i,a,n,s){const r=[],l=[];let h=null,g=null;const v=()=>{for(const m of r)m.dragging=!1;r.length=0,l.length=0,h=null,g=null,this._moveManipulation.interactive=!0};if(1===e.length&&t===Y.XY){const m=e[0].graphic;a=this._buildSnappingPipelineSteps(m,(0,w.RL)(m),a,n,s)}const _=a.next(m=>{if("start"===m.action){r.length=0,l.length=0;for(const b of e)b.dragging||!b.manipulationXY.hasManipulator(i)&&b.manipulationXY.grabbing||(r.push(b),l.push(b.graphic),b.dragging=!0);if(0!==l.length&&(this._moveManipulation.interactive=!1,h=(0,V.oq)(l,this.view.state.viewingMode),g=(0,V.QY)(l),this.emit("graphic-move-start",new _n(l)),this.destroyed))return null}return 0!==l.length?m:null}).next(m=>h(m)).next(m=>this._updateMoveTooltip(m,t,e)).next(m=>{switch(m.action){case"start":case"update":if(m.translationX||m.translationY||m.translationZ){const b=this.view.toScreen(m.mapStart),M=this.view.toScreen(m.mapEnd);if(this.emit("graphic-move",new yn(M.x-b.x,M.y-b.y,l)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Qi(l)),this.destroyed)return null;v()}});return n.next(m=>g(m)).next(()=>{if(this.emit("graphic-move-stop",new Qi(l)),this.destroyed)return null;v()}),_}_updateMoveTooltip(e,t,i){const{tooltipOptions:a,_tooltip:n}=this;if((0,o.Wi)(n))return e;if(n.clear(),t===Y.XY||t===Y.XY_AXIS)if("end"===e.action)n.info=new Dt({tooltipOptions:a});else{const r=(0,tt.GQ)(e.mapStart,e.mapEnd,0===i.length?"absolute-height":i[0].state.isDraped?"on-the-ground":"absolute-height");(0,o.pC)(r)&&(n.info=new Dt({tooltipOptions:a,distance:r}))}return t===Y.Z&&("end"===e.action?n.info=new Lt({tooltipOptions:a}):(0,o.yw)((0,xe._e)(e.mapStart,e.mapEnd),s=>{n.info=new Lt({tooltipOptions:a,distance:s})})),e}_buildSnappingPipelineSteps(e,t,i,a,n){const s=e.geometry;if((0,o.Wi)(s)||"point"!==s.type&&"mesh"!==s.type)return i;const r=("point"===s.type?s:s.anchor).clone(),l=new ke.N({elevationInfo:t,pointer:n,editGeometryOperations:Ke.c.fromGeometry(r,this.view.state.viewingMode),visualizer:new Ae._,excludeFeature:e}),h=this.snappingManager;return i.next(g=>(r.z=(0,w.vQ)(this.view,r,(0,w.RL)(e),{mode:"absolute-height",offset:0}),F(H({},g),{snapOrigin:l.coordinateHelper.pointToVector(r)}))).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:h,cancel:a,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return{tooltip:this._tooltip}}};(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Bt.prototype,"view",void 0),(0,p._)([(0,d.Cb)()],Bt.prototype,"graphics",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Bt.prototype,"enableZ",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Zt.Z})],Bt.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Bt.prototype,"snappingManager",void 0),(0,p._)([(0,d.Cb)()],Bt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Bt.prototype,"updating",null),Bt=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Bt);class fn{constructor(t){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new bt({graphic:t})}get graphic(){return this.state.graphic}}var Ki=c(89557),Mn=c(55214),St=c(90014),ki=c(86606),vi=c(86190);function Ji(e,t,i){return new vi.A(e,"on-the-ground"===i.mode?vi.v.XY:vi.v.XYZ,t,0)}function $i(e,t,i){const a=(0,A.c)();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;const n=qi(e,t,(0,St.mJ)(i.plane)),s=qi(e,t,i.edgeDirection);if((0,o.Wi)(n)||(0,o.Wi)(s))return null;const r=(0,u.f)((0,A.c)(),n,s);return(0,St.Yq)(a,r,(0,St.Ue)())}function qi(e,t,i){const a=(0,Te.Tx)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),n=(0,A.c)(),s=(0,A.c)();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(a,s)?(0,u.r)(s,n,s):null}var ta=c(85112),Ft=c(96926);let Ce=class extends jt.h{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=at.yP}};(0,p._)([(0,d.Cb)()],Ce.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Ce.prototype,"distance",void 0),Ce=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],Ce);var xn=c(30174),Cn=c(63656);let et=class extends(Wt.Z.EventedMixin(De.r)){constructor(e){super(e),this._vertexManipulatorMaterial=(0,$.EA)(y.colorToVec4(y.reshapeManipulators.vertex.color),y.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,$.qJ)(y.colorToVec4(y.reshapeManipulators.vertex.outlineColor),y.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,$.qJ)(y.colorToVec4(y.reshapeManipulators.vertex.hoverOutlineColor),y.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,$.EA)(y.colorToVec4(y.reshapeManipulators.edge.color),y.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,$.qJ)(y.colorToVec4(y.reshapeManipulators.edge.outlineColor),y.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=(0,$.EA)(y.colorToVec4(y.reshapeManipulators.edgeOffset.color),y.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,$.EA)(y.colorToVec4(y.reshapeManipulators.edgeOffset.hoverColor),y.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=(0,$.EA)(y.colorToVec4(y.reshapeManipulators.selected.color),y.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,$.qJ)(y.colorToVec4(y.reshapeManipulators.selected.outlineColor),y.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,$.qJ)(y.colorToVec4(y.reshapeManipulators.selected.hoverOutlineColor),y.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new Me.Z,this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=K.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new Je.n,this._snappingPipelineHandle=new Je.n,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new bt({graphic:e});this._tooltip=new Ge.u({view:t}),this.own([(0,f.YP)(()=>i.displaying,a=>{for(const n of this._manipulatorInfos)n.manipulator.available=a}),(0,f.YP)(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:a,enabled:n,edgeOffsetEnabled:s})=>{(0,o.pC)(a)&&(a.visible=n,a.edgeDistance=s?"far":"default")},f.nn),(0,f.gx)(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),f.nn),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=(0,o.SC)(this._segmentLabels),this._tooltip=(0,o.SC)(this._tooltip),this._editGeometryOperations=(0,o.SC)(this._editGeometryOperations),this._moveManipulation=(0,o.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,o.SC)(this._graphicMoveManipulation),this._manipulatorHandles=(0,o.SC)(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}get inputGeometry(){return(0,o.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter(t=>t.manipulator.selected&&"vertex"===t.type);this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._moveManipulation=(0,o.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,o.SC)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if((0,o.Wi)(this._editGeometryOperations))return;const e=(0,w.RL)(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return(0,o.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return(0,o.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if((0,o.Wi)(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return(0,o.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if((0,o.Wi)(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return(0,o.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),this._createManipulators()}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),(0,o.Wi)(e)||((0,o.SC)(this._editGeometryOperations),this._editGeometryOperations=Ke.c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(),(0,o.SC)(this._segmentLabels),this._segmentLabels=new Ue({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,w.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const a=[],n=this._manipulatorInfos.some(r=>"vertex"===r.type&&r.manipulator.selected),s=e===Ee.SELECTED_OR_ALL&&n;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.grabbing||s&&!r.manipulator.selected||a.push(r),i++);if(0===a.length)return t;if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(K.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(K.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)"vertex"===t.type&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(K.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const n=[];for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&n.push(s);this._moveVertices(n,e,Ft.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case K.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case K.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case K.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case K.MOVING:switch(this._reshapeEventState){case K.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case K.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case K.RESHAPING:switch(this._reshapeEventState){case K.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case K.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){const{graphic:t,handles:i,tool:a,view:n}=this,s=this._graphicState;if(this._graphicMoveManipulation=new mi({tool:a,view:n,graphicState:s}),this.enableMoveGraphic){let h=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((g,v,_)=>{v.next(m=>this._trackNumDragging(m)).next(m=>("start"===m.action&&(h=(0,o.Wg)(this._editGeometryOperations).createUndoGroup()),m)).next(m=>this._perGraphicManipulatorDragAction(Ee.ALL,m)).next(m=>(this._updateTranslateGraphicTooltip(Y.XY,m),m)).next(m=>{"end"===m.action&&(this._tooltip.clear(),h=(0,o.hw)(h))}),_.next(this._cancelDragOperation(()=>h=(0,o.hw)(h)))}))}else this._graphicMoveManipulation.forEachManipulator(h=>{h.grabbable=!1,h.cursor=null});this._graphicMoveManipulation.forEachManipulator(h=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(h,!1),h.events.on("immediate-click",g=>{this._manipulatorInfos.some(v=>v.manipulator.selected)?this._clearSelection():this.emit("immediate-click",F(H({},g),{graphic:this.graphic})),g.stopPropagation()})])),this._moveManipulation=new ue({tool:a,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&(0,pe.c)(t),snapToScene:!1,radius:ue.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((h,g)=>{i.add([this._watchAndUpdateGrabState(h,!1),h.events.on("immediate-click",v=>{this._moveManipulation.zManipulation.hasManipulator(h)||this._manipulatorInfos.some(_=>_.manipulator.selected)||this.emit("immediate-click",F(H({},v),{graphic:t})),v.stopPropagation()})]),i.add(h.events.on("focus-changed",({action:v})=>{"focus"===v&&this._tooltipOptions.enabled?this._updateTranslateTooltip(g===U.TRANSLATE_Z?Y.Z:Y.XY):this._tooltip.clear()}))}),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const r=(0,o.Wg)(t.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline((h,g,v,_,m)=>{const b=v.next(M=>this._trackNumDragging(M)).next(M=>{const z=this._manipulatorInfos.filter(N=>"vertex"===N.type&&N.manipulator.selected);return F(H({},M),M.manipulatorType===U.TRANSLATE_XY&&1===z.length?{info:z[0],snapOrigin:z[0].handle.pos}:{info:null})}).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:M=>!!M.info,cancel:_,snappingManager:a.snappingManager,snappingContext:new ke.N({editGeometryOperations:(0,o.Wg)(this._editGeometryOperations),elevationInfo:e,pointer:m,excludeFeature:t,visualizer:new Ae._}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next((0,V.AN)()).next(M=>this._perGraphicManipulatorDragAction(Ee.SELECTED_OR_ALL,M)).next(M=>(this._updateTranslateTooltip(h,M),M));return _.next(this._cancelDragOperation()),b},e,r,t),(0,f.YP)(()=>null==s?void 0:s.displaying,()=>{this._updateMoveManipulationPosition()},f.nn),s.on("changed",()=>this._updateMoveManipulationPosition()),(0,f.YP)(()=>null==s?void 0:s.isDraped,h=>{const g="align-move-manipulation";h?i.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),g):i.remove(g)},f.nn)]),this._updateMoveManipulationPosition();const l=Fe({view:n,graphic:t,forEachManipulator:h=>{if(!this.destroyed){(0,o.pC)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(h);for(const g of this._manipulatorInfos)h(g.manipulator,U.TRANSLATE_XY);this._moveManipulation.forEachManipulator(h)}},onManipulatorsChanged:h=>this.on("manipulators-changed",h)});(0,o.pC)(l)&&(this._outlineVisualElement=l.visualElement instanceof he?l.visualElement:null),(0,o.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",()=>{s.isDraped||this._updateMoveManipulationPosition()}),(0,f.YP)(()=>s.isDraped,()=>this._updateMoveManipulationPosition())]),this._manipulatorHandles.add(l)}_createEdgeOffsetManipulator(e,t=(0,w.RL)(this.graphic)){const i=y.reshapeManipulators.edgeOffset,a=i.size/2,n=a+i.collisionPadding;if((0,o.Wi)(this._edgeOffsetManipulatorGeometryInside)||(0,o.Wi)(this._edgeOffsetManipulatorGeometryOutside)){const m=a/n,b=m*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=mt.Z.createExtrudedTriangle(b,m/2,m/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=mt.Z.createExtrudedTriangle(-b,m/2,m/2,i.height,-i.offset)}const r=new wt.Z({view:this.view,renderObjects:[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:R.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:R.Q9.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:R.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:R.Q9.Focused}],elevationInfo:"on-the-ground"!==t.mode||(0,ki.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:n,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:(0,A.f)(0,0,1)},collisionPriority:1}),l=new wt.Z({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),h={manipulator:r,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:l,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(h,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(h);const g=this._getManipulatorInfoFromHandle(h.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(h)),v=this._getManipulatorInfoFromHandle(h.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(h));h.locationUpdateHandle=(0,G.AL)([g,v]),this._manipulatorHandles.add(h.locationUpdateHandle,r),this._manipulatorHandles.add([this._watchAndUpdateGrabState(r,!0),this._watchAndUpdateGrabState(l,!0)],r),this._manipulatorHandles.add((0,V.Xd)(r,this._createEdgeOffsetPipeline(h,t)),r),this._manipulatorHandles.add((0,V.Xd)(l,(m,b,M,z)=>{if("touch"===z)this._createEdgeOffsetPipeline(h,t)(m,b,M);else if(this.enableMoveGraphic){const N=this.graphic,W=(0,o.pC)(N.geometry)?N.geometry.spatialReference:null;b.next(B=>this._trackNumDragging(B)).next((0,V.kY)(this.view,m.elevationAlignedLocation)).next((0,Tt.G)(this.view,m.elevationAlignedLocation,t,W,N)).next((0,V.zh)()).next((0,V.AN)()).next(B=>this._perGraphicManipulatorDragAction(Ee.ALL,B)).next(B=>(this._updateTranslateGraphicTooltip(Y.XY,B),B)).next(B=>{"end"===B.action&&this._tooltip.clear()}),M.next(this._cancelDragOperation())}}),r);const _=m=>{this._manipulatorInfos.some(b=>b.manipulator.selected)?this._clearSelection():this.emit("immediate-click",F(H({},m),{graphic:this.graphic})),m.stopPropagation()};return this._manipulatorHandles.add([r.events.on("immediate-click",_),l.events.on("immediate-click",_),r.events.on("focus-changed",({action:m})=>{const b=this._tooltipOptions;"focus"===m&&b.enabled?this._tooltip.info=new Ce({tooltipOptions:b}):this._tooltip.clear()})],r),this._manipulatorInfos.push(h),this.manipulators.add(r),this.manipulators.add(l),this.emit("manipulators-changed"),h}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,n=()=>{(0,o.hw)(e.visibilityHandle);const s=function Sn(e,t,i){const a=i.projectToRenderScreen(e,(0,T.J$)()),n=i.projectToRenderScreen(t,(0,T.J$)());return(0,o.pC)(a)&&(0,o.pC)(n)?(0,u.p)((0,u.b)(a,a,n)):0}(this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||s)&&(i.grabbable=!s,a.grabbable=!s,e.visibilityHandle=(0,G.AL)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",n),a.events.on("focus-changed",n),{remove:()=>{(0,o.hw)(e.visibilityHandle),this.manipulators.remove(a)}}],i),n()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=(0,o.Wg)(this._editGeometryOperations).data.coordinateHelper,i=$i(this.view,e.manipulator.elevationAlignedLocation,Ji(t,e.handle,(0,o.Wg)(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,s=(0,o.pC)(i)?function bn(e,t,i){const a=(0,St.mJ)(e),n=(0,u.r)((0,A.c)(),t,i),s=(0,u.f)((0,A.c)(),n,a),r=(0,u.f)((0,A.c)(),n,s);return(0,be.f)(n[0],n[1],n[2],0,s[0],s[1],s[2],0,r[0],r[1],r[2],0,0,0,0,1)}(i,a,n):be.I;e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const r=(0,u.l)((0,u.b)($e,a,n))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-r,0,0],[r,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,a,n)=>{this._clearSelection();const{step:s,cleanup:r}=this._initializeEdgeOffset(e,t);a.next(l=>this._trackNumDragging(l)).next((0,V.kY)(this.view,i.elevationAlignedLocation)).next(s).next((0,Tt.bB)(this.view)).next((0,Tt.zP)(this.view,(0,o.Wg)(this._editGeometryOperations).data.spatialReference)).next((0,V.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next(l=>{"end"===l.action&&r()}),n.next(l=>(r(),l)).next(l=>(this._tooltip.clear(),l)).next(this._cancelDragOperation())}}_initializeEdgeOffset(e,t){const i=(0,o.Wg)(this._editGeometryOperations),a=Ji(i.data.coordinateHelper,e.handle,t),n=i.createUndoGroup(),s=$i(this.view,e.manipulator.elevationAlignedLocation,a);a.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),a.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);const r=()=>new Mn.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:(0,o.Wg)(this._editGeometryOperations).data.spatialReference}),l=new he({view:this.view,isDraped:this._graphicState.isDraped,geometry:r(),elevationInfo:e.elevationInfo,width:y.visualElements.lineGraphics.outline.width,color:y.colorToVec4(P.main),attached:!0});let h;const g=()=>{this._cleanEdgeOffsetCollapsedEdges(e),h=(0,o.hw)(h)},v=this.on("undo",g);return h=(0,G.AL)([(0,G.ed)(l),(0,f.YP)(()=>this._graphicState.isDraped,_=>l.isDraped=_),this._graphicState.on("changed",()=>l.geometry=r()),n,v]),{step:_=>(0,o.Wi)(a)||(0,o.Wi)(s)?(g(),null):F(H({},_),{operation:a,plane:s}),cleanup:g}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||(0,o.Wi)(t.operation))return t;this._updateEventState(K.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=t;return(i||a||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;if((0,o.Wi)(t)||(0,o.Wi)(i))return e;const a=t.signedDistanceToPoint(i);return F(H({},e),{signedDistance:a})}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:a}=e,n=this._tooltip,s=this._tooltipOptions;if(!s.enabled||(0,o.Wi)(i))return n.clear(),e;const r=function En(e,t,i,a,n){if(e){const s=n.toXYZ(n.pointToVector(i)),r=(0,St.nF)(a,s,S.WM.get()),l=(0,Cn.FB)(r,s,n.spatialReference);if((0,o.pC)(l))return(0,at.yG)(l.value*Math.sign(t),l.unit)}return(0,at.yG)(t*(0,I.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,-i,t,a.plane,(0,o.Wg)(this._editGeometryOperations).data.coordinateHelper);return(0,o.Wi)(n.info)||"reshape-edge-offset"!==n.info.type?n.info=new Ce({tooltipOptions:s,distance:r}):n.info.distance=r,e}}_cleanEdgeOffsetCollapsedEdges(e){var h,g;const t=null==(h=e.handle.leftVertex.leftEdge)?void 0:h.leftVertex,i=e.handle.leftVertex,a=null==(g=e.handle.rightVertex.rightEdge)?void 0:g.rightVertex,n=e.handle.rightVertex,s=(0,o.Wg)(this._editGeometryOperations).data.coordinateHelper,r=1e-6,l=[];t&&s.distance(t.pos,i.pos)<r&&l.push(this._getManipulatorInfoFromHandle(i)),(s.distance(i.pos,n.pos)<r||a&&s.distance(a.pos,n.pos)<r)&&l.push(this._getManipulatorInfoFromHandle(n)),l.length&&this._removeVertices(l)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=(0,w.RL)(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if((0,o.Wi)(this._vertexManipulatorGeometry)||(0,o.Wi)(this._vertexManipulatorOutlineGeometry)){const{size:r,outlineSize:l}=this._computeVertexManipulatorSizeAndOutline(y.reshapeManipulators.vertex);this._vertexManipulatorGeometry=mt.Z.createSphereGeometry(r,16,16),this._vertexManipulatorOutlineGeometry=mt.Z.createSphereGeometry(l,16,16)}if((0,o.Wi)(this._edgeManipulatorGeometry)||(0,o.Wi)(this._edgeManipulatorOutlineGeometry)){const{size:r,outlineSize:l}=this._computeVertexManipulatorSizeAndOutline(y.reshapeManipulators.edge);this._edgeManipulatorGeometry=mt.Z.createSphereGeometry(r,16,16),this._edgeManipulatorOutlineGeometry=mt.Z.createSphereGeometry(l,16,16)}const i=(0,o.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Vt.Vertex|R.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:Vt.Vertex|R.Q9.Unfocused|R.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Vt.Vertex|R.Q9.Focused|R.Q9.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:R.Q9.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:R.Q9.Selected|R.Q9.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:R.Q9.Selected|R.Q9.Focused}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Vt.Edge|R.Q9.Focused|R.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Vt.Edge|R.Q9.Focused|R.Q9.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:Vt.Edge|R.Q9.Unfocused|R.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:Vt.Edge|R.Q9.Unfocused|R.Q9.Unselected});const a=new wt.Z({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(a,e,t);const n="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(n),this.manipulators.add(a),this._updateManipulatorPosition(n),"edge"===n.type){const r=this._getManipulatorInfoFromHandle(n.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(n)),l=this._getManipulatorInfoFromHandle(n.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(n));n.locationUpdateHandle=(0,G.AL)([r,l]),this._manipulatorHandles.add(n.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const s=(0,V.Xd)(a,(r,l,h,g)=>{let v=null;l.next(_=>this._trackNumDragging(_)).next(_=>{if("start"===_.action&&(v=(0,o.Wg)(this._editGeometryOperations).createUndoGroup()),"edge"===n.type){const m=this._splitEdgeManipulator(n);return F(H({},_),{info:m,snapOrigin:m.handle.pos})}return F(H({},_),{info:n,snapOrigin:n.handle.pos})}).next((0,V.kY)(this.view,r.elevationAlignedLocation)).next((0,Tt.VG)(this.view,this.graphic,r.elevationAlignedLocation,r.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:h,snappingManager:this.tool.snappingManager,snappingContext:new ke.N({editGeometryOperations:(0,o.Wg)(this._editGeometryOperations),elevationInfo:t,pointer:g,excludeFeature:this.graphic,visualizer:new Ae._}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((0,V.AN)()).next(_=>{this._perVertexManipulatorDragAction(_),"end"===_.action&&(v=(0,o.hw)(v)),this._updateTranslateVertexTooltip(r,Y.XY,_)}),h.next(this._cancelDragOperation(()=>v=(0,o.hw)(v)))});return this._manipulatorHandles.add([s,a.events.on("immediate-click",r=>this._manipulatorClickCallback(r,n)),a.events.on("select-changed",()=>{n.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),a.events.on("focus-changed",({action:r})=>{"focus"===r&&"edge"!==n.type?this._updateTranslateVertexTooltip(a,Y.XY):this._tooltip.clear()})],a),this.emit("manipulators-changed"),n}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=(0,o.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,(0,o.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case K.NONE:break;case K.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case K.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(K.NONE)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Vt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=y.reshapeManipulators.vertex.size/2+y.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=(0,o.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=Vt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=y.reshapeManipulators.edge.size/2+y.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||(0,ki.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>this._onGrabStateChanged(e,t,i.action,i.pointerType))}_onGrabStateChanged(e,t,i,a="mouse"){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(K.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(n=>{n.manipulator.interactive=!this._numGrabbing&&(0,o.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in n&&(n.edgeManipulator.interactive=!this._numGrabbing)}),(0,o.Wg)(this._graphicMoveManipulation).forEachManipulator(n=>n.interactive=!this._numGrabbing))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(e.manipulator.grabbing&&this._onGrabStateChanged(e.manipulator,!1,"end"),this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=(0,o.Wg)(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Pe),e.manipulator.grabbing&&(0,o.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if((0,o.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const n=i.location,s=a.location,r=.5;e.manipulator.location=(0,Te.Tx)(n.x+r*(s.x-n.x),n.y+r*(s.y-n.y),n.hasZ&&s.hasZ?0:void 0,t.data.spatialReference)}else(0,u.h)($e,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=$e}}_splitEdgeManipulator(e,t=.5){const i=(0,o.Wg)(this._editGeometryOperations),a=(0,o.Wg)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const n=(0,w.RL)(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(a)):(s=e,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,Y.XY),this._updateSelection(e.manipulator);const r=this._updateEventState(K.RESHAPING),l=i.data.coordinateHelper.vectorToArray(s.handle.pos),h=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:h,vertexIndex:(0,o.Wg)(a.index)}],added:l}),r&&this._updateEventState(K.NONE),s}_updateMoveManipulationPosition(){const e=(0,u.s)($e,0,0,0);let t=0,i=!1,a=null,n=null;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected?(t++,(0,u.a)(e,e,s.manipulator.renderLocation),(0,o.Wi)(a)||s.selectedIndex>a.selectedIndex?(n=a,a=s):((0,o.Wi)(n)||s.selectedIndex>n.selectedIndex)&&(n=s)):i=!0);if(0!==t){const s=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=s,this._moveManipulation.xyAxisManipulation.available=s,this._moveManipulation.zManipulation.available=s&&this.enableZVertex&&(0,pe.c)(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=s&&1!==t}else{const s=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=s,this._moveManipulation.xyAxisManipulation.available=s,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=s,this._moveManipulation.zManipulation.available=s&&this.enableZShape&&(0,pe.c)(this.graphic)}if(0!==t){let s=0;if((0,o.pC)(a)){const r=a.handle.pos,l=(0,o.pC)(n)?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,h=(0,o.Wi)(n)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;l&&h?this._moveManipulation.xyAxisManipulation.available=!1:l?s=ea(l,r):h&&(s=ea(r,h))}this._moveManipulation.angle=s,this._moveManipulation.radius=zi}else this._moveManipulation.angleDeferred=()=>ji((0,o.Wg)(this.graphic.geometry)),this._moveManipulation.radius=ue.radiusForSymbol(this.graphic.symbol);0!==t&&i?((0,u.g)(e,e,1/t),Pe.spatialReference=(0,o.Wg)(this._editGeometryOperations).data.spatialReference,Pe.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Pe),this._moveManipulation.elevationAlignedLocation=Pe):(0,o.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,o.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,$.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=(0,o.Wg)(this._editGeometryOperations);for(const a of e)if("vertex"===a.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const n=(0,o.Wg)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);n&&this._createVertexOrEdgeManipulator(n)}if(t.length>0){const a=t.map(s=>{const r=i.data.components.indexOf(s.component);return{coordinates:i.data.coordinateHelper.vectorToArray(s.pos),componentIndex:r,vertexIndex:(0,o.Wg)(s.index)}});this.outputGeometry=i.data.geometry;const n=this._updateEventState(K.RESHAPING);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:a.map(s=>s.coordinates),vertices:a}),this.destroyed)||n&&(this._updateEventState(K.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?Ft.O.NEW_STEP:Ft.O.ACCUMULATE_STEPS)){const a=(0,o.Wg)(this._editGeometryOperations);a.moveVertices(e.map(n=>n.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const n of e)this._updateManipulatorPosition(n)}_offsetEdge(e,t){if((0,o.Wi)(t.operation)||(0,o.Wi)(t.signedDistance))return;const i=(0,o.Wg)(this._editGeometryOperations),a=t.operation.clone();a.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===ta.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===ta.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter(a=>"vertex"===a.type&&a.manipulator.selected);1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const a=e===Y.Z,n=a?new Lt({tooltipOptions:i}):new Dt({tooltipOptions:i});if((0,o.pC)(t)&&"end"!==t.action){const{mapStart:s,mapEnd:r}=t,l=a?(0,xe._e)(s,r):(0,tt.GQ)(s,r,this._graphicState.isDraped?"on-the-ground":"absolute-height");n.distance=(0,o.pC)(l)?l:at.yP}this._tooltip.info=n}_updateTranslateVertexTooltip(e,t,i){const a=this._tooltipOptions;if(!a.enabled)return;const n=t===Y.Z,s=new te({tooltipOptions:a});if((0,o.pC)(i)&&"end"!==i.action){const{mapStart:h,mapEnd:g}=i,v=n?(0,xe._e)(h,g):(0,tt.GQ)(h,g,this._graphicState.isDraped?"on-the-ground":"absolute-height");s.distance=(0,o.pC)(v)?v:at.yP}const r=(0,xe.g1)(e.elevationAlignedLocation);(0,o.pC)(r)&&(s.elevation=H({mode:"absolute-height"},r));const{geometry:l}=this.graphic;(0,o.pC)(l)&&!n&&(s.area="polygon"===l.type?(0,xn.M)(l,this._graphicState.isDraped):null,s.totalLength="polyline"===l.type?(0,tt.Ul)(l,this._graphicState.isDraped?"on-the-ground":"absolute-height"):null),this._tooltip.info=s}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function ea(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,p._)([(0,d.Cb)()],et.prototype,"_segmentLabels",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],et.prototype,"tool",void 0),(0,p._)([(0,d.Cb)()],et.prototype,"_tooltip",void 0),(0,p._)([(0,d.Cb)()],et.prototype,"inputGeometry",null),(0,p._)([(0,d.Cb)()],et.prototype,"outputGeometry",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],et.prototype,"updating",null),(0,p._)([(0,d.Cb)()],et.prototype,"manipulators",null),(0,p._)([(0,d.Cb)()],et.prototype,"view",null),(0,p._)([(0,d.Cb)()],et.prototype,"graphic",null),(0,p._)([(0,d.Cb)()],et.prototype,"enableZShape",null),(0,p._)([(0,d.Cb)()],et.prototype,"enableZVertex",null),(0,p._)([(0,d.Cb)()],et.prototype,"enableMoveGraphic",null),(0,p._)([(0,d.Cb)()],et.prototype,"enableMidpoints",null),(0,p._)([(0,d.Cb)()],et.prototype,"enableEdgeOffset",null),(0,p._)([(0,d.Cb)()],et.prototype,"_labelOptions",null),(0,p._)([(0,d.Cb)()],et.prototype,"_tooltipOptions",null),et=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],et);const Pe=(0,Te.Tx)(0,0,null,null),$e=(0,A.c)();var Vt,K,Ee;(function(e){e.Vertex=R.jg.Custom1,e.Edge=R.jg.Custom2})(Vt||(Vt={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(K||(K={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Ee||(Ee={}));let ot=class extends(Wt.Z.EventedMixin(Qe.m)){constructor(e){super(e),this._handles=new Me.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new je.Z,this.tooltipOptions=new Zt.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new et({tool:this});this.own([e.on("reshape",t=>{"reshape"===t.type&&this._onReshapeGeometryChanged(),this.emit("reshape",t)}),e.on("move",t=>{"move"===t.type&&this._onReshapeGeometryChanged(),this.emit("move",t)}),e.on("vertex-add",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)}),e.on("vertex-remove",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)}),e.on("immediate-click",t=>this.emit("immediate-click",t)),this.view.on("pointer-down",["Shift"],t=>{t.stopPropagation()}),(0,f.YP)(()=>this.graphic,()=>this._updateGraphic(),f.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,o.SC)(this._handles),this._reshapeOperation=(0,o.SC)(this._reshapeOperation)}get updating(){var e,t;return null!=(t=null==(e=this._reshapeOperation)?void 0:e.updating)&&t}_updateGeometry(){const e=(0,Ki.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,o.pC)(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,Ki.P)(this.graphic)!==Ri.e.SUPPORTED)return;const e=(0,f.YP)(()=>{var t;return null==(t=this.graphic)?void 0:t.geometry},()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()},f.Z_);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){(0,o.Wi)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canUndo(){var e;return null!=(e=this._reshapeOperation.canUndo)&&e}undo(){(0,o.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,o.pC)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e;return null!=(e=this._reshapeOperation.canRedo)&&e}redo(){(0,o.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,o.pC)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,p._)([(0,d.Cb)()],ot.prototype,"_reshapeOperation",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ot.prototype,"view",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],ot.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ot.prototype,"enableZShape",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ot.prototype,"enableZVertex",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ot.prototype,"enableMoveGraphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ot.prototype,"enableMidpoints",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ot.prototype,"enableEdgeOffset",void 0),(0,p._)([(0,d.Cb)()],ot.prototype,"type",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:je.Z})],ot.prototype,"labelOptions",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Zt.Z})],ot.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],ot.prototype,"snappingManager",void 0),(0,p._)([(0,d.Cb)()],ot.prototype,"updating",null),(0,p._)([(0,d.Cb)()],ot.prototype,"automaticManipulatorSelection",void 0),ot=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],ot);var On=c(49672),_i=c(59617),An=c(23719),wn=c(50618),Ie=c(70562);let Xt=class extends jt.h{constructor(e){super(e),this.type="transform-rotate",this.rotationType="geographic"}};(0,p._)([(0,d.Cb)()],Xt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"rotation",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"rotationPrecision",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"orientation",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"orientationPrecision",void 0),(0,p._)([(0,d.Cb)()],Xt.prototype,"rotationType",void 0),Xt=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Xt);let ee=class extends jt.h{constructor(e){super(e),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};(0,p._)([(0,d.Cb)()],ee.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],ee.prototype,"scale",void 0),(0,p._)([(0,d.Cb)()],ee.prototype,"size",void 0),(0,p._)([(0,d.Cb)()],ee.prototype,"sizeUnit",void 0),(0,p._)([(0,d.Cb)()],ee.prototype,"sizePrecision",void 0),ee=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],ee);let Rt=class extends jt.h{constructor(e){super(e),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var Z,Oe;(0,p._)([(0,d.Cb)()],Rt.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"orientation",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"orientationEnabled",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"orientationPrecision",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"rotationType",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"size",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"sizeUnit",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"sizeEnabled",void 0),(0,p._)([(0,d.Cb)()],Rt.prototype,"sizePrecision",void 0),Rt=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Rt),function(e){e.ScaleIn=R.jg.Custom2,e.ScaleOut=R.jg.Custom3,e.RotateLeft=R.jg.Custom4,e.RotateRight=R.jg.Custom5,e.Unlocked=R.jg.Custom7,e.DelayedFocused=R.jg.Custom8,e.TouchInput=R.jg.Custom12}(Z||(Z={}));class Tn{constructor({adapter:t,tooltipOptions:i,mode:a,tool:n}){this.mode=null,this._handles=new Me.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new Wt.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>(0,o.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=n,this.mode=a,this.adapter=t,this._tooltipOptions=i,this._tooltip=new Ge.u({view:n.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,f.gx)(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),f.nn))}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}destroy(){(0,o.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,o.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,o.SC)(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const i=(0,wn.A)({update:({deltaTime:a})=>{t.update(a)&&this.cancelActiveAnimation()}});this._activeAnimation=F(H({},t),{frameTask:i})}cancelActiveAnimation(){(0,o.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,o.SC)(this._activeAnimation))}forEachManipulator(t){t(this._ringManipulator,U.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const i=this.tool.graphicState.graphic,a=(0,V.Xd)(t,(n,s,r)=>{this._scaleRotateDragData=null;const l=this.adapter.startInteraction(),h={mode:"none",origin:(0,A.a)(n.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=h,this._updateDragState();const g=S.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(n.renderLocation,g),s.next((0,Tt._N)(this.tool.view,(0,St.Yq)(n.renderLocation,g,(0,St.Ue)()))).next(v=>{const _=(0,St.mJ)(v.plane),m=(0,$.Gd)(v.renderStart,v.renderEnd,h.origin,_),b=An.Q4.shortestSignedDiff(h.angle,m);h.angleDir=(0,At.uZ)(h.angleDir+b,-.3,.3),h.angle=m;const M=function Dn(e,t){const i=(0,u.b)(S.WM.get(),t.renderStart,e.origin),a=(0,u.b)(S.WM.get(),t.renderEnd,e.origin),n=(0,u.l)(i),s=(0,u.l)(a);return 0===n?0:s/n}(h,v);if(h.scaleDir=(0,At.uZ)(h.scaleDir+(M-this.adapter.scale),-.2,.2),this._onScaleChanged(),"none"===h.mode){const N=this.mode||function Rn(e,t,i,a){const{renderStart:n,renderEnd:s}=e,r=qe(n,a,S.WM.get()),l=qe(s,a,S.WM.get());if((0,u.d)(r,l)<100)return null;const h=(0,u.b)(S.WM.get(),n,i),g=(0,u.f)(S.WM.get(),h,(0,St.mJ)(t)),v=n,_=(0,u.a)(S.WM.get(),v,g),m=qe(i,a,S.WM.get()),b=r,M=qe(_,a,S.WM.get()),z=(0,u.b)(S.WM.get(),M,b),N=(0,u.b)(S.WM.get(),r,m),W=(0,Ie.re)(b,z),B=(0,Ie.re)(m,N);return(0,Ie.Jk)(W,l)<(0,Ie.Jk)(B,l)?"rotate":"scale"}(v,v.plane,h.origin,this.tool.view.state.camera);if((0,o.pC)(N)){switch(N){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:i,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:i,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}h.mode=N}}switch(h.mode){case"rotate":l.state.angle=h.initialAngle+m;break;case"scale":l.state.scale=M,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),v.action){case"start":case"update":switch(h.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:i,angle:(0,At.BV)(h.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:i,xScale:M,yScale:M})}break;case"end":switch(h.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:(0,At.BV)(h.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:M,yScale:M})}}return"end"===v.action&&(this.startAnimation(ia(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),l.done()),v}).next(this._updateTooltipPipelineStep(h)),r.next(()=>{if(l.cancel(),(0,o.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:1,yScale:1})}this.startAnimation(ia(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([a,t.events.on("focus-changed",n=>{"focus"===n.action?this.startAnimation(function Gn(e,t){let i=0,a=null;const n=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=n,i=0,t()},update:s=>(i+=s,!a()||i>200?Oe.STOP:Oe.CONTINUE),destroy:()=>{e.getFocused=a,t()}}}(this,()=>this._updateDelayedFocusedState())):this._updateDelayedFocusedState()}),t.events.on("immediate-click",n=>{n.stopPropagation()}),(0,f.YP)(()=>{var n;return null==(n=this.tool.graphicState)?void 0:n.displaying},n=>this._ringManipulator.available=n,f.nn)])}_updateTooltipPipelineStep(t){return i=>{const a=this._tooltipOptions;if(!a.enabled)return i;if("end"===i.action)return this._updateFocusTooltip(),i;const n=this._tooltip,s=this._tooltipOptions.visualVariables,r=(0,o.pC)(s)?s.size:null,l=(0,o.pC)(s)?s.rotation:null;switch(t.mode){case"scale":n.info=new ee({tooltipOptions:a,scale:{value:this.adapter.scale},size:(0,at.yG)((0,o.Pt)(this.adapter.size,-1),"meters"),sizeUnit:(0,o.pC)(r)?r.unit:null,sizePrecision:(0,o.pC)(r)?ti(r.valueType):null});break;case"rotate":{const h=(0,o.pC)(l)?ti(l.valueType):null,g=(0,o.pC)(l)?l.rotationType:"geographic";n.info=new Xt({tooltipOptions:a,rotation:(0,at.GJ)((0,o.Pt)(-this.adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:h,orientation:(0,at.GJ)(-this.adapter.angle,"radians","geographic"),orientationPrecision:h,rotationType:g})}}return i}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,i=(0,o.pC)(t)?t.rotation:null,a=(0,o.pC)(t)?t.size:null;this._tooltip.info=new Rt({tooltipOptions:this._tooltipOptions,orientation:(0,at.GJ)(-this.adapter.angle,"radians","geographic"),orientationEnabled:null==this.mode||"rotate"===this.mode,orientationPrecision:(0,o.pC)(i)?ti(i.valueType):null,rotationType:(0,o.pC)(i)?i.rotationType:"geographic",size:(0,at.yG)((0,o.Pt)(this.adapter.size,-1),"meters"),sizeUnit:(0,o.pC)(a)?a.unit:null,sizeEnabled:null==this.mode||"scale"===this.mode,sizePrecision:(0,o.pC)(a)?ti(a.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Z.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Z.Unlocked,!((0,o.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,o.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Z.ScaleIn|Z.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Z.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Z.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Z.RotateLeft|Z.RotateRight,!1),this._ringManipulator.updateStateEnabled(Z.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Z.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Z.ScaleIn|Z.ScaleOut|Z.RotateLeft|Z.RotateRight,!1)}_updateManipulatorTransform(){const t=(0,q.d)(S.MP.get(),this.adapter.angle,(0,A.f)(0,0,1));if((0,o.Wi)(t))return;const i=this.getScale(),a=(0,q.u)(S.MP.get(),(0,u.s)(S.WM.get(),i,i,i));this._ringManipulator.modelTransform=(0,q.m)(S.MP.get(),a,t)}_createRingManipulator(){const t=(J,Yt,ae)=>{const ne=[],se=Math.ceil(128*(Yt-J)/(2*Math.PI));for(let ut=0;ut<se+1;ut++){const We=J+ut*(Yt-J)/se;ne.push((0,A.f)(ae*Math.cos(We),ae*Math.sin(We),0))}return ne},i=J=>t(0,2*Math.PI,J),n=(J,Yt)=>mt.Z.createPathExtrusionGeometry((J=>[[-J/2,0],[J/2,0],[J/2,.25],[-J/2,.25]])(Yt),J,[],[],!1),s=i(160),r=n(s,24),l={left:[],right:[]},h=[];for(let J=0;J<2;J++){const Yt=J*Math.PI-Math.PI/4,ae=Math.PI/2-sn,ne=Yt+ae,se=Yt+Math.PI/2-ae,ut=t(ne,se,190),We=n(ut,9);h.push(ut),h.push(t(ne,se,201)),l.left.push(We),l.right.push(We);for(let Mi=0;Mi<2;Mi++){const pa=0===Mi,Ct=(0,be.c)();if(pa){(0,q.h)(Ct,Ct,[1,-1,1]),(0,q.e)(Ct,Ct,-ne,[0,0,1]);const ge=Math.round(.2*(ut.length-1));Ct[12]=ut[ge][0],Ct[13]=ut[ge][1],Ct[14]=ut[ge][2]}else{(0,q.e)(Ct,Ct,se,[0,0,1]);const ge=Math.round(.8*(ut.length-1));Ct[12]=ut[ge][0],Ct[13]=ut[ge][1],Ct[14]=ut[ge][2]}const ca=mt.Z.createExtrudedTriangle(60,0,23,.5);mt.Z.transformInPlace(ca,Ct),(pa?l.left:l.right).push(ca)}}const g=[];for(let J=0;J<2;J++){const Yt=J*Math.PI-Math.PI/4,ae=Math.PI/2-on,se=Yt+Math.PI/2-ae,ut=t(Yt+ae,se,213);g.push(n(ut,9))}const v=i(190),_=i(213),m=n(v,9),b=n(_,9),M=i(130),z=i(107),N=n(M,9),W=n(z,9),B=this._createMaterial(),xt=this._createMaterial(.66),Ve=this._createMaterial(.5),ze=this._createMaterial(.33);let Jt=[{geometry:r,material:B,stateMask:Z.DelayedFocused},{geometry:r,material:Ve,stateMask:R.Q9.None}];this.mode&&"scale"!==this.mode||(Jt=Jt.concat([{geometry:g,material:B,stateMask:Z.DelayedFocused|Z.Unlocked},{geometry:m,material:xt,stateMask:Z.DelayedFocused|Z.ScaleIn},{geometry:b,material:ze,stateMask:Z.DelayedFocused|Z.ScaleIn},{geometry:N,material:xt,stateMask:Z.DelayedFocused|Z.ScaleOut},{geometry:W,material:ze,stateMask:Z.DelayedFocused|Z.ScaleOut}])),this.mode&&"rotate"!==this.mode||(Jt=Jt.concat([{geometry:l.right,material:B,stateMask:Z.DelayedFocused|Z.Unlocked},{geometry:l.left,material:B,stateMask:Z.DelayedFocused|Z.RotateLeft},{geometry:l.right,material:B,stateMask:Z.DelayedFocused|Z.RotateRight}]));const ii=[s,...h];return new wt.Z({view:this.tool.view,renderObjects:Jt,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,w.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:ii,direction:(0,A.f)(0,0,1)}})}_createMaterial(t=1){const i=(0,Si.b)([...Ja,t]);return new gi.E({color:i,transparent:1!==t,cullFace:ve.Vr.Back,renderOccluded:it.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function qe(e,t,i){return t.projectToScreen(e,yi),(0,u.s)(i,yi[0],yi[1],0)}function ia(e,t){let i=null,a=1;const n=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=n,t()},update:s=>(a+=((a+1)/2-a)*Math.min(3*s,1),t(),Math.abs(a-1)<.01?Oe.STOP:Oe.CONTINUE),destroy:()=>{e.getScale=i,t()}}}function ti(e){switch(e){case"integer":case"long":return 0;default:return null}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(Oe||(Oe={}));const yi=(0,T.s1)();var aa=c(89586);function na(e){return(0,o.pC)(e.geometry)&&"mesh"===e.geometry.type?function Pn(e){return(0,o.pC)(e.transform)?function Ln(e,t){let i=t.clone(),a=null;return{undo:n=>{a=(0,o.pC)(e.transform)?e.transform.clone():null,e.transform=i,n.notifyGeometryChanged()},redo:n=>{i=(0,o.pC)(e.transform)?e.transform.clone():null,e.transform=a,n.notifyGeometryChanged()}}}(e,e.transform):function Vn(e){let t,i=e.vertexAttributes.clonePositional();return{undo:a=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}(e)}(e.geometry):function In(e){let t=e.geometry,i=o.YP;return{undo(a){i=a.geometry,a.geometry=t},redo(a){t=a.geometry,a.geometry=i}}}(e)}let Qt=class extends De.r{constructor(e){super(e),this.interactionState=null}initialize(){this.own([(0,f.gx)(()=>(0,o.pC)(this.interactionState)&&this.interactionState.angle!==this.interactionState.previousAngle?{interactionState:this.interactionState,angle:this.interactionState.state.angle}:null,({interactionState:e})=>{this._updateMeshRotation(e)},f.Z_),(0,f.gx)(()=>(0,o.pC)(this.interactionState)&&this.interactionState.scale!==this.interactionState.previousScale?{interactionState:this.interactionState,scale:this.interactionState.state.scale}:null,({interactionState:e})=>{this._updateMeshSize(e)},f.Z_)])}get angle(){const e=this.geometry.transform;if((0,o.Wi)(e))return 0;const t=(0,aa.ZZ)(e.rotation)[2];return Math.abs(t)>.999999?(0,At.Vl)((0,aa.EU)(e.rotation))*Math.sign(t):0}get scale(){return(0,o.pC)(this.interactionState)?this.interactionState.scale:1}startInteraction(){const e=new Kt({angle:this.angle});this.interactionState=e;const t=()=>this.interactionState=null;return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return na(this.graphic)}_updateMeshRotation(e){const t=this.geometry.anchor,i=this.viewingMode===_i.JY.Global,{angle:a,previousAngle:n}=e;this.geometry.rotate(0,0,(0,At.BV)(a-n),{origin:t,geographic:i}),e.previousAngle=a,(0,o.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const t=this.geometry.anchor,i=this.viewingMode===_i.JY.Global,{scale:a,previousScale:n}=e;this.geometry.scale(a/n,{origin:t,geographic:i}),e.previousScale=a,(0,o.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};(0,p._)([(0,d.Cb)({constructOnly:!0})],Qt.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Qt.prototype,"geometry",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],Qt.prototype,"viewingMode",void 0),(0,p._)([(0,d.Cb)()],Qt.prototype,"angle",null),(0,p._)([(0,d.Cb)()],Qt.prototype,"scale",null),(0,p._)([(0,d.Cb)()],Qt.prototype,"interactionState",void 0),Qt=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Qt);let Kt=class extends L.Z{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,p._)([(0,d.Cb)()],Kt.prototype,"angle",void 0),(0,p._)([(0,d.Cb)()],Kt.prototype,"initialAngle",void 0),(0,p._)([(0,d.Cb)()],Kt.prototype,"previousAngle",void 0),(0,p._)([(0,d.Cb)()],Kt.prototype,"previousScale",void 0),(0,p._)([(0,d.Cb)()],Kt.prototype,"scale",void 0),(0,p._)([(0,d.Cb)()],Kt.prototype,"state",null),Kt=(0,p._)([(0,C.j)("InteractionState")],Kt);let ct=class extends De.r{constructor(e){super(e),this.sizeAxis=null,this.interactionState=null}initialize(){this.own((0,f.gx)(()=>(0,o.pC)(this.interactionState)?this.interactionState.state:null,e=>{this._updateSymbol(e)},f.Z_))}get angle(){return(0,o.pC)(this.interactionState)?this.interactionState.angle:(0,o.pC)(this._orientationReferenceSymbolLayer)?function zn(e){return-(0,At.Vl)(e)}(this._orientationReferenceSymbolLayer.heading):0}get scale(){return(0,o.pC)(this.interactionState)?this.interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return(0,o.pC)(this.interactionState)?this.interactionState.initialAngle:0}get size(){const e=this._sizeReferenceSymbolLayer;if((0,o.Wi)(e))return null;const t=this.findLayerView(),i=this._graphicSymbol;if((0,o.Wi)(t)||(0,o.Wi)(i)||"point-3d"!==i.type)return null;const a=t.getSymbolLayerSize(i,e);if("size"in a&&(0,o.pC)(a.size))return a.size;const n=this.sizeAxis;return"width"in a&&(0,o.pC)(a.width)&&((0,o.Wi)(n)||"width"===n||"all"===n||"width-and-depth"===n)?a.width:"depth"in a&&(0,o.pC)(e.depth)&&((0,o.Wi)(n)||"depth"===n||"all"===n||"width-and-depth"===n)?a.depth:"height"in a&&(0,o.pC)(e.height)&&((0,o.Wi)(n)||"height"===n||"all"===n)?a.height:null}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,o.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find(t=>"object"===t.type)}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,o.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find(t=>"object"===t.type&&(0,o.pC)(t.heading))}get _graphicSymbol(){return(0,o.pC)(this.graphic)&&(0,o.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if((0,o.pC)(this.interactionState)||(0,o.Wi)(e)||(0,o.Wi)(t))return Wn;const i=e.symbolLayers.map(l=>"object"===l.type?t.getSymbolLayerSize(e,l):null).toArray(),a=e.clone(),s=new kt({originalSymbol:a,angle:this.angle,initialSizes:i});this.interactionState=s;const r=()=>this.interactionState=null;return{state:s,done:r,cancel:()=>{this._graphicSymbol=a,r()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:i,initialSizes:a}){const n=this._graphicSymbol;if((0,o.Wi)(n)||"point-3d"!==n.type)return;const s=n.clone(),r=-(0,At.BV)(t-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(i,s,(h,g,v)=>{const _=(0,o.Pt)(h.heading,0)+r;g.heading!==_&&(g.heading=_,l=!0);const m=a[v];if((0,o.pC)(m)&&"width"in m){m.width=this.sizeFilter(m.width),m.height=this.sizeFilter(m.height),m.depth=this.sizeFilter(m.depth);const b=m.width*e;g.width!==b&&(g.width=b,l=!0);const M=m.depth*e;g.depth!==M&&(g.depth=M,l=!0);const z=m.height*e;g.height!==z&&(g.height=z,l=!0)}}),l&&(this._graphicSymbol=s)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach((a,n)=>{const s=t.symbolLayers.getItemAt(n);"object"===a.type&&"object"===s.type&&i(a,s,n)})}};(0,p._)([(0,d.Cb)()],ct.prototype,"angle",null),(0,p._)([(0,d.Cb)()],ct.prototype,"scale",null),(0,p._)([(0,d.Cb)()],ct.prototype,"relativeAngle",null),(0,p._)([(0,d.Cb)()],ct.prototype,"initialAngle",null),(0,p._)([(0,d.Cb)()],ct.prototype,"size",null),(0,p._)([(0,d.Cb)()],ct.prototype,"sizeAxis",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],ct.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)()],ct.prototype,"interactionState",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],ct.prototype,"findLayerView",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0})],ct.prototype,"sizeFilter",void 0),(0,p._)([(0,d.Cb)()],ct.prototype,"_sizeReferenceSymbolLayer",null),(0,p._)([(0,d.Cb)()],ct.prototype,"_orientationReferenceSymbolLayer",null),(0,p._)([(0,d.Cb)()],ct.prototype,"_graphicSymbol",null),ct=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],ct);const Wn={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let kt=class extends L.Z{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:n}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:n}}};(0,p._)([(0,d.Cb)()],kt.prototype,"originalSymbol",void 0),(0,p._)([(0,d.Cb)()],kt.prototype,"angle",void 0),(0,p._)([(0,d.Cb)()],kt.prototype,"initialAngle",void 0),(0,p._)([(0,d.Cb)()],kt.prototype,"initialSizes",void 0),(0,p._)([(0,d.Cb)()],kt.prototype,"scale",void 0),(0,p._)([(0,d.Cb)()],kt.prototype,"state",null),kt=(0,p._)([(0,C.j)("InteractionState")],kt);let yt=class extends((0,De.p)(Wt.Z.EventedMixin(Qe.m))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Zt.Z,this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new Je.n,this._tooltip=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new bt({graphic:e}),this.own((0,f.YP)(()=>this.tooltipOptions.enabled,a=>{this._tooltip=a?new Ge.u({view:t}):(0,o.SC)(this._tooltip)},f.tX)),this._moveManipulation=new ue({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&(0,pe.c)(e),radius:ue.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((a,n)=>this.handles.add([a.events.on("immediate-click",s=>{this.emit("immediate-click",F(H({},s),{graphic:e})),s.stopPropagation()}),a.events.on("focus-changed",({action:s})=>{const{tooltipOptions:r,_tooltip:l}=this;(0,o.Wi)(l)||(l.clear(),"focus"!==s)||(l.info=new(n===U.TRANSLATE_Z?Lt:Dt)({tooltipOptions:r}))})])),this._moveManipulation.elevationInfo=(0,w.RL)(e);const i=e.geometry;this._moveManipulation.createGraphicDragPipeline((a,n,s,r,l)=>((0,o.pC)(i)&&a===Y.XY&&(s=s.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new ke.N({elevationInfo:(0,w.RL)(e),pointer:l,editGeometryOperations:Ke.c.fromGeometry(new On.Z({spatialReference:i.spatialReference}),t.state.viewingMode),visualizer:new Ae._,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:r}),this._snappingPipeline.next)),s.next(h=>{const{tooltipOptions:g,_tooltip:v}=this;if((0,o.Wi)(v))return h;const{mapStart:_,mapEnd:m}=h;v.clear();const b=a===Y.Z?Lt:Dt;if("end"===h.action)v.info=new b({tooltipOptions:g});else{const M=a===Y.Z?(0,xe._e)(_,m):(0,tt.GQ)(_,m,this.graphicState.isDraped?"on-the-ground":"absolute-height");(0,o.pC)(M)&&(v.info=new b({tooltipOptions:g,distance:M}))}return h})),this.graphicState,a=>{const{action:n,graphic:s,dxScreen:r,dyScreen:l}=a,h={graphic:s,dxScreen:r,dyScreen:l};switch(n){case"start":this.emit("graphic-translate-start",h),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",h);break;case"end":this.emit("graphic-translate-stop",h)}}),this._moveManipulation.angle=(0,o.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,f.YP)(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),(this.enableScaling||this.enableRotation)&&(this._scaleRotate=new Tn({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate",adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))),this.handles.add([Fe({view:this.view,graphic:this.graphic,forEachManipulator:a=>this._forEachManipulator(a),onManipulatorsChanged:()=>(0,G.kB)()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),(0,f.YP)(()=>t.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(a=>{a instanceof wt.Z&&this.handles.add(a.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=(0,o.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,o.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,o.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){(0,o.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return(0,o.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Qt({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new ct({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find(e=>e.layer===this.graphic.layer),sizeAxis:(0,o.pC)(this.tooltipOptions.visualVariables)&&(0,o.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),(0,o.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return(0,f.YP)(()=>this.graphicState.displaying,e=>{this._forEachManipulator(t=>t.available=e),this._moveManipulation.zManipulation.available=e&&this.enableZ&&(0,pe.c)(this.graphic)})}_createGeometryUndoRecord(){return na(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this._moveManipulation.location=e,(0,o.pC)(this._scaleRotate)&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,(0,o.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){(0,o.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if((0,o.Wi)(this._scaleRotate))return;const e=this._scaleRotate.getScale();this._moveManipulation.displayScale=e}_updateMoveAngle(){this._moveManipulation.angle=this.view.state.viewingMode===_i.JY.Local||this.view.scale<1e6?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){(0,$.u2)(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,o.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],yt.prototype,"view",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],yt.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],yt.prototype,"enableZ",void 0),(0,p._)([(0,d.Cb)()],yt.prototype,"enableRotation",void 0),(0,p._)([(0,d.Cb)()],yt.prototype,"enableScaling",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Zt.Z})],yt.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)()],yt.prototype,"graphicState",void 0),(0,p._)([(0,d.Cb)({value:!1})],yt.prototype,"snapToScene",null),(0,p._)([(0,d.Cb)({constructOnly:!0})],yt.prototype,"snappingManager",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],yt.prototype,"type",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],yt.prototype,"updating",null),yt=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],yt);var vt=c(41743),dt=c(96298),Un=c(25601);class Zn{constructor(){this.lastDragEvent=null,this.next=new V.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,o.pC)(this.lastDragEvent)){const i=F(H({},this.lastDragEvent),{action:"update"});t&&this._adjustScaleFactors(i),this.next.execute(i)}this._enabled=t}createDragEventPipelineStep(){return this.lastDragEvent=null,t=>(this.lastDragEvent="end"!==t.action?H({},t):null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const i=(0,dt.J0)(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-i:i,t.factor2=t.factor2<0?-i:i}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}var Nn=c(26046),fi=c(15708),Bn=c(4517),Yn=c(67100),Hn=c(91672);function ei(e,t){return oa(e,t,!1)}function sa(e,t){return oa(e,t,!0)}function oa(e,t,i){if(e instanceof fi.y){if(e.operation instanceof Bn.z)return function jn(e,t,i=!1){const a=i?-1:1,n=(0,A.f)(a*e.dx,a*e.dy,a*e.dz);(0,u.a)(t.origin,t.origin,n)}(e.operation,t,i),!0;if(e.operation instanceof Yn.S)return function Fn(e,t,i=!1){const a=i?-e.angle:e.angle;(0,u.H)(t.basis1,t.basis1,A.Z,a),(0,u.H)(t.basis2,t.basis2,A.Z,a)}(e.operation,t,i),!0;if(e.operation instanceof Hn.q)return function Xn(e,t,i=!1){const a=i?1/e.factor1:e.factor1,n=i?1/e.factor2:e.factor2;(0,u.g)(t.basis1,t.basis1,a),(0,u.g)(t.basis2,t.basis2,n),(0,E.q)(t.origin,t.origin,e.origin,e.axis1,a),(0,E.q)(t.origin,t.origin,e.origin,e.axis2,n)}(e.operation,t,i),!0}return!1}function ra(e,t,i,a){const n=S.WM.get();(0,u.b)(n,(0,u.b)(n,e.origin,e.basis1),e.basis2);const s=S.WM.get();(0,u.C)(s,n,e.basis1,2);const r=S.WM.get();(0,u.C)(r,s,e.basis2,2);const l=S.WM.get();(0,u.C)(l,n,e.basis2,2),n[2]=s[2]=r[2]=l[2]=t;const h=a?"on-the-ground":"absolute-height",g=(0,at.Fp)((0,tt.bZ)(n,s,i,h),(0,tt.bZ)(l,r,i,h)),v=(0,at.Fp)((0,tt.bZ)(s,r,i,h),(0,tt.bZ)(n,l,i,h));return(0,o.Wi)(v)||(0,o.Wi)(g)?null:[g,v]}let Le=class extends jt.h{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,p._)([(0,d.Cb)()],Le.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],Le.prototype,"angle",void 0),Le=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],Le);let ie=class extends jt.h{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=at.yP,this.ySize=at.yP}};(0,p._)([(0,d.Cb)()],ie.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],ie.prototype,"xScale",void 0),(0,p._)([(0,d.Cb)()],ie.prototype,"yScale",void 0),(0,p._)([(0,d.Cb)()],ie.prototype,"xSize",void 0),(0,p._)([(0,d.Cb)()],ie.prototype,"ySize",void 0),ie=(0,p._)([(0,C.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],ie);let ft=class extends(Wt.Z.EventedMixin(Qe.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Zt.Z,this._preserveAspectRatio=new Zn,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new Me.Z,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=(0,vt.c)(),this.mapBoundsStart=(0,vt.c)(),this.zmax=0,this.sizeStart=null,this.displayBounds=(0,vt.c)(),this.displayBoundsStart=(0,vt.c)(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,_t.a)(),this._endScale=(0,_t.a)()}initialize(){const{view:e,graphic:t,manipulators:i,handles:a}=this,n=this.graphicState=new bt({graphic:t});this.editGeometryOperations=Ke.c.fromGeometry(t.geometry,e.state.viewingMode),this.graphicMoveManipulation=new mi({tool:this,view:e,graphicState:n}),this.moveZManipulator=(0,dt.Pt)(e,dt.lX.CENTER_ON_CALLOUT),this.moveZManipulator.state|=dt.Df,a.add([this._createMoveXYGraphicDragPipeline(),(0,f.YP)(()=>this.enableZ,()=>this._updateManipulatorAvailability(this.moveZManipulator,U.TRANSLATE_Z)),this._createMoveZDragPipeline()]),i.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map(v=>{const _=(0,dt.vw)(e,v);return a.add([(0,f.YP)(()=>this.enableScaling,()=>this._updateManipulatorAvailability(_,U.SCALE)),_.events.on("grab-changed",m=>this._onResizeGrab(m)),this._createResizeDragPipeline(_,v)]),_}),i.addMany(this.resizeManipulators),this.rotateManipulatorTexture=(0,Un.O)(e.toolViewManager.textures),this.rotateManipulator=(0,dt.Ju)(e,this.rotateManipulatorTexture.texture),a.add([(0,f.YP)(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this.rotateManipulator,U.ROTATE)),this.rotateManipulator.events.on("grab-changed",v=>{this._onRotateGrab(v)}),this._createRotateDragPipeline(this.rotateManipulator)]),i.add(this.rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const r=Fe({view:e,graphic:t,forEachManipulator:v=>this._forEachManipulator(v),onManipulatorsChanged:()=>(0,G.kB)()});(0,o.pC)(r)&&(this.outlineVisualElement=r.visualElement instanceof he?r.visualElement:null),(0,o.pC)(this.outlineVisualElement)&&a.add(this.outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),a.add(r),a.add([n.on("changed",()=>this._onGeometryChanged()),(0,f.YP)(()=>n.displaying,()=>this._updateAllManipulatorAvailability()),(0,f.YP)(()=>n.isDraped,()=>this._graphicDrapedChanged(),f.nn),e.trackGraphicState(n)]);const l=e.pointsOfInterest;l&&a.add((0,f.YP)(()=>l.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds())),this._forEachManipulator(v=>{a.add(v.events.on("grab-changed",()=>{this.grabbing=v.grabbing,this._updateAllManipulatorAvailability()}))}),this._forEachManipulator((v,_)=>{a.add(v.events.on("immediate-click",m=>{_===U.TRANSLATE_XY&&this.emit("immediate-click",F(H({},m),{graphic:t})),m.stopPropagation()}))}),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this.mapBounds=null,this.displayBounds=null,this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{handles:e,view:t}=this,i=this._tooltip=new Ge.u({view:t}),a=()=>{i.info=this._getUpdatedTooltipInfo()};e.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",n=>{this._startAngle=n.angle,a()}),this.on("graphic-rotate",n=>{this._endAngle=n.angle,a()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,a()}),this.on("graphic-scale-start",n=>{(0,E.a)(this._startScale,n.xScale,n.yScale),(0,E.a)(this._endScale,n.xScale,n.yScale),a()}),this.on("graphic-scale",n=>{(0,E.a)(this._endScale,n.xScale,n.yScale),a()}),this.on("graphic-scale-stop",()=>{(0,E.a)(this._startScale,0,0),(0,E.a)(this._endScale,0,0),a()})]),this._forEachManipulator(n=>{e.add([n.events.on("focus-changed",a),n.events.on("grab-changed",a),n.events.on("drag",s=>{"cancel"===s.action?this._tooltip.clear():a()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this.graphicMoveManipulation.grabbing||this.graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():this.rotateManipulator.focused?this._computeRotateTooltipInfo():this.resizeManipulators.some(e=>e.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=(0,o.Pt)(this._moveXYTooltipInfo,()=>new Dt({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const e=this._moveZTooltipInfo=(0,o.Pt)(this._moveZTooltipInfo,()=>new Lt({tooltipOptions:this.tooltipOptions})),t=this._moveUnit;if(this.moveZManipulator.dragging){const n=(0,xe.Cr)(this.mapBoundsStart.origin,this.mapBounds.origin,this.view.spatialReference);if((0,o.Wi)(n))return null;e.distance=n}else e.distance=(0,at.yG)(0,t);return e}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo=(0,o.Pt)(this._rotateTooltipInfo,()=>new Le({tooltipOptions:this.tooltipOptions}));return e.angle=this._startAngle-this._endAngle,e}_computeScaleTooltipInfo(){const e=this.graphic.geometry;if((0,o.Wi)(e))return null;const t=this._scaleTooltipInfo=(0,o.Pt)(this._scaleTooltipInfo,()=>new ie({tooltipOptions:this.tooltipOptions})),i=ra(this.mapBounds,this.zmax,e.spatialReference,this.graphicState.isDraped);return(0,o.Wi)(i)?null:(t.xSize=i[0],t.ySize=i[1],(0,o.pC)(this.sizeStart)&&this.resizeManipulators.some(a=>a.dragging)?(t.xScale=i[0].value/this.sizeStart[0].value,t.yScale=i[1].value/this.sizeStart[1].value):(t.xScale=1,t.yScale=1),t)}_graphicDrapedChanged(){this.handles.remove(la),this._updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",e=>{(0,o.pC)(this.attachmentOrigin)&&(0,Pi.jE)(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this._updateDisplayBounds()}),la)}_updateAllManipulatorAvailability(){this._forEachManipulator((e,t)=>this._updateManipulatorAvailability(e,t))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof wt.Z){const a=this.graphicState.displaying,n=this.enableZ&&(0,pe.c)(this.graphic);switch(t){case U.ROTATE:e.available=a&&this.enableRotation;break;case U.SCALE:e.available=a&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?dt.Sc:dt.vc;break;case U.TRANSLATE_Z:e.available=a&&n;break;default:e.available=a}}}_forEachManipulator(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach(t=>e(t,U.SCALE)),e(this.rotateManipulator,U.ROTATE),e(this.moveZManipulator,U.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get _moveUnit(){return(0,o.Pt)((0,I.j5)(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],a=(0,E.g)(S.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,E.i)(a,a);const n=(0,o.Pt)((0,$.du)(this.view,this.graphic),()=>e.extent.center);let s=Jn*this.view.pixelSizeAt(n);const r=this.view.spatialReference,l=e.spatialReference;r.equals(l)||(s*=(0,I.c9)(r)/(0,I.c9)(l)),function Qn(e,t,i,a){a||(a=(0,vt.c)());const n=(0,E.a)(S.qW.get(),e[1],-e[0]),s=(0,E.a)(S.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=(0,E.a)(S.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=S.qW.get();t.components.forEach(v=>v.vertices.forEach(_=>{const m=_.pos;(0,E.a)(l,(0,E.h)(e,m),(0,E.h)(n,m)),(0,E.x)(s,s,l),(0,E.y)(r,r,l)}));const h=1e-6,g=(0,E.a)(S.qW.get(),r[0]-s[0]<h?i/2:0,r[1]-s[1]<h?i/2:0);(0,E.g)(s,s,g),(0,E.b)(r,r,g),(0,E.f)(a.basis1,e,(r[0]-s[0])/2),(0,E.f)(a.basis2,n,(r[1]-s[1])/2),(0,E.a)(a.origin,s[0]*e[0]+s[1]*n[0],s[0]*e[1]+s[1]*n[1]),(0,E.b)(a.origin,a.origin,a.basis1),(0,E.b)(a.origin,a.origin,a.basis2)}(a,t,s,this.mapBounds),this._calculateZMax()}_calculateZMax(){const e=this.editGeometryOperations.data;if(!e.geometry.hasZ)return void(this.zmax=0);const t=e.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of e.components)for(const n of a.vertices){const s=t.getZ(n.pos);i=Math.max(s,i)}this.zmax=i}_updateDisplayBounds(){const e=this.graphic.geometry;if((0,o.Wi)(e))return;const t=(0,o.pC)(this.outlineVisualElement)&&!this.graphicState.isDraped&&(0,o.pC)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:(0,$.du)(this.view,this.graphic);this.attachmentOrigin=(0,o.Pt)(t,e.extent.center);const i=(0,o.pC)(t)?t.z:(0,Ii.w7)(this.mapBounds.origin,this.view.elevationProvider,He.o.fromElevationInfo((0,w.RL)(this.graphic)),this.view.renderCoordsHelper),a=(0,vt.a)(this.mapBounds);a.origin[2]=i,function Kn(e,t,i,a=0,n){n||(n=(0,vt.c)()),t.toRenderCoords(e.origin,i,n.origin);const s=S.WM.get();(0,u.a)(s,e.origin,e.basis1),(0,u.a)(s,s,e.basis2),t.toRenderCoords(s,i,s);const r=S.WM.get();(0,u.a)(r,e.origin,e.basis1),(0,u.b)(r,r,e.basis2),t.toRenderCoords(r,i,r);const l=S.WM.get();(0,u.b)(l,e.origin,e.basis1),(0,u.b)(l,l,e.basis2),t.toRenderCoords(l,i,l);const h=S.WM.get();(0,u.b)(h,e.origin,e.basis1),(0,u.a)(h,h,e.basis2),t.toRenderCoords(h,i,h);const g=(0,u.h)(S.WM.get(),s,r,.5);(0,u.b)(g,g,n.origin);const v=(0,u.h)(S.WM.get(),l,h,.5);(0,u.b)(v,n.origin,v),(0,u.h)(n.basis1,g,v,.5);const _=(0,u.h)(S.WM.get(),h,s,.5);(0,u.b)(_,_,n.origin);const m=(0,u.h)(S.WM.get(),r,l,.5);(0,u.b)(m,n.origin,m),(0,u.h)(n.basis2,_,m,.5);const b=(0,u.f)(S.WM.get(),n.basis1,n.basis2),M=(0,u.f)(b,b,n.basis1);(0,u.n)(M,M),(0,u.g)(n.basis2,M,(0,u.e)(n.basis2,M)),(0,u.g)(n.basis1,n.basis1,1+a/(0,u.l)(n.basis1)),(0,u.g)(n.basis2,n.basis2,1+a/(0,u.l)(n.basis2)),(0,vt.u)(n)}(a,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this._updateManipulators()}get displayBoundsMargin(){const e=this.view.pointsOfInterest;return kn*this.view.pixelSizeAt(e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline((e,t,i)=>this._applyGraphicMoveSteps(t,i,Y.XY))}_createMoveZDragPipeline(){const e=this.view,t=this.editGeometryOperations.data.spatialReference;return(0,V.Xd)(this.moveZManipulator,(i,a,n)=>{const s=(0,A.a)(i.renderLocation),r=a.next((0,Tt.Sp)(e,s,t)).next((0,V.zh)());this._applyGraphicMoveSteps(r,n,Y.Z)})}_applyGraphicMoveSteps(e,t,i){const a=e.next(n=>("start"===n.action&&(this.inputState={type:"move"},(0,vt.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})),n)).next((0,V.AN)()).next(this._moveDragUpdateGeometry()).next(n=>{const s={graphic:this.graphic,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY};switch(n.action){case"start":case"update":(n.mapEnd.x-n.mapStart.x||n.mapEnd.y-n.mapStart.y||n.mapEnd.z-n.mapStart.z)&&this.emit("graphic-translate",s);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",s)}return n}).next(n=>this._updateMoveTooltip(n,i));return t.next(()=>{(0,o.pC)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),a}_calculateSizeStart(){this.sizeStart=(0,o.Wi)(this.graphic.geometry)?null:ra(this.mapBoundsStart,this.zmax,this.graphic.geometry.spatialReference,this.graphicState.isDraped)}_moveDragUpdateGeometry(){return e=>{if((0,o.Wi)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const n of this.editGeometryOperations.data.components)t.push(...n.vertices);return ei(this.editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,"start"===e.action?Ft.O.NEW_STEP:Ft.O.ACCUMULATE_STEPS),this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_updateMoveTooltip(e,t){if(t===Y.XY||t===Y.XY_AXIS){const i=(0,tt.GQ)(e.mapStart,e.mapEnd,this.graphicState.isDraped?"on-the-ground":"absolute-height");(0,o.pC)(i)&&(0,o.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=i)}return e}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);(0,St.BR)(this.displayBounds.plane,t,S.WM.get())&&((0,vt.a)(this.displayBounds,this.displayBoundsStart),(0,vt.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return(0,V.Xd)(e,(i,a,n)=>{(0,o.Wi)(this.inputState)||(a.next(s=>("start"===s.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),s)).next((0,Tt._N)(this.view,this.displayBoundsStart.plane)).next(s=>F(H({},s),{handle:t})).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next(s=>{const r={graphic:this.graphic,xScale:s.factor1,yScale:s.factor2};switch(s.action){case"start":case"update":this.emit("graphic-scale",r);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",r)}return s}),n.next(()=>{(0,o.pC)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,a=this.displayBoundsMargin,n=this.displayBoundsMarginStart,s=(0,u.c)(S.WM.get(),t.origin);(0,u.C)(s,s,t.basis1,-i[0]),(0,u.C)(s,s,t.basis2,-i[1]);const r=(0,u.b)(S.WM.get(),e.renderEnd,s),l=(0,u.b)(S.WM.get(),e.renderStart,s),h=(0,dt.J0)(e.handle),g=(0,dt.Lw)(t),v=(0,dt.Lw)(this.displayBounds)/g,_=(m,b)=>{if(0===m)return 1;let M=(0,u.l)(b),z=.5*m*(0,u.e)(b,r)/M;const N=z<0?-1:1;h&&(z+=(M-.5*m*(0,u.e)(b,l)/M)*N*v);const W=M<1.5*n?1:ha;return M=Math.max(M-n,ha),N>0&&(z-=a),N*Math.max(N*(z/M),W)};return F(H({},e),{factor1:_(i[0],t.basis1),factor2:_(i[1],t.basis2)})}}_resizeDragUpdateGeometry(){return e=>{const t=(0,u.c)((0,A.c)(),this.mapBoundsStart.origin);(0,u.C)(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),(0,u.C)(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=(0,E.a)((0,_t.a)(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);(0,E.i)(i,i);const a=[];for(const r of this.editGeometryOperations.data.components)a.push(...r.vertices);const s=this.editGeometryOperations.scaleVertices(a,t,i,e.factor1,e.factor2,"start"===e.action?Ft.O.NEW_STEP:Ft.O.ACCUMULATE_STEPS,fi.w.REPLACE);return(0,vt.a)(this.mapBoundsStart,this.mapBounds),ei(s,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=(0,dt.Rd)(this.displayBounds,this.view.renderCoordsHelper,dt.aZ.HEADING,(0,St.Ue)()),i=this._calculatePickRay(e.screenPoint);(0,St.BR)(t,i,S.WM.get())&&((0,vt.a)(this.displayBounds,this.displayBoundsStart),(0,vt.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return(0,V.Xd)(e,(t,i,a)=>{const n=this.inputState;(0,o.Wi)(n)||(i.next(s=>("start"===s.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),s)).next((0,Tt._N)(this.view,n.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(n)).next(this._rotateDragUpdateGeometry()).next(s=>{const r={graphic:this.graphic,angle:(0,At.BV)(s.rotateAngle)};switch(s.action){case"start":case"update":this.emit("graphic-rotate",r);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",r)}return s}),a.next(()=>{(0,o.pC)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(e){return t=>{const i=(0,St.mJ)(e.rotatePlane),a=(0,$.Gd)(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return F(H({},t),{rotateAxis:i,rotateAngle:a})}}_rotateDragUpdateGeometry(){return e=>{const t=(0,u.c)((0,A.c)(),this.mapBoundsStart.origin),i=[];for(const s of this.editGeometryOperations.data.components)i.push(...s.vertices);const n=this.editGeometryOperations.rotateVertices(i,t,e.rotateAngle,"start"===e.action?Ft.O.NEW_STEP:Ft.O.ACCUMULATE_STEPS,fi.w.REPLACE);return(0,vt.a)(this.mapBoundsStart,this.mapBounds),ei(n,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_calculatePickRay(e){const t=(0,Ie.Ue)(),i=(0,T.md)(e);return(0,Nn.u4)(this.view.state.camera,i,t),(0,u.n)(t.direction,t.direction),t}_updateManipulators(){if(!this.visible)return;const e=(0,dt.zY)(this.displayBounds,S.MP.get());(0,dt.A5)(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach((t,i)=>{(0,dt.EC)(t,this.resizeHandles[i],e,this.displayBounds)})}_updateZMoveHandle(e,t){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:(0,u.b)(S.WM.get(),i.origin,i.basis1),edge:2},n=S.MP.get();(0,q.g)(n,t,a.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=a.position}_cancel(){const e=this.editGeometryOperations.lastOperation;(0,o.Wi)(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,sa(e,this.mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if((0,o.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,sa((0,o.Wg)(e),this.mapBounds),this._updateDisplayBounds()}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,ei((0,o.Wg)(e),this.mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator,tooltip:this._tooltip}}};(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"view",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"graphic",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"enableZ",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"enableRotation",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"enableScaling",void 0),(0,p._)([(0,d.Cb)({constructOnly:!0,type:Zt.Z})],ft.prototype,"tooltipOptions",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"preserveAspectRatio",null),(0,p._)([(0,d.Cb)()],ft.prototype,"grabbing",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"inputState",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],ft.prototype,"type",void 0),(0,p._)([(0,d.Cb)()],ft.prototype,"_moveUnit",null),ft=(0,p._)([(0,C.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],ft);const la="draped-elevation-changes",kn=10,Jn=80,ha=1e-6},90585:(gt,X,c)=>{c.d(X,{L:()=>I});var p=c(17626),G=c(14517),o=c(61885),f=c(62208),d=c(32917),O=c(23841),x=c(77712),Q=(c(85931),c(8314),c(90912),c(76898)),T=c(67831),Mt=c(84161),Gt=c(28093),A=c(55915),D=c(60507),L=c(8080),j=c(82706),rt=c(94672);let I=class extends G.Z{constructor(u){super(u),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new o.Z.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(u){this._circleCollisionCache=null,this._originalSymbol=u.symbol,this._set("graphic",u),this.attachSymbolChanged()}get elevationInfo(){const u="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,nt=(0,D.vu)(this.graphic);return new j.ZP({mode:nt,offset:u?u.offset:0})}set focusedSymbol(u){u!==this._get("focusedSymbol")&&(this._set("focusedSymbol",u),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(u){u!==this._get("grabbing")&&(this._set("grabbing",u),this._updateGraphicSymbol())}set hovering(u){u!==this._get("hovering")&&(this._set("hovering",u),this._updateGraphicSymbol())}set selected(u){u!==this._get("selected")&&(this._set("selected",u),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:u?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(u){const nt=this.graphic;if(!1===nt.visible)return null;const lt=nt.geometry;if((0,f.Wi)(lt))return null;const st=this._get("focusedSymbol"),tt=(0,f.pC)(st)?st:nt.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,u,lt,tt):this._intersectDistance3D(this.view,u,nt)}attach(){this.attachSymbolChanged(),(0,f.pC)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,f.pC)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,d.YP)(()=>{var u;return null==(u=this.graphic)?void 0:u.symbol},u=>{(0,f.pC)(u)&&u!==this.focusedSymbol&&u!==this._originalSymbol&&(this._originalSymbol=u,this._focused&&(0,f.pC)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))},d.Z_)}detachSymbolChanged(){(0,f.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&(0,f.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(u,nt,lt,st){if(st=st||(0,L.js)(lt),(0,f.Wi)(st))return null;let Et=this._circleCollisionCache;if("point"!==lt.type||"simple-marker"!==st.type)return(0,rt.D)(nt,lt,u)?1:null;if((0,f.Wi)(Et)||!Et.originalPoint.equals(lt)){const oe=lt,ht=u.spatialReference;if((0,A.Up)(oe.spatialReference,ht)){const pt=(0,A.iV)(oe,ht);Et={originalPoint:oe.clone(),mapPoint:pt,radiusPx:(0,O.F2)(st.size)},this._circleCollisionCache=Et}}if((0,f.pC)(Et)){const oe=(0,O.md)(nt,_t),ht=u.toScreen(Et.mapPoint),pt=Et.radiusPx,re=ht.x+(0,O.F2)(st.xoffset),ai=ht.y-(0,O.F2)(st.yoffset);return(0,T.s)(oe,[re,ai])<pt*pt?1:null}return null}_intersectDistance3D(u,nt,lt){const st=u.toMap(nt,{include:[lt]});return st&&(0,A.KC)(st,E,u.renderSpatialReference)?(0,Mt.i)(E,u.state.camera.eye):null}};(0,p._)([(0,x.Cb)({constructOnly:!0,nonNullable:!0})],I.prototype,"graphic",null),(0,p._)([(0,x.Cb)()],I.prototype,"elevationInfo",null),(0,p._)([(0,x.Cb)({constructOnly:!0,nonNullable:!0})],I.prototype,"view",void 0),(0,p._)([(0,x.Cb)({value:null})],I.prototype,"focusedSymbol",null),(0,p._)([(0,x.Cb)({constructOnly:!0})],I.prototype,"layer",void 0),(0,p._)([(0,x.Cb)()],I.prototype,"interactive",void 0),(0,p._)([(0,x.Cb)()],I.prototype,"selectable",void 0),(0,p._)([(0,x.Cb)()],I.prototype,"grabbable",void 0),(0,p._)([(0,x.Cb)({value:!1})],I.prototype,"grabbing",null),(0,p._)([(0,x.Cb)()],I.prototype,"dragging",void 0),(0,p._)([(0,x.Cb)()],I.prototype,"hovering",null),(0,p._)([(0,x.Cb)({value:!1})],I.prototype,"selected",null),(0,p._)([(0,x.Cb)()],I.prototype,"cursor",void 0),I=(0,p._)([(0,Q.j)("esri.views.interactive.GraphicManipulator")],I);const E=(0,Gt.c)(),_t=(0,O.s1)()},68371:(gt,X,c)=>{c.d(X,{Z:()=>A});var p=c(17626),G=c(14517),o=c(77712),x=(c(85931),c(8314),c(90912),c(76898)),C=(c(50645),c(15448));c(62996);const Q={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let T=class extends G.Z{constructor(D){super(D),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this._backgroundColor="rgba(0, 0, 0, 0.6)",this._textColor="white",this._textShadowColor=[0,0,0],this._textShadowSize=1}get position(){return[this.x,this.y]}set position(D){this._set("x",D[0]),this._set("y",D[1])}get _textShadow(){const[D,L,j]=this._textColor;return`0 0 ${this._textShadowSize}px rgb(${D}, ${L}, ${j})`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}render(){return(0,C.h)("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this._backgroundColor,color:this._textColor,padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(D){if(!this.visible)return;const L=D.font.replace(/^(.*?)px/,"");D.font=`${this.fontSize}px ${L}`;const j=this._padding,rt=this._borderRadius,I=D.measureText(this.text).width,E=this.fontSize,_t=Mt[this.anchor];D.textAlign="center",D.textBaseline="middle";const u=I+2*j,nt=E+2*j;this._roundedRect(D,this.x+_t.x*u,this.y+_t.y*nt,u,nt,rt),D.fillStyle=this._backgroundColor,D.fill();const tt=this.x+(_t.x+.5)*u,Et=this.y+(_t.y+.5)*nt;this._renderTextShadow(D,this.text,tt,Et),D.fillStyle=this._textColor,D.fillText(this.text,tt,Et)}_renderTextShadow(D,L,j,rt){D.lineJoin="miter",D.fillStyle=`rgba(${this._textShadowColor[0]}, ${this._textShadowColor[1]}, ${this._textShadowColor[2]}, ${1/Gt.length})`;const I=this._textShadowSize;for(const[E,_t]of Gt)D.fillText(L,j+I*E,rt+I*_t)}_roundedRect(D,L,j,rt,I,E){D.beginPath(),D.moveTo(L,j+E),D.arcTo(L,j,L+E,j,E),D.lineTo(L+rt-E,j),D.arcTo(L+rt,j,L+rt,j+E,E),D.lineTo(L+rt,j+I-E),D.arcTo(L+rt,j+I,L+rt-E,j+I,E),D.lineTo(L+E,j+I),D.arcTo(L,j+I,L,j+I-E,E),D.closePath()}_cssClasses(){const D={"esri-text-overlay-item":!0};for(const L in Q)D[Q[L]]=this.anchor===L;return D}};(0,p._)([(0,o.Cb)()],T.prototype,"x",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"y",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"position",null),(0,p._)([(0,o.Cb)()],T.prototype,"text",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"fontSize",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"anchor",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"visible",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"_backgroundColor",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"_textColor",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"_textShadowColor",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"_textShadowSize",void 0),(0,p._)([(0,o.Cb)()],T.prototype,"_textShadow",null),(0,p._)([(0,o.Cb)()],T.prototype,"_padding",null),(0,p._)([(0,o.Cb)()],T.prototype,"_borderRadius",null),T=(0,p._)([(0,x.j)("esri.views.overlay.TextOverlayItem")],T);const Mt={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},Gt=[];for(let L=0;L<360;L+=22.5)Gt.push([Math.cos(Math.PI*L/180),Math.sin(Math.PI*L/180)]);const A=T},94672:(gt,X,c)=>{c.d(X,{D:()=>x,K:()=>O}),c(29132);var G=c(62208),o=c(16730),f=c(22264),d=c(2004);function O(C,w,Q,T=new d.Z){let Mt;if("2d"===Q.type)Mt=w*Q.resolution;else if("3d"===Q.type){const rt=Q.overlayPixelSizeInMapUnits(C),I=Q.basemapSpatialReference;Mt=(0,G.pC)(I)&&!I.equals(Q.spatialReference)?(0,o.c9)(I)/(0,o.c9)(Q.spatialReference):w*rt}const Gt=C.x-Mt,A=C.y-Mt,D=C.x+Mt,L=C.y+Mt,{spatialReference:j}=Q;return T.xmin=Math.min(Gt,D),T.ymin=Math.min(A,L),T.xmax=Math.max(Gt,D),T.ymax=Math.max(A,L),T.spatialReference=j,T}function x(C,w,Q){const T=Q.toMap(C);return!(0,G.Wi)(T)&&O(T,(0,f.k)(),Q,k).intersects(w)}const k=new d.Z}}]);