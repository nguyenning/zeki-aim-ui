"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[4109],{54109:(y,C,o)=>{o.r(C),o.d(C,{SceneLayerSnappingSourceWorker:()=>l,default:()=>T});var g=o(15861),O=o(17626),p=o(62208),v=o(10699),f=(o(63290),o(90912),o(85931),o(8314),o(82255),o(76898)),u=o(84161),c=o(28093),m=o(13777),h=o(97126),D=o(83308),M=o(82274),L=o(51445);let l=class{constructor(){this._idToComponent=new Map,this._components=new M.Z(t=>t.bounds),this._edges=new M.Z(t=>t.bounds),this._tmpLineSegment=(0,m.Ue)(),this._tmpP1=(0,c.c)(),this._tmpP2=(0,c.c)(),this._tmpP3=(0,c.c)(),this.remoteClient=null}fetchCandidates(t,e){var n=this;return(0,g.Z)(function*(){yield Promise.resolve(),(0,v.k_)(e),yield n._ensureEdgeLocations(t,e);const s=[];return n._edges.forEachNeighbor(_=>n._addCandidates(t,_,s),t.bounds),{result:{candidates:s}}})()}_ensureEdgeLocations(t,e){var n=this;return(0,g.Z)(function*(){const s=[];if(n._components.forEachNeighbor(i=>{if((0,p.Wi)(i.info)){const{id:d,uid:r}=i;s.push({id:d,uid:r})}},t.bounds),!s.length)return;const _={components:s},a=yield n.remoteClient.invoke("fetchAllEdgeLocations",_,(0,p.Pt)(e,{}));for(const i of a.components)n._setFetchEdgeLocations(i)})()}add(t){var e=this;return(0,g.Z)(function*(){const n=new j(t.id,t.bounds);return e._idToComponent.set(n.id,n),e._components.add([n]),{result:{}}})()}remove(t){var e=this;return(0,g.Z)(function*(){const n=e._idToComponent.get(t.id);if(n){const s=[];e._edges.forEachNeighbor(_=>{_.component===n&&s.push(_)},n.bounds),e._edges.remove(s),e._components.remove([n]),e._idToComponent.delete(n.id)}return{result:{}}})()}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if((0,p.Wi)(e)||t.uid!==e.uid)return;const n=L.extractComponentsEdgeLocationsLayout.createView(t.locations),s=new Array(n.count),_=(0,c.c)(),a=(0,c.c)();for(let r=0;r<n.count;r++){const P=(0,h.c)(),E=(0,h.g)(P);n.position0.getVec(r,_),n.position1.getVec(r,a),(0,u.C)(E,E,_,.5),(0,u.C)(E,E,a,.5),(0,u.a)(E,E,t.origin),P[3]=(0,u.i)(E,_);const W=new I(e,r,P);s[r]=W}this._edges.add(s);const{objectIds:i,origin:d}=t;e.info={locations:n,objectIds:i,origin:d}}_addCandidates(t,e,n){const{locations:s,origin:_,objectIds:a}=e.component.info,i=s.position0.getVec(e.index,this._tmpP1),d=s.position1.getVec(e.index,this._tmpP2);(0,u.a)(i,i,_),(0,u.a)(d,d,_);const r=a[s.componentIndex.get(e.index)];this._addEdgeCandidate(t,r,i,d,n),this._addVertexCandidate(t,r,i,n),this._addVertexCandidate(t,r,d,n)}_addEdgeCandidate(t,e,n,s,_){if(!(t.types&D.r.EDGE))return;const a=(0,h.g)(t.bounds),i=(0,m.zk)(n,s,this._tmpLineSegment),d=(0,m.nF)(i,a,this._tmpP3);if(!(0,h.m)(t.bounds,d))return null;_.push({type:"edge",objectId:e,target:(0,c.a)(d),distance:(0,u.i)(a,d),start:(0,c.a)(n),end:(0,c.a)(s)})}_addVertexCandidate(t,e,n,s){if(!(t.types&D.r.VERTEX))return;const _=(0,h.g)(t.bounds);if(!(0,h.m)(t.bounds,n))return null;s.push({type:"vertex",objectId:e,target:(0,c.a)(n),distance:(0,u.i)(_,n)})}};function T(){return new l}l=(0,O._)([(0,f.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],l);let j=(()=>{class t{constructor(n,s){this.id=n,this.bounds=s,this.info=null,this.uid=++t.uid}}return t.uid=0,t})();class I{constructor(e,n,s){this.component=e,this.index=n,this.bounds=s}}}}]);