"use strict";var Et=Object.defineProperty,bt=Object.defineProperties,Tt=Object.getOwnPropertyDescriptors,tt=Object.getOwnPropertySymbols,St=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable,et=(C,P,s)=>P in C?Et(C,P,{enumerable:!0,configurable:!0,writable:!0,value:s}):C[P]=s,it=(C,P)=>{for(var s in P||(P={}))St.call(P,s)&&et(C,s,P[s]);if(tt)for(var s of tt(P))xt.call(P,s)&&et(C,s,P[s]);return C},at=(C,P)=>bt(C,Tt(P));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[645],{60595:(C,P,s)=>{s.d(P,{T:()=>r});var w=s(15861),o=s(84792),S=s(26584),a=s(62208);function r(W,R,M,x,T,v){return L.apply(this,arguments)}function L(){return(L=(0,w.Z)(function*(W,R,M,x,T,v){let E=null;if((0,a.pC)(M)){const I=`${W}/nodepages/`,A=I+Math.floor(M.rootIndex/M.nodesPerPage);try{return{type:"page",rootPage:(yield(0,o.default)(A,{query:{f:"json",token:x},responseType:"json",signal:v})).data,rootIndex:M.rootIndex,pageSize:M.nodesPerPage,lodMetric:M.lodSelectionMetricType,urlPrefix:I}}catch(h){(0,a.pC)(T)&&T.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",A,h),E=h}}if(!R)return null;const y=`${W}/nodes/`,d=y+(R&&R.split("/").pop());try{return{type:"node",rootNode:(yield(0,o.default)(d,{query:{f:"json",token:x},responseType:"json",signal:v})).data,urlPrefix:y}}catch(I){throw new S.Z("sceneservice:root-node-missing","Root node missing.",{pageError:E,nodeError:I,url:d})}})).apply(this,arguments)}},1437:(C,P,s)=>{s.d(P,{p:()=>x});var w=s(17626),o=s(54024),S=s(62208),a=s(60330),r=s(77712),M=(s(85931),s(8314),s(90912),s(76898));const x=T=>{let v=class extends((0,a.v)(T)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(E){this._userInteractive=E}get updating(){return!1}get visible(){return!(0,S.pC)(this.parent)||this.parent.visible&&!this.parent.suspended}set visible(E){void 0!==E?this._override("visible",E):this._clearOverride("visible")}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,o.kB)(()=>this._interactiveViewModelCount--)}};return(0,w._)([(0,r.Cb)({readOnly:!0})],v.prototype,"type",void 0),(0,w._)([(0,r.Cb)({constructOnly:!0})],v.prototype,"analysis",void 0),(0,w._)([(0,r.Cb)({constructOnly:!0})],v.prototype,"parent",void 0),(0,w._)([(0,r.Cb)({constructOnly:!0})],v.prototype,"view",void 0),(0,w._)([(0,r.Cb)({type:Boolean})],v.prototype,"interactive",null),(0,w._)([(0,r.Cb)()],v.prototype,"_userInteractive",void 0),(0,w._)([(0,r.Cb)({readOnly:!0})],v.prototype,"updating",null),(0,w._)([(0,r.Cb)()],v.prototype,"visible",null),(0,w._)([(0,r.Cb)()],v.prototype,"_interactiveViewModelCount",void 0),v=(0,w._)([(0,M.j)("esri.views.3d.analysis.AnalysisView3D")],v),v}},99688:(C,P,s)=>{s.r(P),s.d(P,{default:()=>Ct});var w=s(15861),o=s(17626),S=s(14517),a=s(62208),r=s(77712),M=(s(85931),s(8314),s(90912),s(76898)),x=s(1437),T=s(25706),v=s(72392),E=s(63290),y=s(32917),d=s(41743),I=s(44917),A=s(49410),h=s(96298),st=s(54865),nt=s(61779);const Z=E.Z.getLogger("esri.views.3d.analysis.Slice.SliceController");let b=class extends S.Z{constructor(t){super(t),this._handles=new v.Z,this._internalChange=!1,this._currentSlicePlane=null,this.state="ready"}get ready(){return"ready"===this.state}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",t=>{const e=t.item;null!=e&&(e instanceof I.Z||e instanceof A.Z)?e instanceof I.Z&&(0,nt.xk)(e)?(Z.error("excludedLayers",`Layer '${e.title}, id:${e.id}' of type '${e.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),t.preventDefault()):this.analysis.excludedLayers.includes(e)&&t.preventDefault():(Z.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),t.preventDefault())})),function rt(t,e){O.has(t)||O.set(t,{all:[],activeController:null}),O.get(t).all.push(e)}(this.view,this),this._handles.add([(0,y.YP)(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),(0,y.YP)(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),(0,y.YP)(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),(0,y.YP)(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([(0,y.YP)(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){"destroyed"!==this.state&&(this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function ot(t,e){if(!O.has(t))throw new Error("view expected in global slice register");const i=O.get(t),n=i.all.lastIndexOf(e);if(-1===n)throw new Error("controller expected in global slice register");i.all.splice(n,1),0===i.all.length&&O.delete(t)}(this.view,this),this._handles.destroy(),this.set("view",null),this._set("state","destroyed"))}whenReady(){var t=this;return(0,w.Z)(function*(){return yield(0,y.N1)(()=>t.ready),t})()}get _allLayerAndSubLayerViews(){const t=this.view.allLayerViews.items;return t.concat(t.filter(h.lR).flatMap(({sublayerViews:e})=>e.items))}_updateBoundedPlaneFromSlicePlane(){const t=this.analysis.shape,e=this._currentSlicePlane;if((0,a.Wi)(e)&&(0,a.Wi)(t)||(0,a.pC)(e)&&(0,a.pC)(t)&&t.equals(e))return;let i=null,n=null;if((0,a.pC)(t)&&(0,a.pC)(t.position)){const l=t.position.spatialReference,p=(0,h.m3)(t,this.view);(0,a.Wi)(p)&&(0,st.e)(this.analysis,l,Z),i=(0,h.oP)(p,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,d.c)()),(0,a.pC)(i)&&(n={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height})}this._currentSlicePlane=n,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=(0,h.Hq)(this.analysisViewData.plane,this.view,this.view.spatialReference,new T.Z);let i=null;(0,a.pC)(e)&&(i={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=e,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(F)return;const t=$(this.view);if(this.analysisViewData.active)(0,a.pC)(t.activeController)&&t.activeController!==this?(F=!0,t.activeController.analysisViewData.active=!1,F=!1):(0,a.pC)(t.activeController),this._updateLayerViews(),t.activeController=this;else{if((0,a.pC)(t.activeController)&&t.activeController!==this)return;(0,a.pC)(t.activeController)&&t.activeController===this&&(t.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){"ready"===this.state&&function lt(t){const e=$(t).activeController;t.slicePlane=(0,a.pC)(e)&&(0,a.pC)(e.analysisViewData.plane)&&e.analysisViewData.visible?e.analysisViewData.plane:null}(this.view)}_updateLayerViews(){const t=(0,a.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,e=[],i=n=>{"layers"in n?n.layers.forEach(i):e.push(n)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(n=>{n.destroyed||("slicePlaneEnabled"in n&&(n.slicePlaneEnabled=t&&!e.includes(n.layer)),"sublayerViews"in n&&n.sublayerViews.forEach(l=>{l.slicePlaneEnabled=t&&!e.includes(l.sublayer)}))}),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=t&&!this.analysis.excludeGroundSurface)}};(0,o._)([(0,r.Cb)({readOnly:!0})],b.prototype,"state",void 0),(0,o._)([(0,r.Cb)()],b.prototype,"view",void 0),(0,o._)([(0,r.Cb)()],b.prototype,"analysis",void 0),(0,o._)([(0,r.Cb)()],b.prototype,"analysisViewData",void 0),(0,o._)([(0,r.Cb)()],b.prototype,"ready",null),(0,o._)([(0,r.Cb)()],b.prototype,"_allLayerAndSubLayerViews",null),b=(0,o._)([(0,M.j)("esri.views.3d.analysis.Slice.SliceController")],b);const O=new Map;let F=!1;function $(t){return O.get(t)}var k,ht=s(84244),dt=s(50618),G=s(23841),H=s(28347),c=s(84161),B=s(28093),m=s(90014),pt=s(70562),_=s(26242),u=s(2589),J=s(25601),ut=s(19142),j=s(8859),ct=s(26046),vt=s(62483),yt=s(67857),Pt=s(22712),K=s(75079),z=s(41900);let g=k=class extends Pt.f{constructor(t){super(t),this.clock=ht.m,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new v.Z,this._viewHandles=new v.Z,this._frameTask=null,this._pointerMoveTimerMs=u.N3,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=(0,d.c)(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=(0,G.vW)(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=(0,vt.Z8)(t.view.state.viewingMode),this._intersector.options.store=yt.eC.MIN}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this.rotateHeadingImage=(0,J.O)(this.view.toolViewManager.textures),this.rotateTiltImage=(0,J.s)(this.view.toolViewManager.textures);const t=i=>{this._updateManipulatorsInteractive(i),i.grabbing||((0,a.pC)(this.analysisViewData.plane)&&(0,d.a)(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=(0,h.Pt)(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",i=>{this._onShiftGrab(i),t(this.shiftManipulator)}),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=(0,h.Ju)(this.view,this.rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",i=>{this._onRotateHeadingGrab(i),t(this.rotateHeadingManipulator)}),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=(0,h.Ju)(this.view,this.rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",i=>{this._onRotateTiltGrab(i),t(this.rotateTiltManipulator)}),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((i,n)=>{const l=(0,h.vw)(this.view,i);return l.events.on("grab-changed",p=>{this._onResizeGrab(p,n),t(l)}),this._handles.add(this._createResizeDragPipeline(l)),l}),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=(0,h.R_)(this.view),this._previewPlaneOutlineVisualElement=(0,h.i3)(this.view),this._previewPlaneOutlineVisualElement.width=u.q7,this._handles.add((0,y.YP)(()=>this.analysisViewData.plane,()=>this._updateManipulators(),y.Z_));const e=(0,y.YP)(()=>this.state,i=>{"sliced"===i&&this.finishToolCreation()},y.tX);this._handles.add([e,(0,y.YP)(()=>this.view.state.camera,()=>this._onCameraChange())])}destroy(){this.rotateHeadingImage=(0,a.RY)(this.rotateHeadingImage),this.rotateTiltImage=(0,a.RY)(this.rotateTiltImage),this._handles=(0,a.SC)(this._handles),this._viewHandles=(0,a.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,a.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,a.SC)(this._previewPlaneGridVisualElement)}get state(){const t=!!this.analysisViewData.plane,e=!!this.inputState;return t?t&&e?"slicing":t&&!e?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,a.pC)(this._creatingPointerId)?"grabbing":null}set analysis(t){if(null==t)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",t)}get inputState(){return this._get("inputState")}set inputState(t){this._set("inputState",t),this.analysisViewData.showGrid=(0,a.pC)(t)&&"resize"===t.type,this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return(0,a.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){(0,a.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){(0,a.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(t){this.shiftManipulator&&(this._updateManipulators(),t||this._clearPointerMoveTimeout())}onInputEvent(t){switch(t.type){case"pointer-drag":if(!N(t))return;this._isPlacingSlicePlane?this._onClickPlacePlane(t)&&t.stopPropagation():this._onPointerDrag(t)&&t.stopPropagation();break;case"pointer-move":this._onPointerMove(t);break;case"pointer-up":this._onPointerUp(t)&&t.stopPropagation();break;case"immediate-click":if(!N(t))return;this._onClickPlacePlane(t)&&t.stopPropagation();break;case"click":if(!N(t))return;this._onClickExcludeLayer(t)&&t.stopPropagation();break;case"drag":this.inputState&&t.stopPropagation();break;case"key-down":this._onKeyDown(t)&&t.stopPropagation();break;case"key-up":this._onKeyUp(t)&&t.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.editable}_onPointerDrag(t){const e=this.inputState;if(t.pointerId===this._creatingPointerId&&(0,a.pC)(e)&&"shift"===e.type){const i=(0,z.vT)(t);return this.shiftManipulator.events.emit("drag",{action:e.hasBeenDragged?"update":"start",pointerType:t.pointerType,start:i,screenPoint:i}),e.hasBeenDragged=!0,!0}return!1}_onPointerMove(t){this._lastCursorPosition.x=t.x,this._lastCursorPosition.y=t.y,this._resetPointerMoveTimeout(),"touch"!==t.pointerType&&this._updatePreviewPlane((0,z.vT)(t),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(t){if(t.pointerId===this._creatingPointerId&&(0,a.pC)(this.analysisViewData.plane)){const e=(0,z.vT)(t);return this.shiftManipulator.events.emit("drag",{action:"end",start:e,screenPoint:e}),(0,d.a)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(t){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const e=(0,z.vT)(t),i=(0,d.c)();if(this._pickPlane(e,!1,this._activeKeyModifiers,i)){if((0,d.a)(i,this._startPlane),this.analysis.shape=(0,h.Hq)(i,this.view,this.view.spatialReference,new T.Z),"pointer-drag"===t.type){const n=this._calculatePickRay(e);this.inputState=Q(n,t.pointerId,i.origin,i)}return!0}}return!1}_onClickExcludeLayer(t){return!("exclude"!==this.layersMode||!this.created||(this.view.hitTest((0,z.vT)(t)).then(e=>{if(e.results.length){const i=e.results[0],n="graphic"===(null==i?void 0:i.type)&&i.graphic;if(n){const l=n.sourceLayer||n.layer;l&&this.analysis.excludedLayers.push(l)}}else e.ground.layer?this.analysis.excludedLayers.push(e.ground.layer):this.analysis.excludeGroundSurface=!0}),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),0))}_onKeyDown(t){return(t.key===u.GI||t.key===u.tW)&&(this._activeKeyModifiers[t.key]=!0,(0,a.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(t){return!(t.key!==u.GI&&t.key!==u.tW||!this._activeKeyModifiers[t.key]||(delete this._activeKeyModifiers[t.key],(0,a.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),0))}_onShiftGrab(t){if("start"!==t.action||(0,a.Wi)(this.analysisViewData.plane))return;const e=this._calculatePickRay(t.screenPoint);(0,d.a)(this.analysisViewData.plane,this._startPlane),this.inputState=Q(e,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(t){return(0,K.Xd)(t,(e,i,n)=>{const l=this.inputState;if((0,a.Wi)(l)||"shift"!==l.type)return;const p=(0,a.pC)(this.analysisViewData.plane)?(0,d.a)(this.analysisViewData.plane,(0,d.c)()):null;i.next((0,j._N)(this.view,l.shiftPlane)).next(this._shiftDragAdjustSensitivity(l)).next(this._shiftDragUpdatePlane(l)),n.next(()=>{(0,a.pC)(p)&&this._updateBoundedPlane(p)})})}_shiftDragAdjustSensitivity(t){return e=>{if((0,a.Wi)(this.analysisViewData.plane))return null;const n=Math.min((1-Math.abs((0,c.e)((0,d.n)(this.analysisViewData.plane),e.ray.direction)/(0,c.l)(e.ray.direction)))/.001,1),l=-(0,m.jH)(this._startPlane.plane,e.renderEnd),p=-(0,m.jH)(this._startPlane.plane,t.startPoint);return t.depth=t.depth*(1-n)+l*n-p,e}}_shiftDragUpdatePlane(t){return()=>{if((0,a.Wi)(this.analysisViewData.plane))return;const e=(0,c.c)(_.WM.get(),this._startPlane.origin),i=(0,c.c)(_.WM.get(),(0,d.n)(this._startPlane));(0,c.g)(i,i,-t.depth),(0,c.a)(i,i,e);const n=(0,d.f)(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,(0,d.c)());this._updateBoundedPlane(n)}}_onRotateHeadingGrab(t){if("start"!==t.action||(0,a.Wi)(this.analysisViewData.plane))return;const e=(0,h.Rd)(this.analysisViewData.plane,this.view.renderCoordsHelper,h.aZ.HEADING,(0,m.Ue)()),i=this._calculatePickRay(t.screenPoint),n=(0,B.c)();(0,m.BR)(e,i,n)&&((0,d.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:n})}_createRotateHeadingDragPipeline(t){return(0,K.Xd)(t,(e,i,n)=>{const l=this.inputState;if((0,a.Wi)(l)||"rotate"!==l.type)return;const p=(0,a.pC)(this.analysisViewData.plane)?(0,d.a)(this.analysisViewData.plane,(0,d.c)()):null;i.next((0,j._N)(this.view,l.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(l)).next(this._rotateDragUpdatePlaneFromRotate()),n.next(()=>{(0,a.pC)(p)&&this._updateBoundedPlane(p)})})}_onRotateTiltGrab(t){if("start"!==t.action||(0,a.Wi)(this.analysisViewData.plane))return;const e=(0,h.Rd)(this.analysisViewData.plane,this.view.renderCoordsHelper,h.aZ.TILT,(0,m.Ue)()),i=this._calculatePickRay(t.screenPoint),n=(0,B.c)();(0,m.BR)(e,i,n)&&((0,d.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:n})}_createRotateTiltDragPipeline(t){return(0,K.Xd)(t,(e,i,n)=>{const l=this.inputState;if((0,a.Wi)(l)||"rotate"!==l.type)return;const p=(0,a.pC)(this.analysisViewData.plane)?(0,d.a)(this.analysisViewData.plane,(0,d.c)()):null;i.next((0,j._N)(this.view,l.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(l)).next(this._rotateDragUpdatePlaneFromRotate()),n.next(()=>{(0,a.pC)(p)&&this._updateBoundedPlane(p)})})}_rotateDragRenderPlaneToRotate(t){return e=>{if((0,a.Wi)(this.analysisViewData.plane))return null;const i=(0,m.mJ)(t.rotatePlane),n=(0,ut.Gd)(t.startPoint,e.renderEnd,this.analysisViewData.plane.origin,i);return at(it({},e),{rotateAxis:i,rotateAngle:n})}}_rotateDragUpdatePlaneFromRotate(){return t=>{if((0,a.Wi)(this.analysisViewData.plane))return;const e=(0,H.d)(_.MP.get(),t.rotateAngle,t.rotateAxis);if((0,a.Wi)(e))return;const i=(0,c.m)(_.WM.get(),this._startPlane.basis1,e),n=(0,c.m)(_.WM.get(),this._startPlane.basis2,e),l=(0,d.f)(this.analysisViewData.plane.origin,i,n,(0,d.c)());this._updateBoundedPlane(l)}}_onResizeGrab(t,e){if("start"!==t.action||(0,a.Wi)(this.analysisViewData.plane))return;const i=this._calculatePickRay(t.screenPoint),n=_.WM.get();(0,m.BR)(this.analysisViewData.plane.plane,i,n)&&((0,d.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:e,startPoint:(0,B.a)(n)})}_createResizeDragPipeline(t){return(0,K.Xd)(t,(e,i,n)=>{const l=this.inputState;if((0,a.Wi)(l)||"resize"!==l.type||(0,a.Wi)(this.analysisViewData.plane))return;const p=(0,d.a)(this.analysisViewData.plane,(0,d.c)());i.next((0,j._N)(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(l)),n.next(()=>{this._updateBoundedPlane(p)})})}_resizeDragUpdatePlane(t){return e=>{if((0,a.Wi)(this.analysisViewData.plane))return;const n=(0,h.Q3)(this._resizeHandles[t.activeHandleIdx],t.startPoint,e.renderEnd,this.view.state.camera,this._startPlane,(0,d.a)(this.analysisViewData.plane));this._updateBoundedPlane(n)}}_updateBoundedPlane(t){const e=this.analysisViewData;if(!(0,a.pC)(e))throw new Error("valid internal object expected");e.plane=t}_updatePreviewPlane(t,e={}){let i=this._previewPlane;if(this._previewPlane=null,(0,a.Wi)(t))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const n=(0,a.pC)(i)?i:(0,d.c)();if(i=(0,a.pC)(i)?(0,d.a)(i,_t):null,this._pickPlane(t,!0,e,n)){const l=u.Vj;let p=!1;(0,a.pC)(i)&&(p=(0,c.e)(i.plane,n.plane)<l||(0,c.e)((0,c.n)(_.WM.get(),i.basis1),(0,c.n)(_.WM.get(),n.basis1))<l),p&&(this._previewPlaneOpacity=0),this._previewPlane=n}}(0,a.pC)(this._previewPlane)&&(0,a.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,dt.A)({update:({deltaTime:n})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+n/(1e3*u.Fj),1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):(0,a.Wi)(this._previewPlane)&&(0,a.pC)(this._frameTask)?this._removeFrameTask():(0,a.pC)(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){this._frameTask=(0,a.hw)(this._frameTask)}_calculatePickRay(t){const e=(0,pt.Ue)(),i=(0,G.md)(t,wt);return(0,ct.u4)(this.view.state.camera,i,e),(0,c.n)(e.direction,e.direction),e}_pickMinResult(t){const e=(0,G.md)(t,_.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector),this._intersector.results.min}_pickPlane(t,e,i,n){const l=this._pickMinResult(t),p=_.WM.get();if(!l.getIntersectionPoint(p))return!1;const f=l.getTransformedNormal(_.WM.get()),U=this.view.state.camera;(0,c.e)(f,U.viewForward)>0&&(0,c.g)(f,f,-1);const Y=(0,h.fT)(p,U),mt=(e?1:-1)*Y*u.go,X=(0,c.g)(_.WM.get(),f,mt);return(0,c.a)(X,X,p),(0,h.j6)(X,f,Y,Y,U,i[u.GI]?h.ww.VERTICAL:i[u.tW]?h.ww.HORIZONTAL:this.analysis.tiltEnabled?h.ww.TILTED:h.ww.HORIZONTAL_OR_VERTICAL,this.view.renderCoordsHelper,n),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,a.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=h.do,this.rotateHeadingManipulator.state|=h.do,this.rotateTiltManipulator.state|=h.do,this._prevPointerMoveTimeout=this.clock.setTimeout(()=>{this.shiftManipulator.state&=~h.do,this.rotateHeadingManipulator.state&=~h.do,this.rotateTiltManipulator.state&=~h.do},this._pointerMoveTimerMs)}_updateManipulators(){if(k.disableEngineLayers)return;let t=null,e=!1;if((0,a.pC)(this.analysisViewData.plane))t=this.analysisViewData.plane,e=!1;else{if(!(0,a.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(f=>f.available=!1),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);t=this._previewPlane,e=!0}const i=(0,h.zY)(t,_.MP.get());e?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(f=>f.available=!1),this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach(f=>f.available=!0),(0,h.tF)(this.shiftManipulator,i,t,this.view.state.camera),(0,h.A5)(this.rotateHeadingManipulator,i,t,this.view.renderCoordsHelper),(0,h.wj)(this.rotateTiltManipulator,i,t),this.resizeManipulators.forEach((f,U)=>(0,h.EC)(f,this._resizeHandles[U],i,t)),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const n=(0,c.s)(_.WM.get(),(0,c.l)(t.basis1),(0,c.l)(t.basis2),1),l=(0,H.u)(_.MP.get(),n),p=(0,H.m)(l,i,l);this._previewPlaneOutlineVisualElement.transform=p,this._previewPlaneGridVisualElement.transform=p,this._updateMaterials()}_updateMaterials(){this._previewPlaneOutlineVisualElement.color=[u.hf[0],u.hf[1],u.hf[2],u.hf[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.backgroundColor=[u.wk[0],u.wk[1],u.wk[2],u.wk[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.gridColor=[0,0,0,0]}_updateManipulatorsInteractive(t){if(!t.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach(e=>{e.interactive=!0});this.shiftManipulator.interactive=this.shiftManipulator===t,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===t,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===t,this.resizeManipulators.forEach(e=>{e.interactive=e===t})}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:t=>{this._pointerMoveTimerMs=t}}}};function Q(t,e,i,n){const l=(0,h.TA)(i,(0,d.n)(n),t.direction,(0,m.Ue)()),p=(0,B.c)();return(0,m.BR)(l,t,p)?{type:"shift",creatingPointerId:e,hasBeenDragged:!1,shiftPlane:l,depth:0,startPoint:p}:null}function N(t){return"mouse"!==t.pointerType||0===t.button}g.disableEngineLayers=!1,(0,o._)([(0,r.Cb)()],g.prototype,"clock",void 0),(0,o._)([(0,r.Cb)({constructOnly:!0})],g.prototype,"view",void 0),(0,o._)([(0,r.Cb)()],g.prototype,"analysisViewData",void 0),(0,o._)([(0,r.Cb)({readOnly:!0})],g.prototype,"state",null),(0,o._)([(0,r.Cb)({readOnly:!0})],g.prototype,"cursor",null),(0,o._)([(0,r.Cb)()],g.prototype,"analysis",null),(0,o._)([(0,r.Cb)()],g.prototype,"removeIncompleteOnCancel",void 0),(0,o._)([(0,r.Cb)({readOnly:!0})],g.prototype,"layersMode",void 0),(0,o._)([(0,r.Cb)({value:null})],g.prototype,"inputState",null),(0,o._)([(0,r.Cb)()],g.prototype,"_isPlacingSlicePlane",null),(0,o._)([(0,r.Cb)()],g.prototype,"_creatingPointerId",null),g=k=(0,o._)([(0,M.j)("esri.views.3d.analysis.Slice.SliceTool")],g);const _t=(0,d.c)(),wt=(0,G.s1)(),gt=g;var Mt=s(4794),ft=s(54889);let V=class extends S.Z{constructor(t){super(t),this._handles=new v.Z,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.preview=!0}get ready(){return"ready"===this.state}initialize(){this._initialize()}_initialize(){var t=this;return(0,w.Z)(function*(){if("destroyed"===t.state||"ready"===t.state)return;yield(0,y.N1)(()=>t.view.ready);const e=t.analysisViewData;if((0,a.Wi)(e))throw new Error("expected internal object to be valid");t._gridVisualElement=(0,h.R_)(t.view),t._outlineVisualElement=(0,h.i3)(t.view),t._handles.add([(0,y.YP)(()=>({visible:(0,a.pC)(e.plane)&&t.analysisViewData.visible,active:t.analysisViewData.active,preview:t.preview,showGrid:t.showGrid}),i=>t._updateMaterials(i),y.tX),(0,y.YP)(()=>e.plane,i=>t._updatePlane(i),y.tX)],"internal"),t._set("state","ready")})()}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=(0,a.SC)(this._gridVisualElement),this._outlineVisualElement=(0,a.SC)(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}whenReady(){var t=this;return(0,w.Z)(function*(){yield(0,y.N1)(()=>t.view.ready)})()}_updatePlane(t){if((0,a.Wi)(t))return;const e=(0,c.s)(_.WM.get(),(0,c.l)(t.basis1),(0,c.l)(t.basis2),1),i=(0,H.u)(_.MP.get(),e),n=(0,h.zY)(t,_.MP.get()),l=(0,H.m)(i,n,i);this._outlineVisualElement.transform=l,this._gridVisualElement.transform=l}_updateMaterials({visible:t,active:e,preview:i,showGrid:n}){this._outlineVisualElement.color=u.hf,this._outlineVisualElement.width=i?u.q7:u.kq,this._outlineVisualElement.stipplePattern=e?null:(0,ft.z5)(5),this._gridVisualElement.backgroundColor=u.wk,this._gridVisualElement.gridColor=n?u.A:Mt.Z,this._gridVisualElement.visible=t,this._outlineVisualElement.visible=t}};(0,o._)([(0,r.Cb)({readOnly:!0})],V.prototype,"state",void 0),(0,o._)([(0,r.Cb)()],V.prototype,"view",void 0),(0,o._)([(0,r.Cb)()],V.prototype,"analysis",void 0),(0,o._)([(0,r.Cb)()],V.prototype,"analysisViewData",void 0),(0,o._)([(0,r.Cb)()],V.prototype,"ready",null),(0,o._)([(0,r.Cb)()],V.prototype,"showGrid",void 0),(0,o._)([(0,r.Cb)()],V.prototype,"preview",void 0),V=(0,o._)([(0,M.j)("esri.views.3d.analysis.Slice.SliceVisualization")],V);var q=s(95925);let D=class extends((0,x.p)(S.Z)){constructor(t){super(t),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0,this.showGrid=!1}initialize(){this.analysisVisualization=new V({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new b({view:this.view,analysis:this.analysis,analysisViewData:this}),this.own((0,q.Lp)(this,gt))}destroy(){(0,q.Yq)(this),this.analysisVisualization=(0,a.SC)(this.analysisVisualization),this.analysisController=(0,a.SC)(this.analysisController)}get editable(){return!this.analysisVisualization.preview}set editable(t){this.analysisVisualization.preview=!t}when(){var t=this;return(0,w.Z)(function*(){return yield t.analysisVisualization.whenReady(),yield t.analysisController.whenReady(),t})()}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,a.Wg)(this.tool)}}};(0,o._)([(0,r.Cb)({readOnly:!0})],D.prototype,"type",void 0),(0,o._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],D.prototype,"analysis",void 0),(0,o._)([(0,r.Cb)()],D.prototype,"tool",void 0),(0,o._)([(0,r.Cb)()],D.prototype,"plane",void 0),(0,o._)([(0,r.Cb)()],D.prototype,"active",void 0),(0,o._)([(0,r.Cb)({aliasOf:"analysisVisualization.showGrid"})],D.prototype,"showGrid",void 0),(0,o._)([(0,r.Cb)()],D.prototype,"editable",null),D=(0,o._)([(0,M.j)("esri.views.3d.analysis.SliceAnalysisView3D")],D);const Ct=D}}]);