"use strict";var Et=Object.defineProperty,bt=Object.defineProperties,Mt=Object.getOwnPropertyDescriptors,Ge=Object.getOwnPropertySymbols,Ct=Object.prototype.hasOwnProperty,Dt=Object.prototype.propertyIsEnumerable,je=(j,R,i)=>R in j?Et(j,R,{enumerable:!0,configurable:!0,writable:!0,value:i}):j[R]=i,I=(j,R)=>{for(var i in R||(R={}))Ct.call(R,i)&&je(j,i,R[i]);if(Ge)for(var i of Ge(R))Dt.call(R,i)&&je(j,i,R[i]);return j},K=(j,R)=>bt(j,Mt(R));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[6212],{50978:(j,R,i)=>{i.d(R,{M:()=>X,b:()=>F});var n=i(2166),U=i(69960),c=i(65787),d=i(17625),f=i(22355),W=i(16396);function F(B){const g=new f.kG,{vertex:A,fragment:E}=g;(0,n.Sv)(A,B),A.uniforms.add(new c.p("width",_=>_.width)),g.attributes.add(W.T.POSITION,"vec3"),g.attributes.add(W.T.NORMAL,"vec3"),g.attributes.add(W.T.UV0,"vec2"),g.attributes.add(W.T.AUXPOS1,"float"),g.varyings.add("vtc","vec2"),g.varyings.add("vlength","float"),g.varyings.add("vradius","float"),A.code.add(d.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),E.uniforms.add([new c.p("outlineSize",_=>_.outlineSize),new U.N("outlineColor",_=>_.outlineColor),new c.p("stripeLength",_=>_.stripeLength),new U.N("stripeEvenColor",_=>_.stripeEvenColor),new U.N("stripeOddColor",_=>_.stripeOddColor)]);const M=1/Math.sqrt(2);return E.code.add(d.H`
    const float INV_SQRT2 = ${d.H.float(M)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),g}const X=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}))},96212:(j,R,i)=>{i.r(R),i.d(R,{default:()=>yt});var n=i(17626),U=i(14517),c=i(62208),d=i(77712),F=(i(90912),i(85931),i(76898)),X=i(39691),B=i(1437),g=i(74554),A=i(72392),E=i(63290),M=i(15572),_=i(32917),C=i(84161),b=i(28093),$=i(44766),v=i(55214),L=i(55915),N=i(81863),k=i(10049),H=i(54865),Pe=i(68);const Ee="esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController",o=E.Z.getLogger(Ee);let p=class extends U.Z{constructor(e){super(e),this._unitNormalizer=new Pe.D,this._handles=new A.Z,this._tempStartPosition=(0,b.c)(),this._tempEndPosition=(0,b.c)(),this._tempCornerPosition=(0,b.c)()}initialize(){const e=this.view.spatialReference,t=(0,N.rS)(e),s=t===N.GG?N.wY:t;this._sphericalPCPF=s;const r=(0,L.Up)(e,s);this._unitNormalizer.spatialReference=r?s:e,this._handles.add([(0,_.YP)(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:a,startPoint:l})=>{a.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(l)},_.tX),(0,_.YP)(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:a,endPoint:l})=>{a.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(l)},_.tX),(0,_.YP)(()=>({result:this._computedResult,viewData:this.viewData}),({result:a,viewData:l})=>{l.result=a},_.tX)])}destroy(){this._handles=(0,c.SC)(this._handles)}_applyProjectionAndElevationAlignment(e){if((0,c.Wi)(e))return e;const{spatialReference:t,elevationProvider:s}=this.view,r=(0,H.G)(e,t,s);return(0,c.Wi)(r)?((0,H.e)(this.analysis,e.spatialReference,o),null):r}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:s}=this.viewData;if((0,c.Wi)(e)||(0,c.Wi)(t))return null;const r=this._euclideanDistances(e,t),a=this._geodesicDistance(e,t,r.horizontal.value),l=s===g.e.Geodesic||s===g.e.Auto&&r.horizontal.value>1e5?"geodesic":"euclidean";return{mode:l,distance:"euclidean"===l?r.direct:a,directDistance:r.direct,horizontalDistance:r.horizontal,verticalDistance:r.vertical,geodesicDistance:a}}_euclideanDistances(e,t){const s=e.clone();s.z=t.z;const r=this._tempStartPosition,a=this._tempEndPosition,l=this._tempCornerPosition,y=this.view.spatialReference,m=this._sphericalPCPF,u=(0,L.Up)(y,m)?m:y;(0,L.KC)(e,r,u),(0,L.KC)(t,a,u),(0,L.KC)(s,l,u);const O=(0,C.i)(r,a),P=(0,C.i)(l,a),z=Math.abs(t.z-e.z),G=me=>this._unitNormalizer.normalizeDistance(me),V=G(O),ne=G(P),_e=G(z);return{direct:(0,M.EV)(V,"meters"),horizontal:(0,M.EV)(ne,"meters"),vertical:(0,M.EV)(_e,"meters")}}_geodesicDistance(e,t,s){const r=e.spatialReference,a=new v.Z({spatialReference:r});a.addPath([e,t]);const l=r.isGeographic&&(0,k.Gb)(r)?(0,k.Jf)([a],"meters")[0]:r.isWebMercator?(0,$.geodesicLength)(a,"meters"):null,y=(0,c.pC)(l)?l:this._fallbackGeodesicDistance(e,t,s);return(0,M.EV)(y,"meters")}_fallbackGeodesicDistance(e,t,s){if((0,L.UY)(e,D)&&(0,L.UY)(t,q)){const r=new k._q;return(0,k.cA)(r,D,q),r.distance}return s}};(0,n._)([(0,d.Cb)()],p.prototype,"view",void 0),(0,n._)([(0,d.Cb)()],p.prototype,"analysis",void 0),(0,n._)([(0,d.Cb)()],p.prototype,"viewData",void 0),(0,n._)([(0,d.Cb)()],p.prototype,"_computedResult",null),p=(0,n._)([(0,F.j)(Ee)],p);const D=(0,b.c)(),q=(0,b.c)();var w,J,e,ee=i(15861),Z=i(91558),Y=(i(52515),i(51819)),te=i(21286),x=i(84600),le=i(23841),Se=i(16730),Ae=i(67831);(e=w||(w={}))[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(J||(J={}));var be=i(495),ce=i(67214),he=i(87469),Ue=i(43703),ae=i(4794),ue=i(26242),We=i(53928),xe=i(57521),se=i(40723),Ie=i(19625),Be=i(13934),Ke=i(60881),Fe=i(5894),ie=i(16396),Ne=i(651),He=i(91056),Me=i(87601),Ze=i(39114),we=i(88569),Ye=i(12407),Ce=i(44835),Qe=i(41528),Xe=i(50978),Te=i(67969),De=i(2078);class ge extends He.A{constructor(t,s,r){super(t,s,r)}initializeProgram(t){return new Ye.$(t.rctx,ge.shader.get().build(this.configuration),Ze.i)}_setPipelineState(t){return(0,De.sm)({blending:this.configuration.transparent?t===Ce.A.NONE?we.wu:(0,we.j7)(t):null,polygonOffset:this.configuration.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:Te.wb.LESS},depthWrite:De.LZ,colorWrite:De.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return Te.MX.TRIANGLE_STRIP}}ge.shader=new Ne.J(Xe.M,()=>i.e(3368).then(i.bind(i,3368)));class ve extends Qe.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=Ce.A.NONE}}(0,n._)([(0,Me.o)()],ve.prototype,"polygonOffsetEnabled",void 0),(0,n._)([(0,Me.o)()],ve.prototype,"transparent",void 0),(0,n._)([(0,Me.o)({count:Ce.A.COUNT})],ve.prototype,"transparencyPassType",void 0);class Je extends se.F5{constructor(t){super(t,new ke),this._configuration=new ve}getConfiguration(t,s){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this._configuration.transparencyPassType=s.transparencyPassType,this._configuration}dispose(){}intersect(){}requiresSlot(t,s){return s===Be.H.Color&&t===Fe.r.OPAQUE_MATERIAL}createGLMaterial(t){return new $e(t)}createBufferWriter(){return new at}}class $e extends Ke.Z{beginSlot(t){return this.ensureTechnique(ge,t)}}class ke extends se.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,ae.f)(1,.5,0,1),this.stripeEvenColor=(0,ae.f)(1,1,1,1),this.stripeOddColor=(0,ae.f)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const qe=(0,Ie.U$)().vec3f(ie.T.POSITION).vec3f(ie.T.NORMAL).vec2f(ie.T.UV0).f32(ie.T.AUXPOS1),et=(0,b.c)(),tt=(0,b.c)(),it=(0,b.c)(),st=(0,b.c)(),rt=(0,b.c)();class at{constructor(){this.vertexBufferLayout=qe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 2*(t.indices.get(ie.T.POSITION).length/2+1)}write(t,s,r,a,l){const y=r.vertexAttributes.get(ie.T.POSITION).data,m=r.vertexAttributes.get(ie.T.NORMAL).data,u=y.length/3,O=r&&r.indices&&r.indices.get(ie.T.POSITION);O&&O.length!==2*(u-1)&&console.warn("MeasurementArrowMaterial does not support indices");const P=et,z=tt,G=it,V=st,ne=rt,_e=a.position,me=a.normal,pe=a.uv0;let ye=0;for(let Q=0;Q<u;++Q){const fe=3*Q;if((0,C.s)(P,y[fe],y[fe+1],y[fe+2]),Q<u-1){const oe=3*(Q+1);(0,C.s)(z,y[oe],y[oe+1],y[oe+2]),(0,C.s)(ne,m[oe],m[oe+1],m[oe+2]),(0,C.n)(ne,ne),(0,C.b)(G,z,P),(0,C.n)(G,G),(0,C.f)(V,ne,G),(0,C.n)(V,V)}const Pt=(0,C.i)(P,z);t&&s&&((0,C.m)(P,P,t),(0,C.m)(z,z,t),(0,C.m)(V,V,s));const de=l+2*Q,Oe=de+1;_e.setVec(de,P),_e.setVec(Oe,P),me.setVec(de,V),me.setVec(Oe,V),pe.set(de,0,ye),pe.set(de,1,-1),pe.set(Oe,0,ye),pe.set(Oe,1,1),Q<u-1&&(ye+=Pt)}const Ot=a.auxpos1;for(let Q=0;Q<2*u;++Q)Ot.set(l+Q,ye)}}class nt extends We._{constructor(t){super(t),this._parameters={arrowWidth:16,arrowOutlineColor:Z.Z.toUnitRGBA((0,Y.e9)()),arrowStripeEvenColor:Z.Z.toUnitRGBA((0,Y.RN)()),arrowStripeOddColor:Z.Z.toUnitRGBA((0,Y.e9)()),arrowSubdivisions:128},this._origin=(0,b.c)(),this._originTransform=(0,Ue.c)(),this._arrowCenter=(0,b.c)(),this._renderOccluded=se.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:t}))}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(t){this._stripeLength=t,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(t){if(this._stripesEnabled=t,this.attached){const s=this.opacity,{arrowStripeEvenColor:r,arrowStripeOddColor:a}=this._parameters,l=(0,te.H)(ze,this._stripesEnabled?r:a,s);this._arrowMaterial.setParameters({stripeEvenColor:l})}}get opacity(){return this._opacity}set opacity(t){t!==this._opacity&&(this._opacity=t,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:t,arrowStripeOddColor:s,arrowOutlineColor:r}=this._parameters;this._arrowMaterial=new Je({outlineColor:r,stripeEvenColor:this._stripesEnabled?t:s,stripeOddColor:s,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new A.Z,this._handles.add((0,_.YP)(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=(0,c.SC)(this._handles)}forEachExternalMaterial(t){t(this._arrowMaterial)}createGeometries(t){if((0,c.Wi)(this._geometry)||(0,c.Wi)(this._geometry.startRenderSpace)||(0,c.Wi)(this._geometry.endRenderSpace))return;const s=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);s.transformation=this._originTransform,t.addGeometry(s),this._viewChanged()}_createArrowGeometry(t,s,r,a){const l=this.view.renderCoordsHelper,y=[],m=[],u=(O,P)=>{const z=ue.WM.get();(0,C.b)(z,O,r),y.push(z),m.push(P)};if("euclidean"===a.type){a.eval(.5,this._arrowCenter);const O=ue.WM.get();l.worldUpAtPosition(this._arrowCenter,O),u(t,O),u(s,O)}else{a.eval(.5,this._arrowCenter);const O=this._parameters.arrowSubdivisions+1&-2;for(let P=0;P<O;++P){const z=P/(O-1),G=ue.WM.get(),V=ue.WM.get();a.eval(z,G),l.worldUpAtPosition(G,V),u(G,V)}}return(0,xe.rh)(this._arrowMaterial,y,m)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,c.pC)(this._geometry)){const t=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*t})}}_updateArrowOpacity(){const t=this.opacity,{arrowStripeEvenColor:s,arrowStripeOddColor:r,arrowOutlineColor:a}=this._parameters,l=(0,te.H)(ze,this._stripesEnabled?s:r,t),y=(0,te.H)(ot,a,t),m=(0,te.H)(lt,r,t);this._arrowMaterial.setParameters({stripeEvenColor:l,outlineColor:y,stripeOddColor:m})}}const ze=(0,ae.c)(),ot=(0,ae.c)(),lt=(0,ae.c)();var ct=i(77603),re=i(64770),Re=i(54889),dt=i(56683),ht=i(41840);let T=class extends U.Z{get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,c.Wi)(e)||(0,c.Wi)(t)||e.equals(t))return w.None;const s=this.analysisView.result;if((0,c.Wi)(s))return w.Direct;if("geodesic"===s.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?w.ProjectedGeodesic:w.Direct;const{verticalDistance:r,horizontalDistance:a}=s,l=r.value,y=a.value;return Math.min(l/y,y/l)<this.triangleCollapseRatioThreshold?w.Direct:w.Triangle}get actualVisualizedMeasurement(){if((0,c.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case g.e.Auto:case g.e.Euclidean:default:return"euclidean";case g.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,c.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,c.Wi)(this._triangleOrientationOverride)!==e&&(this._triangleOrientationOverride=(0,c.Wi)(this._triangleOrientationOverride)?this._actualVisualElementsOrientation:null)}get labels(){return{direct:this._segmentLabel,horizontal:"geodesic"===this.actualVisualizedMeasurement?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}constructor(e){super(e),this._params={triangleColor:Z.Z.toUnitRGBA((0,Y.e9)(.75)),triangleLineWidth:3,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:Z.Z.toUnitRGBA((0,Y.e9)(.75)),guideLineWidth:2,guideStippleLengthPixels:6,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},this._handles=new A.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,b.c)(),this._endPosition=(0,b.c)(),this._cornerPosition=(0,b.c)(),this._startPositionAtSeaLevel=(0,b.c)(),this._endPositionAtSeaLevel=(0,b.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=J.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){var e=this;const t=this._params,s={attached:!0,view:this.view};this._segmentVisualElement=new nt(K(I({},s),{geometry:null,renderOccluded:se.yD.OccludeAndTransparent})),this._triangleVisualElement=new he.r(K(I({},s),{width:t.triangleLineWidth,color:t.triangleColor,renderOccluded:se.yD.OccludeAndTransparent})),this._rightAngleQuad=new ct.R(K(I({},s),{color:Z.Z.toUnitRGBA((0,Y.e9)(.75)),renderOccluded:se.yD.OccludeAndTransparent}));const r=K(I({},s),{polygonOffset:!0,renderOccluded:se.yD.OccludeAndTransparent});this._projectedGeodesicLine=new he.r(K(I({},r),{width:t.geodesicProjectionLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,Re.z5)(t.guideStippleLengthPixels)})),this._geodesicStartHint=new he.r(K(I({},r),{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,Re.z5)(t.guideStippleLengthPixels)})),this._geodesicEndHint=new he.r(K(I({},r),{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,Re.z5)(t.guideStippleLengthPixels)}));const a=K(I({},s),{backgroundColor:(0,Y.hU)(.6),textColor:(0,Y.uu)()});this._segmentLabel=new ce.Kc(K(I({},a),{fontSize:t.direcLabelFontSize})),this._verticalLabel=new ce.Kc(K(I({},a),{fontSize:t.verticalLabelFontSize})),this._horizontalLabel=new ce.Kc(K(I({},a),{fontSize:t.horizontalLabelFontSize})),this._handles.add([(0,_.YP)(()=>{const{elevationAlignedStartPoint:l,elevationAlignedEndPoint:y}=this.analysisView,m=this.view;return{view:m,camera:m.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:l,elevationAlignedEndPoint:y,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},l=>this._updateGeometryAndViewMode(l),_.tX),(0,_.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),l=>this._updateVisualElementVisibility(l),_.tX),(0,_.YP)(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),l=>this._updateLabelText(l),_.tX),(0,_.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),l=>this._updateLabelVisibility(l),_.tX),(0,_.YP)(()=>this._measurementArrowStripeLength,l=>this._updateSegmentStripeLength(l),_.tX),(0,dt.qe)((0,ee.Z)(function*(){return e._updateMessageBundle()}))]),this._updateMessageBundle()}destroy(){this._handles=(0,c.SC)(this._handles),this._segmentVisualElement=(0,c.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,c.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,c.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,c.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,c.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,c.SC)(this._geodesicEndHint),this._segmentLabel=(0,c.SC)(this._segmentLabel),this._verticalLabel=(0,c.SC)(this._verticalLabel),this._horizontalLabel=(0,c.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case w.None:break;case w.Direct:this._segmentVisualElement.visible=!0;break;case w.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case w.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:s,elevationAlignedStartPoint:r,elevationAlignedEndPoint:a,orientation:l,visualizedMeasurement:y,stripeLength:m}){const u=e.renderCoordsHelper;if((0,c.Wi)(u)||(0,c.Wi)(r)||(0,c.Wi)(a)||r.equals(a))return;let O=this._startPosition,P=this._endPosition;u.toRenderCoords(r,O),u.toRenderCoords(a,P);const z=l===J.AboveSegment?1:-1,G=z*(u.getAltitude(P)-u.getAltitude(O));G<0&&(O=this._endPosition,P=this._startPosition);const V="geodesic"===y?new re.u(this._startPosition,this._endPosition,u.spatialReference):new re.y(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=V,this._updateSegmentStripeLength(m),s){case w.Direct:this._updateSegment(V,l);break;case w.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:V,orientation:l,startPosition:O,endPosition:P,deltaSign:z,altitudeDelta:G});break;case w.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:l,startPosition:O,endPosition:P})}}_updateSegment(e,t){this._segmentLabel.anchor=t===J.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:s,orientation:r,startPosition:a,endPosition:l,deltaSign:y,altitudeDelta:m}){const u=this._cornerPosition;e.worldUpAtPosition(a,u),(0,C.g)(u,u,y*Math.abs(m)),(0,C.a)(u,u,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[u[0],u[1],u[2]],[l[0],l[1],l[2]]]],this._rightAngleQuad.geometry={previous:a,center:u,next:l};const O=new re.y(a,u),P=new re.y(u,l),z=function ut(e,t,s,r,a){const l=gt,y=vt;a.projectToRenderScreen(s,l),a.projectToRenderScreen(t,y);const m={segment:"bottom",horizontal:"top",vertical:l[0]<y[0]?"left":"right"};{const u=_t,O=mt;if((0,be.c)(e,s,u,a),(0,be.c)(e,t,O,a),(0,Ae.h)(u,O)>=Ve){const P=Math.sign(u[1])===Math.sign(O[1]);m.segment=P?(0,ce.jB)(m.vertical):m.vertical}else{const P=pt;(0,be.c)(s,t,P,a),(0,Ae.h)(P,O)>=Ve&&(m.segment=Math.sign(P[0])===Math.sign(O[0])?(0,ce.jB)(m.horizontal):m.horizontal)}}if(r===J.BelowSegment){const u=O=>"top"===O?"bottom":"top";m.segment=u(m.segment),m.horizontal=u(m.horizontal),m.vertical=u(m.vertical)}return m}(a,l,u,r,t);this._segmentLabel.anchor=z.segment,this._segmentLabel.geometry={type:"segment",segment:s,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:O,sampleLocation:"center"},this._verticalLabel.anchor=z.vertical,this._horizontalLabel.geometry={type:"segment",segment:P,sampleLocation:"center"},this._horizontalLabel.anchor=z.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:s,endPosition:r}){e.setAltitude(this._startPositionAtSeaLevel,0,s),e.setAltitude(this._endPositionAtSeaLevel,0,r);const a=new re.u(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new re.y(this._startPositionAtSeaLevel,s)),this._geodesicEndHint.setGeometryFromSegment(new re.y(this._endPositionAtSeaLevel,r)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=t===J.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){(0,c.pC)(e)?(this._segmentLabel.text="euclidean"===t?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const s=this._segmentLabel,r=this._horizontalLabel,a=this._verticalLabel;if(s.visible=!1,r.visible=!1,a.visible=!1,e)switch(t){case w.Direct:s.visible=!0;break;case w.Triangle:s.visible=!0,r.visible=!0,a.visible=!0;break;case w.ProjectedGeodesic:s.visible=!0}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if((0,c.Wi)(t)||(0,c.Wi)(e))return null;const{directDistance:s,horizontalDistance:r,verticalDistance:a,geodesicDistance:l}=t,y=this.analysisView.unit,m=u=>I({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},u);switch(y){case"metric":return m({euclideanDistance:s&&(0,x.Rd)(e,s),geodesicDistance:l&&(0,x.Rd)(e,l),horizontalDistance:r&&(0,x.Rd)(e,r),verticalDistance:a&&(0,x.Wv)(e,a)});case"imperial":return m({euclideanDistance:s&&(0,x.Ud)(e,s),geodesicDistance:l&&(0,x.Ud)(e,l),horizontalDistance:r&&(0,x.Ud)(e,r),verticalDistance:a&&(0,x.Zv)(e,a)});default:return m({euclideanDistance:s&&(0,x.VG)(e,s,y),geodesicDistance:l&&(0,x.VG)(e,l,y),horizontalDistance:r&&(0,x.VG)(e,r,y),verticalDistance:a&&(0,x.VG)(e,a,y)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,c.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,c.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===J.Auto?this.view.state.camera.aboveGround?J.AboveSegment:J.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(null==t||!t.state)return!1;const r=t.renderCoordsHelper,a=t.state.camera.computeScreenPixelSizeAt(e);return r.getAltitude(e)/a>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,c.Wi)(e))return null;let s=null;const r=e.directDistance;switch(t){case"metric":s=r&&(0,M.nn)(r,"meters");break;case"imperial":s=r&&(0,M.nn)(r,(0,Se.FN)(r.value,r.unit));break;default:s=r&&(0,M.nn)(r,t)}return(0,c.Wi)(s)?null:(0,te.sk)(s.value/30)*(0,Se.En)(1,s.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,ht.ME)("esri/core/t9n/Units").then(e=>{this.messages=e}).finally(()=>{this.loadingMessages=!1})}get testData(){var e;return{labels:this.labels,stripeLength:null==(e=this._segmentVisualElement)?void 0:e.stripeLength}}};(0,n._)([(0,d.Cb)()],T.prototype,"_triangleOrientationOverride",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"messages",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"view",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"analysis",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"analysisView",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"loadingMessages",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"visible",null),(0,n._)([(0,d.Cb)()],T.prototype,"viewMode",null),(0,n._)([(0,d.Cb)()],T.prototype,"actualVisualizedMeasurement",null),(0,n._)([(0,d.Cb)()],T.prototype,"visualElementOrientation",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"triangleCollapseRatioThreshold",void 0),(0,n._)([(0,d.Cb)()],T.prototype,"allowVisualElementsOrientationChange",null),(0,n._)([(0,d.Cb)()],T.prototype,"labels",null),(0,n._)([(0,d.Cb)()],T.prototype,"_labelsText",null),(0,n._)([(0,d.Cb)()],T.prototype,"_actualVisualElementsOrientation",null),(0,n._)([(0,d.Cb)()],T.prototype,"_measurementArrowStripeLength",null),T=(0,n._)([(0,F.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],T);const Ve=Math.cos((0,te.Vl)(12)),gt=(0,le.J$)(),vt=(0,le.J$)(),_t=(0,le.gX)(),mt=(0,le.gX)(),pt=(0,le.gX)();let S=class extends((0,B.p)(U.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=g.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new T({view:e,analysis:t,analysisView:this}),this._analysisController=new p({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,c.SC)(this._analysisController),this._analysisVisualization=(0,c.SC)(this._analysisVisualization)}get updating(){var e;return!(null==(e=this._analysisVisualization)||!e.loadingMessages)}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){var e,t;return null!=(t=null==(e=this._analysisVisualization.labels.direct)?void 0:e.text)?t:""}get horizontalLabelText(){var e,t;return null!=(t=null==(e=this._analysisVisualization.labels.horizontal)?void 0:e.text)?t:""}get verticalLabelText(){var e,t;return null!=(t=null==(e=this._analysisVisualization.labels.vertical)?void 0:e.text)?t:""}get unit(){return(0,c.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){var e;return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:K(I({},null==(e=this._analysisVisualization)?void 0:e.testData),{visualization:this._analysisVisualization,controller:this._analysisController})}};(0,n._)([(0,d.Cb)()],S.prototype,"updating",null),(0,n._)([(0,d.Cb)({readOnly:!0})],S.prototype,"type",void 0),(0,n._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],S.prototype,"analysis",void 0),(0,n._)([(0,d.Cb)()],S.prototype,"result",void 0),(0,n._)([(0,d.Cb)()],S.prototype,"measurementMode",void 0),(0,n._)([(0,d.Cb)()],S.prototype,"elevationAlignedStartPoint",void 0),(0,n._)([(0,d.Cb)()],S.prototype,"elevationAlignedEndPoint",void 0),(0,n._)([(0,d.Cb)({readOnly:!0})],S.prototype,"viewMode",null),(0,n._)([(0,d.Cb)({readOnly:!0})],S.prototype,"actualVisualizedMeasurement",null),(0,n._)([(0,d.Cb)()],S.prototype,"visualElementOrientation",null),(0,n._)([(0,d.Cb)()],S.prototype,"allowVisualElementsOrientationChange",null),(0,n._)([(0,d.Cb)()],S.prototype,"triangleCollapseRatioThreshold",null),(0,n._)([(0,d.Cb)({readOnly:!0})],S.prototype,"directLabelText",null),(0,n._)([(0,d.Cb)({readOnly:!0})],S.prototype,"horizontalLabelText",null),(0,n._)([(0,d.Cb)({readOnly:!0})],S.prototype,"verticalLabelText",null),(0,n._)([(0,d.Cb)()],S.prototype,"_analysisVisualization",void 0),(0,n._)([(0,d.Cb)()],S.prototype,"_analysisController",void 0),(0,n._)([(0,d.Cb)()],S.prototype,"unit",null),(0,n._)([(0,d.Cb)(X.Y)],S.prototype,"_defaultUnit",void 0),S=(0,n._)([(0,F.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],S);const yt=S},82755:(j,R,i)=>{i.d(R,{i:()=>b});var n=i(17626),U=i(14517),c=i(61996),d=i(62208),f=i(77712),X=(i(90912),i(85931),i(76898)),B=i(62600),g=i(54840),A=i(23147);class E{constructor(v){this._resourceFactory=v,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=B.eZ.Outline}destroy(){this._destroyResources()}get resources(){return(0,d.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(v){v!==this._visible&&(this._visible=v,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(v){v!==this._attached&&(this._attached=v,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(v){var N;this._renderGroup=v;const L=null==(N=(0,d.WG)(this._resources))?void 0:N.layerView;L&&(L.renderGroup=v)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?(0,d.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,d.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var k;this._destroyResources();const v=this._resourceFactory.createResources(),L=new M({view:this._resourceFactory.view,renderGroup:this._renderGroup}),N=null==(k=this._resourceFactory.view.basemapTerrain)?void 0:k.overlayManager;this._resources={layerView:new M({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:v,geometriesAdded:!1},N&&(this._resources.drapeSourceRenderer=N.registerGeometryDrapeSource(L)),this._syncGeometriesToRenderer()}_destroyResources(){var L;if((0,d.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const v=null==(L=this._resourceFactory.view.basemapTerrain)?void 0:L.overlayManager;v&&v.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,d.Wi)(this._resources)||(0,d.Wi)(this._resources.drapeSourceRenderer)||!this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,g.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,d.Wi)(this._resources)||(0,d.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,g.T.UPDATE),this._resources.geometriesAdded=!0)}}let M=class extends((0,c.IG)(U.Z)){constructor($){super($),this.drapeSourceType=B.Lw.Features,this.updatePolicy=A.j.SYNC,this.renderGroup=B.eZ.Outline}};(0,n._)([(0,f.Cb)({constructOnly:!0})],M.prototype,"view",void 0),(0,n._)([(0,f.Cb)({readOnly:!0})],M.prototype,"drapeSourceType",void 0),(0,n._)([(0,f.Cb)()],M.prototype,"renderGroup",void 0),M=(0,n._)([(0,X.j)("DrapedVisualElementLayerView")],M);var _=i(68604),C=i(94375);class b extends _.l{constructor({view:v,isDraped:L}){super(v),this._isDraped=!1,this.object3dResources=new C.O(this.createObject3DResourceFactory(v)),this.drapedResources=new E(this.createDrapedResourceFactory(v)),this.isDraped=null!=L&&L}get isDraped(){return this._isDraped}set isDraped(v){v!==this._isDraped&&(this._isDraped=v,this.object3dResources.attached=this.attached&&!v,this.drapedResources.attached=this.attached&&v)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(v){this.drapedResources.renderGroup=v}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(v){this.object3dResources.visible=v,this.drapedResources.visible=v}}},77603:(j,R,i)=>{i.d(R,{R:()=>k});var n=i(62208),U=i(32917),c=i(28347),d=i(43703),f=i(84161),W=i(28093),F=i(993),X=i(4794),B=i(26242),g=i(38114),A=i(82755),E=i(64835),M=i(94255),_=i(41120),C=i(57521),b=i(40723),$=i(64232),v=i(16396),L=i(92972),N=i(92222);class k extends A.i{constructor(o){super(o),this._maxSize=0,this._position=(0,W.c)(),this._up=(0,W.c)(),this._right=(0,W.c)(),this._renderOccluded=b.yD.OccludeAndTransparent,this._color=(0,X.f)(1,0,0,1),this._outlineColor=(0,X.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=b.yD.Opaque,this.applyProps(o)}createObject3DResourceFactory(o){return{view:o,createResources:h=>this._createObject3DResources(h),destroyResources:h=>this._destroyObject3DResources(h),cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(o){return{view:o,createResources:()=>this._createDrapedResources(),destroyResources:h=>this._destroyDrapedResources(h)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateQuadMaterial())}get color(){return this._color}set color(o){(0,F.c)(this._color,o),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(o){(0,F.c)(this._outlineColor,o),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(o){const h=0===this._outlineSize!=(0===o);this._outlineSize=o,h?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(o){o!==this._size&&(this._size=o,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(o){this._outlineRenderOccluded=o,this._updateOutlineMaterial()}set geometry({previous:o,center:h,next:p}){this._maxSize=Math.min((0,f.i)(h,o),(0,f.i)(h,p))/3,(0,f.n)(this._up,(0,f.b)(this._up,o,h)),(0,f.n)(this._right,(0,f.b)(this._right,p,h)),(0,f.c)(this._position,h),this.recreateGeometry()}_createObject3DResources(o){const h=new L.E(this._quadMaterialParameters),p=0===this._outlineSize?void 0:new N.U(this._outlineMaterialParameters);return this._createObject3DGeometries(o,h,p),{quadMaterial:h,outlineMaterial:p,forEach:D=>{D(h),p&&D(p)}}}_destroyObject3DResources(o){var h;o.quadMaterial.dispose(),null==(h=o.outlineMaterial)||h.dispose()}_createObject3DGeometries(o,h,p){if((0,f.k)(this._up,W.Z)&&(0,f.k)(this._right,W.Z))return;const D=this._createGeometries(h,p);for(const q of D)o.addGeometry(q);this._updateTransformObject3D(o)}_createDrapedResources(){const o=new L.E(this._quadMaterialParameters),h=0===this._outlineSize?void 0:new N.U(this._outlineMaterialParameters),p=this._createGeometries(o,h).map(D=>new $.z(D,{boundingInfo:D.boundingInfo}));return this._setTransformDraped(p),{quadMaterial:o,outlineMaterial:h,geometries:p,pixelRatioHandle:(0,U.YP)(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()})}}_destroyDrapedResources(o){var h;o.pixelRatioHandle.remove(),o.geometries=[],null==(h=o.outlineMaterial)||h.dispose(),o.quadMaterial.dispose()}_createGeometries(o,h){const{up:p,right:D,corner:q}=this._getVertices(),ee=this._quadGeometryData(p,D,q,o);return h?[ee,(0,C.rh)(h,[p,q,D])]:[ee]}_getVertices(){let o=this._up,h=this._right;const p=(0,f.a)(B.WM.get(),o,h);return this.isDraped&&(o=(0,f.c)(B.WM.get(),o),h=(0,f.c)(B.WM.get(),h),o[2]=0,h[2]=0,p[2]=0),{up:o,right:h,corner:p}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(o=(0,n.WG)(this.object3dResources.object)){if(!o)return;const p=this._size*this.view.state.camera.computeScreenPixelSizeAt(this._position),D=Math.min(this._maxSize,p);(0,c.f)(H,this._position),(0,c.k)(H,H,[D,D,D]),o.transformation=H}_setTransformDraped(o){if(0===o.length)return;const{view:{basemapTerrain:{overlayManager:h},state:{contentPixelRatio:p}}}=this,{_position:D,_size:q}=this,ee=(0,f.c)(B.WM.get(),D);ee[2]=E.Rn;const Z=Pe;Z.spatialReference=(0,n.Wg)(h.renderer.spatialReference),Z.x=ee[0],Z.y=ee[1];const Le=q*(h.overlayPixelSizeInMapUnits(Z)*p),Y=Math.min(this._maxSize,Le);(0,c.f)(H,ee),(0,c.k)(H,H,[Y,Y,1]);for(const te of o)te.updateTransformation(x=>{(0,c.c)(x,H)})}_quadGeometryData(o,h,p,D){return new _.Z(D,[[v.T.POSITION,new M.a([0,0,0,...h,...o,...p],3,!0)]],[[v.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){var o,h;null==(o=(0,n.WG)(this.object3dResources.resources))||o.quadMaterial.setParameters(this._quadMaterialParameters),null==(h=(0,n.WG)(this.drapedResources.resources))||h.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){var o,h,p,D;null==(h=null==(o=(0,n.WG)(this.object3dResources.resources))?void 0:o.outlineMaterial)||h.setParameters(this._outlineMaterialParameters),null==(D=null==(p=(0,n.WG)(this.drapedResources.resources))?void 0:p.outlineMaterial)||D.setParameters(this._outlineMaterialParameters)}}const H=(0,d.c)(),Pe=(0,g.Tx)(0,0,void 0,null)},94375:(j,R,i)=>{i.d(R,{O:()=>X});var n=i(62208),U=i(32917),c=i(24425),d=i(97272),f=i(81695),W=i(23147),F=i(34103);class X{constructor(g){this._resourceFactory=g,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,n.pC)(this._resources)?this._resources.object:null}get resources(){return(0,n.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(g){g!==this._visible&&(this._visible=g,this._syncVisible())}get attached(){return this._attached}set attached(g){g!==this._attached&&(this._attached=g,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const g=this._resourceFactory.view._stage;if((0,n.Wi)(this._resources)||!g)return;const A=this._resources.object;this._resources.external.forEach(E=>{E.type!==c.U.Mesh&&E.type!==c.U.Line&&E.type!==c.U.Point||g.remove(E)}),A.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,A,this._resources.layer),this._resources.external.forEach(E=>{E.type!==c.U.Mesh&&E.type!==c.U.Line&&E.type!==c.U.Point||g.add(E)})}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const g=this._resourceFactory,A=g.view,E=A._stage;if(!E)return;const M=new F.F({pickable:!1,updatePolicy:W.j.SYNC});E.add(M);const _=new d.T({castShadow:!1}),C=g.createResources(_,M);C.forEach(v=>{E.add(v),v instanceof f.x&&E.loadImmediate(v)}),E.add(_),M.add(_);const b=g.cameraChanged,$=b?(0,U.YP)(()=>A.state.camera,v=>b(v),U.nn):null;this._resources={layer:M,object:_,external:C,cameraHandle:$},this._syncVisible()}_destroyResources(){var A;if((0,n.Wi)(this._resources))return;const g=this._resourceFactory.view._stage;g&&(g.remove(this._resources.object),g.remove(this._resources.layer),this._resources.external.forEach(E=>g.remove(E))),this._resources.object.dispose(),null==(A=this._resources.cameraHandle)||A.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){(0,n.Wi)(this._resources)||(this._resources.object.visible=this._visible)}}}}]);