"use strict";var q=Object.defineProperty,O=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,C=(m,h,l)=>h in m?q(m,h,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[h]=l,$=(m,h)=>{for(var l in h||(h={}))_.call(h,l)&&C(m,l,h[l]);if(O)for(var l of O(h))ee.call(h,l)&&C(m,l,h[l]);return m};(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[5362],{95362:(m,h,l)=>{l.r(h),l.d(h,{applyEdits:()=>J});var F,e,g=l(15861),G=l(88879),b=l(46160),d=l(26584),B=l(58817),f=l(62208),D=l(21726),W=l(35948),N=l(93555),V=l(47519),x=l(6733);(e=F||(F={})).GLTF_BINARY="3D_glb",e.GLTF_JSON="3D_gltf";var w=l(72469);function z(e){return e&&null!=e.applyEdits}function J(e,t,r){return v.apply(this,arguments)}function v(){return v=(0,g.Z)(function*(e,t,r,n={}){var o;let s,p;const u={edits:r,result:new Promise((a,c)=>{s=a,p=c})};e.emit("apply-edits",u);try{const{results:a,edits:c}=yield M(e,t,r,n),i=H=>H.filter(K=>!K.error).map(B.d9),y={edits:c,addedFeatures:i(a.addFeatureResults),updatedFeatures:i(a.updateFeatureResults),deletedFeatures:i(a.deleteFeatureResults),addedAttachments:i(a.addAttachmentResults),updatedAttachments:i(a.updateAttachmentResults),deletedAttachments:i(a.deleteAttachmentResults),exceededTransferLimit:!1};return null!=(o=a.editedFeatureResults)&&o.length&&(y.editedFeatures=a.editedFeatureResults),(y.addedFeatures.length||y.updatedFeatures.length||y.deletedFeatures.length||y.addedAttachments.length||y.updatedAttachments.length||y.deletedAttachments.length)&&(e.emit("edits",y),(0,x.lQ)(e)&&x.dU.emit("edits",{layer:e,event:y})),s(y),a}catch(a){throw p(a),a}}),v.apply(this,arguments)}function M(e,t,r,n){return A.apply(this,arguments)}function A(){return A=(0,g.Z)(function*(e,t,r,n){var u,o,a,c,i,y;if(yield e.load(),!z(t))throw new d.Z(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,w.ln)(e))throw new d.Z(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:s,options:p}=yield P(e,r,n);return(null==(u=s.addFeatures)?void 0:u.length)||(null==(o=s.updateFeatures)?void 0:o.length)||(null==(a=s.deleteFeatures)?void 0:a.length)||(null==(c=s.addAttachments)?void 0:c.length)||(null==(i=s.updateAttachments)?void 0:i.length)||(null==(y=s.deleteAttachments)?void 0:y.length)?{edits:s,results:yield t.applyEdits(s,p)}:{edits:s,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),A.apply(this,arguments)}function P(e,t,r){return I.apply(this,arguments)}function I(){return I=(0,g.Z)(function*(e,t,r){const n=t&&(t.addFeatures||t.updateFeatures||t.deleteFeatures),s=t&&(t.addAttachments||t.updateAttachments||t.deleteAttachments),p=(0,f.pC)(e.infoFor3D);if(!t||!n&&!s)throw new d.Z(`${e.type}-layer:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");const u=(0,w.S1)(e);if(!u.data.isVersioned&&(null==r?void 0:r.gdbVersion))throw new d.Z(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!u.editing.supportsRollbackOnFailure&&(null==r?void 0:r.rollbackOnFailureEnabled))throw new d.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");if(!u.editing.supportsGlobalId&&(null==r?void 0:r.globalIdUsed))throw new d.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!u.editing.supportsGlobalId&&s)throw new d.Z(`${e.type}-layer:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((null==r||!r.globalIdUsed)&&s)throw new d.Z(`${e.type}-layer:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true");const o=$({},r);if(null!=o.rollbackOnFailureEnabled||u.editing.supportsRollbackOnFailure||(o.rollbackOnFailureEnabled=!0),!1===o.rollbackOnFailureEnabled&&"original-and-current-features"===o.returnServiceEditsOption)throw new d.Z(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true.");if(!u.editing.supportsReturnServiceEditsInSourceSpatialReference&&o.returnServiceEditsInSourceSR)throw new d.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(o.returnServiceEditsInSourceSR&&"original-and-current-features"!==o.returnServiceEditsOption)throw new d.Z(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const a=$({},t);if(a.addFeatures=t&&b.Z.isCollection(t.addFeatures)?t.addFeatures.toArray():a.addFeatures||[],a.updateFeatures=t&&b.Z.isCollection(t.updateFeatures)?t.updateFeatures.toArray():a.updateFeatures||[],a.deleteFeatures=t&&b.Z.isCollection(t.deleteFeatures)?t.deleteFeatures.toArray():a.deleteFeatures||[],a.addFeatures.length&&!u.operations.supportsAdd)throw new d.Z(`${e.type}-layer:unsupported-operation`,"Layer does not support adding features.");if(a.updateFeatures.length&&!u.operations.supportsUpdate)throw new d.Z(`${e.type}-layer:unsupported-operation`,"Layer does not support updating features.");if(a.deleteFeatures.length&&!u.operations.supportsDelete)throw new d.Z(`${e.type}-layer:unsupported-operation`,"Layer does not support deleting features.");a.addAttachments=a.addAttachments||[],a.updateAttachments=a.updateAttachments||[],a.deleteAttachments=a.deleteAttachments||[],a.addFeatures=a.addFeatures.map(U),a.updateFeatures=a.updateFeatures.map(U),a.addAssets=[];const c=(null==r?void 0:r.globalIdUsed)||p;return a.addFeatures.forEach(i=>Y(i,e,c)),a.updateFeatures.forEach(i=>k(i,e,c)),a.deleteFeatures.forEach(i=>j(i,e,c)),a.addAttachments.forEach(i=>T(i,e)),a.updateAttachments.forEach(i=>T(i,e)),p&&(yield X(a,e)),{edits:yield Q(a),options:o}}),I.apply(this,arguments)}function Z(e,t,r){var n,s;if(r){if("attributes"in e&&!e.attributes[t.globalIdField])throw new d.Z(`${t.type}-layer:invalid-parameter`,"Feature should have 'globalId' when 'globalIdUsed' is true");if(!("attributes"in e)&&!e.globalId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"'globalId' of the feature should be passed when 'globalIdUsed' is true")}if("geometry"in e&&(0,f.pC)(e.geometry)){if(e.geometry.hasZ&&!1===(null==(n=t.capabilities)?void 0:n.data.supportsZ))throw new d.Z(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===(null==(s=t.capabilities)?void 0:s.data.supportsM))throw new d.Z(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function Y(e,t,r){Z(e,t,r)}function j(e,t,r){Z(e,t,r)}function k(e,t,r){Z(e,t,r);const n=(0,w.S1)(t);if("geometry"in e&&(0,f.pC)(e.geometry)&&(null==n||!n.editing.supportsGeometryUpdate))throw new d.Z(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}function T(e,t){var s;const{feature:r,attachment:n}=e;if(!r||"attributes"in r&&!r.attributes[t.globalIdField])throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in r)&&!r.globalId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!n.globalId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!n.data&&!n.uploadId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(n.data instanceof File&&n.data.name||n.name))throw new d.Z(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if((null==(s=t.capabilities)||!s.editing.supportsUploadWithItemId)&&n.uploadId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof n.data){const p=(0,D.sJ)(n.data);if(p&&!p.isBase64)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function Q(e){return E.apply(this,arguments)}function E(){return E=(0,g.Z)(function*(e){var o,a;const t=null!=(o=e.addFeatures)?o:[],r=null!=(a=e.updateFeatures)?a:[],n=t.concat(r).map(c=>c.geometry),s=yield(0,N.aX)(n),p=t.length,u=r.length;return s.slice(0,p).forEach((c,i)=>t[i].geometry=c),s.slice(p,p+u).forEach((c,i)=>r[i].geometry=c),e}),E.apply(this,arguments)}function U(e){const t=new G.Z;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function X(e,t){return S.apply(this,arguments)}function S(){return S=(0,g.Z)(function*(e,t){var u,o;if((0,f.Wi)(t.infoFor3D))return;const{infoFor3D:r}=t;let n=!1;for(const a of r.editFormats)if(a===F.GLTF_BINARY){n=!0;break}const s=[];for(const a of null!=(u=e.addFeatures)?u:[])s.push(L(a,e,t,n));for(const a of null!=(o=e.updateFeatures)?o:[])s.push(L(a,e,t,n));const p=yield Promise.allSettled(s);for(const a of p)if("rejected"===a.status)throw a.reason}),S.apply(this,arguments)}function L(e,t,r,n){return R.apply(this,arguments)}function R(){return R=(0,g.Z)(function*(e,t,r,n){var i;if((0,f.Wi)(e.geometry)||"mesh"!==e.geometry.type)return;const s=e.geometry,p=r.globalIdField;if((0,f.pC)(r.parsedUrl)&&(0,f.pC)(s.external)&&Array.isArray(s.external.source)&&1===s.external.source.length&&"source"in s.external.source[0]&&"string"==typeof s.external.source[0].source&&s.external.source[0].source.startsWith(r.parsedUrl.path))return;if(!n)throw new d.Z(`${r.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");const u=yield s.toBinaryGLTF({ignoreLocalTransform:!0}),o=yield u.buffer(),a=`{${(0,W.D)()}}`,c=`${a}.glb`;null==(i=t.addAssets)||i.push({featureGlobalId:e.getAttribute(p),assetMapGlobalId:a,assetName:c,flags:(0,f.pC)(s.transform)&&s.transform.geographic?V.i.PROJECT_VERTICES:0,data:o.data,mimeType:o.type,assetType:F.GLTF_BINARY,feature:e})}),R.apply(this,arguments)}}}]);