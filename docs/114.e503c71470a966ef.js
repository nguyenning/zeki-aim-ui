"use strict";var pt=Object.defineProperty,ft=Object.defineProperties,mt=Object.getOwnPropertyDescriptors,Se=Object.getOwnPropertySymbols,gt=Object.prototype.hasOwnProperty,Ft=Object.prototype.propertyIsEnumerable,Ie=(O,F,l)=>F in O?pt(O,F,{enumerable:!0,configurable:!0,writable:!0,value:l}):O[F]=l,u=(O,F)=>{for(var l in F||(F={}))gt.call(F,l)&&Ie(O,l,F[l]);if(Se)for(var l of Se(F))Ft.call(F,l)&&Ie(O,l,F[l]);return O},m=(O,F)=>ft(O,mt(F));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[114],{30114:(O,F,l)=>{l.r(F),l.d(F,{default:()=>ht});var h=l(15861),x=l(17626),A=(l(29132),l(88879)),R=l(84792),b=l(97478),I=l(26584),_=l(8314),Z=l(2076),J=l(47996),g=l(62208),ve=l(94113),ye=l(10699),q=l(21726),S=l(77712),L=(l(85931),l(90912),l(76898)),z=l(2004),he=l(91179),be=l(56554),pe=l(15283),_e=l(2865),T=l(2618),Te=l(94573),Ee=l(33696),fe=l(82054);function Ce(r,e){return e}function V(r,e,t,n){switch(t){case 0:return N(r,e+n,0);case 1:return"lowerLeft"===r.originPosition?N(r,e+n,1):function qe({translate:r,scale:e},t,n){return r[n]-t*e[n]}(r,e+n,1)}}function me(r,e,t,n){return 2===t?N(r,e,2):V(r,e,t,n)}function je(r,e,t,n){return 2===t?N(r,e,3):V(r,e,t,n)}function Ze(r,e,t,n){return 3===t?N(r,e,3):me(r,e,t,n)}function N({translate:r,scale:e},t,n){return r[n]+t*e[n]}class De{constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=Ce,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this._attributesConstructor=()=>{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this._attributesConstructor=()=>{},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=(0,Ee.k)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(!(0,g.Wi)(t))for(const n of e.features)t(n.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const n=e.fields.map(s=>s.name);this._attributesConstructor=function(){for(const s of n)this[s]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this._deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(t,n,s)=>this.addCoordinatePoint(t,n,s),this.createGeometry=t=>this.createPointGeometry(t);break;case"esriGeometryPolygon":this.addCoordinate=(t,n,s)=>this._addCoordinatePolygon(t,n,s),this.createGeometry=t=>this._createPolygonGeometry(t);break;case"esriGeometryPolyline":this.addCoordinate=(t,n,s)=>this._addCoordinatePolyline(t,n,s),this.createGeometry=t=>this._createPolylineGeometry(t);break;case"esriGeometryMultipoint":this.addCoordinate=(t,n,s)=>this._addCoordinateMultipoint(t,n,s),this.createGeometry=t=>this._createMultipointGeometry(t);break;default:(0,Te.Bg)(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,n){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:n,queryGeometryType:s}=t,i=(0,fe.$g)(n.clone(),n,!1,!1,this.transform),d=(0,fe.di)(i,s,!1,!1);e.queryGeometryType=s,e.queryGeometry=u({},d)}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,n){switch(t=this.applyTransform(this.transform,t,n,0),n){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let n=0;return t<=1&&(n=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,n)}_addCoordinatePolyline(e,t,n){this._dehydratedAddPointsCoordinate(e.paths,t,n)}_addCoordinatePolygon(e,t,n){this._dehydratedAddPointsCoordinate(e.rings,t,n)}_addCoordinateMultipoint(e,t,n){0===n&&e.points.push([]);const s=this._transformPathLikeValue(t,n);e.points[e.points.length-1].push(s)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,n){0===n&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const s=this._transformPathLikeValue(t,n),i=e[e.length-1];0===n&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),i.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=s}_deriveApplyTransform(e){const{hasZ:t,hasM:n}=e;return t&&n?Ze:t?me:n?je:V}}var ge=l(20477),W=l(17253),K=l(84952);function X(){return(X=(0,h.Z)(function*(r,e,t){const n=(0,T.en)(r),s=u({},t),i=K.Z.from(e),d=!i.quantizationParameters,{data:c}=yield(0,ge.executeQueryPBF)(n,i,new De({sourceSpatialReference:i.sourceSpatialReference,applyTransform:d}),s);return c})).apply(this,arguments)}var Pe=l(24263),Y=l(76391),Ae=l(87183);function Je(r){const e=r.toJSON();return e.attachmentTypes&&(e.attachmentTypes=e.attachmentTypes.join(",")),e.keywords&&(e.keywords=e.keywords.join(",")),e.globalIds&&(e.globalIds=e.globalIds.join(",")),e.objectIds&&(e.objectIds=e.objectIds.join(",")),e.size&&(e.size=e.size.join(",")),e}function xe(r,e){const t={};for(const n of r){const{parentObjectId:s,parentGlobalId:i,attachmentInfos:d}=n;for(const c of d){const{id:y}=c,p=(0,q.qg)((0,Pe.Dp)(`${e}/${s}/attachments/${y}`)),f=Ae.Z.fromJSON(c);f.set({url:p,parentObjectId:s,parentGlobalId:i}),t[s]?t[s].push(f):t[s]=[f]}}return t}function Ne(r,e,t){let n={query:(0,Y.A)(u(m(u({},r.query),{f:"json"}),Je(e)))};return t&&(n=m(u(u({},t),n),{query:u(u({},t.query),n.query)})),(0,R.default)(r.path+"/queryAttachments",n)}var Ge=l(67736);function H(){return(H=(0,h.Z)(function*(r,e,t){const n=(0,T.en)(r);return Ne(n,Ge.Z.from(e),u({},t)).then(s=>xe(s.data.attachmentGroups,n.path))})).apply(this,arguments)}var Me=l(90463);function k(){return(k=(0,h.Z)(function*(r,e,t){const n=(0,T.en)(r);return(0,ge.executeQueryForExtent)(n,K.Z.from(e),u({},t)).then(s=>({count:s.data.count,extent:z.Z.fromJSON(s.data.extent)}))})).apply(this,arguments)}var Be=l(24865);function Le(r,e){const t=r.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.orderByFields&&(t.orderByFields=t.orderByFields.join(",")),!t.outFields||null!=e&&e.returnCountOnly?delete t.outFields:t.outFields=t.outFields.includes("*")?"*":t.outFields.join(","),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.dynamicDataSource&&(t.layer=JSON.stringify({source:t.dynamicDataSource}),delete t.dynamicDataSource),t}function ze(r,e,t){return w.apply(this,arguments)}function w(){return(w=(0,h.Z)(function*(r,e,t){const n=yield Re(r,e,t),s=n.data,i=s.geometryType,d=s.spatialReference,c={};for(const y of s.relatedRecordGroups){const p={fields:void 0,objectIdFieldName:void 0,geometryType:i,spatialReference:d,hasZ:!!s.hasZ,hasM:!!s.hasM,features:y.relatedRecords};if(null!=y.objectId)c[y.objectId]=p;else for(const f in y)y.hasOwnProperty(f)&&"relatedRecords"!==f&&(c[y[f]]=p)}return m(u({},n),{data:c})})).apply(this,arguments)}function Ve(r,e,t){return ee.apply(this,arguments)}function ee(){return(ee=(0,h.Z)(function*(r,e,t){const n=yield Re(r,e,t,{returnCountOnly:!0}),s=n.data,i={};for(const d of s.relatedRecordGroups)null!=d.objectId&&(i[d.objectId]=d.count);return m(u({},n),{data:i})})).apply(this,arguments)}function Re(r,e){return te.apply(this,arguments)}function te(){return(te=(0,h.Z)(function*(r,e,t={},n){const s=(0,Y.A)(u(u(m(u({},r.query),{f:"json"}),n),Le(e,n)));return(0,R.default)(r.path+"/queryRelatedRecords",m(u({},t),{query:u(u({},t.query),s)}))})).apply(this,arguments)}var M=l(67010);function re(){return(re=(0,h.Z)(function*(r,e,t){return e=M.Z.from(e),ze((0,T.en)(r),e,t).then(s=>{const i=s.data,d={};return Object.keys(i).forEach(c=>d[c]=W.default.fromJSON(i[c])),d})})).apply(this,arguments)}function ne(){return(ne=(0,h.Z)(function*(r,e,t){return e=M.Z.from(e),Ve((0,T.en)(r),e,u({},t)).then(s=>s.data)})).apply(this,arguments)}var $e=l(13924),Xe=l(61515);const Oe="Layer does not support extent calculation.";function He(r,e,t,n){return se.apply(this,arguments)}function se(){return(se=(0,h.Z)(function*(r,e,t,n){const s=yield U(r,e,"json",n);return(0,Xe.p)(e,t,s.data),s})).apply(this,arguments)}function ke(r,e,t){return oe.apply(this,arguments)}function oe(){return(oe=(0,h.Z)(function*(r,e,t){return(0,g.pC)(e.timeExtent)&&e.timeExtent.isEmpty?{data:{objectIds:[]}}:U(r,e,"json",t,{returnIdsOnly:!0})})).apply(this,arguments)}function we(r,e,t){return ae.apply(this,arguments)}function ae(){return(ae=(0,h.Z)(function*(r,e,t){return(0,g.pC)(e.timeExtent)&&e.timeExtent.isEmpty?{data:{count:0,extent:null}}:U(r,e,"json",t,{returnExtentOnly:!0,returnCountOnly:!0}).then(n=>{const s=n.data;if(s.hasOwnProperty("extent"))return n;if(s.features)throw new Error(Oe);if(s.hasOwnProperty("count"))throw new Error(Oe);return n})})).apply(this,arguments)}function et(r,e,t){return(0,g.pC)(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):U(r,e,"json",t,{returnIdsOnly:!0,returnCountOnly:!0})}function U(r,e,t,n={},s={}){const i="string"==typeof r?(0,q.mN)(r):r,d=e.geometry?[e.geometry]:[];return n.responseType="pbf"===t?"array-buffer":"json",(0,$e.aX)(d,null,n).then(c=>{const y=c&&c[0];(0,g.pC)(y)&&((e=e.clone()).geometry=y);const p=(0,Y.A)(u(u(m(u({},i.query),{f:t}),s),function Ye(r,e){var i,d;const t=r.geometry,n=r.toJSON(),s=n;if((0,g.pC)(t)&&(s.geometry=JSON.stringify(t),s.geometryType=(0,he.Ji)(t),s.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference)),null!=(i=n.topFilter)&&i.groupByFields&&(s.topFilter.groupByFields=n.topFilter.groupByFields.join(",")),null!=(d=n.topFilter)&&d.orderByFields&&(s.topFilter.orderByFields=n.topFilter.orderByFields.join(",")),n.topFilter&&(s.topFilter=JSON.stringify(s.topFilter)),n.objectIds&&(s.objectIds=n.objectIds.join(",")),n.orderByFields&&(s.orderByFields=n.orderByFields.join(",")),n.outFields&&!((null==e?void 0:e.returnCountOnly)||(null==e?void 0:e.returnExtentOnly)||(null==e?void 0:e.returnIdsOnly))?s.outFields=n.outFields.includes("*")?"*":n.outFields.join(","):delete s.outFields,n.outSR?s.outSR=n.outSR.wkid||JSON.stringify(n.outSR):t&&n.returnGeometry&&(s.outSR=s.inSR),n.returnGeometry&&delete n.returnGeometry,n.timeExtent){const c=n.timeExtent,{start:y,end:p}=c;null==y&&null==p||(s.time=y===p?y:`${null==y?"null":y},${null==p?"null":p}`),delete n.timeExtent}return s}(e,s)));return(0,R.default)((0,q.v_)(i.path,"queryTopFeatures"),m(u({},n),{query:u(u({},p),n.query)}))})}var B=l(6871);function ie(){return(ie=(0,h.Z)(function*(r,e,t,n){const s=(0,T.en)(r),i=u({},n),{data:d}=yield He(s,B.Z.from(e),t,i);return W.default.fromJSON(d)})).apply(this,arguments)}function ue(){return(ue=(0,h.Z)(function*(r,e,t){const n=(0,T.en)(r);return(yield ke(n,B.Z.from(e),u({},t))).data.objectIds})).apply(this,arguments)}function le(){return(le=(0,h.Z)(function*(r,e,t){const n=(0,T.en)(r),s=yield we(n,B.Z.from(e),u({},t));return{count:s.data.count,extent:z.Z.fromJSON(s.data.extent)}})).apply(this,arguments)}function de(){return(de=(0,h.Z)(function*(r,e,t){const n=(0,T.en)(r);return(yield et(n,B.Z.from(e),u({},t))).data.count})).apply(this,arguments)}var ot=l(14517);let D=class extends ot.Z{constructor(...r){super(...r),this.requestOptions=null,this.url=null}normalizeCtorArgs(r,e){return"string"!=typeof r?r:u({url:r},e)}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(r){return r?(0,q.mN)(r):null}_encode(r,e,t){const n={};for(const s in r){if("declaredClass"===s)continue;const i=r[s];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){n[s]=[];for(let d=0;d<i.length;d++)n[s][d]=this._encode(i[d])}else if("object"==typeof i)if(i.toJSON){const d=i.toJSON(t&&t[s]);n[s]=e?d:JSON.stringify(d)}else n[s]=e?i:JSON.stringify(i);else n[s]=i}return n}};(0,x._)([(0,S.Cb)({readOnly:!0})],D.prototype,"parsedUrl",null),(0,x._)([(0,S.Cb)()],D.prototype,"requestOptions",void 0),(0,x._)([(0,S.Cb)({type:String})],D.prototype,"url",void 0),D=(0,x._)([(0,L.j)("esri.tasks.Task")],D);const at=D;let E=class extends at{constructor(r){super(r),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(r,e){return this.executeJSON(r,e).then(t=>this.featureSetFromJSON(r,t,e))}executeJSON(r,e){var t=this;return(0,h.Z)(function*(){var p;const n=u(u({},t.requestOptions),e),s=t._normalizeQuery(r),i=null!=(null==(p=r.outStatistics)?void 0:p[0]),d=(0,_.Z)("featurelayer-pbf-statistics"),c=!i||d;let y;if("pbf"===t.format&&c)try{y=yield function Fe(r,e,t){return X.apply(this,arguments)}(t.url,s,n)}catch(f){if("query:parsing-pbf"!==f.name)throw f;t.format="json"}return"json"!==t.format&&c||(y=yield(0,_e.F)(t.url,s,n)),t._normalizeFields(y.fields),y})()}featureSetFromJSON(r,e,t){var n=this;return(0,h.Z)(function*(){if(!n._queryIs3DObjectFormat(r)||(0,g.Wi)(n.infoFor3D)||!e.features||!e.features.length)return W.default.fromJSON(e);const{meshFeatureSetFromJSON:s}=yield(0,ye.Hl)(Promise.all([l.e(8592),l.e(2579)]).then(l.bind(l,42579)),t);return s(r,n.infoFor3D,e)})()}executeForCount(r,e){const t=u(u({},this.requestOptions),e),n=this._normalizeQuery(r);return(0,Me.P)(this.url,n,t)}executeForExtent(r,e){const t=u(u({},this.requestOptions),e),n=this._normalizeQuery(r);return function Ue(r,e,t){return k.apply(this,arguments)}(this.url,n,t)}executeForIds(r,e){const t=u(u({},this.requestOptions),e),n=this._normalizeQuery(r);return(0,Be.G)(this.url,n,t)}executeRelationshipQuery(r,e){r=M.Z.from(r);const t=u(u({},this.requestOptions),e);return(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),function We(r,e,t){return re.apply(this,arguments)}(this.url,r,t)}executeRelationshipQueryForCount(r,e){r=M.Z.from(r);const t=u(u({},this.requestOptions),e);return(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),function Ke(r,e,t){return ne.apply(this,arguments)}(this.url,r,t)}executeAttachmentQuery(r,e){const t=u(u({},this.requestOptions),e);return function Qe(r,e,t){return H.apply(this,arguments)}(this.url,r,t)}executeTopFeaturesQuery(r,e){const t=u(u({},this.requestOptions),e);return function tt(r,e,t,n){return ie.apply(this,arguments)}(this.parsedUrl,r,this.sourceSpatialReference,t)}executeForTopIds(r,e){const t=u(u({},this.requestOptions),e);return function rt(r,e,t){return ue.apply(this,arguments)}(this.parsedUrl,r,t)}executeForTopExtents(r,e){const t=u(u({},this.requestOptions),e);return function nt(r,e,t){return le.apply(this,arguments)}(this.parsedUrl,r,t)}executeForTopCount(r,e){const t=u(u({},this.requestOptions),e);return function st(r,e,t){return de.apply(this,arguments)}(this.parsedUrl,r,t)}_normalizeQuery(r){let e=K.Z.from(r);if(e.sourceSpatialReference=e.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(e=e===r?e.clone():e,e.gdbVersion=r.gdbVersion||this.gdbVersion,e.dynamicDataSource=r.dynamicDataSource?pe.n.from(r.dynamicDataSource):this.dynamicDataSource),(0,g.pC)(this.infoFor3D)&&this._queryIs3DObjectFormat(r)){e=e===r?e.clone():e,e.formatOf3DObjects=null;for(const t of this.infoFor3D.queryFormats){if("3D_glb"===t.id){e.formatOf3DObjects=t.id;break}"3D_gltf"!==t.id||e.formatOf3DObjects||(e.formatOf3DObjects=t.id)}if(!e.formatOf3DObjects)throw new I.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,g.Wi)(e.outFields)||!e.outFields.includes("*")){e=e===r?e.clone():e,(0,g.Wi)(e.outFields)&&(e.outFields=[]);const{originX:t,originY:n,originZ:s,translationX:i,translationY:d,translationZ:c,scaleX:y,scaleY:p,scaleZ:f,rotationX:C,rotationY:j,rotationZ:v,rotationDeg:G}=this.infoFor3D.transformFieldRoles;e.outFields.push(t,n,s,i,d,c,y,p,f,C,j,v,G)}}return e}_normalizeFields(r){if((0,g.pC)(this.fieldsIndex)&&(0,g.pC)(r))for(const e of r){const t=this.fieldsIndex.get(e.name);t&&Object.assign(e,t.toJSON())}}_queryIs3DObjectFormat(r){return(0,g.pC)(this.infoFor3D)&&r.returnGeometry&&"xyFootprint"!==r.multipatchOption&&!r.outStatistics}};(0,x._)([(0,S.Cb)({type:pe.n})],E.prototype,"dynamicDataSource",void 0),(0,x._)([(0,S.Cb)()],E.prototype,"fieldsIndex",void 0),(0,x._)([(0,S.Cb)()],E.prototype,"format",void 0),(0,x._)([(0,S.Cb)()],E.prototype,"gdbVersion",void 0),(0,x._)([(0,S.Cb)()],E.prototype,"infoFor3D",void 0),(0,x._)([(0,S.Cb)()],E.prototype,"sourceSpatialReference",void 0),E=(0,x._)([(0,L.j)("esri.tasks.QueryTask")],E);const it=E;var ut=l(20514),lt=l(65234);const dt=new Z.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function ce(){return(ce=(0,h.Z)(function*(r){return"string"==typeof r?(0,q.sJ)(r)||{data:r}:new Promise((e,t)=>{const n=new FileReader;n.readAsDataURL(r),n.onload=()=>e((0,q.sJ)(n.result)),n.onerror=s=>t(s)})})).apply(this,arguments)}const yt=new Set(["Feature Layer","Table"]);let P=class extends J.Z{constructor(){var r;super(...arguments),r=this,this.type="feature-layer",this.refresh=(0,ye.Ds)((0,h.Z)(function*(){var n,s;yield r.load();const e=null==(n=r.sourceJSON.editingInfo)?void 0:n.lastEditDate;if(null==e)return{dataChanged:!0,updates:{}};try{yield r._fetchService(null)}catch(i){return{dataChanged:!0,updates:{}}}const t=e!==(null==(s=r.sourceJSON.editingInfo)?void 0:s.lastEditDate);return{dataChanged:t,updates:t?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null}}))}load(r){const e=(0,g.pC)(r)?r.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,e)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:r}},parsedUrl:e,dynamicDataSource:t,infoFor3D:n,gdbVersion:s,spatialReference:i,fieldsIndex:d}=this.layer,c=(0,_.Z)("featurelayer-pbf")&&r&&(0,g.Wi)(n)?"pbf":"json";return new it({url:e.path,format:c,fieldsIndex:d,infoFor3D:n,dynamicDataSource:t,gdbVersion:s,sourceSpatialReference:i})}addAttachment(r,e){var t=this;return(0,h.Z)(function*(){yield t.load();const n=r.attributes[t.layer.objectIdField],s=t.layer.parsedUrl.path+"/"+n+"/addAttachment",i=t._getLayerRequestOptions(),d=t._getFormDataForAttachment(e,i.query);try{const c=yield(0,R.default)(s,{body:d});return t._createFeatureEditResult(c.data.addAttachmentResult)}catch(c){throw t._createAttachmentErrorResult(n,c)}})()}updateAttachment(r,e,t){var n=this;return(0,h.Z)(function*(){yield n.load();const s=r.attributes[n.layer.objectIdField],i=n.layer.parsedUrl.path+"/"+s+"/updateAttachment",d=n._getLayerRequestOptions({query:{attachmentId:e}}),c=n._getFormDataForAttachment(t,d.query);try{const y=yield(0,R.default)(i,{body:c});return n._createFeatureEditResult(y.data.updateAttachmentResult)}catch(y){throw n._createAttachmentErrorResult(s,y)}})()}applyEdits(r,e){var t=this;return(0,h.Z)(function*(){yield t.load();const n=r.addFeatures.map(t._serializeFeature,t),s=r.updateFeatures.map(t._serializeFeature,t),i=t._getFeatureIds(r.deleteFeatures,null==e?void 0:e.globalIdUsed);(0,ut.P)(n,s,t.layer.spatialReference);const d=[],c=[],y=[...r.deleteAttachments];for(const G of r.addAttachments)d.push(yield t._serializeAttachment(G));for(const G of r.updateAttachments)c.push(yield t._serializeAttachment(G));const p=d.length||c.length||y.length?{adds:d,updates:c,deletes:y}:null,f={gdbVersion:(null==e?void 0:e.gdbVersion)||t.layer.gdbVersion,rollbackOnFailure:null==e?void 0:e.rollbackOnFailureEnabled,useGlobalIds:null==e?void 0:e.globalIdUsed,returnEditMoment:null==e?void 0:e.returnEditMoment,usePreviousEditMoment:null==e?void 0:e.usePreviousEditMoment,sessionId:null==e?void 0:e.sessionId};null!=e&&e.returnServiceEditsOption?(f.edits=JSON.stringify([{id:t.layer.layerId,adds:n,updates:s,deletes:i,attachments:p}]),f.returnServiceEditsOption=dt.toJSON(null==e?void 0:e.returnServiceEditsOption),f.returnServiceEditsInSourceSR=null==e?void 0:e.returnServiceEditsInSourceSR):(f.adds=n.length?JSON.stringify(n):null,f.updates=s.length?JSON.stringify(s):null,f.deletes=i.length?null!=e&&e.globalIdUsed?JSON.stringify(i):i.join(","):null,f.attachments=p&&JSON.stringify(p));const C=t._getLayerRequestOptions({method:"post",query:f}),j=null!=e&&e.returnServiceEditsOption?t.layer.url:t.layer.parsedUrl.path,v=yield(0,R.default)(j+"/applyEdits",C);return t._createEditsResult(v)})()}deleteAttachments(r,e){var t=this;return(0,h.Z)(function*(){yield t.load();const n=r.attributes[t.layer.objectIdField],s=t.layer.parsedUrl.path+"/"+n+"/deleteAttachments";try{return(yield(0,R.default)(s,t._getLayerRequestOptions({query:{attachmentIds:e.join(",")},method:"post"}))).data.deleteAttachmentResults.map(t._createFeatureEditResult)}catch(i){throw t._createAttachmentErrorResult(n,i)}})()}fetchRecomputedExtents(r={}){var e=this;return this.load({signal:r.signal}).then((0,h.Z)(function*(){const n=e._getLayerRequestOptions(m(u({},r),{query:{returnUpdates:!0}})),{layerId:s,url:i}=e.layer,{data:d}=yield(0,R.default)(`${i}/${s}`,n),{id:c,extent:y,fullExtent:p,timeExtent:f}=d,C=y||p;return{id:c,fullExtent:C&&z.Z.fromJSON(C),timeExtent:f&&b.Z.fromJSON({start:f[0],end:f[1]})}}))}queryAttachments(r,e={}){var t=this;return(0,h.Z)(function*(){const{parsedUrl:n}=t.layer,s=n.path;yield t.load();const i=t._getLayerRequestOptions(e);if(!t.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:d}=r,c=[];for(const y of d)c.push((0,R.default)(s+"/"+y+"/attachments",i));return Promise.all(c).then(y=>d.map((p,f)=>({parentObjectId:p,attachmentInfos:y[f].data.attachmentInfos}))).then(y=>xe(y,s))}return t.queryTask.executeAttachmentQuery(r,i)})()}queryFeatures(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.execute(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryFeaturesJSON(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeJSON(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryObjectIds(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeForIds(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryFeatureCount(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeForCount(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryExtent(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeForExtent(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryRelatedFeatures(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeRelationshipQuery(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryRelatedFeaturesCount(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeRelationshipQueryForCount(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryTopFeatures(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeTopFeaturesQuery(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryTopObjectIds(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeForTopIds(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryTopExtents(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeForTopExtents(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}queryTopCount(r,e){var t=this;return(0,h.Z)(function*(){return yield t.load(),t.queryTask.executeForTopCount(r,m(u({},e),{query:t._createRequestQueryOptions(e)}))})()}_createRequestQueryOptions(r){const e=u(m(u({},this.layer.customParameters),{token:this.layer.apiKey}),null==r?void 0:r.query);return this.layer.datesInUnknownTimezone&&(e.timeReferenceUnknownClient=!0),e}_fetchService(r,e){var t=this;return(0,h.Z)(function*(){if(!r){const{data:s}=yield(0,R.default)(t.layer.parsedUrl.path,t._getLayerRequestOptions({query:(0,_.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:e}));r=s}t.sourceJSON=t._patchServiceJSON(r);const n=r.type;if(!yt.has(n))throw new I.Z("feature-layer-source:unsupported-type",`Source type "${n}" is not supported`)})()}_patchServiceJSON(r){var e;if("Table"!==r.type&&r.geometryType&&(null==(e=null==r?void 0:r.drawingInfo)||!e.renderer)&&!r.defaultSymbol){const t=(0,be.bU)(r.geometryType).renderer;(0,ve.RB)("drawingInfo.renderer",t,r)}return"esriGeometryMultiPatch"===r.geometryType&&r.infoFor3D&&(r.geometryType="mesh"),r}_serializeFeature(r){const{geometry:e,attributes:t}=r;return(0,g.Wi)(e)?{attributes:t}:"mesh"===e.type||"extent"===e.type?null:{geometry:e.toJSON(),attributes:t}}_serializeAttachment(r){var e=this;return(0,h.Z)(function*(){const{feature:t,attachment:n}=r,{globalId:s,name:i,contentType:d,data:c,uploadId:y}=n,p={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(p.parentGlobalId="attributes"in t?t.attributes&&t.attributes[e.layer.globalIdField]:t.globalId),y)p.uploadId=y;else if(c){const f=yield function ct(r){return ce.apply(this,arguments)}(c);p.contentType=f.mediaType,p.data=f.data,c instanceof File&&(p.name=c.name)}return i&&(p.name=i),d&&(p.contentType=d),p})()}_getFeatureIds(r,e){const t=r[0];return t?this._canUseGlobalIds(e,r)?this._getGlobalIdsFromFeatureIdentifier(r):"objectId"in t?this._getObjectIdsFromFeatureIdentifier(r):this._getIdsFromFeatures(r):[]}_getIdsFromFeatures(r){const e=this.layer.objectIdField;return r.map(t=>t.attributes&&t.attributes[e])}_canUseGlobalIds(r,e){return r&&"globalId"in e[0]}_getObjectIdsFromFeatureIdentifier(r){return r.map(e=>e.objectId)}_getGlobalIdsFromFeatureIdentifier(r){return r.map(e=>e.globalId)}_createEditsResult(r){const e=r.data,{layerId:t}=this.layer,n=[];let s=null;if(Array.isArray(e))for(const c of e)n.push({id:c.id,editedFeatures:c.editedFeatures}),c.id===t&&(s={addResults:c.addResults,updateResults:c.updateResults,deleteResults:c.deleteResults,attachments:c.attachments,editMoment:c.editMoment});else s=e;const i=null==s?void 0:s.attachments,d={addFeatureResults:s.addResults?s.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:s.updateResults?s.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:s.deleteResults?s.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:i&&i.addResults?i.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:i&&i.updateResults?i.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:i&&i.deleteResults?i.deleteResults.map(this._createFeatureEditResult,this):[]};if(s.editMoment&&(d.editMoment=s.editMoment),n.length>0){d.editedFeatureResults=[];for(const c of n){const{adds:y,updates:p,deletes:f,spatialReference:C}=c.editedFeatures,j=C?new lt.Z(C):null;d.editedFeatureResults.push({layerId:c.id,editedFeatures:{adds:(null==y?void 0:y.map(v=>this._createEditedFeature(v,j)))||[],updates:(null==p?void 0:p.map(v=>({original:this._createEditedFeature(v[0],j),current:this._createEditedFeature(v[1],j)})))||[],deletes:(null==f?void 0:f.map(v=>this._createEditedFeature(v,j)))||[],spatialReference:j}})}}return d}_createEditedFeature(r,e){return new A.Z({attributes:r.attributes,geometry:(0,he.im)(m(u({},r.geometry),{spatialReference:e}))})}_createFeatureEditResult(r){const e=!0===r.success?null:r.error||{code:void 0,description:void 0};return{objectId:r.objectId,globalId:r.globalId,error:e?new I.Z("feature-layer-source:edit-failure",e.description,{code:e.code}):null}}_createAttachmentErrorResult(r,e){return{objectId:r,globalId:null,error:new I.Z("feature-layer-source:attachment-failure",e.details.messages&&e.details.messages[0]||e.message,{code:e.details.httpStatus||e.details.messageCode})}}_getFormDataForAttachment(r,e){const t=r instanceof FormData?r:r&&r.elements?new FormData(r):null;if(t)for(const n in e){const s=e[n];null!=s&&(t.set?t.set(n,s):t.append(n,s))}return t}_getLayerRequestOptions(r={}){const{parsedUrl:e,gdbVersion:t,dynamicDataSource:n}=this.layer;return m(u({},r),{query:u(m(u({gdbVersion:t,layer:n?JSON.stringify({source:n}):void 0},e.query),{f:"json"}),this._createRequestQueryOptions(r)),responseType:"json"})}};(0,x._)([(0,S.Cb)()],P.prototype,"type",void 0),(0,x._)([(0,S.Cb)({constructOnly:!0})],P.prototype,"layer",void 0),(0,x._)([(0,S.Cb)({readOnly:!0})],P.prototype,"queryTask",null),P=(0,x._)([(0,L.j)("esri.layers.graphics.sources.FeatureLayerSource")],P);const ht=P},90463:(O,F,l)=>{l.d(F,{P:()=>R});var h=l(15861),x=l(2618),Q=l(20477),A=l(84952);function R(I,_,Z){return b.apply(this,arguments)}function b(){return(b=(0,h.Z)(function*(I,_,Z){const J=(0,x.en)(I);return(0,Q.executeQueryForCount)(J,A.Z.from(_),u({},Z)).then(g=>g.data.count)})).apply(this,arguments)}},24865:(O,F,l)=>{l.d(F,{G:()=>R});var h=l(15861),x=l(2618),Q=l(20477),A=l(84952);function R(I,_,Z){return b.apply(this,arguments)}function b(){return(b=(0,h.Z)(function*(I,_,Z){const J=(0,x.en)(I);return(0,Q.executeQueryForIds)(J,A.Z.from(_),u({},Z)).then(g=>g.data.objectIds)})).apply(this,arguments)}}}]);