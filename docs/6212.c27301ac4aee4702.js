"use strict";var Mt=Object.defineProperty,bt=Object.defineProperties,Lt=Object.getOwnPropertyDescriptors,Re=Object.getOwnPropertySymbols,Dt=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable,ze=(G,M,t)=>M in G?Mt(G,M,{enumerable:!0,configurable:!0,writable:!0,value:t}):G[M]=t,x=(G,M)=>{for(var t in M||(M={}))Dt.call(M,t)&&ze(G,t,M[t]);if(Re)for(var t of Re(M))wt.call(M,t)&&ze(G,t,M[t]);return G},H=(G,M)=>bt(G,Lt(M));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[6212],{50978:(G,M,t)=>{t.d(M,{M:()=>U,b:()=>j});var o=t(2166),R=t(69960),_=t(65787),l=t(17625),D=t(22355),C=t(16396);function j(B){const g=new D.kG;(0,o.S)(g,B),g.vertex.uniforms.add(new _.p("width",b=>b.width)),g.attributes.add(C.T.POSITION,"vec3"),g.attributes.add(C.T.NORMAL,"vec3"),g.attributes.add(C.T.UV0,"vec2"),g.attributes.add(C.T.AUXPOS1,"float"),g.varyings.add("vtc","vec2"),g.varyings.add("vlength","float"),g.varyings.add("vradius","float"),g.vertex.code.add(l.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),g.fragment.uniforms.add([new _.p("outlineSize",b=>b.outlineSize),new R.N("outlineColor",b=>b.outlineColor),new _.p("stripeLength",b=>b.stripeLength),new R.N("stripeEvenColor",b=>b.stripeEvenColor),new R.N("stripeOddColor",b=>b.stripeOddColor)]);const w=1/Math.sqrt(2);return g.fragment.code.add(l.H`
    const float INV_SQRT2 = ${l.H.float(w)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),g}const U=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},96212:(G,M,t)=>{t.r(M),t.d(M,{default:()=>Pt});var o=t(17626),R=t(14517),_=t(62208),l=t(77712),U=(t(85931),t(8314),t(90912),t(76898)),B=t(39691),g=t(1437),w=t(74554),b=t(72392),Y=t(63290),F=t(15572),s=t(32917),d=t(84161),h=t(28093),p=t(44766),O=t(55214),v=t(55915),u=t(12080),f=t(10049),z=t(54865),K=t(68);const Ve=Y.Z.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController");let $=class extends R.Z{constructor(e){super(e),this._unitNormalizer=new K.D,this._handles=new b.Z,this._tempStartPosition=(0,h.c)(),this._tempEndPosition=(0,h.c)(),this._tempCornerPosition=(0,h.c)()}initialize(){this._handles.add((0,s.gx)(()=>{var e;return null==(e=this.view)?void 0:e.ready},()=>this._initialize(),{once:!0,sync:!0,initial:!0}))}destroy(){this._handles=(0,_.SC)(this._handles)}_initialize(){const e=this.view.spatialReference,i=(0,u.rS)(e),r=i===u.GG?u.wY:i;this._sphericalPCPF=r;const n=(0,v.Up)(e,r);this._unitNormalizer.spatialReference=n?r:e,this._handles.add([(0,s.YP)(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:a,startPoint:c})=>{a.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(c)},s.tX),(0,s.YP)(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:a,endPoint:c})=>{a.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(c)},s.tX),(0,s.YP)(()=>({result:this._computedResult,viewData:this.viewData}),({result:a,viewData:c})=>{c.result=a},s.tX)])}_applyProjectionAndElevationAlignment(e){if((0,_.Wi)(e))return e;const i=(0,z.G)(e,this.view.spatialReference,this.view.elevationProvider);return(0,_.Wi)(i)?((0,z.e)(this.analysis,e.spatialReference,Ve),null):i}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,measurementMode:r}=this.viewData;if((0,_.Wi)(e)||(0,_.Wi)(i))return null;const n=this._euclideanDistances(e,i),a=this._geodesicDistance(e,i,n.horizontal.value),c=r===w.e.Geodesic||r===w.e.Auto&&n.horizontal.value>1e5?"geodesic":"euclidean";return{mode:c,distance:"euclidean"===c?n.direct:a,directDistance:n.direct,horizontalDistance:n.horizontal,verticalDistance:n.vertical,geodesicDistance:a}}_euclideanDistances(e,i){const r=e.clone();r.z=i.z;const n=this._tempStartPosition,a=this._tempEndPosition,c=this._tempCornerPosition,P=this.view.spatialReference,y=this._sphericalPCPF,m=(0,v.Up)(P,y)?y:P;(0,v.KC)(e,n,m),(0,v.KC)(i,a,m),(0,v.KC)(r,c,m);const E=(0,d.i)(n,a),L=(0,d.i)(c,a),V=Math.abs(i.z-e.z),W=ue=>this._unitNormalizer.normalizeDistance(ue),I=W(E),se=W(L),ce=W(V);return{direct:(0,F.EV)(I,"meters"),horizontal:(0,F.EV)(se,"meters"),vertical:(0,F.EV)(ce,"meters")}}_geodesicDistance(e,i,r){const n=e.spatialReference,a=new O.Z({spatialReference:n});a.addPath([e,i]);const c=n.isGeographic&&(0,f.Gb)(n)?(0,f.Jf)([a],"meters")[0]:n.isWebMercator?(0,p.geodesicLength)(a,"meters"):null,P=(0,_.pC)(c)?c:this._fallbackGeodesicDistance(e,i,r);return(0,F.EV)(P,"meters")}_fallbackGeodesicDistance(e,i,r){if((0,v.UY)(e,Oe)&&(0,v.UY)(i,fe)){const n={distance:0};return(0,f.cA)(n,Oe,fe),n.distance}return r}};(0,o._)([(0,l.Cb)()],$.prototype,"view",void 0),(0,o._)([(0,l.Cb)()],$.prototype,"analysis",void 0),(0,o._)([(0,l.Cb)()],$.prototype,"viewData",void 0),(0,o._)([(0,l.Cb)()],$.prototype,"_computedResult",null),$=(0,o._)([(0,U.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],$);const Oe=(0,h.c)(),fe=(0,h.c)();var S,Q,e,je=t(15861),q=(t(52515),t(21286)),N=t(84600),te=t(23841),Me=t(16730),be=t(67831),Ue=t(67709);(e=S||(S={}))[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(Q||(Q={}));var ve=t(495),ie=t(67214),ne=t(87469),Ge=t(43703),me=t(4794),ae=t(26242),xe=t(53928),Ie=t(57521),J=t(40723),Be=t(19625),Ke=t(6945),oe=t(42743),Ne=t(60881),He=t(5894),X=t(16396),Fe=t(651),Ze=t(91056),ye=t(87601),Qe=t(39114),Le=t(88569),Ye=t(12407),Xe=t(41528),$e=t(50978),De=t(67969),Ce=t(2078);class le extends Ze.A{constructor(i,r,n){super(i,r,n)}initializeProgram(i){const r=le.shader.get().build(this.configuration);return new Ye.$(i.rctx,r,Qe.i)}_setPipelineState(i){return(0,Ce.sm)({blending:this.configuration.transparent?i===oe.Am.NONE?Le.wu:(0,Le.j7)(i):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:De.wb.LESS},depthWrite:Ce.LZ,colorWrite:Ce.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return De.MX.TRIANGLE_STRIP}}le.shader=new Fe.J($e.M,()=>t.e(3368).then(t.bind(t,3368)));class he extends Xe.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=oe.Am.NONE}}(0,o._)([(0,ye.o)()],he.prototype,"polygonOffsetEnabled",void 0),(0,o._)([(0,ye.o)()],he.prototype,"transparent",void 0),(0,o._)([(0,ye.o)({count:oe.Am.COUNT})],he.prototype,"transparencyPassType",void 0);class Je extends J.F5{constructor(i){super(i,new qe),this.techniqueConfig=new he}getConfiguration(i,r){var n;return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=null!=(n=null==r?void 0:r.transparencyPassType)?n:oe.Am.NONE,this.techniqueConfig}dispose(){}intersect(){}requiresSlot(i){return i===He.r.OPAQUE_MATERIAL}createGLMaterial(i){return i.output===Ke.H.Color?new ke(i):null}createBufferWriter(){return new at}}class ke extends Ne.Z{beginSlot(i){return this.ensureTechnique(le,i)}}class qe extends J.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=[1,.5,0,1],this.stripeLength=1,this.stripeEvenColor=[1,1,1,1],this.stripeOddColor=[1,.5,0,1],this.polygonOffset=!1}}const et=(0,Be.U$)().vec3f(X.T.POSITION).vec3f(X.T.NORMAL).vec2f(X.T.UV0).f32(X.T.AUXPOS1),tt=(0,h.c)(),it=(0,h.c)(),st=(0,h.c)(),rt=(0,h.c)(),nt=(0,h.c)();class at{constructor(){this.vertexBufferLayout=et}allocate(i){return this.vertexBufferLayout.createBuffer(i)}elementCount(i){return 2*(i.indices.get(X.T.POSITION).length/2+1)}write(i,r,n,a){const c=r.vertexAttributes.get(X.T.POSITION).data,P=r.vertexAttributes.get(X.T.NORMAL).data,y=c.length/3,m=r&&r.indices&&r.indices.get(X.T.POSITION);m&&m.length!==2*(y-1)&&console.warn("MeasurementArrowMaterial does not support indices");const E=tt,L=it,V=st,W=rt,I=nt,se=i.transformation,ce=i.invTranspTransformation,ue=n.position,Te=n.normal,_e=n.uv0;let ge=0;for(let Z=0;Z<y;++Z){const Pe=3*Z;if((0,d.s)(E,c[Pe],c[Pe+1],c[Pe+2]),Z<y-1){const ee=3*(Z+1);(0,d.s)(L,c[ee],c[ee+1],c[ee+2]),(0,d.s)(I,P[ee],P[ee+1],P[ee+2]),(0,d.n)(I,I),(0,d.b)(V,L,E),(0,d.n)(V,V),(0,d.f)(W,I,V),(0,d.n)(W,W)}const ft=(0,d.i)(E,L);se&&ce&&((0,d.m)(E,E,se),(0,d.m)(L,L,se),(0,d.m)(W,W,ce));const re=a+2*Z,pe=re+1;ue.setVec(re,E),ue.setVec(pe,E),Te.setVec(re,W),Te.setVec(pe,W),_e.set(re,0,ge),_e.set(re,1,-1),_e.set(pe,0,ge),_e.set(pe,1,1),Z<y-1&&(ge+=ft)}const Ot=n.auxpos1;for(let Z=0;Z<2*y;++Z)Ot.set(a+Z,ge)}}class ot extends xe._{constructor(i){super(i),this._parameters=lt,this._handles=null,this._origin=(0,h.c)(),this._originTransform=(0,Ge.c)(),this._arrowCenter=(0,h.c)(),this._renderOccluded=J.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(i)}get renderOccluded(){return this._renderOccluded}set renderOccluded(i){i!==this._renderOccluded&&(this._renderOccluded=i,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:i}))}get geometry(){return this._geometry}set geometry(i){this._geometry=i,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(i){this._stripeLength=i,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(i){if(this._stripesEnabled=i,this.attached){const r=this.opacity,{arrowStripeEvenColor:n,arrowStripeOddColor:a}=this._parameters,c=(0,q.H)(we,this._stripesEnabled?n:a,r);this._arrowMaterial.setParameters({stripeEvenColor:c})}}get opacity(){return this._opacity}set opacity(i){i!==this._opacity&&(this._opacity=i,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:i,arrowStripeOddColor:r,arrowOutlineColor:n}=this._parameters;this._arrowMaterial=new Je({outlineColor:n,stripeEvenColor:this._stripesEnabled?i:r,stripeOddColor:r,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new b.Z,this._handles.add((0,s.YP)(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(i){i(this._arrowMaterial)}createGeometries(i){if((0,_.Wi)(this._geometry)||(0,_.Wi)(this._geometry.startRenderSpace)||(0,_.Wi)(this._geometry.endRenderSpace))return;const r=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);i.addGeometry(r,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(i,r,n,a){const c=this.view.renderCoordsHelper,P=[],y=[],m=(E,L)=>{const V=ae.WM.get();(0,d.b)(V,E,n),P.push(V),y.push(L)};if("euclidean"===a.type){a.eval(.5,this._arrowCenter);const E=ae.WM.get();c.worldUpAtPosition(this._arrowCenter,E),m(i,E),m(r,E)}else{a.eval(.5,this._arrowCenter);const E=this._parameters.arrowSubdivisions+1&-2;for(let L=0;L<E;++L){const V=L/(E-1),W=ae.WM.get(),I=ae.WM.get();a.eval(V,W),c.worldUpAtPosition(W,I),m(W,I)}}return Ie.Z.createPolylineGeometry(P,y)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,_.pC)(this._geometry)){const i=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*i})}}_updateArrowOpacity(){const i=this.opacity,{arrowStripeEvenColor:r,arrowStripeOddColor:n,arrowOutlineColor:a}=this._parameters,c=(0,q.H)(we,this._stripesEnabled?r:n,i),P=(0,q.H)(ht,a,i),y=(0,q.H)(dt,n,i);this._arrowMaterial.setParameters({stripeEvenColor:c,outlineColor:P,stripeOddColor:y})}}const lt={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},we=(0,me.c)(),ht=(0,me.c)(),dt=(0,me.c)();var Ae,ct=t(77603),k=t(64770),Ee=t(54889),ut=t(56683),_t=t(41840);!function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"}(Ae||(Ae={}));let T=class extends R.Z{constructor(e){super(e),this._params=x({},pt),this._handles=new b.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,h.c)(),this._endPosition=(0,h.c)(),this._cornerPosition=(0,h.c)(),this._startPositionAtSeaLevel=(0,h.c)(),this._endPositionAtSeaLevel=(0,h.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=Q.Auto,this.triangleCollapseRatioThreshold=.03}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=this.analysisView;if((0,_.Wi)(e)||(0,_.Wi)(i)||e.equals(i))return S.None;const r=this.analysisView.result;if((0,_.Wi)(r))return S.Direct;if("geodesic"===r.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?S.ProjectedGeodesic:S.Direct;const{verticalDistance:n,horizontalDistance:a}=r,c=n.value,P=a.value;return Math.min(c/P,P/c)<this.triangleCollapseRatioThreshold?S.Direct:S.Triangle}get actualVisualizedMeasurement(){if((0,_.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case w.e.Auto:case w.e.Euclidean:default:return"euclidean";case w.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,_.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,_.Wi)(this._triangleOrientationOverride)!==e&&(this._triangleOrientationOverride=(0,_.Wi)(this._triangleOrientationOverride)?this._actualVisualElementsOrientation:null)}get labels(){return{direct:this._segmentLabel,horizontal:"geodesic"===this.actualVisualizedMeasurement?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}initialize(){var e=this;const i=this._params,r={attached:!0,view:this.view};this._segmentVisualElement=new ot(H(x({},r),{geometry:null,renderOccluded:J.yD.OccludeAndTransparent})),this._triangleVisualElement=new ne.r(H(x({},r),{width:i.triangleLineWidth,color:i.triangleColor,renderOccluded:J.yD.OccludeAndTransparent})),this._rightAngleQuad=new ct.R(H(x({},r),{color:de,renderOccluded:J.yD.OccludeAndTransparent}));const n=H(x({},r),{polygonOffset:!0,renderOccluded:J.yD.OccludeAndTransparent});this._projectedGeodesicLine=new ne.r(H(x({},n),{width:i.geodesicProjectionLineWidth,color:i.geodesicProjectionLineColor,stipplePattern:(0,Ee.z5)(i.guideStippleLengthPixels)})),this._geodesicStartHint=new ne.r(H(x({},n),{width:i.guideLineWidth,color:i.geodesicProjectionLineColor,stipplePattern:(0,Ee.z5)(i.guideStippleLengthPixels)})),this._geodesicEndHint=new ne.r(H(x({},n),{width:i.guideLineWidth,color:i.geodesicProjectionLineColor,stipplePattern:(0,Ee.z5)(i.guideStippleLengthPixels)})),this._segmentLabel=new ie.Kc(H(x({},r),{fontSize:i.direcLabelFontSize})),this._verticalLabel=new ie.Kc(H(x({},r),{fontSize:i.verticalLabelFontSize})),this._horizontalLabel=new ie.Kc(H(x({},r),{fontSize:i.horizontalLabelFontSize})),this._handles.add([(0,s.YP)(()=>{const{elevationAlignedStartPoint:a,elevationAlignedEndPoint:c}=this.analysisView,P=this.view;return{view:P,camera:P.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},a=>this._updateGeometryAndViewMode(a),s.tX),(0,s.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateVisualElementVisibility(a),s.tX),(0,s.YP)(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),a=>this._updateLabelText(a),s.tX),(0,s.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateLabelVisibility(a),s.tX),(0,s.YP)(()=>this._measurementArrowStripeLength,a=>this._updateSegmentStripeLength(a),s.tX),(0,ut.qe)((0,je.Z)(function*(){return e._updateMessageBundle()}))]),this._updateMessageBundle()}destroy(){this._handles=(0,_.SC)(this._handles),this._segmentVisualElement=(0,_.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,_.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,_.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,_.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,_.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,_.SC)(this._geodesicEndHint),this._segmentLabel=(0,_.SC)(this._segmentLabel),this._verticalLabel=(0,_.SC)(this._verticalLabel),this._horizontalLabel=(0,_.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:i}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(i){case S.None:break;case S.Direct:this._segmentVisualElement.visible=!0;break;case S.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case S.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:i,viewMode:r,elevationAlignedStartPoint:n,elevationAlignedEndPoint:a,orientation:c,visualizedMeasurement:P,stripeLength:y}){const m=e.renderCoordsHelper;if((0,_.Wi)(m)||(0,_.Wi)(n)||(0,_.Wi)(a)||n.equals(a))return;let E=this._startPosition,L=this._endPosition;m.toRenderCoords(n,E),m.toRenderCoords(a,L);const V=c===Q.AboveSegment?1:-1,W=V*(m.getAltitude(L)-m.getAltitude(E));W<0&&(E=this._endPosition,L=this._startPosition);const I="geodesic"===P?new k.u4(this._startPosition,this._endPosition,m.spatialReference):new k.y$(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=I,this._updateSegmentStripeLength(y),r){case S.Direct:this._updateSegment(I,c);break;case S.Triangle:this._updateSegmentAndTriangle({view:e,camera:i,segment:I,orientation:c,startPosition:E,endPosition:L,deltaSign:V,altitudeDelta:W});break;case S.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:c,startPosition:E,endPosition:L})}}_updateSegment(e,i){this._segmentLabel.anchor=i===Q.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:i,segment:r,orientation:n,startPosition:a,endPosition:c,deltaSign:P,altitudeDelta:y}){const m=this._cornerPosition;e.worldUpAtPosition(a,m),(0,d.g)(m,m,P*Math.abs(y)),(0,d.a)(m,m,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[m[0],m[1],m[2]],[c[0],c[1],c[2]]]],this._rightAngleQuad.geometry={previous:a,center:m,next:c};const E=new k.y$(a,m),L=new k.y$(m,c),V=function gt(e,i,r,n,a){const c=vt,P=mt;a.projectToRenderScreen(r,c),a.projectToRenderScreen(i,P);const y={segment:"bottom",horizontal:"top",vertical:c[0]<P[0]?"left":"right"};{const m=yt,E=Ct;if((0,ve.c)(e,r,m,a),(0,ve.c)(e,i,E,a),(0,be.h)(m,E)>=Se){const L=Math.sign(m[1])===Math.sign(E[1]);y.segment=L?(0,ie.jB)(y.vertical):y.vertical}else{const L=Et;(0,ve.c)(r,i,L,a),(0,be.h)(L,E)>=Se&&(y.segment=Math.sign(L[0])===Math.sign(E[0])?(0,ie.jB)(y.horizontal):y.horizontal)}}if(n===Q.BelowSegment){const m=E=>"top"===E?"bottom":"top";y.segment=m(y.segment),y.horizontal=m(y.horizontal),y.vertical=m(y.vertical)}return y}(a,c,m,n,i);this._segmentLabel.anchor=V.segment,this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:E,sampleLocation:"center"},this._verticalLabel.anchor=V.vertical,this._horizontalLabel.geometry={type:"segment",segment:L,sampleLocation:"center"},this._horizontalLabel.anchor=V.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:i,startPosition:r,endPosition:n}){e.setAltitude(this._startPositionAtSeaLevel,0,r),e.setAltitude(this._endPositionAtSeaLevel,0,n);const a=new k.u4(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new k.y$(this._startPositionAtSeaLevel,r)),this._geodesicEndHint.setGeometryFromSegment(new k.y$(this._endPositionAtSeaLevel,n)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=i===Q.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:i}){(0,_.pC)(e)?(this._segmentLabel.text="euclidean"===i?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:i}){const r=this._segmentLabel,n=this._horizontalLabel,a=this._verticalLabel;if(r.visible=!1,n.visible=!1,a.visible=!1,e)switch(i){case S.Direct:r.visible=!0;break;case S.Triangle:r.visible=!0,n.visible=!0,a.visible=!0;break;case S.ProjectedGeodesic:r.visible=!0}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,i=this.analysisView.result;if((0,_.Wi)(i)||(0,_.Wi)(e))return null;const{directDistance:r,horizontalDistance:n,verticalDistance:a,geodesicDistance:c}=i,P=this.analysisView.unit,y=m=>x({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},m);switch(P){case"metric":return y({euclideanDistance:r&&(0,N.Rd)(e,r),geodesicDistance:c&&(0,N.Rd)(e,c),horizontalDistance:n&&(0,N.Rd)(e,n),verticalDistance:a&&(0,N.Wv)(e,a)});case"imperial":return y({euclideanDistance:r&&(0,N.Ud)(e,r),geodesicDistance:c&&(0,N.Ud)(e,c),horizontalDistance:n&&(0,N.Ud)(e,n),verticalDistance:a&&(0,N.Zv)(e,a)});default:return y({euclideanDistance:r&&(0,N.VG)(e,r,P),geodesicDistance:c&&(0,N.VG)(e,c,P),horizontalDistance:n&&(0,N.VG)(e,n,P),verticalDistance:a&&(0,N.VG)(e,a,P)})}}_updateSegmentStripeLength(e){const i=this._segmentVisualElement;(0,_.pC)(e)?(i.stripeLength=e,i.stripesEnabled=!0):i.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,_.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===Q.Auto?this.view.state.camera.aboveGround?Q.AboveSegment:Q.BelowSegment:e}_requiresGeodesicGuideAt(e){const i=this.view;if(null==i||!i.state)return!1;const n=i.renderCoordsHelper,a=i.state.camera.computeScreenPixelSizeAt(e);return n.getAltitude(e)/a>=10}get _measurementArrowStripeLength(){const{result:e,unit:i}=this.analysisView;if((0,_.Wi)(e))return null;let r=null;const n=e.directDistance;switch(i){case"metric":r=n&&(0,F.nn)(n,"meters");break;case"imperial":r=n&&(0,F.nn)(n,(0,Me.FN)(n.value,n.unit));break;default:r=n&&(0,F.nn)(n,i)}return(0,_.Wi)(r)?null:(0,q.sk)(r.value/30)*(0,Me.En)(1,r.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,_t.ME)("esri/core/t9n/Units").then(e=>{this.messages=e}).finally(()=>{this.loadingMessages=!1})}get testData(){var e;return{labels:this.labels,stripeLength:null==(e=this._segmentVisualElement)?void 0:e.stripeLength}}};(0,o._)([(0,l.Cb)()],T.prototype,"_triangleOrientationOverride",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"messages",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"view",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"analysis",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"analysisView",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"loadingMessages",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"visible",null),(0,o._)([(0,l.Cb)()],T.prototype,"viewMode",null),(0,o._)([(0,l.Cb)()],T.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,l.Cb)()],T.prototype,"visualElementOrientation",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"triangleCollapseRatioThreshold",void 0),(0,o._)([(0,l.Cb)()],T.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,l.Cb)()],T.prototype,"labels",null),(0,o._)([(0,l.Cb)()],T.prototype,"_labelsText",null),(0,o._)([(0,l.Cb)()],T.prototype,"_actualVisualElementsOrientation",null),(0,o._)([(0,l.Cb)()],T.prototype,"_measurementArrowStripeLength",null),T=(0,o._)([(0,U.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],T);const de=(0,Ue.f)(1,.5,0,.75),pt={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:de,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:de,guideLineWidth:2,guideLineColor:de,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Se=Math.cos((0,q.Vl)(12)),vt=(0,te.J$)(),mt=(0,te.J$)(),yt=(0,te.gX)(),Ct=(0,te.gX)(),Et=(0,te.gX)();let A=class extends((0,g.p)(R.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=w.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,i=this.analysis;this._analysisVisualization=new T({view:e,analysis:i,analysisView:this}),this._analysisController=new $({view:e,analysis:i,viewData:this})}destroy(){this._analysisController=(0,_.SC)(this._analysisController),this._analysisVisualization=(0,_.SC)(this._analysisVisualization)}get updating(){var e;return!(null==(e=this._analysisVisualization)||!e.loadingMessages)}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get unit(){return(0,_.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){var e;return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:H(x({},null==(e=this._analysisVisualization)?void 0:e.testData),{visualization:this._analysisVisualization,controller:this._analysisController})}};(0,o._)([(0,l.Cb)()],A.prototype,"updating",null),(0,o._)([(0,l.Cb)({readOnly:!0})],A.prototype,"type",void 0),(0,o._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],A.prototype,"analysis",void 0),(0,o._)([(0,l.Cb)()],A.prototype,"result",void 0),(0,o._)([(0,l.Cb)()],A.prototype,"measurementMode",void 0),(0,o._)([(0,l.Cb)()],A.prototype,"elevationAlignedStartPoint",void 0),(0,o._)([(0,l.Cb)()],A.prototype,"elevationAlignedEndPoint",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],A.prototype,"viewMode",null),(0,o._)([(0,l.Cb)({readOnly:!0})],A.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,l.Cb)()],A.prototype,"visualElementOrientation",null),(0,o._)([(0,l.Cb)()],A.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,l.Cb)()],A.prototype,"triangleCollapseRatioThreshold",null),(0,o._)([(0,l.Cb)({readOnly:!0})],A.prototype,"directLabelText",null),(0,o._)([(0,l.Cb)({readOnly:!0})],A.prototype,"horizontalLabelText",null),(0,o._)([(0,l.Cb)({readOnly:!0})],A.prototype,"verticalLabelText",null),(0,o._)([(0,l.Cb)()],A.prototype,"_analysisVisualization",void 0),(0,o._)([(0,l.Cb)()],A.prototype,"_analysisController",void 0),(0,o._)([(0,l.Cb)()],A.prototype,"unit",null),(0,o._)([(0,l.Cb)(B.Y)],A.prototype,"_defaultUnit",void 0),A=(0,o._)([(0,U.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],A);const Pt=A},54865:(G,M,t)=>{t.d(M,{G:()=>l,e:()=>D});var o=t(62208),R=t(55915),_=t(53929);function l(C,j,U,B=!1){const g=(0,R.fM)(C,j);return(0,o.Wi)(g)?null:(g.hasZ&&!B||!(0,o.pC)(U)||(g.z=(0,o.Pt)((0,_.KO)(U,g),0)),g)}function D(C,j,U){U.warnOnce(`Failed to project analysis geometry (id: '${C.id}'), projection from spatial reference (wkid: '${j.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},87469:(G,M,t)=>{t.d(M,{r:()=>b});var o=t(62208),R=t(28347),_=t(43703),l=t(84161),D=t(28093),C=t(993),j=t(67709),U=t(53928),B=t(44014),g=t(40723),w=t(92222);class b extends U._{constructor(s){super(s),this._renderOccluded=g.yD.OccludeAndTransparent,this._width=1,this._color=(0,j.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(s)}setGeometryFromRenderSpacePoint(s,d=1e3){const h=[];h.push([[s[0]-d,s[1]+0,s[2]+0],[s[0]+d,s[1]+0,s[2]+0]]),h.push([[s[0]-0,s[1]-d,s[2]+0],[s[0]+0,s[1]+d,s[2]+0]]),h.push([[s[0]-0,s[1]+0,s[2]-d],[s[0]+0,s[1]+0,s[2]+d]]),this.geometry=h}setGeometryFromExtent(s){const d=this.view.spatialReference,h=(0,D.c)(),p=(0,D.c)(),O=100,v=[];(0,l.s)(h,s[0],s[1],O),this.view.renderCoordsHelper.toRenderCoords(h,d,p),v.push([p[0],p[1],p[2]]),(0,l.s)(h,s[2],s[1],O),this.view.renderCoordsHelper.toRenderCoords(h,d,p),v.push([p[0],p[1],p[2]]),(0,l.s)(h,s[2],s[3],O),this.view.renderCoordsHelper.toRenderCoords(h,d,p),v.push([p[0],p[1],p[2]]),(0,l.s)(h,s[0],s[3],O),this.view.renderCoordsHelper.toRenderCoords(h,d,p),v.push([p[0],p[1],p[2]]),(0,l.s)(h,s[0],s[1],O),this.view.renderCoordsHelper.toRenderCoords(h,d,p),v.push([p[0],p[1],p[2]]),(0,l.s)(h,s[0],s[1],O),this.view.renderCoordsHelper.toRenderCoords(h,d,p),v.push([p[0],p[1],p[2]]),this.geometry=[v]}setGeometryFromFrustum(s){const d=[];s.lines.forEach(h=>{d.push([h.origin[0],h.origin[1],h.origin[2]]),d.push([h.endpoint[0],h.endpoint[1],h.endpoint[2]])}),this.geometry=[d]}setGeometryFromBoundedPlane(s){const d=[],h=s.origin,p=s.basis1,O=s.basis2,v=.5,u=(0,D.c)(),f=(0,D.c)(),z=(0,D.c)(),K=(0,D.c)();u[0]=h[0]-p[0]*v-O[0]*v,u[1]=h[1]-p[1]*v-O[1]*v,u[2]=h[2]-p[2]*v-O[2]*v,f[0]=h[0]-p[0]*v+O[0]*v,f[1]=h[1]-p[1]*v+O[1]*v,f[2]=h[2]-p[2]*v+O[2]*v,z[0]=h[0]+p[0]*v+O[0]*v,z[1]=h[1]+p[1]*v+O[1]*v,z[2]=h[2]+p[2]*v+O[2]*v,K[0]=h[0]+p[0]*v-O[0]*v,K[1]=h[1]+p[1]*v-O[1]*v,K[2]=h[2]+p[2]*v-O[2]*v,d.push([u[0],u[1],u[2]]),d.push([f[0],f[1],f[2]]),d.push([z[0],z[1],z[2]]),d.push([K[0],K[1],K[2]]),d.push([u[0],u[1],u[2]]),this.geometry=[d]}setGeometryFromSegment(s){const d=s.endRenderSpace;this.transform=(0,R.f)(Y,d);const{points:h}=s.createRenderGeometry(d,this.view.renderCoordsHelper);this.geometry=[h]}setGeometryFromSegments(s,d=D.Z){this.transform=(0,R.f)(Y,d),this.geometry=s.map(h=>h.createRenderGeometry(d,this.view.renderCoordsHelper).points)}getTransformedGeometry(){return(0,o.Wi)(this._geometry)?null:this._geometry.map(s=>s.map(d=>(0,l.m)((0,D.c)(),d,this.transform)))}get renderOccluded(){return this._renderOccluded}set renderOccluded(s){s!==this._renderOccluded&&(this._renderOccluded=s,this._updateMaterial())}get geometry(){return this._geometry}set geometry(s){this._geometry=s,this.recreateGeometry()}get width(){return this._width}set width(s){s!==this._width&&(this._width=s,this._updateMaterial())}get color(){return this._color}set color(s){(0,C.g)(s,this._color)||((0,C.c)(this._color,s),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(s){s!==this._innerWidth&&(this._innerWidth=s,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(s){(0,o.pC)(s)?!(0,o.Wi)(this._innerColor)&&(0,C.g)(s,this._innerColor)||(this._innerColor=(0,C.c)((0,j.c)(),s),this._updateMaterial()):(0,o.pC)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(s){const d=(0,o.pC)(s)!==(0,o.pC)(this._stipplePattern);this._stipplePattern=s,d?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(s){((0,o.Wi)(s)||(0,o.Wi)(this._stippleOffColor)||!(0,C.g)(s,this._stippleOffColor))&&(this._stippleOffColor=(0,o.pC)(s)?(0,j.a)(s):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(s){this._stipplePreferContinuous!==s&&(this._stipplePreferContinuous=s,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(s){this._writeDepthEnabled!==s&&(this._writeDepthEnabled=s,this._updateMaterial())}get falloff(){return this._falloff}set falloff(s){s!==this._falloff&&(this._falloff=s,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(s){s!==this._polygonOffset&&(this._polygonOffset=s,this._updateMaterial())}createExternalResources(){this._material=new w.U(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(s){const d=this._createLineGeometries();if(0!==d.length)for(let h=0;h<d.length;++h){const p=(0,B.YU)(d[h]);s.addGeometry(p,this._material)}}forEachExternalMaterial(s){s(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const s=this.geometry;if((0,o.Wi)(s)||0===s.length)return[];const d=[];return s.forEach(h=>{const O=new Float64Array(3*h.length);h.forEach((u,f)=>{O[3*f+0]=u[0],O[3*f+1]=u[1],O[3*f+2]=u[2]}),d.push({overlayInfo:null,attributeData:{position:O},removeDuplicateStartEnd:B.NW.KEEP})}),d}}const Y=(0,_.c)()},53928:(G,M,t)=>{t.d(M,{_:()=>U});var o=t(62208),R=t(28347),_=t(43703),l=t(68604),D=t(42743),C=t(97272),j=t(34103);class U extends l.l{constructor(g){super(g.view),this._resources=null,this._transform=(0,_.c)()}get object(){return(0,o.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(g){(0,R.c)(this._transform,g),(0,o.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,o.Wi)(this._resources))return;const g=this._resources.object,w=this.view._stage;w.removeMany(g.geometries),g.removeAllGeometries(),this.createGeometries(g),this.visible||g.setVisible(this.visible),w.addMany(g.geometries)}createResources(){this.destroyResources();const g=this.view._stage;if(!g)return;const w=new j.F({isPickable:!1,updatePolicy:D.jq.SYNC});g.add(w);const b=new C.T({castShadow:!1});b.transformation=this._transform,this.createExternalResources(),this.createGeometries(b),g.addMany(b.geometries),this.forEachExternalMaterial(Y=>g.add(Y)),g.add(b),w.add(b),this.visible||b.setVisible(!1),this._resources={layer:w,object:b}}destroyResources(){const g=this.view._stage;!(0,o.Wi)(this._resources)&&g&&(g.remove(this._resources.object),g.remove(this._resources.layer),this.forEachExternalMaterial(w=>{g.remove(w),w.dispose()}),g.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(g){(0,o.Wi)(this._resources)||this._resources.object.setVisible(g)}}},77603:(G,M,t)=>{t.d(M,{R:()=>p});var o=t(72392),R=t(62208),_=t(32917),l=t(28347),D=t(43703),C=t(84161),j=t(28093),U=t(993),B=t(67709),g=t(26242),w=t(53928),b=t(52107),Y=t(57521),F=t(40723),s=t(16396),d=t(92972),h=t(92222);class p extends w._{constructor(u){super(u),this._handles=new o.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,j.c)(),this._up=(0,j.c)(),this._right=(0,j.c)(),this._renderOccluded=F.yD.OccludeAndTransparent,this._color=(0,B.f)(1,0,0,1),this._outlineColor=(0,B.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=F.yD.Opaque,this.applyProps(u)}get renderOccluded(){return this._renderOccluded}set renderOccluded(u){u!==this._renderOccluded&&(this._renderOccluded=u,this._updateQuadMaterial())}get color(){return this._color}set color(u){(0,U.c)(this._color,u),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(u){(0,U.c)(this._outlineColor,u),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(u){const f=0===this._outlineSize!=(0===u);this._outlineSize=u,f?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(u){u!==this._size&&(this._size=u,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(u){this._outlineRenderOccluded=u,this._updateOutlineMaterial()}set geometry({previous:u,center:f,next:z}){this._maxSize=Math.min((0,C.i)(f,u),(0,C.i)(f,z))/3,(0,C.n)(this._up,(0,C.b)(this._up,u,f)),(0,C.n)(this._right,(0,C.b)(this._right,z,f)),(0,C.c)(this._position,f),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new d.E(this.quadMaterialParameters),this._outlineMaterial=new h.U(this.outlineMaterialParameters),this._handles.add((0,_.YP)(()=>this.view.state.camera,()=>this._updateTransform()))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(u){u(this._quadMaterial),u(this._outlineMaterial)}createGeometries(u){this._createQuadGeometry(u),this._createOutlineGeometry(u),this._updateTransform(u)}_createQuadGeometry(u){const f=this._quadGeometryData(this._up,this._right);u.addGeometry(f,this._quadMaterial)}_createOutlineGeometry(u){if(0===this._outlineSize)return;const f=(0,C.a)(g.WM.get(),this._up,this._right),z=Y.Z.createPolylineGeometry([this._up,f,this._right]);u.addGeometry(z,this._outlineMaterial)}_updateTransform(u=this.object){const z=this._size*this.view.state.camera.computeScreenPixelSizeAt(this._position),K=Math.min(this._maxSize,z);(0,l.f)(O,this._position),(0,l.h)(O,O,[K,K,K]),(0,R.pC)(u)&&(u.transformation=O)}_quadGeometryData(u,f){const z=(0,C.a)(g.WM.get(),u,f);return new b.Z([[s.T.POSITION,{size:3,data:[0,0,0,...f,...u,...z],exclusive:!0}]],[[s.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const O=(0,D.c)()},68604:(G,M,t)=>{t.d(M,{l:()=>R});var o=t(32917);class R{constructor(l){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=l,this._handle=(0,o.YP)(()=>this.view.ready,D=>{this._resourcesCreated&&(D?this._createResources():this._destroyResources())})}applyProps(l){let D=!1;for(const C in l)C in this?"attached"===C?D=l[C]:this[C]=l[C]:console.error("Cannot set unknown property",C);this.attached=D}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(l){l!==this._attached&&this.view._stage&&(this._attached=l,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(l){l!==this._visible&&(this._visible=l,this.attached&&this.updateVisibility(l))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}}}]);