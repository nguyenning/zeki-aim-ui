"use strict";var ne=Object.defineProperty,ae=Object.defineProperties,oe=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,le=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,Y=(R,b,t)=>b in R?ne(R,b,{enumerable:!0,configurable:!0,writable:!0,value:t}):R[b]=t,K=(R,b)=>{for(var t in b||(b={}))le.call(b,t)&&Y(R,t,b[t]);if(z)for(var t of z(b))he.call(b,t)&&Y(R,t,b[t]);return R},N=(R,b)=>ae(R,oe(b));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[8433],{59990:(R,b,t)=>{function _(E){var o;const m=E.layer;return"floorInfo"in m&&(null==(o=m.floorInfo)?void 0:o.floorField)&&"floors"in E.view?O(E.view.floors,m.floorInfo.floorField):null}function n(E,m){var o;return"floorInfo"in m&&(null==(o=m.floorInfo)?void 0:o.floorField)?O(E,m.floorInfo.floorField):null}function O(E,m){if(null==E||!E.length)return null;const o=E.filter(I=>""!==I).map(I=>`'${I}'`);return o.push("''"),`${m} IN (${o.join(",")}) OR ${m} IS NULL`}t.d(b,{c:()=>_,f:()=>n})},19702:(R,b,t)=>{t.d(b,{A:()=>G});var _=t(15861),n=t(17626),O=t(54024),E=t(10699),m=t(32917),o=t(77712),p=(t(85931),t(8314),t(90912),t(76898)),M=t(36947);const G=P=>{let f=class extends P{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(x){super.postscript(x),(0,M.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var x=this;return(0,_.Z)(function*(){const a=new AbortController,y=a.signal;x.handles.add((0,O.kB)(()=>a.abort())),yield(0,m.N1)(()=>{var S;return null==(S=x.view.defaultsFromMap)?void 0:S.heightModelInfoReady},y),(0,E.k_)(y);const c=(0,M.Wt)(x.layer,x.view.heightModelInfo,x.supportsHeightUnitConversion);if(c)throw c})()}canResume(){const x=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!x||!x.minScale||!x.maxScale||x.minScale>=x.maxScale)}getSuspendInfo(){const x=super.getSuspendInfo(),a=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return a&&a.minScale&&a.maxScale&&a.minScale<a.maxScale&&(x.outsideScaleRange=!0),x}};return(0,n._)([(0,o.Cb)()],f.prototype,"view",void 0),(0,n._)([(0,o.Cb)()],f.prototype,"slicePlaneEnabled",void 0),f=(0,n._)([(0,p.j)("esri.views.3d.layers.LayerView3D")],f),f}},22229:(R,b,t)=>{t.d(b,{Z:()=>S});var _=t(17626),n=t(14517),O=t(61885),E=t(72392),m=t(62208),o=t(32917),I=t(77712),M=(t(85931),t(8314),t(90912),t(76898)),G=t(77029),P=t(65401),f=t(87091);class a{constructor(){this._extents=new G.Z({allocator:d=>d||(0,P.Ue)()}),this._tmpExtent=(0,P.Ue)(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(d){this._contains(d)||(this._removeContained(d),(0,P.JG)(this._extents.pushNew(),d),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(d){return this._mergeTight(d),d.hasProgressed}_mergeTight(d=f.G5){const g=this._extents,C=new Set;let T=0;for(;T!==g.length;){g.sort((j,A)=>j[0]-A[0]),T=g.length,C.clear();for(let j=0;j<g.length;++j){if(d.done)return;const A=g.getItemAt(j);for(let U=j+1;U<g.length;++U){const V=g.getItemAt(U);if(V[0]>=A[2])break;C.add(V)}C.forEach(U=>{if(A===U)return;if(U[2]<=A[0])return void C.delete(U);const V=(0,P.SO)(A),Z=(0,P.SO)(U),L=this._tmpExtent;(0,P.jn)(A,U,L);const Q=V+Z;((0,P.SO)(L)-Q)/Q<.05&&((0,P.JG)(A,L),C.delete(U),g.remove(U),d.madeProgress())}),C.add(A)}}this._dirty=!1}_contains(d){return this._extents.some(g=>(0,P.r3)(g,d))}_removeContained(d){this._extents.filterInPlace(g=>!(0,P.r3)(d,g))}get test(){const d=this;return{containsPoint:g=>d._extents.some(C=>(0,P.BD)(C,g))}}}var y=t(42743);let c=class extends n.Z{constructor(){super(...arguments),this.dirtyExtents=new a,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new E.Z,this.updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new O.Z}setup(h,d,g,C){this.graphicsCoreOwner=h,this.queryGraphicUIDsInExtent=d,this.graphicsCore=g,this.elevationProvider=C;const T=this.graphicsCoreOwner.view.resourceController.scheduler;this.handles.add([C.on("elevation-change",j=>this._elevationChanged(j)),(0,o.YP)(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),T.registerTask(f.T8.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this.updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(h){for(this.globalDirty&&(this._markAllGraphicsElevationDirty(),this.globalDirty=!1,h.madeProgress()),h.run(()=>this.dirtyExtents.merge(h));this.running&&!h.done;)this._updateDirtyGraphics(h),this._updateDirtyExtents(h);this.graphicsCoreOwner.view.deconflictor.setDirty(),this.notifyChange("updating")}_updateDirtyGraphics(h){const d=this.graphicsCoreOwner.view.renderCoordsHelper,g=this.graphicsCore.effectiveUpdatePolicy===y.jq.ASYNC;for(const C of this.dirtyGraphicsSet.keys()){const T=this.graphicsCore.getGraphics3DGraphicById(C);if(this.dirtyGraphicsSet.delete(C),(0,m.pC)(T)&&(T.alignWithElevation(this.elevationProvider,d,g),h.madeProgress()),h.done)return}}_updateDirtyExtents(h){for(;!this.dirtyExtents.empty&&!h.done;){const d=this.dirtyExtents.pop(),g=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:d,spatialReference:g});const C=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(d,g,T=>{const j=this.graphicsCore.getGraphics3DGraphicById(T);(0,m.pC)(j)&&j.needsElevationUpdates()&&this.dirtyGraphicsSet.add(T)}),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-C)+.9*this.averageExtentUpdateSize,h.madeProgress()}}_markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((h,d)=>this.dirtyGraphicsSet.add(d))}_elevationChanged(h){if("scene"===h.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:d,spatialReference:g}=h;if(this.graphicsCoreOwner.suspended){if(!this.updateElevation){const C=this.graphicsCore.computedExtent;C&&d[2]>C.xmin&&d[0]<C.xmax&&d[3]>C.ymin&&d[1]<C.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:d,spatialReference:g})}else d[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(d),this.notifyChange("updating")}};(0,_._)([(0,I.Cb)({readOnly:!0})],c.prototype,"updating",null),(0,_._)([(0,I.Cb)({readOnly:!0})],c.prototype,"updatingRemaining",null),c=(0,_._)([(0,M.j)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c);const S=c},79650:(R,b,t)=>{t.d(b,{Z:()=>ee});var _=t(15861),n=t(17626),O=t(88879),E=t(94573),m=t(80542),o=t(62208),I=t(10699),i=t(32917),s=t(77712),P=(t(85931),t(8314),t(90912),t(76898)),f=t(84682),x=t(46367),a=t(39256),y=t(84952),c=t(62600),S=t(80960),h=t(1191),d=t(22229),g=t(14517),C=t(72392),T=t(63290),j=t(73234),A=t(98624),U=t(59990),V=t(79721),Z=t(34675),L=t(87091);const Q=T.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");let w=class extends g.Z{constructor(...e){super(...e),this._dirty=!1,this._querying=!1,this._handles=new C.Z}get updating(){return this._dirty||this._querying||(0,o.pC)(this._queryResult)}setup(e,r){this._layerView=e,this._core=r,this._objectIdField=e.layer.objectIdField,this._queryEngine=new Z.q({layerView:this._layerView,priority:L.T8.FILTER_VISIBILITY}),this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(L.T8.FILTER_VISIBILITY,this)),this._handles.add((0,i.on)(()=>{var u;return null==(u=r.owner)?void 0:u.loadedGraphics},"after-changes",u=>this._graphicsChanged(u),{onListenerAdd:()=>this.dirty=!0})),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(e=>e.clearVisibilityFlag(V.P.FILTER)),this._queryResult=null,this._querying=!1),this.dirty=!1}_graphicsChanged(e){this._queryEngine&&0==(e.type&j.y.ADD)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(V.P.FILTER,V.E.GRAPHIC)||e.setVisibilityFlag(V.P.FILTER,!1,V.E.GRAPHIC),this.dirty=!0)}filterChanged(){const e=this._recomputeFilter();e!==this._featureFilter&&(this._featureFilter=e,this.dirty=!0);const r="layerFilter"in this._layerView?this._layerView.layerFilter:null;r!==this._sceneFilter&&(this._sceneFilter=r,this.dirty=!0)}get active(){return(this._featureFilter||this._sceneFilter)&&this._core.graphics3DGraphics.size>0}_recomputeFilter(){const e="filter"in this._layerView?this._layerView.filter:null,r="timeExtent"in this._layerView?this._layerView.timeExtent:null,l=(0,U.c)(this._layerView);if((0,o.Wi)(r)&&(0,o.Wi)(l))return e;const u=(0,o.pC)(e)?e.clone():new A.Z;return(0,o.pC)(r)&&(u.timeExtent=(0,o.pC)(u.timeExtent)?u.timeExtent.intersection(r):r),(0,o.pC)(l)&&(u.where=null==u.where||""===u.where?l:`(${u.where}) AND (${l})`),u}get running(){return this._dirty&&!this._querying||(0,o.pC)(this._queryResult)}runTask(e){if(!this.active)return void this.clear();!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this._featureFilter,this._sceneFilter).then(l=>{this._queryResult=l,this._querying=!1}).catch(l=>{if(!(0,I.D_)(l)){Q.warn("FeatureFilter query failed: "+l,{error:l});const u=new Set;this._core.graphics3DGraphics.forEach(D=>u.add(this._getFeatureId(D.graphic))),this._queryResult=u,this._querying=!1}}),e.madeProgress());const r=this._queryResult;(0,o.pC)(r)&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities(l=>{if(e.done)return!1;const u=r.has(this._getFeatureId(l.graphic));return!!l.setVisibilityFlag(V.P.FILTER,u,V.E.GRAPHIC)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null))}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty=e}};(0,n._)([(0,s.Cb)({readOnly:!0})],w.prototype,"updating",null),(0,n._)([(0,s.Cb)({readOnly:!0})],w.prototype,"running",null),(0,n._)([(0,s.Cb)()],w.prototype,"_dirty",void 0),(0,n._)([(0,s.Cb)()],w.prototype,"_querying",void 0),(0,n._)([(0,s.Cb)()],w.prototype,"_queryResult",void 0),w=(0,n._)([(0,P.j)("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],w);var $=t(83518),X=t(14752),k=t(67873),q=t(67225),J=t(97445),B=t(42743);let v=class extends m.r{constructor(e){super(e),this.type="graphics-3d",this.elevationFeatureExpressionEnabled=!1,this.dataExtent=null,this.drapeSourceType=c.L.Features,this.preferredUpdatePolicy=B.jq.ASYNC,this.suspendResumeExtent=null}normalizeCtorArgs(e){const r=e.frustumVisibilityEnabled?new $.Z:null,l=e.scaleVisibilityEnabled?new k.Z:null,u=(e.filterVisibilityEnabled||e.timeExtentEnabled)&&"multipatch"!==e.owner.layer.geometryType?new w:null,D=e.elevationAlignmentEnabled?new d.Z:null,{owner:F,updateClippingExtent:W,dataExtent:se,elevationFeatureExpressionEnabled:ie,preferredUpdatePolicy:re}=e;return{owner:F,updateClippingExtent:W,dataExtent:se,frustumVisibility:r,scaleVisibility:l,filterVisibility:u,elevationAlignment:D,elevationFeatureExpressionEnabled:ie,preferredUpdatePolicy:re}}initialize(){const e=new h.w({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:this.owner.hasZ,hasM:this.owner.hasM});this._set("graphicsCore",e),this.scaleVisibility&&this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());const r=this.filterVisibility;(0,o.pC)(r)&&(this.updatingHandles.add(()=>"filter"in this.owner&&this.owner.filter,()=>r.filterChanged()),this.updatingHandles.add(()=>"timeExtent"in this.owner&&this.owner.timeExtent,()=>r.filterChanged()),this.updatingHandles.add(()=>"layerFilter"in this.owner&&this.owner.layerFilter,()=>r.filterChanged())),this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(l,u)=>{(0,f.Hg)(l,u)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}),this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo()),this.updatingHandles.add(()=>this.layer.labelingInfo,(l,u)=>{(0,f.Hg)(l,u)&&this.graphicsCore.updateLabelingInfo()}),this.updatingHandles.add(()=>this.preferredUpdatePolicy,l=>this.graphicsCore.preferredUpdatePolicy=l)}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("frustumVisibility",(0,o.SC)(this.frustumVisibility)),this._set("scaleVisibility",(0,o.SC)(this.scaleVisibility)),this._set("filterVisibility",(0,o.SC)(this.filterVisibility)),this._set("elevationAlignment",(0,o.SC)(this.elevationAlignment)),this._set("objectStates",(0,o.SC)(this.objectStates)),this._set("graphicsCore",(0,o.SC)(this.graphicsCore)),this._set("owner",null)}get layer(){return this.owner.layer}get suspendResumeExtentMode(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}get scaleVisibilitySuspended(){var e;return null==(e=this.scaleVisibility)?void 0:e.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return(0,o.Wi)(this.frustumVisibility)||!this.frustumVisibility.suspended}get suspendInfo(){var r;const e={};return null!=(r=this.scaleVisibility)&&r.suspended&&(e.outsideScaleRange=!0),(0,o.pC)(this.frustumVisibility)&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e}get updating(){var e,r;return!!((null==(e=this.graphicsCore)?void 0:e.updating)||(0,o.pC)(this.frustumVisibility)&&this.frustumVisibility.updating||(null==(r=this.updatingHandles)?void 0:r.updating))}get updatingRemaining(){var e,r;return null!=(r=null==(e=this.graphicsCore)?void 0:e.updatingRemaining)?r:0}get featureStore(){var e;return null==(e=this.graphicsCore)?void 0:e.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){var e;return null==(e=this.owner)?void 0:e.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){var e;return null==(e=this.graphicsCore)?void 0:e.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var e;return null==(e=this.graphicsCore)?void 0:e.graphics3DGraphicsByObjectID}get symbolUpdateType(){var e;return null==(e=this.graphicsCore)?void 0:e.symbolUpdateType}get displayFeatureLimit(){var F;const e=this.view.resourceController.memoryController.memoryFactor,r=null==(F=this.graphicsCore)?void 0:F.displayFeatureLimit;if(1===e)return r;const l=Math.ceil(r.maximumNumberOfFeatures*e),u=Math.ceil(r.maximumTotalNumberOfFeatures*e),D=Math.ceil(r.minimumTotalNumberOfFeatures*e);return N(K({},r),{maximumNumberOfFeatures:l,maximumTotalNumberOfFeatures:u,minimumTotalNumberOfFeatures:D})}get usedMemory(){var e,r;return null!=(r=null==(e=this.graphicsCore)?void 0:e.usedMemory)?r:0}get usedMemoryPerFeature(){var e,r;return null!=(r=null==(e=this.graphicsCore)?void 0:e.usedMemoryPerGraphic)?r:0}get unprocessedMemoryEstimate(){var e,r;return null!=(r=null==(e=this.graphicsCore)?void 0:e.unprocessedMemoryEstimate)?r:0}get performanceInfo(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:(0,o.Wi)(this.frustumVisibility)||!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibility.suspended}}setup(){var e=this;return(0,_.Z)(function*(){(0,o.pC)(e.frustumVisibility)&&e.frustumVisibility.setup(e);const r=e.owner,u=(D,F,W)=>e.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(D,F,W);e.scaleVisibility&&e.scaleVisibility.setup(e,e.layer,u,e.graphicsCore,e.owner.view.basemapTerrain),(0,o.pC)(e.filterVisibility)&&("filter"in r||"timeExtent"in r)&&e.filterVisibility.setup(r,e.graphicsCore),e.elevationAlignment&&e.elevationAlignment.setup(e,u,e.graphicsCore,r.view.elevationProvider),e._set("objectStates",new X.d(e.graphicsCore)),e._set("labeling",e.owner.view.labeler.addGraphicsOwner(e.graphicsCore,e.scaleVisibility)),e._set("deconfliction",r.view.deconflictor.addGraphicsOwner(e.graphicsCore)),yield(0,I.U3)(e.graphicsCore.setup({elevationAlignment:e.elevationAlignment,scaleVisibility:e.scaleVisibility,filterVisibility:e.filterVisibility,deconflictor:e.deconfliction,labeler:e.labeling,objectStates:e.objectStates})),e.updatingHandles.add(()=>e.layer.renderer,D=>e.updatingHandles.addPromise(e.graphicsCore.rendererChange(D))),e.updatingHandles.add(()=>r.fullOpacity,()=>e.graphicsCore.opacityChange()),e._setupSuspendResumeExtent(),e.updateClippingExtent&&(e.updatingHandles.add(()=>r.view.clippingArea,()=>e._updateClippingExtent()),e._updateClippingExtent()),e.graphicsCore.startCreateGraphics(),e.graphicsCore.labelsEnabled&&(yield(0,I.U3)(e.graphicsCore.updateLabelingInfo()))})()}maskOccludee(e){const{set:r,handle:l}=this.objectStates.acquireSet(B.V_.MaskOccludee,null);return this.objectStates.setUid(r,e.uid),l}highlight(e,r){if(e instanceof y.Z){const{set:l,handle:u}=this.objectStates.acquireSet(B.V_.Highlight,r);return this.owner.queryObjectIds(e).then(D=>this.objectStates.setObjectIds(l,D)),u}if("number"==typeof e||"string"==typeof e)return this.highlight([e],r);if(e instanceof O.Z)return this.highlight([e],r);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof O.Z){const l=e;if(null==(0,J.g)(this.layer.fieldsIndex,l[0].attributes,r)){const u=l.map(W=>W.uid),{set:D,handle:F}=this.objectStates.acquireSet(B.V_.Highlight,null);return this.objectStates.setUids(D,u),F}e=l.map(u=>(0,J.g)(this.layer.fieldsIndex,u.attributes,r))}if("number"==typeof e[0]||"string"==typeof e[0]){const l=e,{set:u,handle:D}=this.objectStates.acquireSet(B.V_.Highlight,r);return this.objectStates.setObjectIds(u,l),D}}return te}whenGraphicBounds(e,r){var l;return null==(l=this.graphicsCore)?void 0:l.whenGraphicBounds(e,r)}computeAttachmentOrigin(e,r){var l;return null==(l=this.graphicsCore)?void 0:l.computeAttachmentOrigin(e,r)}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,r,l){const u=(0,a.Kb)(e,{renderer:r,arcade:l});if((0,o.pC)(u)&&u.color){const D=u.color;D[0]=D[0]/255,D[1]=D[1]/255,D[2]=D[2]/255}return u}getRenderingInfoAsync(e,r,l,u){return(0,a.xn)(e,K({renderer:r,arcade:l},u))}getSymbolLayerSize(e,r){var l;return null==(l=this.graphicsCore)?void 0:l.getSymbolLayerSize(e,r)}setObjectIdVisibility(e,r){var l;null==(l=this.graphicsCore)||l.setObjectIdVisibility(e,r)}_updateClippingExtent(){const e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add((0,i.YP)(()=>this.suspendResumeExtentMode,()=>{switch(this.handles.remove(H),this.suspendResumeExtentMode){case"computed":this.handles.add([(0,i.YP)(()=>this.graphicsCore.computedExtent,e=>this._updateSuspendResumeExtent(e),i.nn),(0,i.YP)(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],H);break;case"data":this.handles.add([(0,i.gx)(()=>this.dataExtent,e=>this._updateSuspendResumeExtent(e),i.nn),(0,i.YP)(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent((0,o.Wg)(this.dataExtent)))],H);break;default:(0,E.Bg)(this.suspendResumeExtentMode)}},i.nn))}_updateSuspendResumeExtent(e){this._suspendResumeExtentChanged(e?this._extentToSuspendResumeRect(e,this.suspendResumeExtent):null)}_extentToSuspendResumeRect(e,r){const l=this.owner.view.spatialReference;if(!e.spatialReference.equals(l)){if(!(0,x.Q8)(e,l))return;e=(0,x.iV)(e,l)}return(0,q.Go)(e,r,S.ZF,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(e){(0,o.pC)(this.frustumVisibility)&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)}};(0,n._)([(0,s.Cb)()],v.prototype,"type",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"owner",void 0),(0,n._)([(0,s.Cb)()],v.prototype,"layer",null),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"updateClippingExtent",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"elevationFeatureExpressionEnabled",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"graphicsCore",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"scaleVisibility",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"filterVisibility",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"elevationAlignment",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],v.prototype,"frustumVisibility",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],v.prototype,"deconfliction",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],v.prototype,"labeling",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],v.prototype,"objectStates",void 0),(0,n._)([(0,s.Cb)()],v.prototype,"suspendResumeExtentMode",null),(0,n._)([(0,s.Cb)()],v.prototype,"dataExtent",void 0),(0,n._)([(0,s.Cb)()],v.prototype,"scaleVisibilitySuspended",null),(0,n._)([(0,s.Cb)()],v.prototype,"suspended",null),(0,n._)([(0,s.Cb)()],v.prototype,"legendEnabled",null),(0,n._)([(0,s.Cb)()],v.prototype,"suspendInfo",null),(0,n._)([(0,s.Cb)()],v.prototype,"updating",null),(0,n._)([(0,s.Cb)()],v.prototype,"updatingRemaining",null),(0,n._)([(0,s.Cb)()],v.prototype,"featureStore",null),(0,n._)([(0,s.Cb)()],v.prototype,"view",null),(0,n._)([(0,s.Cb)()],v.prototype,"loadedGraphics",null),(0,n._)([(0,s.Cb)()],v.prototype,"fullOpacity",null),(0,n._)([(0,s.Cb)()],v.prototype,"filter",null),(0,n._)([(0,s.Cb)()],v.prototype,"slicePlaneEnabled",null),(0,n._)([(0,s.Cb)()],v.prototype,"drapeSourceType",void 0),(0,n._)([(0,s.Cb)()],v.prototype,"updatePolicy",null),(0,n._)([(0,s.Cb)()],v.prototype,"preferredUpdatePolicy",void 0),(0,n._)([(0,s.Cb)()],v.prototype,"displayFeatureLimit",null),v=(0,n._)([(0,P.j)("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],v);const ee=v,H="suspendResumeExtentMode",te={remove(){},pause(){},resume(){}}},83518:(R,b,t)=>{t.d(b,{Z:()=>x});var _=t(17626),n=t(14517),O=t(72392),E=t(32917),m=t(77712),s=(t(85931),t(8314),t(90912),t(76898)),p=t(12080),M=t(37810),G=t(87091);let f=class extends n.Z{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new O.Z,this.graphicsCoreOwner=null,this.updating=!0}setup(a){this.graphicsCoreOwner=a,this.extentIntersection=new M.q({renderCoordsHelper:a.view.renderCoordsHelper});const y=a.view,c=y.basemapTerrain,S=y.resourceController.scheduler;this.handles.add([y.on("resize",()=>this._viewChange()),(0,E.YP)(()=>y.state.camera,()=>this._viewChange(),E.Z_),S.registerTask(G.T8.FRUSTUM_VISIBILITY,this),c.on("elevation-bounds-change",()=>this._elevationBoundsChange())]),"local"===y.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([(0,E.YP)(()=>{var h,d,g;return[c.baseOpacity,c.wireframe,null==(g=null==(d=null==(h=y.map)?void 0:h.ground)?void 0:d.navigationConstraint)?void 0:g.type]},()=>this._updateIsVisibleBelowSurface(),E.nn)])}destroy(){this.graphicsCoreOwner=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set("updating",!0)}setExtent(a){this.extent=a,this.extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(a){this._isVisibleBelowSurface=a,this._setDirty(),this.extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const a=this.graphicsCoreOwner.view;this.isVisibleBelowSurface="local"===a.viewingMode||!a.basemapTerrain.opaque||a.map.ground&&a.map.ground.navigationConstraint&&"none"===a.map.ground.navigationConstraint.type}_updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const a=this.graphicsCoreOwner.view;let y;if(this._isVisibleBelowSurface)y=-.3*(0,p.Iu)(a.spatialReference).radius;else{const{min:c,max:S}=a.basemapTerrain.elevationBounds;y=c-Math.max(1,(S-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,y)}get running(){return this.updating}runTask(){if(this._set("updating",!1),!this.extent)return void this._set("suspended",!1);this._updateExtentIntersection();const a=this.graphicsCoreOwner.view.frustum,y=(0,p.Iu)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(a,y))}};(0,_._)([(0,m.Cb)({readOnly:!0})],f.prototype,"suspended",void 0),(0,_._)([(0,m.Cb)({readOnly:!0})],f.prototype,"updating",void 0),f=(0,_._)([(0,s.j)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],f);const x=f},14752:(R,b,t)=>{t.d(b,{d:()=>o});var O,I,_=t(54024),n=t(42743);(I=O||(O={}))[I.Object=0]="Object",I[I.RenderGeometry=1]="RenderGeometry",I[I.External=2]="External",I[I.COUNT=3]="COUNT";class E{constructor(){this.items=[]}addObject(i,s){this.items.push({type:O.Object,objectStateId:s,object:i})}addRenderGeometry(i,s,p){this.items.push({type:O.RenderGeometry,objectStateId:s,renderGeometry:i,owner:p})}addExternal(i,s){this.items.push({type:O.External,objectStateId:s,remove:i})}remove(i){for(let s=this.items.length-1;s>=0;--s){const p=this.items[s];p.objectStateId===i&&(this._removeObjectStateItem(p),this.items.splice(s,1))}}removeObject(i){for(let s=this.items.length-1;s>=0;--s){const p=this.items[s];p.type===O.Object&&p.object===i&&(this._removeObjectStateItem(p),this.items.splice(s,1))}}removeRenderGeometry(i){for(let s=this.items.length-1;s>=0;--s){const p=this.items[s];p.type===O.RenderGeometry&&p.renderGeometry===i&&(this._removeObjectStateItem(p),this.items.splice(s,1))}}removeAll(){this.items.forEach(i=>{this._removeObjectStateItem(i)}),this.items=[]}_removeObjectStateItem(i){switch(i.type){case O.Object:i.objectStateId.channel===n.V_.Highlight?i.object.removeHighlight(i.objectStateId):i.objectStateId.channel===n.V_.MaskOccludee&&i.object.removeOcclude(i.objectStateId);break;case O.RenderGeometry:i.owner.removeRenderGeometryObjectState(i.renderGeometry,i.objectStateId);break;case O.External:i.remove(i.objectStateId)}}}class m{constructor(i,s){this.stateType=i,this.objectIdField=s,this.objectStateSet=new E,this.ids=new Set,this.paused=!1}hasGraphic(i){return this.ids.has(this.objectIdField?i.graphic.attributes[this.objectIdField]:i.graphic.uid)}}class o{constructor(i){this._graphicsCore=i,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach(i=>i.objectStateSet.removeAll()),this._stateSets=null}acquireSet(i,s){const p=new m(i,s);this._stateSets.push(p);const M=(0,_.kB)(()=>this.releaseSet(p));return{set:p,handle:M}}releaseSet(i){i.objectStateSet.removeAll();const s=this._stateSets?this._stateSets.indexOf(i):-1;-1!==s&&this._stateSets.splice(s,1)}_addObjectStateSet(i,s){i.addObjectStateSet(s.stateType,s.objectStateSet)}_removeObjectStateSet(i,s){i.removeObjectState(s.objectStateSet)}setUid(i,s){i.ids.add(s);const p=this._graphicsCore.graphics3DGraphics.get(s);p&&this._addObjectStateSet(p,i)}setUids(i,s){s.forEach(p=>this.setUid(i,p))}setObjectIds(i,s){s.forEach(p=>i.ids.add(p)),this._initializeSet(i)}addGraphic(i){this._stateSets.forEach(s=>{!s.paused&&s.hasGraphic(i)&&this._addObjectStateSet(i,s)})}removeGraphic(i){this._stateSets.forEach(s=>{s.hasGraphic(i)&&this._removeObjectStateSet(i,s)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(i=>i.objectStateSet.removeAll())}_initializeSet(i){const s=this._graphicsCore.graphics3DGraphics;i.objectIdField?s.forEach(p=>{p&&i.hasGraphic(p)&&this._addObjectStateSet(p,i)}):i.ids.forEach(p=>{const M=s.get(p);M&&this._addObjectStateSet(M,i)})}get test(){return{states:this._stateSets}}}},34675:(R,b,t)=>{t.d(b,{q:()=>y});var _=t(15861),n=t(17626),E=(t(29132),t(14517)),m=t(62208),o=t(77712),p=(t(85931),t(8314),t(90912),t(76898)),M=t(2004),G=t(58175),P=t(17253),f=t(84952),x=t(71774);const a=G.q;let y=class extends E.Z{constructor(c){super(c),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}get defaultQueryJSON(){return new f.Z({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this._ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}executeQueryForIdSet(c,S){var h=this;return(0,_.Z)(function*(){return h.dataQueryEngine.executeQueryForIdSet(h._ensureQueryJSON(c,S))})()}executeQueryForCount(c,S){var h=this;return(0,_.Z)(function*(){return h.dataQueryEngine.executeQueryForCount(h._ensureQueryJSON(c),S)})()}executeQueryForExtent(c,S){var h=this;return(0,_.Z)(function*(){const{count:d,extent:g}=yield h.dataQueryEngine.executeQueryForExtent(h._ensureQueryJSON(c),S);return{count:d,extent:M.Z.fromJSON(g)}})()}executeQueryForIds(c,S){var h=this;return(0,_.Z)(function*(){return h.dataQueryEngine.executeQueryForIds(h._ensureQueryJSON(c),S)})()}executeQueryForLatestObservations(c,S){var h=this;return(0,_.Z)(function*(){const d=yield h.dataQueryEngine.executeQueryForLatestObservations(h._ensureQueryJSON(c),S),g=P.default.fromJSON(d);return g.features.forEach(C=>{C.layer=h.layer,C.sourceLayer=h.layer}),g})()}executeQuery(c,S){var h=this;return(0,_.Z)(function*(){const d=yield h.dataQueryEngine.executeQuery(h._ensureQueryJSON(c),S),g=P.default.fromJSON(d);return g.features.forEach(C=>{C.layer=h.layer,C.sourceLayer=h.layer}),g})()}_ensureQueryJSON(c,S){let h=this.defaultQueryJSON;return(0,m.pC)(c)&&("outSpatialReference"in c&&!c.outSpatialReference&&(c.outSpatialReference=this.spatialReference),h=c.toJSON()),(0,m.pC)(S)&&(h=N(K({},h),{sceneFilter:N(K({},S),{geometry:S.geometry.toJSON()})})),h}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const c="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,S=this.layer.objectIdField,h=x.Mk.toJSON(this.queryGeometryType),d=this.layer.fields.map(V=>V.toJSON()),g=this.layerView.view.resourceController.scheduler,C=this.priority,T=this.spatialReference.toJSON(),j=this.layerView.processor.featureStore,{hasZ:A,hasM:U}=this.layerView;return this._dataQueryEngineInstance=new a({hasZ:A,hasM:U,geometryType:h,fields:d,timeInfo:c,spatialReference:T,objectIdField:S,featureStore:j,scheduler:g,priority:C}),this._dataQueryEngineInstance}};(0,n._)([(0,o.Cb)({constructOnly:!0})],y.prototype,"layerView",void 0),(0,n._)([(0,o.Cb)({constructOnly:!0})],y.prototype,"priority",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],y.prototype,"spatialReference",void 0),(0,n._)([(0,o.Cb)({readOnly:!0,aliasOf:"layerView.layer"})],y.prototype,"layer",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],y.prototype,"queryGeometryType",null),(0,n._)([(0,o.Cb)({readOnly:!0})],y.prototype,"defaultQueryJSON",null),y=(0,n._)([(0,p.j)("esri.views.3d.layers.graphics.QueryEngine")],y)},97445:(R,b,t)=>{function _(O,E,m){if(!m||null==E)return null;if(!O)return function n(O,E){const m=E.toLowerCase();for(const o in O)if(o.toLowerCase()===m)return O[o];return null}(E,m);const o=O.get(m);return o?E[o.name]:null}t.d(b,{g:()=>_})},45611:(R,b,t)=>{t.d(b,{Z:()=>x});var _=t(17626),n=t(14517),O=t(61885),E=t(80542),m=t(61996),o=t(63290),I=t(62208),i=t(60330),s=t(77712),P=(t(85931),t(8314),t(90912),t(76898));let f=class extends((0,E.p)((0,m.IG)((0,i.v)(O.Z.EventedMixin(n.Z))))){constructor(a){super(a),this.layer=null,this.parent=null}initialize(){this.when().catch(a=>{if("layerview:create-error"!==a.name){const y=this.layer&&this.layer.id||"no id",c=this.layer&&this.layer.title||"no title";o.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${c}', id: '${y}')`,a)}})}get fullOpacity(){return(0,I.Pt)(this.get("layer.opacity"),1)*(0,I.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var a;return!this.suspended&&!0===(null==(a=this.layer)?void 0:a.legendEnabled)}get updating(){var a;return!!(null!=(a=this.updatingHandles)&&a.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var a;return!0===(null==(a=this.layer)?void 0:a.visible)}set visible(a){void 0!==a?this._override("visible",a):this._clearOverride("visible")}canResume(){var a,y,c;return this.visible&&(null==(a=this.layer)?void 0:a.loaded)&&!(null!=(y=this.parent)&&y.suspended)&&(null==(c=this.view)?void 0:c.ready)||!1}getSuspendInfo(){const a=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(a.viewNotReady=!0),this.layer&&this.layer.loaded||(a.layerNotLoaded=!0),this.visible||(a.layerInvisible=!0),a}isUpdating(){return!1}};(0,_._)([(0,s.Cb)()],f.prototype,"fullOpacity",null),(0,_._)([(0,s.Cb)()],f.prototype,"layer",void 0),(0,_._)([(0,s.Cb)()],f.prototype,"parent",void 0),(0,_._)([(0,s.Cb)({readOnly:!0})],f.prototype,"suspended",null),(0,_._)([(0,s.Cb)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,_._)([(0,s.Cb)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,_._)([(0,s.Cb)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,_._)([(0,s.Cb)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,_._)([(0,s.Cb)()],f.prototype,"visible",null),(0,_._)([(0,s.Cb)()],f.prototype,"view",void 0),f=(0,_._)([(0,P.j)("esri.views.layers.LayerView")],f);const x=f}}]);