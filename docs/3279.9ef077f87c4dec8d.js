"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[3279],{76825:(q,L,e)=>{e.d(L,{cn:()=>i,j:()=>A,lK:()=>v});const i="updating";function v(C){return"updating"===C?null:C}function A(C){return"updating"===C}},22498:(q,L,e)=>{e.d(L,{z:()=>W});var i=e(17626),A=(e(29132),e(14517)),C=e(85931),w=e(63290),F=e(21286),s=e(62208),j=e(76825),f=e(32917),O=e(16730),o=e(77712),g=(e(90912),e(76898)),n=e(84161),I=e(10410),S=e(55915),K=e(5548),l=e(65401),R=e(94425),D=e(37053),T=e(46367),Q=e(98624),b=e(42964),J=e(6040),ee=e(65234);const te="esri.views.3d.layers.i3s.I3SMeshViewFilter",Z=w.Z.getLogger(te);let W=class extends A.Z{constructor(t){super(t),this._projectionEngineLoaded=!1}initialize(){(0,f.N1)(()=>{var t;return(null==(t=(0,s.Wg)(this.viewFilter))?void 0:t.geometry)||(0,s.pC)(this.layerFilter)}).then(()=>this.loadAsyncModule(Promise.all([e.e(4918),e.e(4766)]).then(e.bind(e,44766)).then(t=>{this.destroyed||(this._geometryEngine=t)})))}get sortedObjectIds(){if((0,s.Wi)(this.viewFilter)||(0,s.Wi)(this.viewFilter.objectIds))return null;const t=(0,J.QZ)(this.viewFilter.objectIds);return t.sort(),t}get parsedWhereClause(){const t=(0,s.pC)(this.viewFilter)?this.viewFilter.where:null;if((0,s.Wi)(t)||!t)return null;try{return I.WhereClause.create(t,this.layerFieldsIndex)}catch(r){Z.error(`Failed to parse filter where clause: ${r}`)}return null}addFilters(t,r,a,y){const u=this.sortedObjectIds;(0,s.pC)(u)&&t.push(E=>(0,b.Yb)(u,!0,E)),this.addSqlFilter(t,this.parsedWhereClause);const c=(0,j.lK)(this._layerMaskGeometries),d=this._geometryEngine;if((0,s.pC)(c)&&(0,s.pC)(this.layerFilter)&&(0,s.pC)(d)){const E=this.layerFilter.spatialRelationship;t.push((h,m)=>le(d,h,m,y,r,a,c,E))}const p=(0,j.lK)(this._viewMaskGeometries);if((0,s.pC)(p)&&(0,s.pC)(this.viewFilter)&&(0,s.pC)(d)){const E=this.viewFilter.spatialRelationship;t.push((h,m)=>le(d,h,m,y,r,a,p,E))}}isMBSGeometryVisible(t,r,a){const y=(0,j.lK)(this._layerMaskGeometries),u=this._geometryEngine;if((0,s.pC)(y)&&(0,s.pC)(this.layerFilter)&&(0,s.pC)(u)){const d=this.layerFilter.spatialRelationship,p=y[0].spatialReference||r;return(0,S.st)(t,a,X,p)?_e(u,X,y,p,d):(Z.warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}const c=(0,j.lK)(this._viewMaskGeometries);if((0,s.pC)(c)&&(0,s.pC)(this.viewFilter)&&(0,s.pC)(u)){const d=this.viewFilter.spatialRelationship,p=c[0].spatialReference||r;return(0,S.st)(t,a,X,p)?_e(u,X,c,p,d):(Z.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){const t=(0,j.lK)(this._viewMaskGeometries),r=(0,j.lK)(this._layerMaskGeometries);return(0,s.Wi)(t)||(0,s.Wi)(r)?t||r:r.concat(t)}get _layerMaskGeometries(){const t=this.layerFilter;return(0,s.Wi)(t)?null:(0,s.Wi)(this._geometryEngine)?j.cn:"disjoint"===t.spatialRelationship?t.geometries.map(r=>({type:"polygon",rings:r.rings,spatialReference:r.spatialReference,cache:{}})):[t.geometries.reduce((r,a)=>(r.rings=[...r.rings,...a.rings],r),{type:"polygon",rings:[],spatialReference:t.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if((0,s.Wi)(this.viewFilter))return null;const{geometry:t}=this.viewFilter;if((0,s.Wi)(t))return null;if((0,s.Wi)(this.viewFilter)||(0,s.Wi)(this._geometryEngine))return j.cn;const{distance:r,units:a}=this.viewFilter,y=this.viewFilter.spatialRelationship,u="mesh"===t.type?t.extent:t;if((0,s.Wi)(r)||0===r)return re(this._geometryEngine,u,y);const c=a||(0,O.qE)(u.spatialReference);if(u.spatialReference.isWGS84){const E=this._geometryEngine.geodesicBuffer(u,r,c);return re(this._geometryEngine,E,y)}const d=(0,T.iV)(u,ee.Z.WGS84);if((0,s.pC)(d)){const E=(0,T.iV)(this._geometryEngine.geodesicBuffer(d,r,c),u.spatialReference);return re(this._geometryEngine,E,y)}if(!this._projectionEngineLoaded&&(this.loadAsyncModule((0,S.zD)().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let p=null;try{p=(0,S.iV)(u,ee.Z.WGS84)}catch(E){}if(p)try{p=(0,S.iV)(this._geometryEngine.geodesicBuffer(p,r,c),u.spatialReference)}catch(E){p=null}return p||Z.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${u.spatialReference.wkid}) to WGS84.`),re(this._geometryEngine,p,y)}get updating(){return(0,j.j)(this._layerMaskGeometries)||(0,j.j)(this._viewMaskGeometries)}static checkSupport(t){return!((0,s.Wi)(t)||(t.timeExtent?(Z.warn("Filters with a timeExtent are not supported for mesh scene layers"),1):!function de(t){return null!=t&&ae.includes(t)}(t.spatialRelationship)&&(Z.warn(`Filters with spatialRelationship other than ${ae.join(", ")} are not supported for mesh scene layers`),1)))}};(0,i._)([(0,o.Cb)()],W.prototype,"layerFilter",void 0),(0,i._)([(0,o.Cb)({type:Q.Z})],W.prototype,"viewFilter",void 0),(0,i._)([(0,o.Cb)()],W.prototype,"layerFieldsIndex",void 0),(0,i._)([(0,o.Cb)()],W.prototype,"loadAsyncModule",void 0),(0,i._)([(0,o.Cb)()],W.prototype,"addSqlFilter",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],W.prototype,"sortedObjectIds",null),(0,i._)([(0,o.Cb)({readOnly:!0})],W.prototype,"parsedWhereClause",null),(0,i._)([(0,o.Cb)({readOnly:!0})],W.prototype,"parsedGeometry",null),(0,i._)([(0,o.Cb)({readOnly:!0})],W.prototype,"_layerMaskGeometries",null),(0,i._)([(0,o.Cb)({readOnly:!0})],W.prototype,"_viewMaskGeometries",null),(0,i._)([(0,o.Cb)()],W.prototype,"updating",null),(0,i._)([(0,o.Cb)()],W.prototype,"_projectionEngineLoaded",void 0),(0,i._)([(0,o.Cb)()],W.prototype,"_geometryEngine",void 0),W=(0,i._)([(0,g.j)(te)],W);const ae=["contains","intersects","disjoint"];var P,t;function re(t,r,a){if((0,s.Wi)(r))return null;if("disjoint"===a&&"polygon"===r.type){const y=r.rings.length,u=r.spatialReference,c=new Array(y);for(let E=0;E<y;++E){const h=(0,l.al)(1/0,1/0,-1/0,-1/0);(0,l.Wi)(h,r.rings[E]),c[E]={type:"polygon",rings:[r.rings[E]],spatialReference:u,cache:{},aabr:h}}c.sort((E,h)=>E.aabr[0]-h.aabr[0]);const d=new Set,p=new C.SO;for(let E=0;E<c.length;++E){const h=c[E],m=h.aabr[0];d.forEach(M=>{if(m>=M.aabr[2])return void d.delete(M);if(h.aabr[1]>M.aabr[3]||h.aabr[3]<M.aabr[1]||!t.intersects(h,M))return;h.rings=h.rings.concat(M.rings),(0,l.jn)(h.aabr,M.aabr,h.aabr),h.cache={},d.delete(M);const B=(0,C.cq)(c,M,c.length,p);c.splice(B,1)}),d.add(h)}for(const E of c)E.aabr=void 0;return c}return[r]}function _e(t,r,a,y,u){const c=ce(t,r,y);return a.every(d=>ue(t,d,c,u)!==P.DISCARD)}function le(t,r,a,y,u,c,d,p){const E=d[0].spatialReference||u.spatialReference;if(!(0,S.st)(a.node.mbs,c,X,E))return void Z.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const h=ce(t,X,E),m=function pe(t,r,a,y,u){const c=r.renderSpatialReference,d=new Map,p={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:a};p.rings[0][3]=p.rings[0][0];let h,m;switch(t){case"intersects":h=(M,B,V)=>M.intersects(B,V)?P.KEEP:P.TEST,m=se;break;case"contains":h=(M,B,V)=>M.contains(B,V)?P.TEST:P.DISCARD,m=se;break;default:h=(M,B,V)=>M.disjoint(B,V)?P.TEST:P.DISCARD,m=Ee}return{collection:y,object:u,type:t,maskSR:a,renderSR:c,aabbCache:d,triangle:p,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:h,geometryTest:m}}(p,u,E,y,a.objectHandle);for(const M of d){if(0===r.length)return;switch(ue(t,M,h,p)){case P.DISCARD:return void(r.length=0);case P.KEEP:continue}(0,b.hv)(r,a.featureIds,B=>ye(t,M,B,m))}}(t=P||(P={}))[t.KEEP=0]="KEEP",t[t.DISCARD=1]="DISCARD",t[t.TEST=2]="TEST";const X=[0,0,0,0];function ce(t,r,a){const y={type:"point",x:r[0],y:r[1],hasZ:!1,hasM:!1,spatialReference:a},u=!(0,D.oR)(a)&&!(0,D.sS)(a),c=Number.isNaN(r[3])?0:(0,F.uZ)(r[3],0,2*R.sv.radius),d=u?t.buffer(y,c,1):t.geodesicBuffer(y,c,1);return d.type="polygon",d}function ue(t,r,a,y){switch(y){case"intersects":case"contains":return se(t,r,a);case"disjoint":return Ee(t,r,a)}}function se(t,r,a){return t.intersects(r,a)?t.contains(r,a)?P.KEEP:P.TEST:P.DISCARD}function Ee(t,r,a){return t.intersects(r,a)?t.contains(r,a)?P.DISCARD:P.TEST:P.KEEP}function ye(t,r,a,y){const{collection:u,object:c,renderSR:d,maskSR:p,geometryTest:E,aabbCache:h}=y;let m=h.get(a);if(!m){const z=u.getObjectTransform(c);u.getComponentAabb(c,a,N);const x=[[N[0],N[1],0],[N[0],N[4],0],[N[3],N[4],0],[N[3],N[1],0]];for(let U=0;U<4;++U)(0,n.t)(x[U],x[U],z.rotationScale),(0,n.a)(x[U],x[U],z.position),(0,S.SH)(x[U],d,x[U],p);m={type:"polygon",rings:[x],spatialReference:p,cache:{}},m.rings[0][4]=m.rings[0][0],h.set(a,m)}switch(E(t,r,m)){case P.DISCARD:return!1;case P.KEEP:return!0}const{triangle:M,triangleTest:B,positions:V}=y,H=M.rings[0][0],$=M.rings[0][1],Y=M.rings[0][2],k=u.getObjectTransform(c);u.getComponentPositions(c,a,V);const{indices:ne,data:G,stride:ie,startIndex:he,endIndex:ge}=V;for(let z=he;z<ge;z+=3){const x=ie*ne[z+0],U=ie*ne[z+1],oe=ie*ne[z+2];switch((0,n.s)(H,G[x+0],G[x+1],G[x+2]),(0,n.s)($,G[U+0],G[U+1],G[U+2]),(0,n.s)(Y,G[oe+0],G[oe+1],G[oe+2]),(0,n.t)(H,H,k.rotationScale),(0,n.t)($,$,k.rotationScale),(0,n.t)(Y,Y,k.rotationScale),(0,n.a)(H,H,k.position),(0,n.a)($,$,k.position),(0,n.a)(Y,Y,k.position),(0,S.SH)(H,d,H,p),(0,S.SH)($,d,$,p),(0,S.SH)(Y,d,Y,p),B(t,r,M)){case P.DISCARD:return!1;case P.KEEP:return!0}}return"intersects"!==y.type}const N=(0,K.Ue)()},94443:(q,L,e)=>{e.d(L,{u:()=>K});var i=e(15861),v=e(17626),A=e(14517),C=e(26584),w=e(72392),F=e(62208),s=e(77712),O=(e(90912),e(85931),e(76898)),o=e(2004),_=e(5437),g=e(58175),n=e(17253),I=e(96854);const S=g.q;let K=class extends A.Z{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return new I.Z({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(l){super(l),this._handles=new w.Z}initialize(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=(0,F.SC)(this._dataQueryEngineInstance),this._handles=(0,F.SC)(this._handles),this._set("layerView",null)}executeQueryForCount(l,R){var D=this;return(0,i.Z)(function*(){return D._dataQueryEngine.executeQueryForCount(D._ensureQueryJSON(l),R)})()}executeQueryForExtent(l,R){var D=this;return(0,i.Z)(function*(){const{count:T,extent:Q}=yield D._dataQueryEngine.executeQueryForExtent(D._ensureQueryJSON(l),R);return{count:T,extent:o.Z.fromJSON(Q)}})()}executeQueryForIds(l,R){var D=this;return(0,i.Z)(function*(){return D._dataQueryEngine.executeQueryForIds(D._ensureQueryJSON(l),R)})()}executeQuery(l,R){var D=this;return(0,i.Z)(function*(){const T=D._ensureQueryJSON(l);if(T.returnGeometry)throw new C.Z("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(T.returnCentroid)throw new C.Z("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");const Q=yield D._dataQueryEngine.executeQuery(T,R),b=n.Z.fromJSON(Q);return b.features.forEach(J=>{J.geometry=null}),b})()}_ensureQueryJSON(l){return(0,F.Wi)(l)?this.defaultQueryJSON:l.toJSON()}_ensureDataQueryEngine(){var ee,te;if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const l=this.layer.objectIdField||_.d,D=null!=(te=null==(ee=this.layer.fields)?void 0:ee.map(Z=>Z.toJSON()))?te:[],T=this.layerView.view.resourceController.scheduler,Q=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new S({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:D,timeInfo:null,spatialReference:Q,objectIdField:l,featureStore:this.spatialIndex,scheduler:T,priority:this.priority}),this._dataQueryEngineInstance}};(0,v._)([(0,s.Cb)({constructOnly:!0})],K.prototype,"layerView",void 0),(0,v._)([(0,s.Cb)({constructOnly:!0})],K.prototype,"priority",void 0),(0,v._)([(0,s.Cb)({constructOnly:!0})],K.prototype,"spatialIndex",void 0),(0,v._)([(0,s.Cb)()],K.prototype,"spatialReference",null),(0,v._)([(0,s.Cb)()],K.prototype,"layer",null),(0,v._)([(0,s.Cb)()],K.prototype,"defaultQueryJSON",null),K=(0,v._)([(0,O.j)("esri.views.3d.layers.i3s.I3SQueryEngine")],K)},72537:(q,L,e)=>{e.d(L,{u:()=>F});var i=e(62208),v=e(5548),A=e(77044),C=e(88071),w=e(42964);class F{constructor(f){this._objectIdField=f.objectIdField,this._getFeatureExtent=f.getFeatureExtent}getObjectId(f){return f.id}getAttributes(f){const{meta:O,index:o}=f,_={};this._objectIdField&&(_[this._objectIdField]=f.id);const g=(0,i.pC)(O.attributeInfo)&&O.attributeInfo.attributeData;if((0,i.pC)(g))for(const n of Object.keys(g))_[n]=(0,w.Jx)(g[n],o);return _}getAttribute(f,O){if(O===this._objectIdField)return f.id;const{meta:o,index:_}=f,g=(0,i.pC)(o.attributeInfo)&&o.attributeInfo.attributeData;return(0,i.pC)(g)?(0,w.Jx)(g[O],_):null}getGeometry(f){if(f.geometry)return f.geometry;const[O,o,_,g,n]=this._getFeatureExtent(f,s);return new C.Z([5],[O,o,_,g,o,_,g,n,_,O,n,_,O,o,_])}getCentroid(f,O){if(f.geometry)return(0,A.Y)(new C.Z,f.geometry,O.hasZ,O.hasM);const[o,_,g,n,I,S]=this._getFeatureExtent(f,s);return new C.Z([0],[(o+n)/2,(_+I)/2,(g+S)/2])}cloneWithGeometry(f,O){const{id:o,index:_,meta:g}=f;return{id:o,index:_,meta:g,geometry:O}}}const s=(0,v.Ue)()},41941:(q,L,e)=>{e.d(L,{I:()=>n});var i=e(17626),v=e(14517),A=e(61885),C=e(77712),s=(e(90912),e(85931),e(76898)),j=e(4794),f=e(55915),O=e(5548),o=e(65401),_=e(52836);const g=(0,O.Ue)();let n=class extends v.Z{constructor(l){super(l),this.events=new A.Z}forEach(l){this.forAllFeatures(R=>(l(R),_.K.CONTINUE))}forEachBounds(l,R){const D=this.getFeatureExtent;for(const T of l)R(D(T,g))}forEachInBounds(l,R){this.forAllFeatures(D=>{const T=this.getFeatureExtent(D,S);return(0,o.kK)(l,(0,O.y8)(T,K))&&R(D),_.K.CONTINUE},D=>{if((0,f.st)(D.node.mbs,this.sourceSpatialReference,I,this.viewSpatialReference),I[0]>=l[0]&&I[2]<=l[2]&&I[1]>=l[1]&&I[3]<=l[3])return _.K.CONTINUE;const T=Math.max(l[0],Math.min(I[0],l[2])),Q=Math.max(l[1],Math.min(I[1],l[3])),b=I[0]-T,J=I[1]-Q;return b*b+J*J<=I[3]*I[3]?_.K.CONTINUE:_.K.SKIP})}};(0,i._)([(0,C.Cb)({constructOnly:!0})],n.prototype,"featureAdapter",void 0),(0,i._)([(0,C.Cb)({constructOnly:!0})],n.prototype,"forAllFeatures",void 0),(0,i._)([(0,C.Cb)({constructOnly:!0})],n.prototype,"getFeatureExtent",void 0),(0,i._)([(0,C.Cb)({constructOnly:!0})],n.prototype,"sourceSpatialReference",void 0),(0,i._)([(0,C.Cb)({constructOnly:!0})],n.prototype,"viewSpatialReference",void 0),n=(0,i._)([(0,s.j)("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],n);const I=(0,j.c)(),S=(0,O.Ue)(),K=(0,o.Ue)()},89476:(q,L,e)=>{e.d(L,{l:()=>f});var i=e(17626),v=e(63290),A=e(77712),F=(e(90912),e(85931),e(76898)),s=e(10410),j=e(42964);const f=O=>{let o=class extends O{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=_=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&v.Z.getLogger(this.declaredClass).error("Error while evaluating definitionExpression: "+_),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&v.Z.getLogger(this.declaredClass).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const _=s.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!_.isStandardized)return v.Z.getLogger(this.declaredClass).error("definitionExpression is using non standard function"),null;const g=[];return(0,j.e8)(_.fieldNames,this.i3slayer.fields,{missingFields:g}),g.length>0?(v.Z.getLogger(this.declaredClass).error(`definitionExpression references unknown fields: ${g.join(", ")}`),null):(this._definitionExpressionErrors=0,_)}catch(_){return v.Z.getLogger(this.declaredClass).error("Failed to parse definitionExpression: "+_),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(_,g){try{return _.testFeature(g)}catch(n){return this.logError(n),!1}}_addDefinitionExpressionToQuery(_){if(!this.parsedDefinitionExpression)return _;const g=this.i3slayer.definitionExpression,n=_.clone();return n.where=n.where?`(${g}) AND (${n.where})`:g,n}};return(0,i._)([(0,A.Cb)()],o.prototype,"i3slayer",void 0),(0,i._)([(0,A.Cb)({readOnly:!0})],o.prototype,"parsedDefinitionExpression",null),(0,i._)([(0,A.Cb)({readOnly:!0})],o.prototype,"definitionExpressionFields",null),o=(0,i._)([(0,F.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],o),o}}}]);