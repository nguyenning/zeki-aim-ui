"use strict";var ae=Object.defineProperty,oe=Object.defineProperties,de=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,D=(h,o,n)=>o in h?ae(h,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[o]=n,j=(h,o)=>{for(var n in o||(o={}))ue.call(o,n)&&D(h,n,o[n]);if(N)for(var n of N(o))pe.call(o,n)&&D(h,n,o[n]);return h},V=(h,o)=>oe(h,de(o));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[8740],{78740:(h,o,n)=>{n.r(o),n.d(o,{FeatureServiceSnappingSource:()=>p});var w=n(15861),r=n(17626),T=n(14517),P=n(80542),k=n(54024),d=n(62208),v=n(32917),s=n(77712),S=(n(85931),n(8314),n(90912),n(76898)),J=n(84161),W=n(4794),F=n(41743);function m(e,t){return(0,F.g)(t.extent,E),(0,F.h)(E,(0,J.s)(A,e.x,e.y,0))}const E=(0,F.c)(),A=(0,W.c)();var $=n(93579);let u=class extends T.Z{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=(0,d.pC)(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort((i,a)=>m(t,i)-m(t,a)),e}_scaleEnabled(){return(0,$.rs)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||(0,d.Wi)(this.tileInfo))return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:i}=t,a=[];for(const{row:l,colFrom:f,colTo:C}of e)for(let y=f;y<=C;y++){const O={id:null,level:i,row:l,col:t.normalizeCol(y)};this.tileInfo.updateTileInfo(O),a.push(O)}return a}get tileInfo(){var e,t;return null!=(t=null==(e=this.view.featuresTilingScheme)?void 0:e.tileInfo)?t:null}get tileSize(){return(0,d.pC)(this.tileInfo)?this.tileInfo.size[0]:256}initialize(){this.own((0,v.YP)(()=>{var e,t;return null==(t=null==(e=this.view)?void 0:e.state)?void 0:t.viewpoint},()=>this.notifyChange("tilesCoveringView"),v.Z_))}};(0,r._)([(0,s.Cb)({readOnly:!0})],u.prototype,"tiles",null),(0,r._)([(0,s.Cb)({readOnly:!0})],u.prototype,"_scaleEnabled",null),(0,r._)([(0,s.Cb)({readOnly:!0})],u.prototype,"tilesCoveringView",null),(0,r._)([(0,s.Cb)({readOnly:!0})],u.prototype,"tileInfo",null),(0,r._)([(0,s.Cb)({readOnly:!0})],u.prototype,"tileSize",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],u.prototype,"view",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],u.prototype,"layer",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"pointOfInterest",void 0),u=(0,r._)([(0,S.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],u);var L=n(27351);let c=class extends P.r{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=this.effectivePointOfInterest;if((0,d.pC)(t)){const i=e.map(a=>m(t,a));for(let a=1;a<i.length;a++)if(i[a-1]>i[a])return e.sort((l,f)=>m(t,l)-m(t,f)),e.slice()}return e}get tilesCoveringView(){var e,t;return this._filterTiles(null==(t=null==(e=this.view.featureTiles)?void 0:e.tiles)?void 0:t.toArray()).map(Y)}get tileInfo(){var e,t;return null!=(t=null==(e=this.view.featureTiles)?void 0:e.tilingScheme.toTileInfo())?t:null}get tileSize(){var e,t;return null!=(t=null==(e=this.view.featureTiles)?void 0:e.tileSize)?t:256}get effectivePointOfInterest(){var t;const e=this.pointOfInterest;return(0,d.pC)(e)?e:null==(t=this.view.pointsOfInterest)?void 0:t.focus.location}initialize(){this.handles.add((0,v.YP)(()=>this.view.featureTiles,e=>{this.handles.remove(U),e&&this.handles.add(e.addClient(),U)},v.nn))}_filterTiles(e){return(0,d.Wi)(e)?[]:e.filter(t=>Math.abs(t.measures.screenRect[3]-t.measures.screenRect[1])>B&&t.measures.visibility===L.E.VISIBLE_ON_SURFACE)}};function Y({lij:[e,t,i],extent:a}){return{id:`${e}/${t}/${i}`,level:e,row:t,col:i,extent:a}}(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tiles",null),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tilesCoveringView",null),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tileInfo",null),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tileSize",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],c.prototype,"view",void 0),(0,r._)([(0,s.Cb)()],c.prototype,"pointOfInterest",void 0),(0,r._)([(0,s.Cb)()],c.prototype,"effectivePointOfInterest",null),c=(0,r._)([(0,S.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],c);const B=50,U="feature-tiles";var G=n(9218),Q=n(72392),X=n(37118),z=n(65401),K=n(73187);let b=class extends K.q{constructor(e){super(e),this.handles=new Q.Z}initialize(){const e=setInterval(()=>this._fetchDebugInfo(),2e3);this.handles.add((0,k.kB)(()=>clearInterval(e)))}destroy(){this.handles.destroy()}getTiles(){if(!this.debugInfo)return[];const e=new Map,t=new Map;this.debugInfo.storedTiles.forEach(l=>{e.set(l.data.id,l.featureCount)}),this.debugInfo.pendingTiles.forEach(l=>{e.set(l.data.id,l.featureCount),t.set(l.data.id,l.state)});const i=l=>{var y;const f=t.get(l),C=null!=(y=e.get(l))?y:"?";return f?`${f}:${C}\n${l}`:`store:${C}\n${l}`},a=new Map;return this.debugInfo.storedTiles.forEach(l=>{a.set(l.data.id,l.data)}),this.debugInfo.pendingTiles.forEach(l=>{a.set(l.data.id,l.data)}),Array.from(a.values()).map(l=>({lij:[l.level,l.row,l.col],geometry:X.Z.fromExtent((0,z.HH)(l.extent,this.view.spatialReference)),label:i(l.id)}))}_fetchDebugInfo(){this.handle.getDebugInfo(null).then(e=>{this.debugInfo=e,this.update()})}};(0,r._)([(0,s.Cb)({constructOnly:!0})],b.prototype,"handle",void 0),b=(0,r._)([(0,S.j)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],b);var q=n(10699),_=n(42930),ee=n(71774);let g=class extends P.r{constructor(e){super(e),this.availability=0,this.workerHandleUpdating=!0,this.editId=0}get updating(){return this.updatingHandles.updating||this.workerHandleUpdating}destroy(){this.workerHandle.destroy()}initialize(){this.workerHandle=new te(this.schedule),this.handles.add([this.workerHandle.on("notify-updating",({updating:e})=>this.workerHandleUpdating=e),this.workerHandle.on("notify-availability",({availability:e})=>this._set("availability",e))])}setup(e,t){var i=this;return(0,w.Z)(function*(){const a=i._serviceInfoFromLayer(e.layer);if((0,d.Wi)(a))return;const l={configuration:i._convertConfiguration(e.configuration),serviceInfo:a,spatialReference:e.spatialReference.toJSON()};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("setup",l,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}configure(e,t){var i=this;return(0,w.Z)(function*(){const a=i._convertConfiguration(e);yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("configure",a,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}refresh(e){var t=this;return(0,w.Z)(function*(){yield t.updatingHandles.addPromise(t.workerHandle.invokeMethod("refresh",{},e)),t.updatingHandles.addPromise(t.workerHandle.invokeMethod("whenNotUpdating",{},e))})()}fetchCandidates(e,t){var i=this;return(0,w.Z)(function*(){const a={distance:e.distance,point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),types:e.types,filter:(0,d.pC)(e.filter)?e.filter.createQuery().toJSON():null};return i.workerHandle.invoke(a,t)})()}updateTiles(e,t){var i=this;return(0,w.Z)(function*(){const a={tiles:e.tiles,tileInfo:(0,d.pC)(e.tileInfo)?e.tileInfo.toJSON():null,tileSize:e.tileSize};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("updateTiles",a,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}applyEdits(e,t){var i=this;return(0,w.Z)(function*(){var y,O,R,Z,x,M;const a=i.editId++,l={id:a};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("beginApplyEdits",l,t));const f=yield i.updatingHandles.addPromise((0,q.Hl)(e.result,t)),C={id:a,edits:{addedFeatures:null!=(O=null==(y=f.addedFeatures)?void 0:y.map(({objectId:H})=>H))?O:[],deletedFeatures:null!=(Z=null==(R=f.deletedFeatures)?void 0:R.map(({objectId:H,globalId:le})=>({objectId:H,globalId:le})))?Z:[],updatedFeatures:null!=(M=null==(x=f.updatedFeatures)?void 0:x.map(({objectId:H})=>H))?M:[]}};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("endApplyEdits",C,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}getDebugInfo(e){return this.workerHandle.invokeMethod("getDebugInfo",{},e)}_convertConfiguration(e){return{filter:(0,d.pC)(e.filter)?e.filter.toJSON():null,customParameters:e.customParameters}}_serviceInfoFromLayer(e){var t;return"multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:e.parsedUrl.path,fields:e.fields.map(i=>i.toJSON()),geometryType:ee.Mk.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:null==(t=e.timeInfo)?void 0:t.toJSON()}}};(0,r._)([(0,s.Cb)({constructOnly:!0})],g.prototype,"schedule",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],g.prototype,"updating",null),(0,r._)([(0,s.Cb)({readOnly:!0})],g.prototype,"availability",void 0),(0,r._)([(0,s.Cb)()],g.prototype,"workerHandleUpdating",void 0),g=(0,r._)([(0,S.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],g);class te extends _.q{constructor(t){super("FeatureServiceSnappingSourceWorker","fetchCandidates",{},t,{strategy:"dedicated"})}}var ie=n(49672),ne=n(72258),re=n(2584);let I=class extends T.Z{constructor(e){super(e),this.pointOfInterest=null}get tiles(){return[{id:"0/0/0",level:0,row:0,col:0,extent:(0,z.al)(-1e8,-1e8,1e8,1e8)}]}get tileInfo(){return new re.Z({origin:new ie.Z({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new ne.Z({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}};(0,r._)([(0,s.Cb)({readOnly:!0})],I.prototype,"tiles",null),(0,r._)([(0,s.Cb)({readOnly:!0})],I.prototype,"tileInfo",null),(0,r._)([(0,s.Cb)({readOnly:!0})],I.prototype,"tileSize",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],I.prototype,"layer",void 0),(0,r._)([(0,s.Cb)()],I.prototype,"pointOfInterest",void 0),I=(0,r._)([(0,S.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],I);var se=n(66463);let p=class extends((0,P.p)(T.Z)){constructor(e){super(e)}get updateTilesParameters(){return{tiles:this.tilesOfInterest.tiles,tileInfo:this.tilesOfInterest.tileInfo,tileSize:this.tilesOfInterest.tileSize}}get updating(){return this.workerHandle.updating||this.updatingHandles.updating}get configuration(){return{filter:this.layer.createQuery(),customParameters:this.layer.customParameters}}get availability(){return this.workerHandle.availability}get layer(){return this.layerSource.layer}initialize(){const e=this.view;if((0,d.pC)(e))switch(e.type){case"2d":this.tilesOfInterest=new u({view:e,layer:this.layer}),this.workerHandle=new g;break;case"3d":{const t=e.resourceController;this.tilesOfInterest=new c({view:e}),this.workerHandle=new g({schedule:i=>t.schedule(i)});break}}else this.tilesOfInterest=new I({layer:this.layer}),this.workerHandle=new g;this.handles.add([(0,k.ed)(this.workerHandle)]),this.workerHandle.setup({layer:this.layer,spatialReference:this.spatialReference,configuration:this.configuration},null),this.updatingHandles.add(()=>this.updateTilesParameters,()=>this.workerHandle.updateTiles(this.updateTilesParameters,null),v.nn),this.handles.add([(0,v.YP)(()=>this.configuration,t=>this.workerHandle.configure(t,null),v.Z_)]),(0,d.pC)(e)&&this.handles.add((0,v.YP)(()=>se.Z.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES,t=>{t&&!this.debug?(this.debug=new b({view:e,handle:this.workerHandle}),this.handles.add((0,k.ed)(this.debug),"debug")):!t&&this.debug&&this.handles.remove("debug")},v.nn)),this.handles.add(this.layerSource.layer.on("apply-edits",t=>{this.workerHandle.applyEdits(t,null)}))}refresh(){this.workerHandle.refresh(null)}fetchCandidates(e,t){var i=this;return(0,w.Z)(function*(){return i.tilesOfInterest.pointOfInterest=e.coordinateHelper.vectorToPoint(e.point),(yield i.workerHandle.fetchCandidates(V(j({},e),{filter:null}),t)).candidates.map(a=>(0,G.X)(a,e.coordinateHelper,e.elevationInfo))})()}getDebugInfo(e){return this.workerHandle.getDebugInfo(e)}};(0,r._)([(0,s.Cb)({constructOnly:!0})],p.prototype,"spatialReference",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],p.prototype,"layerSource",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],p.prototype,"view",void 0),(0,r._)([(0,s.Cb)()],p.prototype,"tilesOfInterest",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"updateTilesParameters",null),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"updating",null),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"configuration",null),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"availability",null),p=(0,r._)([(0,S.j)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],p)}}]);