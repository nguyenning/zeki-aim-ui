"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[4366],{4366:(L,D,e)=>{e.r(D),e.d(D,{default:()=>U});var v=e(15861),l=e(17626),d=e(62208),T=e(10699),x=e(32917),m=(e(63290),e(90912),e(85931),e(8314),e(82255),e(76898)),R=e(69759),h=e(26584),y=e(77712),w=e(49672),n=e(13812),C=e(84952),f=e(10023);const O=a=>{let t=class extends a{constructor(){super(...arguments),this.view=null}fetchPopupFeatures(i,r){var o=this;return(0,v.Z)(function*(){const{layer:g}=o;if(!i)throw new h.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:g});const{popupEnabled:p}=g,c=(0,f.V)(g,r);if(!p||(0,d.Wi)(c))throw new h.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:p,popupTemplate:c});const V=yield c.getRequiredFields(),E=new C.Z;E.timeExtent=o.timeExtent,E.geometry=i,E.outFields=V,E.outSpatialReference=i.spatialReference;const I=o.view.resolution,b="2d"===o.view.type?new w.Z(I,I,o.view.spatialReference):new w.Z(.5*I,.5*I,o.view.spatialReference),{returnTopmostRaster:H,showNoDataRecords:W}=c.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},j={returnDomainValues:!0,returnTopmostRaster:H,pixelSize:b,showNoDataRecords:W,signal:(0,d.pC)(r)?r.signal:null};return g.queryVisibleRasters(E,j).then(z=>z)})()}canResume(){var i;return!(!super.canResume()||null!=(i=this.timeExtent)&&i.isEmpty)}};return(0,l._)([(0,y.Cb)()],t.prototype,"layer",void 0),(0,l._)([(0,y.Cb)()],t.prototype,"suspended",void 0),(0,l._)([(0,y.Cb)(n.qG)],t.prototype,"timeExtent",void 0),(0,l._)([(0,y.Cb)()],t.prototype,"view",void 0),t=(0,l._)([(0,m.j)("esri.views.layers.ImageryLayerView")],t),t};let F=class extends(O(R.Z)){constructor(){var a;super(...arguments),a=this,this.type="imagery-3d",this.redrawDebounced=(0,T.Ds)(function(){var t=(0,v.Z)(function*(i){a.redraw((r,o)=>a._redrawImage(r,o),i)});return function(i){return t.apply(this,arguments)}}(),2e3)}initialize(){this.handles.add([(0,x.gx)(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this.updatingHandles.addPromise(this.redrawDebounced()))]),this.updatingHandles.add(()=>{var a,t;return null==(t=null==(a=this.layer)?void 0:a.exportImageServiceParameters)?void 0:t.version},()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(()=>this.timeExtent,()=>this.updatingHandles.addPromise(this.refreshDebounced()))}_initializeMaximumDataResolution(){const t=this.layer.fullExtent;!t||this.view.basemapTerrain.spatialReference.equals(t.spatialReference),this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY}}getFetchOptions(){return{timeExtent:this.timeExtent}}processResult(a,t,i){var r=this;return(0,v.Z)(function*(){t.imageElement?a.image=t.imageElement:(a.image=document.createElement("canvas"),a.pixelData=t.pixelData,yield r._redrawImage(a,i))})()}_redrawImage(a,t){var i=this;return(0,v.Z)(function*(){if(!(a.image instanceof HTMLCanvasElement)||(0,d.Wi)(a.pixelData))throw new Error;const r=a.image,o=r.getContext("2d"),g=yield i.layer.applyRenderer(a.pixelData,{signal:t}),p=i.layer.applyFilter(g).pixelBlock;if((0,d.Wi)(p))throw new Error;r.width=p.width,r.height=p.height;const c=o.createImageData(p.width,p.height);c.data.set(p.getAsRGBA()),o.putImageData(c,0,0)})()}};F=(0,l._)([(0,m.j)("esri.views.3d.layers.ImageryLayerView3D")],F);const U=F},10023:(L,D,e)=>{e.d(D,{V:()=>Z,e:()=>T});var v=e(15861),l=e(62208),d=e(36630);function T(s){return x.apply(this,arguments)}function x(){return(x=(0,v.Z)(function*(s,u=s.popupTemplate){if((0,l.Wi)(u))return[];const P=yield u.getRequiredFields(s.fieldsIndex),{lastEditInfoEnabled:M}=u,{objectIdField:m,typeIdField:R,globalIdField:h,relationships:y}=s;if(P.includes("*"))return["*"];const w=M?yield(0,d.CH)(s):[],n=(0,d.Q0)(s.fieldsIndex,[...P,...w]);return R&&n.push(R),n&&m&&s.fieldsIndex.has(m)&&!n.includes(m)&&n.push(m),n&&h&&s.fieldsIndex.has(h)&&!n.includes(h)&&n.push(h),y&&y.forEach(C=>{const{keyField:f}=C;n&&f&&s.fieldsIndex.has(f)&&!n.includes(f)&&n.push(f)}),n})).apply(this,arguments)}function Z(s,u){return s.popupTemplate?s.popupTemplate:(0,l.pC)(u)&&u.defaultPopupTemplateEnabled&&(0,l.pC)(s.defaultPopupTemplate)?s.defaultPopupTemplate:null}}}]);