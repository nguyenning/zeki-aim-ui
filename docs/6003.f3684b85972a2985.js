"use strict";var or=Object.defineProperty,lr=Object.defineProperties,cr=Object.getOwnPropertyDescriptors,ct=Object.getOwnPropertySymbols,ur=Object.prototype.hasOwnProperty,fr=Object.prototype.propertyIsEnumerable,ut=(le,X,C)=>X in le?or(le,X,{enumerable:!0,configurable:!0,writable:!0,value:C}):le[X]=C,A=(le,X)=>{for(var C in X||(X={}))ur.call(X,C)&&ut(le,C,X[C]);if(ct)for(var C of ct(X))fr.call(X,C)&&ut(le,C,X[C]);return le},q=(le,X)=>lr(le,cr(X));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[6003],{36003:(le,X,C)=>{C.r(X),C.d(X,{default:()=>sr});var E=C(15861),P=C(17626),ft=C(73281),ke=C(90885),j=C(26584),M=C(62208),dt=C(99959),Se=C(10699),mt=C(32917),k=C(77712),ht=(C(85931),C(8314)),pt=C(90912),yt=C(55342),gt=C(68653),ue=C(76898),xt=C(44917),It=C(552),vt=C(50107),Ve=(C(29132),C(84792)),Ye=C(63290),De=C(83960),bt=C(37053),Xe=C(38305),Je=C(13812),St=C(25982),Ct=C(9548),xe=C(2584),me=C(79781),je=C(30994),Ce=C(8341),Rt=C(54805),Tt=C(37084),ee=C(2004),ne=C(65234);const Ke=Ye.Z.getLogger("esri.layers.mixins.ImageryTileMixin"),wt=i=>{let t=class extends i{constructor(){super(...arguments),this._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},this.bandIds=null,this.copyright=null,this.fullExtent=null,this.interpolation="nearest",this.multidimensionalDefinition=null,this.raster=null,this.rasterInfo=null,this.sourceJSON=null,this.spatialReference=null,this.tileInfo=null,this.symbolizer=null}set url(s){this._set("url",(0,Xe.Nm)(s,Ke))}set renderer(s){this._set("renderer",s),this.updateRenderer()}convertVectorFieldData(s,a){var c=this;return(0,E.Z)(function*(){if((0,M.Wi)(s))return null;const u=c._rasterJobHandler.instance,f=c.rasterInfo.dataType;return u?u.convertVectorFieldData({pixelBlock:s,dataType:f},a):(0,je.KC)(s,f)})()}createFlowMesh(s,a){var c=this;return(0,E.Z)(function*(){const u=c._rasterJobHandler.instance;return u?u.createFlowMesh(s,a):(0,Tt.GE)(s.meshType,s.simulationSettings,s.flowData,(0,M.pC)(a.signal)?a.signal:(new AbortController).signal)})()}normalizeRasterFetchOptions(s){var f,h;const{multidimensionalInfo:a}=this.rasterInfo;if((0,M.Wi)(a))return s;let c=s.multidimensionalDefinition||this.multidimensionalDefinition;!(0,M.Wi)(c)&&c.length||(c=(0,me.Tj)(this.raster.rasterInfo));const u=s.timeExtent||this.timeExtent;if((0,M.pC)(c)&&(0,M.pC)(u)&&((0,M.pC)(u.start)||(0,M.pC)(u.end))){c=c.map(b=>b.clone());const d=null==(h=null==(f=a.variables.find(({name:b})=>b===c[0].variableName))?void 0:f.dimensions)?void 0:h.find(({name:b})=>"StdTime"===b),m=c.find(({dimensionName:b})=>"StdTime"===b);if(!d||!m)return q(A({},s),{multidimensionalDefinition:null});const{start:p,end:x}=u,g=(0,M.Wi)(p)?null:p.getTime(),y=(0,M.Wi)(x)?null:x.getTime(),v=null!=g?g:y,S=null!=y?y:g;if((0,M.pC)(d.values)){const b=d.values.filter(I=>{if(Array.isArray(I)){if(v===S)return I[0]<=v&&I[1]>=v;const w=I[0]>=v&&I[1]<=S||I[0]<v&&I[1]>S;return I[0]<=v&&I[1]>v||I[0]<S&&I[1]>=S||w}return v===S?I===v:I>=v&&I<=S});if(b.length){const I=b.sort((R,w)=>{var Z,O,z,F;return v===S?(null!=(Z=R[0])?Z:R)-(null!=(O=w[0])?O:w):Math.abs((null!=(z=R[1])?z:R)-S)-Math.abs((null!=(F=w[1])?F:w)-S)})[0];m.values=[I]}else c=null}else if(d.hasRegularIntervals&&d.extent){const[b,I]=d.extent;v>I||S<b?c=null:m.values=v===S?[v]:[Math.max(b,v),Math.min(I,S)]}}return q(A({},s),{multidimensionalDefinition:c})}updateRenderer(){var s=this;return(0,E.Z)(function*(){if(!s.loaded||JSON.stringify(s._cachedRendererJson)===JSON.stringify(s.renderer))return;const a=s._rasterJobHandler.instance;a&&(s.symbolizer.rendererJSON=(0,Ce.ol)(s.renderer.toJSON()),s.symbolizer.bind(),yield a.updateSymbolizer(s.symbolizer),s._cachedRendererJson=s.renderer.toJSON())})()}applyRenderer(s,a){var c=this;return(0,E.Z)(function*(){const u=s&&s.pixelBlock;if(!((0,M.pC)(u)&&u.pixels&&u.pixels.length>0))return null;let f;yield c.updateRenderer();const h=c._rasterJobHandler.instance,{bandIds:d}=c;return f=h?yield h.symbolize(q(A({},s),{simpleStretchParams:a,bandIds:d})):c.symbolizer.symbolize(q(A({},s),{simpleStretchParams:a,bandIds:d})),f})()}getTileUrl(s,a,c){return"RasterTileServer"===this.raster.datasetFormat?`${this.url}/tile/${s}/${a}/${c}`:""}getCompatibleTileInfo(s,a,c=!1){if(!this.loaded||(0,M.Wi)(a))return null;if(c&&s.equals(this.spatialReference))return this.tileInfo;const u=(0,bt.C5)(s);return xe.Z.create({size:256,spatialReference:s,origin:u?{x:u.origin[0],y:u.origin[1]}:{x:a.xmin,y:a.ymax}})}getCompatibleFullExtent(s){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(s)||(this._compatibleFullExtent=this.raster.computeExtent(s)),this._compatibleFullExtent):null}fetchTile(s,a,c,u={}){var f=this;return(0,E.Z)(function*(){if(u.requestAsImageElement){const h=f.getTileUrl(s,a,c);return(0,Ve.default)(h,{responseType:"image",query:A(A({},f.refreshParameters),f.raster.ioConfig.customFetchParameters),signal:u.signal}).then(d=>d.data)}return(0,M.pC)(f.rasterInfo.multidimensionalInfo)&&(u=f.normalizeRasterFetchOptions(u),(0,M.Wi)(u.multidimensionalDefinition))?{extent:f.raster.getTileExtentFromTileInfo(s,a,c,u.tileInfo||f.rasterInfo.storageInfo.tileInfo),pixelBlock:null}:(yield f._initJobHandler(),"raster-shaded-relief"===f.renderer.type&&(u=q(A({},u),{buffer:{cols:1,rows:1}})),f.raster.fetchTile(s,a,c,u))})()}fetchPixels(s,a,c,u={}){var f=this;return(0,E.Z)(function*(){return(0,M.pC)(f.rasterInfo.multidimensionalInfo)&&(u=f.normalizeRasterFetchOptions(u),(0,M.Wi)(u.multidimensionalDefinition))?{extent:s,pixelBlock:null}:(yield f._initJobHandler(),f.raster.fetchPixels(s,a,c,u))})()}identify(s,a={}){var c=this;return(0,E.Z)(function*(){return!(0,M.pC)(c.rasterInfo.multidimensionalInfo)||c.rasterInfo.hasMultidimensionalTranspose&&((0,me.WU)(a.multidimensionalDefinition)||a.transposedVariableName||a.timeExtent)||(a=c.normalizeRasterFetchOptions(a),!(0,M.Wi)(a.multidimensionalDefinition))?c.raster.identify(s,a):{location:s,value:null}})()}increaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount++}decreaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}hasStandardTime(){var c;const s=this.rasterInfo.multidimensionalInfo;if((0,M.Wi)(s)||"standard-time"!==this.rasterInfo.dataType)return!1;const a=null==(c=this.multidimensionalDefinition[0])?void 0:c.variableName;return s.variables.some(u=>u.name===a&&u.dimensions.some(f=>"StdTime"===f.name))}getStandardTimeValue(s){return new Date(24*(s-25569)*3600*1e3).toString()}_configDefaultSettings(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=(0,me.Tj)(this.raster.rasterInfo)),this._configDefaultRenderer()}_initJobHandler(){if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;const s=new Ct.Z;return this._rasterJobHandler.connectionPromise=s.initialize().then(()=>{this._rasterJobHandler.instance=s,this.raster.rasterJobHandler=s,this.renderer&&this.updateRenderer()}).catch(()=>null),this._rasterJobHandler.connectionPromise}_shutdownJobHandler(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null,this._cachedRendererJson=null}_configDefaultInterpolation(){var s;if(null==this.interpolation){const a=(0,Ce.In)(this.rasterInfo,this.raster.tileType,null==(s=this.sourceJSON)?void 0:s.defaultResamplingMethod);this._set("interpolation",a)}}_configDefaultRenderer(){var c,u,f;const s=this.raster.rasterInfo;if(this.bandIds||(this.bandIds=(0,Ce.YD)(s)),!this.renderer){const h=(0,Ce.Ob)(s,{bandIds:this.bandIds,variableName:(0,M.pC)(this.multidimensionalDefinition)?null==(c=this.multidimensionalDefinition[0])?void 0:c.variableName:null});"WCSServer"===this.raster.datasetFormat&&"raster-stretch"===h.type&&((null==(u=s.statistics)?void 0:u[0].max)>1e24||(null==(f=s.statistics)?void 0:f[0].min)<-1e24)&&(h.dynamicRangeAdjustment=!0,h.statistics=null,"none"===h.stretchType&&(h.stretchType="min-max")),this.renderer=h}this.symbolizer?(this.symbolizer.rendererJSON=(0,Ce.ol)(this.renderer.toJSON()),this.symbolizer.rasterInfo=s):this.symbolizer=new Rt.Z({rendererJSON:this.renderer.toJSON(),rasterInfo:s});const a=this.symbolizer.bind();a.success||Ke.warn("imagery-tile-mixin",a.error||"The given renderer is not supported by the layer.")}};return(0,P._)([(0,k.Cb)()],t.prototype,"_cachedRendererJson",void 0),(0,P._)([(0,k.Cb)()],t.prototype,"_compatibleFullExtent",void 0),(0,P._)([(0,k.Cb)()],t.prototype,"_rasterJobHandler",void 0),(0,P._)([(0,k.Cb)()],t.prototype,"bandIds",void 0),(0,P._)([(0,k.Cb)({json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),(0,P._)([(0,k.Cb)({type:ee.Z,json:{read:!1}}),(0,De.B)("rasterInfo.extent")],t.prototype,"fullExtent",void 0),(0,P._)([(0,k.Cb)()],t.prototype,"interpolation",void 0),(0,P._)([(0,k.Cb)()],t.prototype,"ioConfig",void 0),(0,P._)([(0,k.Cb)({type:[St.Z]})],t.prototype,"multidimensionalDefinition",void 0),(0,P._)([(0,k.Cb)()],t.prototype,"raster",void 0),(0,P._)([(0,k.Cb)({readOnly:!0}),(0,De.B)("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),(0,P._)([(0,k.Cb)()],t.prototype,"sourceJSON",void 0),(0,P._)([(0,k.Cb)({type:ne.Z,json:{read:!1}}),(0,De.B)("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),(0,P._)([(0,k.Cb)({type:xe.Z,json:{read:!1}}),(0,De.B)("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),(0,P._)([(0,k.Cb)(Je.HQ)],t.prototype,"url",null),(0,P._)([(0,k.Cb)({types:ke.dr})],t.prototype,"renderer",null),(0,P._)([(0,k.Cb)()],t.prototype,"symbolizer",void 0),t=(0,P._)([(0,ue.j)("esri.layers.ImageryTileMixin")],t),t};var Pt=C(49286),Mt=C(6647),Ft=C(30346),Bt=C(99555),kt=C(97941),Re=C(36255),Dt=C(2939),Te=C(79645),we=C(27497),Ot=C(86810),Zt=C(60330),U=C(28594),te=C(49672);const _=new Map,fe=new class zt{constructor(t=15e3,s=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,s)}decreaseRefCount(t,s){const a=t+"/"+s,c=this._cachedBlocks;if(c.has(a)){const u=c.get(a);return u.refCount--,u.refCount<=0&&(c.delete(a),u.controller&&u.controller.abort()),u.refCount}return 0}getBlock(t,s){const a=t+"/"+s,c=this._cachedBlocks;if(c.has(a)){const u=c.get(a);return u.ts=Date.now(),u.refCount++,c.delete(a),c.set(a,u),u.block}return null}putBlock(t,s,a,c=null){const u=this._cachedBlocks,f=t+"/"+s;if(u.has(f)){const h=u.get(f);h.ts=Date.now(),h.refCount++}else u.set(f,{block:a,ts:Date.now(),refCount:1,controller:c});this._trim(),this._updateTimer()}deleteBlock(t,s){const a=this._cachedBlocks,c=t+"/"+s;a.has(c)&&a.delete(c)}updateMaxSize(t){this._size=t,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const t=this._cachedBlocks;this._timer=setInterval(()=>{const s=Array.from(t),a=Date.now();for(let c=0;c<s.length&&s[c][1].ts<=a-this._duration;c++)t.delete(s[c][0]);0===t.size&&this._clearTimer()},this._interval)}_trim(){const t=this._cachedBlocks;if(-1===this._size||this._size>=t.size)return;const s=Array.from(t);for(let a=0;a<s.length-this._size;a++)t.delete(s[a][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function Qe(i,t){return null==t?i:`${i}?sliceId=${t}`}function qe(i,t,s){if(!_.has(i))return null==t?fe.getBlock(i,s):null;const a=_.get(i);if(null==a[t]){for(let u=0;u<a.length;u++)if(a[u]&&a[u].cache.has(s)){const f=a[u].cache.get(s);return f.refCount++,f.block}return fe.getBlock(i,s)}const c=a[t].cache;if(c.has(s)){const u=c.get(s);return u.refCount++,u.block}for(let u=0;u<a.length;u++)if(u!==t&&a[u]&&a[u]&&a[u].cache.has(s)){const f=a[u].cache.get(s);return f.refCount++,c.set(s,f),f.block}return null}function et(i,t,s,a,c=null){if(!_.has(i))return void(null==t&&fe.putBlock(i,s,a,c));const u=_.get(i);if(null==u[t])return void fe.putBlock(i,s,a,c);const f={refCount:1,block:a,isResolved:!1,isRejected:!1,controller:c};a.then(()=>f.isResolved=!0).catch(()=>f.isRejected=!0),u[t].cache.set(s,f)}var tt=C(8614),he=C(79751);let se=class extends((0,Zt.v)(Ot.wq)){constructor(){super(...arguments),this.rasterJobHandler=null,this.datasetName=null,this.datasetFormat=null,this.rasterInfo=null,this.ioConfig={sampling:"closest"}}init(){var i=this;return(0,E.Z)(function*(){const t=(0,U.zD)();i.addResolvingPromise(t),yield i.when()})()}normalizeCtorArgs(i){return i&&i.ioConfig&&(i=q(A({},i),{ioConfig:A({resolution:null,bandIds:null,sampling:"closest",tileInfo:xe.Z.create()},i.ioConfig)})),i}get _isGlobalWrappableSource(){const{rasterInfo:i}=this,t=(0,U.ut)(i.spatialReference);return(0,M.pC)(t)&&i.extent.width>=t/2}set url(i){this._set("url",(0,Xe.Nm)(i,Ye.Z.getLogger(this.declaredClass)))}open(i){return(0,E.Z)(function*(){throw new j.Z("BaseRaster:open-not-implemented","open() is not implemented")})()}fetchTile(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){const u=a.tileInfo||c.rasterInfo.storageInfo.tileInfo,f=c.getTileExtentFromTileInfo(i,t,s,u);return c.fetchPixels(f,u.size[0],u.size[1],a)})()}identify(i,t={}){var s=this;return(0,E.Z)(function*(){var H;const{multidimensionalDefinition:a,timeExtent:c}=t,{hasMultidimensionalTranspose:u,multidimensionalInfo:f}=s.rasterInfo;let{transposedVariableName:h}=t;const d=(0,M.pC)(f)&&u&&(null!=c||(0,me.WU)(a));d&&!h&&(h=(0,M.pC)(a)&&a.length>0?a[0].variableName:f.variables[0].name,t=q(A({},t),{transposedVariableName:h})),t=s._getRequestOptionsWithSliceId(t);const{spatialReference:m,extent:p}=s.rasterInfo,{datumTransformation:x}=t;let g=(0,U.nF)(i,m,x);if(!p.intersects(g))return{location:g,value:null};if((0,M.pC)(s.rasterInfo.transform)){const L=s.rasterInfo.transform.inverseTransform(g);if(!s.rasterInfo.nativeExtent.intersects(L))return{location:L,value:null};g=L}let y=0;const v=h&&(0,M.pC)(f)&&s.rasterInfo.hasMultidimensionalTranspose;if(!v)if(t.srcResolution)y=(0,U.kr)(t.srcResolution,s.rasterInfo,s.ioConfig.sampling).pyramidLevel;else if(y=yield s.computeBestPyramidLevelForLocation(i,t),null==y)return{location:g,value:null};const S=s.identifyPixelLocation(g,y,null,v);if(null===S)return{location:g,value:null};const{row:b,col:I,rowOffset:R,colOffset:w,blockWidth:Z}=S,O=null!=h?h:(0,M.Wg)(t.sliceId),z=Qe(s.url,O),F=`${y}/${b}/${I}`;let T=qe(z,null,F);(0,M.Wi)(T)&&(T=s.fetchRawTile(y,b,I,t),et(z,null,F,T));const D=yield T;return(0,M.Wi)(D)||null==(H=D.pixels)||!H.length?{location:g,value:null}:s._processIdentifyResult(D,{srcLocation:g,position:R*Z+w,pyramidLevel:y,useTransposedTile:v,requestSomeSlices:d,identifyOptions:t})})()}fetchPixels(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){if(i=(0,U.kZ)(i),(a=c._getRequestOptionsWithSliceId(a)).requestRawData)return c._fetchPixels(i,t,s,a);const u=(0,U.ut)(i.spatialReference),f=(0,U.Hq)(i);if((0,M.Wi)(u)||0===f||1===f&&c._isGlobalWrappableSource)return c._fetchPixels(i,t,s,a);if(f>=3)return{extent:i,pixelBlock:null};const h=[],{xmin:d,xmax:m}=i,p=Math.round(u/(m-d)*t),x=p-Math.round((u/2-d)/(m-d)*t);let g=0;const y=[];for(let I=0;I<=f;I++){const R=new ee.Z({xmin:0===I?d:-u/2,xmax:I===f?m-u*I:u/2,ymin:i.ymin,ymax:i.ymax,spatialReference:i.spatialReference}),w=0===I?p-x:I===f?t-g:p;g+=w,y.push(w);const Z=a.disableWrapAround&&I>0?null:c._fetchPixels(R,w,s,a);h.push(Z)}const v=(yield Promise.all(h)).map(I=>null==I?void 0:I.pixelBlock);let S=null;const b={width:t,height:s};return S=c.rasterJobHandler?(yield c.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:v,srcMosaicSize:b,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:y},a)).pixelBlock:(0,he.us)(v,b,{blockWidths:y}),{extent:i,srcExtent:(0,U.tB)(i,c.rasterInfo.spatialReference,a.datumTransformation),pixelBlock:S}})()}fetchRawPixels(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){t={x:Math.floor(t.x),y:Math.floor(t.y)};const u=yield c._fetchRawTiles(i,t,s,a),{nativeExtent:f,nativePixelSize:h,storageInfo:d}=c.rasterInfo,m=2**i,p=h.x*m,x=h.y*m,g=new ee.Z({xmin:f.xmin+p*t.x,xmax:f.xmin+p*(t.x+s.width-1),ymin:f.ymax-x*(t.y+s.height-1),ymax:f.ymax-x*t.y,spatialReference:f.spatialReference});if(!u)return{extent:g,srcExtent:g,pixelBlock:null};const{pixelBlocks:y,mosaicSize:v}=u;if(1===y.length&&(0,M.pC)(y[0])&&y[0].width===s.width&&y[0].height===s.height)return{extent:g,srcExtent:g,pixelBlock:u.pixelBlocks[0]};const I={x:t.x%(i>0?d.pyramidBlockWidth:d.blockWidth),y:t.y%(i>0?d.pyramidBlockHeight:d.blockHeight)};let R;return R=c.rasterJobHandler?(yield c.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:y,srcMosaicSize:v,destDimension:s,clipOffset:I,clipSize:s,coefs:null,sampleSpacing:null,interpolation:a.interpolation,alignmentInfo:null,blockWidths:null},a)).pixelBlock:(0,he.us)(y,v,{clipOffset:I,clipSize:s}),{extent:g,srcExtent:g,pixelBlock:R}})()}fetchRawTile(i,t,s,a){throw new j.Z("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}computeExtent(i){return(0,U.tB)(this.rasterInfo.extent,i)}decodePixelBlock(i,t){return!this.rasterJobHandler||t.useCanvas?(0,tt.J)(i,t):this.rasterJobHandler.decode({data:i,options:t})}request(i,t,s){var a=this;return(0,E.Z)(function*(){var m;const{customFetchParameters:c}=a.ioConfig,{range:u,query:f,headers:h}=t;s=null!=(m=null!=s?s:t.retryCount)?m:a.ioConfig.retryCount;const d=u?{Range:`bytes=${u.from}-${u.to}`}:null;try{return yield(0,Ve.default)(i,q(A({},t),{query:A(A({},f),c),headers:A(A({},h),d)}))}catch(p){if(s>0)return s--,a.request(i,t,s);throw p}})()}getSliceIndex(i){const{multidimensionalInfo:t}=this.rasterInfo;return(0,M.Wi)(t)||(0,M.Wi)(i)||0===i.length?null:(0,me.gk)(i,t)}getTileExtentFromTileInfo(i,t,s,a){const c=a.lodAt(i);return this.getTileExtent({x:c.resolution,y:c.resolution},t,s,a.origin,a.spatialReference,a.size)}updateTileInfo(){const{storageInfo:i,spatialReference:t,extent:s,pixelSize:a}=this.rasterInfo;if(!i.tileInfo){const c=[],u=i.maximumPyramidLevel||0;let f=Math.max(a.x,a.y),h=1/.0254*96*f;for(let m=0;m<=u;m++)c.push({level:u-m,resolution:f,scale:h}),f*=2,h*=2;const d=new te.Z({x:s.xmin,y:s.ymax,spatialReference:t});i.tileInfo=new xe.Z({origin:d,size:[i.blockWidth,i.blockHeight],spatialReference:t,lods:c}),i.isVirtualTileInfo=!0}}createRemoteDatasetStorageInfo(i,t=512,s=512,a){const{width:c,height:u,nativeExtent:f,pixelSize:h,spatialReference:d}=i,m=new te.Z({x:f.xmin,y:f.ymax,spatialReference:d});null==a&&(a=Math.max(0,Math.round(Math.log(Math.max(c,u))/Math.LN2-8)));const p=this.computeBlockBoundary(f,512,512,{x:f.xmin,y:f.ymax},[h],a);i.storageInfo=new we.Z({blockWidth:t,blockHeight:s,pyramidBlockWidth:t,pyramidBlockHeight:s,origin:m,firstPyramidLevel:1,maximumPyramidLevel:a,blockBoundary:p})}computeBestPyramidLevelForLocation(i,t={}){return(0,E.Z)(function*(){return 0})()}computeBlockBoundary(i,t,s,a,c,u=0,f=2){if(1===c.length&&u>0){c=[...c];let{x:p,y:x}=c[0];for(let g=0;g<u;g++)p*=f,x*=f,c.push({x:p,y:x})}const h=[],{x:d,y:m}=a;for(let p=0;p<c.length;p++){const{x,y:g}=c[p];h.push({minCol:Math.floor((i.xmin-d+.1*x)/t/x),maxCol:Math.floor((i.xmax-d-.1*x)/t/x),minRow:Math.floor((m-i.ymax+.1*g)/s/g),maxRow:Math.floor((m-i.ymin-.1*g)/s/g)})}return h}getPyramidPixelSize(i){const{nativePixelSize:t}=this.rasterInfo,{pyramidResolutions:s,pyramidScalingFactor:a}=this.rasterInfo.storageInfo;if(0===i)return t;if((0,M.pC)(s)&&s.length)return s[i-1];const c=a**i;return{x:t.x*c,y:t.y*c}}identifyPixelLocation(i,t,s,a){const{spatialReference:c,nativeExtent:u,storageInfo:f}=this.rasterInfo,{maximumPyramidLevel:h,origin:d,transposeInfo:m}=f,p=a&&(0,M.pC)(m)?m.tileSize[0]:f.blockWidth,x=a&&(0,M.pC)(m)?m.tileSize[1]:f.blockHeight,g=(0,U.nF)(i,c,s);if(!u.intersects(g)||t<0||t>h)return null;const y=this.getPyramidPixelSize(t),{x:v,y:S}=y,b=(d.y-g.y)/S/x,I=(g.x-d.x)/v/p,R=Math.min(x-1,Math.floor((b-Math.floor(b))*x)),w=Math.min(p-1,Math.floor((I-Math.floor(I))*p));return{pyramidLevel:t,row:Math.floor(b),col:Math.floor(I),rowOffset:R,colOffset:w,blockWidth:p,srcLocation:g}}getTileExtent(i,t,s,a,c,u){const[f,h]=u,d=a.x+s*f*i.x,p=a.y-t*h*i.y;return new ee.Z({xmin:d,xmax:d+f*i.x,ymin:p-h*i.y,ymax:p,spatialReference:c})}getBlockWidthHeight(i){return{blockWidth:i>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:i>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}isBlockOutside(i,t,s){const a=this.rasterInfo.storageInfo.blockBoundary[i];return!a||a.maxRow<t||a.maxCol<s||a.minRow>t||a.minCol>s}_fetchPixels(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){let u=(0,U.Hq)(i);if(u>=2)return{extent:i,pixelBlock:null};const f=c._getSourceDataInfo(i,t,s,a),{pyramidLevel:h,pyramidResolution:d,srcResolution:m,srcExtent:p,srcWidth:x,srcHeight:g}=f;if(0===x||0===g)return{extent:i,srcExtent:p,pixelBlock:null};const y=(0,M.Wg)(c.rasterInfo.transform),v="gcs-shift"===(null==y?void 0:y.type),S=(0,M.pC)((0,U.ut)(i.spatialReference));!v&&S||(u=(0,U.Hq)(f.srcExtent,v));const b=c.rasterInfo.storageInfo,I={x:Math.floor((p.xmin-b.origin.x)/d.x+.1),y:Math.floor((b.origin.y-p.ymax)/d.y+.1)},R=yield c._fetchRawTiles(h,I,{width:x,height:g,wrapCount:u},a);if(!R)return{extent:i,srcExtent:p,pixelBlock:null};const w=h>0?b.pyramidBlockWidth:b.blockWidth,Z=h>0?b.pyramidBlockHeight:b.blockHeight,O=w===x&&Z===g&&I.x%w==0&&I.y%Z==0,z=new te.Z({x:(i.xmax-i.xmin)/t,y:(i.ymax-i.ymin)/s,spatialReference:i.spatialReference}),F=!i.spatialReference.equals(c.rasterInfo.spatialReference),{datumTransformation:T}=a;if(!F&&O&&1===R.pixelBlocks.length&&w===t&&Z===s&&m.x===z.x&&m.y===z.y)return{extent:i,srcExtent:p,pixelBlock:R.pixelBlocks[0]};const D=S&&(0,M.pC)((0,U.ut)(p.spatialReference)),B=a.requestProjectedLocalDirections&&c.rasterInfo.dataType.startsWith("vector");B&&!c.rasterJobHandler&&(yield(0,U.zD)());const H=c.rasterJobHandler?yield c.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:i,srcBufferExtent:R.extent,pixelSize:z.toJSON(),datumTransformation:T,rasterTransform:y,hasWrapAround:u>0||D,isAdaptive:!1!==c.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:B},a):(0,U.Qp)({projectedExtent:i,srcBufferExtent:R.extent,pixelSize:z,datumTransformation:T,rasterTransform:y,hasWrapAround:u>0||D,isAdaptive:!1,includeGCSGrid:B});let L;const G=!a.requestRawData,re={rows:H.spacing[0],cols:H.spacing[1]},N=(0,M.Wg)(c._getRasterTileAlignmentInfo(h,R.extent.xmin)),{pixelBlocks:$,mosaicSize:Y,isPartiallyFilled:Q}=R;let V=null;if(c.rasterJobHandler)({pixelBlock:L,localNorthDirections:V}=yield c.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:$,srcMosaicSize:Y,destDimension:G?{width:t,height:s}:null,coefs:G?H.coefficients:null,sampleSpacing:G?re:null,projectDirections:B,gcsGrid:B?H.gcsGrid:null,isUV:"vector-uv"===c.rasterInfo.dataType,interpolation:a.interpolation,alignmentInfo:N,blockWidths:null},a));else{const W=(0,he.us)($,Y,{alignmentInfo:N});L=G?(0,he.Uk)(W,{width:t,height:s},H.coefficients,re,a.interpolation):W,B&&H.gcsGrid&&(V=(0,he.Qh)({width:t,height:s},H.gcsGrid),L=(0,je.xQ)(L,c.rasterInfo.dataType,V))}return a.requestRawData||B?{srcExtent:p,pixelBlock:L,transformGrid:H,localNorthDirections:V,extent:i,isPartiallyFilled:Q}:{srcExtent:p,extent:i,pixelBlock:L}})()}_fetchRawTiles(i,t,s,a){var c=this;return(0,E.Z)(function*(){const{origin:u,blockBoundary:f}=c.rasterInfo.storageInfo,{blockWidth:h,blockHeight:d}=c.getBlockWidthHeight(i);let{x:m,y:p}=t,{width:x,height:g,wrapCount:y}=s;const v=c._getRasterTileAlignmentInfo(i,0);a.buffer&&(m-=a.buffer.cols,p-=a.buffer.rows,x+=2*a.buffer.cols,g+=2*a.buffer.rows);let S=0,b=0,I=0;y&&(0,M.pC)(v)&&(({worldColumnCountFromOrigin:b,originColumnOffset:I,rightPadding:S}=v),b*v.blockWidth-S>=m+x&&(S=0));const R=Math.floor(m/h),w=Math.floor(p/d),Z=Math.floor((m+x+S-1)/h),O=Math.floor((p+g+S-1)/d),z=f[i];if(!z)return null;const{minRow:F,minCol:T,maxCol:D,maxRow:B}=z;if(0===y&&(O<F||Z<T||w>B||R>D))return null;const H=new Array;let L=!1;const G=null==c.ioConfig.allowPartialFill?a.allowPartialFill:c.ioConfig.allowPartialFill;for(let W=w;W<=O;W++)for(let oe=R;oe<=Z;oe++){let Ae=oe;if(!a.disableWrapAround&&y&&(0,M.pC)(v)&&b<=oe&&(Ae=oe-b-I),W>=F&&Ae>=T&&B>=W&&D>=Ae){const ot=c._fetchRawTile(i,W,Ae,a);H.push(G?new Promise(lt=>{ot.then(ar=>lt(ar)).catch(()=>{L=!0,lt(null)})}):ot)}else H.push(null)}if(0===H.length)return null;const re=yield Promise.all(H),N={height:(O-w+1)*d,width:(Z-R+1)*h},{spatialReference:$}=c.rasterInfo,Y=c.getPyramidPixelSize(i),{x:Q,y:V}=Y;return{extent:new ee.Z({xmin:u.x+R*h*Q,xmax:u.x+(Z+1)*h*Q,ymin:u.y-(O+1)*d*V,ymax:u.y-w*d*V,spatialReference:$}),pixelBlocks:re,mosaicSize:N,isPartiallyFilled:L}})()}_fetchRawTile(i,t,s,a){const c=this.rasterInfo.storageInfo.blockBoundary[i];if(!c)return Promise.resolve(null);const{minRow:u,minCol:f,maxCol:h,maxRow:d}=c;if(t<u||s<f||t>d||s>h)return Promise.resolve(null);const m=Qe(this.url,a.sliceId),p=`${i}/${t}/${s}`;let x=qe(m,a.registryId,p);if((0,M.Wi)(x)){const g=new AbortController;x=this.fetchRawTile(i,t,s,q(A({},a),{signal:g.signal})),et(m,a.registryId,p,x,g),x.catch(()=>function Ht(i,t,s){if(!_.has(i))return void(null==t&&fe.deleteBlock(i,s));const a=_.get(i);null!=a[t]?a[t].cache.delete(s):fe.deleteBlock(i,s)}(m,a.registryId,p))}return a.signal&&(0,Se.fu)(a,()=>{!function Et(i,t,s){if(!_.has(i))return null==t?fe.decreaseRefCount(i,s):0;const a=_.get(i);if(null==a[t])return fe.decreaseRefCount(i,s);const c=a[t].cache;if(c.has(s)){const u=c.get(s);if(u.refCount--,0===u.refCount){c.delete(s);for(let f=0;f<a.length;f++)a[f]&&a[f].cache.has(s)&&a[f].cache.delete(s);u.controller&&u.controller.abort()}return u.refCount}}(m,a.registryId,p)}),x}_computeMagDirValues(i){var d;const{bandCount:t,dataType:s}=this.rasterInfo;if((2!==t||"vector-magdir"!==s)&&"vector-uv"!==s||2!==(null==i?void 0:i.length)||null==(d=i[0])||!d.length)return null;const a=i[0].length;if("vector-magdir"===s){const m=i[1].map(p=>(p+360)%360);return[i[0],m]}const[c,u]=i,f=[],h=[];for(let m=0;m<a;m++){const[p,x]=(0,je.Tg)([c[m],u[m]]);f.push(p),h.push(x)}return[f,h]}_getRasterTileAlignmentInfo(i,t){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=(0,U.P_)(this.rasterInfo)),(0,M.Wi)(this._rasterTileAlighmentInfo.pyramidsInfo)?null:A({startX:t,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[i])}_getSourceDataInfo(i,t,s,a={}){const c={datumTransformation:a.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};a.srcResolution&&(c.srcResolution=a.srcResolution,this._updateSourceDataInfo(i,c));const u=this.rasterInfo.storageInfo.maximumPyramidLevel||0,{srcWidth:f,srcHeight:h,pyramidLevel:d}=c,m=f/t,p=h/s,x=d<u&&m*p>=16;if(x||d===u&&(m>8||p>8)||0===f||0===h){const g=new te.Z({x:(i.xmax-i.xmin)/t,y:(i.ymax-i.ymin)/s,spatialReference:i.spatialReference});let y=(0,U.VO)(g,this.rasterInfo.spatialReference,i,c.datumTransformation);const v=!y||a.srcResolution&&y.x+y.y<a.srcResolution.x+a.srcResolution.y;if(x&&a.srcResolution&&v){const S=Math.round(Math.log(Math.max(m,p))/Math.LN2)-1;if(u-d+3>=S){const b=2**S;y={x:a.srcResolution.x*b,y:a.srcResolution.y*b}}}y&&(c.srcResolution=y,this._updateSourceDataInfo(i,c))}return(c.srcWidth/t>8||c.srcHeight/s>8)&&(c.srcWidth=0,c.srcHeight=0),c}_updateSourceDataInfo(i,t){t.srcWidth=0,t.srcHeight=0;const s=this.rasterInfo.spatialReference,{srcResolution:a,datumTransformation:c}=t,{pyramidLevel:u,pyramidResolution:f,excessiveReading:h}=(0,U.kr)(a,this.rasterInfo,this.ioConfig.sampling);if(h)return;let d=t.srcExtent||(0,U.tB)(i,s,c);if(null==d)return;const m=(0,M.Wg)(this.rasterInfo.transform);m&&(d=m.inverseTransform(d)),t.srcExtent=d;const p=Math.ceil((d.xmax-d.xmin)/f.x-.1),x=Math.ceil((d.ymax-d.ymin)/f.y-.1);t.pyramidLevel=u,t.pyramidResolution=f,t.srcWidth=p,t.srcHeight=x}_getRequestOptionsWithSliceId(i){return(0,M.pC)(this.rasterInfo.multidimensionalInfo)&&null==i.sliceId&&(i=q(A({},i),{sliceId:this.getSliceIndex(i.multidimensionalDefinition)})),i}_processIdentifyResult(i,t){const{srcLocation:s,position:a,pyramidLevel:c,useTransposedTile:u}=t,f=i.pixels[0].length/i.width/i.height;if(i.mask&&!i.mask[a])return{location:s,value:null};const{multidimensionalInfo:h}=this.rasterInfo;if((0,M.Wi)(h)||!u){const y=i.pixels.map(b=>b[a]),v={location:s,value:y,pyramidLevel:c},S=this._computeMagDirValues(y.map(b=>[b]));return null!=S&&S.length&&(v.magdirValue=S.map(b=>b[0])),v}let d=i.pixels.map(y=>Array.prototype.slice.call(y,a*f,a*f+f)),m=this._computeMagDirValues(d);const{requestSomeSlices:p,identifyOptions:x}=t;let g=(0,me.MO)(h,x.transposedVariableName);if(p){const y=(0,me.Ur)(g,(0,M.Wg)(x.multidimensionalDefinition),(0,M.Wg)(x.timeExtent));d=d.map(v=>y.map(S=>v[S])),m=null==m?void 0:m.map(v=>y.map(S=>v[S])),g=y.map(v=>g[v])}return{location:s,value:null,dataSeries:g.map((y,v)=>{const S={value:d.map(b=>b[v]),multidimensionalDefinition:y.multidimensionalDefinition,variableName:y.multidimensionalDefinition[0].variableName,dimensionValues:{}};return null!=m&&m.length&&(S.magdirValue=[m[0][v],m[1][v]]),y.multidimensionalDefinition.forEach(b=>S.dimensionValues[b.dimensionName]=b.values[0]),S}),pyramidLevel:c}}};(0,P._)([(0,k.Cb)()],se.prototype,"_rasterTileAlighmentInfo",void 0),(0,P._)([(0,k.Cb)({readOnly:!0})],se.prototype,"_isGlobalWrappableSource",null),(0,P._)([(0,k.Cb)(Je.HQ)],se.prototype,"url",null),(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],se.prototype,"datasetName",void 0),(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],se.prototype,"datasetFormat",void 0),(0,P._)([(0,k.Cb)()],se.prototype,"rasterInfo",void 0),(0,P._)([(0,k.Cb)()],se.prototype,"ioConfig",void 0),(0,P._)([(0,k.Cb)()],se.prototype,"sourceJSON",void 0),se=(0,P._)([(0,ue.j)("esri.layers.support.rasterDatasets.BaseRaster")],se);const Ie=se;var rt=C(15365);function Lt(i){const t=i.fields,s=i.records,a=t.some(m=>"oid"===m.name.toLowerCase())?"OBJECTID":"OID",c=[{name:a,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map(m=>({name:m.name,type:"esriFieldType"+m.typeName,alias:m.name}))),u=c.map(m=>m.name),f=[];let h=0,d=0;return s.forEach(m=>{const p={};for(p[a]=h++,d=1;d<u.length;d++)p[u[d]]=m[d-1];f.push({attributes:p})}),{displayFieldName:"",fields:c,features:f}}var nt=C(46572),At=C(17253);const pe=new Map;pe.set("int16","esriFieldTypeSmallInteger"),pe.set("int32","esriFieldTypeInteger"),pe.set("int64","esriFieldTypeInteger"),pe.set("float32","esriFieldTypeSingle"),pe.set("float64","esriFieldTypeDouble"),pe.set("text","esriFieldTypeString");let Pe=class extends Ie{constructor(){super(...arguments),this.storageInfo=null,this.datasetFormat="CRF"}open(i){var t=this;return(0,E.Z)(function*(){yield t.init();const{data:s}=yield t.request(t.url+"/conf.json",{signal:null==i?void 0:i.signal});if(!t._validateHeader(s))throw new j.Z("cloudraster:open","Invalid or unsupported conf.json.");t.datasetName=t.url.slice(t.url.lastIndexOf("/")+1);const{storageInfo:a,rasterInfo:c}=t._parseHeader(s);if("thematic"===c.dataType){const u=yield t._fetchAuxiliaryInformation();c.attributeTable=u}t._set("storageInfo",a),t._set("rasterInfo",c),t.ioConfig.retryCount=t.ioConfig.retryCount||0})()}fetchRawTile(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){const{transposeInfo:u}=c.rasterInfo.storageInfo,{transposedVariableName:f}=a,h=!(!u||!f),d=h?0:c.rasterInfo.storageInfo.maximumPyramidLevel-i;if(d<0)return null;const m=c._buildCacheFilePath(d,t,s,a.multidimensionalDefinition,f),p=c._getIndexRecordFromBundle(t,s,h),x=yield c.request(m,{range:{from:0,to:c.storageInfo.headerSize-1},responseType:"array-buffer",signal:a.signal});if(!x)return null;const g=new Uint8Array(x.data),y=c._getTileEndAndContentType(g,p);if(0===y.recordSize)return null;const v=yield c.request(m,{range:{from:y.position,to:y.position+y.recordSize},responseType:"array-buffer",signal:a.signal});if(!v)return null;const[S,b]=c._getTileSize(h);return c.decodePixelBlock(v.data,{width:S,height:b,planes:null,pixelType:null,returnPixelInterleavedDims:h})})()}_validateHeader(i){return i&&"RasterInfo"===i.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some(s=>!i[s])}_parseHeader(i){var Q,V;const t=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][i.pixelType],{bandCount:s,histograms:a,colormap:c,blockWidth:u,blockHeight:f,firstPyramidLevel:h,maximumPyramidLevel:d}=i,m=i.statistics&&i.statistics.map(W=>({min:W.min,max:W.max,avg:W.mean,stddev:W.standardDeviation,median:W.median,mode:W.mode})),p=i.extent.spatialReference,x=null==(Q=i.geodataXform)?void 0:Q.spatialReference,g=new ne.Z((null==p?void 0:p.wkid)||(null==p?void 0:p.wkt)?p:x);let y=new ee.Z({xmin:i.extent.xmin,ymin:i.extent.ymin,xmax:i.extent.xmax,ymax:i.extent.ymax,spatialReference:g});const v=new te.Z({x:i.pixelSizeX,y:i.pixelSizeY,spatialReference:g}),S=Math.round((y.xmax-y.xmin)/v.x),b=Math.round((y.ymax-y.ymin)/v.y),I=this._parseTransform(i.geodataXform),R=I?y:null;I&&(y=I.forwardTransform(y),v.x=(y.xmax-y.xmin)/S,v.y=(y.ymax-y.ymin)/b);const w=null!=(V=i.properties)?V:{},Z=i.format.toLowerCase().replace("cache/",""),O=new te.Z(i.origin.x,i.origin.y,g);let z,F,T,D;if(c&&c.colors)for(z=[],F=0;F<c.colors.length;F++)T=c.colors[F],D=c.values?c.values[F]:F,z.push([D,255&T,T<<16>>>24,T<<8>>>24,T>>>24]);const B=i.LODInfos,H=[];for(F=0;F<B.levels.length;F++)H.push({level:B.levels[F],resolution:B.resolutions[F],scale:96/.0254*B.resolutions[F]});const L=new xe.Z({dpi:96,lods:H,format:Z,origin:O,size:[u,f],spatialReference:g}),G={recordSize:8,packetSize:i.packetSize,headerSize:i.packetSize*i.packetSize*8+64},re=[{maxCol:Math.ceil(S/u)-1,maxRow:Math.ceil(b/f)-1,minCol:0,minRow:0}];let N=2;if(d>0)for(F=0;F<d;F++)re.push({maxCol:Math.ceil(S/N/u)-1,maxRow:Math.ceil(b/N/f)-1,minCol:0,minRow:0}),N*=2;const $=i.mdInfo;let Y=null;if($&&w._yxs){const W=w._yxs;Y={packetSize:W.PacketSize,tileSize:[W.TileXSize,W.TileYSize]}}return{storageInfo:G,rasterInfo:new Te.Z({width:S,height:b,pixelType:t,bandCount:s,extent:y,nativeExtent:R,transform:I,spatialReference:g,pixelSize:v,keyProperties:w,statistics:m,histograms:a,multidimensionalInfo:$,colormap:z,storageInfo:new we.Z({blockWidth:u,blockHeight:f,pyramidBlockWidth:u,pyramidBlockHeight:f,origin:O,tileInfo:L,transposeInfo:Y,firstPyramidLevel:h,maximumPyramidLevel:d,blockBoundary:re})})}}_parseTransform(i){var s,a;if(!(0,nt.j)(i))throw new j.Z("cloudraster:open","the data contains unsupported geodata transform types");const t=(0,nt.c)(i);if("identity"===t.type)return null;if("polynomial"!==t.type||null==(s=t.forwardCoefficients)||!s.length||null==(a=t.inverseCoefficients)||!a.length)throw new j.Z("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return t}_fetchAuxiliaryInformation(i){var t=this;return(0,E.Z)(function*(){const s=t.request(t.url+"/conf.vat.json",{signal:i}).then(f=>f.data).catch(()=>null),a=t.request(t.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:i}).then(f=>f.data).catch(()=>null),c=yield Promise.all([s,a]);let u;if(c[0]){let f=c[0].fields;const h=c[0].values;if(f&&h){f=f.map(m=>({type:"OID"===m.name?"esriFieldTypeOID":pe.get(m.type),name:m.name,alias:m.alias||m.name}));const d=h.map(m=>({attributes:m}));f&&h&&(u={fields:f,features:d})}}return!u&&c[1]&&(u=class Wt{static get supportedVersions(){return[5]}static parse(t){const s=new DataView(t),a=3&s.getUint8(0);if(3!==a)return{header:{version:a},recordSet:null};const c=s.getUint32(4,!0),u=s.getUint16(8,!0),f=s.getUint16(10,!0),h={version:a,recordCount:c,headerByteCount:u,recordByteCount:f};let d=32;const m=[],p=[];let x;if(3===a){for(;13!==s.getUint8(d);)x=String.fromCharCode(s.getUint8(d+11)).trim(),m.push({name:(0,rt.f)(new Uint8Array(t,d,11)),type:x,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(x)],length:s.getUint8(d+16)}),d+=32;if(d+=1,m.length>0)for(;p.length<c&&t.byteLength-d>f;){const g=[];32===s.getUint8(d)?(d+=1,m.forEach(y=>{if("C"===y.type)g.push((0,rt.f)(new Uint8Array(t,d,y.length)).trim());else if("N"===y.type)g.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(t,d,y.length)).trim(),10));else if("F"===y.type)g.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(t,d,y.length)).trim()));else if("D"===y.type){const v=String.fromCharCode.apply(null,new Uint8Array(t,d,y.length)).trim();g.push(new Date(parseInt(v.substring(0,4),10),parseInt(v.substring(4,6),10)-1,parseInt(v.substring(6,8),10)))}d+=y.length}),p.push(g)):d+=f}}return{header:h,fields:m,records:p,recordSet:Lt({fields:m,records:p})}}}.parse(c[1]).recordSet),At.default.fromJSON(u)})()}_buildCacheFilePath(i,t,s,a,c){const u=this._getPackageSize(!!c),f=Math.floor(t/u)*u,h=Math.floor(s/u)*u,d="R"+this._toHexString4(f)+"C"+this._toHexString4(h);let m="L";m+=i>=10?i.toString():"0"+i.toString();const{multidimensionalInfo:p}=this.rasterInfo,x=null==a?void 0:a[0];if((0,M.Wi)(p)||!x)return`${this.url}/_alllayers/${m}/${d}.bundle`;let g="_yxs";if(!c){g=p.variables.find(S=>S.name===x.variableName).dimensions[0].values.indexOf(x.values[0]).toString(16);const v=4-g.length;for(let S=0;S<v;S++)g="0"+g;g="S"+g}const y=this._getVariableFolderName(c||x.variableName);return`${this.url}/_alllayers/${y}/${g}/${m}/${d}.bundle`}_getPackageSize(i=!1){const{transposeInfo:t}=this.rasterInfo.storageInfo;return i&&(0,M.pC)(t)?t.packetSize:this.storageInfo.packetSize}_getTileSize(i=!1){const{storageInfo:t}=this.rasterInfo,{transposeInfo:s}=t;return i&&(0,M.pC)(s)?s.tileSize:t.tileInfo.size}_getVariableFolderName(i){return""===(i=i.trim())?"_v":i.replace(/[\{|\}\-]/g,"_").replace("\\*","_v")}_getIndexRecordFromBundle(i,t,s=!1){const a=this._getPackageSize(s),c=a*(i%a)+t%a;if(c<0)throw"Invalid level / row / col";return 20+c*this.storageInfo.recordSize+44}_getTileEndAndContentType(i,t){const s=i.subarray(t,t+8);let a,c=0;for(a=0;a<5;a++)c|=(255&s[a])<<8*a;const u=0xffffffffff&c;for(c=0,a=5;a<8;a++)c|=(255&s[a])<<8*(a-5);return{position:u,recordSize:0xffffffffff&c}}_toHexString4(i){let t=i.toString(16);if(4!==t.length){let s=4-t.length;for(;s-- >0;)t="0"+t}return t}};(0,P._)([(0,k.Cb)({readOnly:!0})],Pe.prototype,"storageInfo",void 0),(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],Pe.prototype,"datasetFormat",void 0),Pe=(0,P._)([(0,ue.j)("esri.layers.support.rasterDatasets.CloudRaster")],Pe);const Jt=Pe;var Ze=C(17057);let Me=class extends Ie{constructor(){super(...arguments),this.datasetFormat="MEMORY"}open(i){var t=this;return(0,E.Z)(function*(){var b;yield t.init();const{pixelBlock:s,statistics:a,histograms:c,name:u,keyProperties:f,nativeExtent:h,transform:d}=t.data,{width:m,height:p,pixelType:x}=s,g=t.data.extent||new ee.Z({xmin:-.5,ymin:.5,xmax:m-.5,ymax:p-.5,spatialReference:new ne.Z({wkid:3857})}),y=null!=(b=t.data.isPseudoSpatialReference)?b:!t.data.extent,S=new Te.Z({width:m,height:p,pixelType:x,extent:g,nativeExtent:h,transform:d,pixelSize:{x:g.width/m,y:g.height/p},spatialReference:g.spatialReference,bandCount:3,keyProperties:f||{},statistics:a,isPseudoSpatialReference:y,histograms:c});t.createRemoteDatasetStorageInfo(S,512,512),t._set("rasterInfo",S),t.updateTileInfo(),yield t._buildInMemoryRaster(s,{width:512,height:512},i),t.datasetName=u,t.url="/InMemory/"+u})()}fetchRawTile(i,t,s,a={}){const c=this._pixelBlockTiles.get(`${i}/${t}/${s}`);return Promise.resolve(c)}_buildInMemoryRaster(i,t,s){var a=this;return(0,E.Z)(function*(){var p,x;const c=a.rasterInfo.storageInfo.maximumPyramidLevel,u=a.rasterJobHandler?a.rasterJobHandler.split({pixelBlock:i,tileSize:t,maximumPyramidLevel:c},s):Promise.resolve((0,he.Vl)(i,t,c)),f=(0,M.pC)(a.rasterInfo.statistics),h=(0,M.pC)(a.rasterInfo.histograms),d=f?Promise.resolve({statistics:null,histograms:null}):a.rasterJobHandler?a.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:i},s):Promise.resolve((0,Ze.Hv)(i)),m=yield(0,Se.as)([u,d]);if(!m[0].value&&m[1].value)throw new j.Z("inmemory-raster:open","failed to build in memory raster");a._pixelBlockTiles=m[0].value,f||(a.rasterInfo.statistics=null==(p=m[1].value)?void 0:p.statistics),h||(a.rasterInfo.histograms=null==(x=m[1].value)?void 0:x.histograms)})()}};(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],Me.prototype,"datasetFormat",void 0),(0,P._)([(0,k.Cb)()],Me.prototype,"data",void 0),Me=(0,P._)([(0,ue.j)("esri.layers.support.rasterDatasets.InMemoryRaster")],Me);const jt=Me;function ve(i,t){if(!i||!t)return[];let s=t;t.includes("/")?(s=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";const a=[];if(t){const u=ve(i,s);for(let f=0;f<u.length;f++)ve(u[f],t).forEach(h=>a.push(h));return a}const c=i.getElementsByTagNameNS("*",s);if(!c||0===c.length)return[];for(let u=0;u<c.length;u++)a.push(c[u]||c.item[u]);return a}function ie(i,t){if(!i||!t)return null;let s=t;t.includes("/")?(s=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";const a=ve(i,s);return a.length>0?t?ie(a[0],t):a[0]:null}function ae(i,t=null){const s=t?ie(i,t):i;let a;return s?(a=s.textContent||s.nodeValue,a?a.trim():null):null}function ze(i,t){return function Ut(i,t){const s=ve(i,t),a=[];let c;for(let u=0;u<s.length;u++)c=s[u].textContent||s[u].nodeValue,c&&(c=c.trim(),""!==c&&a.push(c));return a}(i,t).map(s=>Number(s))}function ye(i,t){const s=ae(i,t);return Number(s)}function Ue(i,t){var c;const s=null==(c=null==i?void 0:i.nodeName)?void 0:c.toLowerCase(),a=t.toLowerCase();return s.slice(s.lastIndexOf(":")+1)===a}var _e=C(85374);function st(i,t){if(!i||!t)return null;const s=[];for(let a=0;a<i.length;a++)s.push(i[a]),s.push(t[a]);return s}function Ee(i){if(!i)return null;let t=Number(i);if(!isNaN(t)&&0!==t)return new ne.Z({wkid:t});if((i=String(i)).startsWith("COMPD_CS")){if(!i.includes("VERTCS")||!i.includes("GEOGCS")&&!i.startsWith("PROJCS"))return null;const s=i.indexOf("VERTCS"),a=i.indexOf("PROJCS"),c=a>-1?a:i.indexOf("GEOGCS");if(-1===c)return null;const u=i.slice(c,i.lastIndexOf("]",s)+1).trim(),f=i.slice(s,i.lastIndexOf("]")).trim();t=Ge(u);const h=new ne.Z(t?{wkid:t}:{wkt:u}),d=Ge(f);return d&&(h.vcsWkid=d),h}return i.startsWith("GEOGCS")||i.startsWith("PROJCS")?(t=Ge(i),new ne.Z(0!==t?{wkid:t}:{wkt:i})):null}function Ge(i){var c;const t=i.replace(/\]/g,"[").replace(/\"/g,"").split("[").map(u=>u.trim()).filter(u=>""!==u),s=t[t.length-1].split(","),a=null==(c=s[0])?void 0:c.toLowerCase();if(("epsg"===a||"esri"===a)&&i.endsWith('"]]')){const u=Number(s[1]);if(!isNaN(u)&&0!==u)return u}return 0}function $e(i){var a;if("pamdataset"!==(null==(a=null==i?void 0:i.documentElement.tagName)?void 0:a.toLowerCase()))return{};const t={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};i.documentElement.childNodes.forEach(c=>{if(1===c.nodeType)if(Ue(c,"SRS")){if(!t.spatialReference){const u=ae(c);t.spatialReference=Ee(u)}}else if(Ue(c,"Metadata"))if("xml:ESRI"===c.getAttribute("domain")){const{spatialReference:u,transform:f}=function _t(i){var p;const t=ie(i,"GeodataXform"),s=Ee(ye(t,"SpatialReference/WKID")||ae(t,"SpatialReference/WKT"));if("typens:PolynomialXform"!==t.getAttribute("xsi:type"))return{spatialReference:s,transform:null};const a=null!=(p=ye(t,"PolynomialOrder"))?p:1,c=ze(t,"CoeffX/Double"),u=ze(t,"CoeffY/Double"),f=ze(t,"InverseCoeffX/Double"),h=ze(t,"InverseCoeffY/Double"),d=st(c,u),m=st(f,h);return{spatialReference:s,transform:new _e.Z({spatialReference:s,polynomialOrder:a,forwardCoefficients:d,inverseCoefficients:m})}}(c);t.transform=f,t.spatialReference||(t.spatialReference=u)}else ve(c,"MDI").forEach(u=>t.metadata[u.getAttribute("key")]=ae(u));else if(Ue(c,"PAMRasterBand")){const u=function Gt(i){var g;const t=ye(i,"NoDataValue"),s=ie(i,"Histograms/HistItem"),a=ye(s,"HistMin"),c=ye(s,"HistMax"),u=ye(s,"BucketCount"),f=null==(g=ae(s,"HistCounts"))?void 0:g.split("|").map(y=>Number(y));let h,d,m,p;ve(i,"Metadata/MDI").forEach(y=>{var S;const v=Number(null!=(S=y.textContent)?S:y.nodeValue);switch(y.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":h=v;break;case"STATISTICS_MAXIMUM":d=v;break;case"STATISTICS_MEAN":m=v;break;case"STATISTICS_STDDEV":p=v}});const x=ye(i,"Metadata/SourceBandIndex");return{noDataValue:t,histogram:(null==f?void 0:f.length)&&null!=h&&null!=d?{min:a,max:c,size:u||f.length,counts:f}:null,sourceBandIndex:x,statistics:null!=h&&null!=d?{min:h,max:d,avg:m,stddev:p}:null}}(c);null!=u.sourceBandIndex&&null==t.rasterBands[u.sourceBandIndex]?t.rasterBands[u.sourceBandIndex]=u:t.rasterBands.push(u)}});const s=t.rasterBands;return s&&(t.statistics=s[0].statistics?s.map(f=>f.statistics):null,t.histograms=s[0].histogram?s.map(f=>f.histogram):null),t}let He=class extends Ie{open(i){var t=this;return(0,E.Z)(function*(){yield t.init();const s=yield t._fetchData(i);let{spatialReference:a,statistics:c,histograms:u,transform:f}=yield t._fetchAuxiliaryData(i);const h=!a;h&&(a=new ne.Z({wkid:3857})),(null==u?void 0:u.length)&&null==c&&(c=(0,Ze.Oh)(u));const{width:d,height:m}=s;let p=new ee.Z({xmin:-.5,ymin:.5-m,xmax:d-.5,ymax:.5,spatialReference:a});const x=f?f.forwardTransform(p):p;let g=!0;if(f){const v=f.forwardCoefficients;g=v&&0===v[1]&&0===v[2],g&&(f=null,p=x)}const y=new jt({data:{extent:x,nativeExtent:p,transform:f,pixelBlock:s,statistics:c,histograms:u,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:h}});yield y.open(),y.data=null,t._set("rasterInfo",y.rasterInfo),t._inMemoryRaster=y})()}fetchRawTile(i,t,s,a={}){return this._inMemoryRaster.fetchRawTile(i,t,s,a)}_fetchData(i){var t=this;return(0,E.Z)(function*(){const{data:s}=yield t.request(t.url,{responseType:"array-buffer",signal:null==i?void 0:i.signal}),a=(0,tt.y)(s).toUpperCase();if("JPG"!==a&&"PNG"!==a&&"GIF"!==a&&"BMP"!==a)throw new j.Z("image-aux-raster:open","the data is not a supported format");t._set("datasetFormat",a);const c=a.toLowerCase(),u="gif"===c||"bmp"===c||!(0,ht.Z)("ios");return yield t.decodePixelBlock(s,{format:c,useCanvas:u,hasNoZlibMask:!0})})()}_fetchAuxiliaryData(i){var t=this;return(0,E.Z)(function*(){var p,x;const s=(0,M.Wg)(null==i?void 0:i.signal),a=null!=(p=t.ioConfig.skipExtensions)?p:[],c=a.includes("aux.xml")?null:t.request(t.url+".aux.xml",{responseType:"xml",signal:s}),u=t.datasetFormat,f="JPG"===u?"jgw":"PNG"===u?"pgw":"BMP"===u?"bpw":null,h=a.includes(f)?null:t.request(t.url.slice(0,t.url.lastIndexOf("."))+"."+f,{responseType:"text",signal:s}),d=yield(0,Se.as)([c,h]);if(null!=s&&s.aborted)throw(0,Se.zE)();const m=$e(null==(x=d[0].value)?void 0:x.data);if(!m.transform){const g=d[1].value?d[1].value.data.split("\n").slice(0,6).map(y=>Number(y)):null;m.transform=6===(null==g?void 0:g.length)?new _e.Z({forwardCoefficients:[g[4],g[5],g[0],-g[1],g[2],-g[3]]}):null}return m})()}};(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],He.prototype,"datasetFormat",void 0),He=(0,P._)([(0,ue.j)("esri.layers.support.rasterDatasets.ImageAuxRaster")],He);const Ne=He;var $t=C(21726),Vt=C(51026),Yt=C(28930),Xt=C(76671),Kt=C(99208);let Fe=class extends Ie{constructor(){super(...arguments),this._levelOffset=0,this._tilemapCache=null,this._slices=null,this.datasetFormat="RasterTileServer"}open(i){var t=this;return(0,E.Z)(function*(){var h,d;yield t.init();const s=i&&i.signal,a=t.sourceJSON?{data:t.sourceJSON}:yield t.request(t.url,{query:{f:"json"},signal:s});a.ssl&&(t.url=t.url.replace(/^http:/i,"https:"));const c=a.data;if(t.sourceJSON=c,!c)throw new j.Z("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!c.tileInfo)throw new j.Z("imageserverraster:open","use ImageryLayer to open non-tiled image services");t._fixScaleInServiceInfo(),t.tileType=c.cacheType,null==t.tileType&&(t.tileType=["jpg","jpeg","png","png8","png24","png32","mixed"].includes(c.tileInfo.format.toLowerCase())?"Map":"lerc"===c.tileInfo.format.toLowerCase()?"Elevation":"Raster"),t.datasetName=c.name.slice(c.name.indexOf("/")+1);const f=yield t._fetchRasterInfo({signal:s});if(!(0,M.pC)(f))throw new j.Z("image-server-raster:open","cannot initialize image service");{const m="Map"===t.tileType?(0,Vt.d)(c.tileInfo,c):xe.Z.fromJSON(c.tileInfo),{extent:p,pixelSize:x}=f,g=.5/f.width*x.x;let y,v;const S=m.lodAt(Math.max.apply(null,m.lods.map(D=>D.level)));"Map"!==t.tileType&&0!==c.maxScale&&("Raster"===t.tileType?(y=m.lods.find(D=>D.resolution===x.x),y||(y=m.lods[m.lods.length-1])):(y=m.lods.find(D=>Math.abs(D.scale-c.maxScale)<g),y||(y=m.lods.filter(D=>D.scale>c.maxScale).sort((D,B)=>D.scale>B.scale?1:-1)[0])),x.x=x.y=y.resolution,f.width=Math.ceil((p.xmax-p.xmin)/x.x-.1),f.height=Math.ceil((p.ymax-p.ymin)/x.y-.1)),y||(y=S);const b=m.lodAt(Math.min.apply(null,m.lods.map(D=>D.level)));"Map"===t.tileType?t._levelOffset=m.lods[0].level:0!==c.minScale&&"Elevation"===t.tileType&&(v=m.lods.find(D=>Math.abs(D.scale-c.minScale)<g),t._levelOffset=v.level-b.level),v||(v=b);const I=Math.max(x.x,x.y);(Math.abs(x.x-x.y)>g||!m.lods.some(D=>Math.abs(D.resolution-I)<g))&&(x.x=x.y=y.resolution,f.width=Math.ceil((p.xmax-p.xmin)/x.x-.1),f.height=Math.ceil((p.ymax-p.ymin)/x.y-.1));const R=y.level-v.level,[w,Z]=m.size,O=[];m.lods.forEach(D=>{D.level>=v.level&&D.level<=y.level&&O.push({x:D.resolution,y:D.resolution})}),O.sort((D,B)=>D.x-B.x);const z=t.computeBlockBoundary(p,w,Z,m.origin,O,R),F=O.length>1?O.slice(1):null;let T;c.transposeInfo&&(T={tileSize:[c.transposeInfo.rows,c.transposeInfo.cols],packetSize:null!=(d=null==(h=f.keyProperties)?void 0:h._yxs.PacketSize)?d:0}),f.storageInfo=new we.Z({blockWidth:m.size[0],blockHeight:m.size[1],pyramidBlockWidth:m.size[0],pyramidBlockHeight:m.size[1],pyramidResolutions:F,compression:m.format,origin:m.origin,firstPyramidLevel:1,maximumPyramidLevel:R,tileInfo:m,transposeInfo:T,blockBoundary:z}),t._fixGCSShift(f),t._set("rasterInfo",f)}if(c.capabilities.toLowerCase().includes("tilemap")){const m={tileInfo:f.storageInfo.tileInfo,parsedUrl:(0,$t.mN)(t.url),url:t.url,tileServers:[],type:"tile"};t._tilemapCache=new Yt.y({layer:m})}})()}fetchRawTile(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){const{storageInfo:u,extent:f}=c.rasterInfo,{transposeInfo:h}=u,d=(0,M.pC)(h)&&!!a.transposedVariableName;if(c._slices&&!d&&null==a.sliceId)return null;const p=`${c.url}/tile/${d?0:u.maximumPyramidLevel-i+c._levelOffset}/${t}/${s}`,x=c._slices?d?{variable:a.transposedVariableName}:{sliceId:a.sliceId||0}:null,{data:g}=yield c.request(p,{query:x,responseType:"array-buffer",signal:a.signal});if(!g)return null;const y=d?h.tileSize:u.tileInfo.size,v=yield c.decodePixelBlock(g,{width:y[0],height:y[1],planes:null,pixelType:null,isPoint:"Elevation"===c.tileType,returnPixelInterleavedDims:d}),S=u.blockBoundary[i];if("jpg"!==u.compression||s>S.minCol&&s<S.maxCol&&t>S.minRow&&t<S.maxRow)return v;const{origin:b,blockWidth:I,blockHeight:R}=u,{x:w,y:Z}=c.getPyramidPixelSize(i),O=Math.round((f.xmin-b.x)/w)%I,z=Math.round((f.xmax-b.x)/w)%I||I,F=Math.round((b.y-f.ymax)/Z)%R,T=Math.round((b.y-f.ymin)/Z)%R||R,D=s===S.minCol?O:0,B=t===S.minRow?F:0;return(0,he.pW)(v,{x:D,y:B},{width:(s===S.maxCol?z:I)-D,height:(t===S.maxRow?T:R)-B}),v})()}getSliceIndex(i){if(!this._slices||(0,M.Wi)(i)||0===i.length)return null;const t=i;for(let s=0;s<this._slices.length;s++){const a=this._slices[s].multidimensionalDefinition;if(a.length===t.length&&!a.some(c=>{const u=t.find(f=>c.variableName===f.variableName&&f.dimensionName===c.dimensionName);return!u||(Array.isArray(c.values[0])?`${c.values[0][0]}-${c.values[0][1]}`:c.values[0])!==(Array.isArray(u.values[0])?`${u.values[0][0]}-${u.values[0][1]}`:u.values[0])}))return s}return null}fetchVariableStatisticsHistograms(i,t){var s=this;return(0,E.Z)(function*(){const a=s.request(s.url+"/statistics",{query:{variable:i,f:"json"},signal:t}).then(f=>{var h;return null==(h=f.data)?void 0:h.statistics}),c=s.request(s.url+"/histograms",{query:{variable:i,f:"json"},signal:t}).then(f=>{var h;return null==(h=f.data)?void 0:h.histograms}),u=yield Promise.all([a,c]);return u[0]&&u[0].forEach(f=>{f.avg=f.mean,f.stddev=f.standardDeviation}),{statistics:u[0]||null,histograms:u[1]||null}})()}computeBestPyramidLevelForLocation(i,t={}){var s=this;return(0,E.Z)(function*(){if(!s._tilemapCache)return 0;let a=s.identifyPixelLocation(i,0,(0,M.Wg)(t.datumTransformation));if(null===a)return null;let c=0;const{maximumPyramidLevel:u}=s.rasterInfo.storageInfo;let f=u-c+s._levelOffset;const h=a.srcLocation;for(;f>=0;){try{if("available"===(yield s._tilemapCache.fetchAvailability(f,a.row,a.col,t)))break}catch(d){}if(f--,c++,a=s.identifyPixelLocation(h,c,(0,M.Wg)(t.datumTransformation)),null===a)return null}return-1===f||null==a?null:c})()}_fetchRasterInfo(i){var t=this;return(0,E.Z)(function*(){const s=t.sourceJSON;if("Map"===t.tileType){const h=Math.ceil((s.extent.xmax-s.extent.xmin)/s.pixelSizeX-.1),d=Math.ceil((s.extent.ymax-s.extent.ymin)/s.pixelSizeY-.1),m=ne.Z.fromJSON(s.spatialReference||s.extent.spatialReference),p=new te.Z({x:s.pixelSizeX,y:s.pixelSizeY,spatialReference:m});return new Te.Z({width:h,height:d,bandCount:3,extent:ee.Z.fromJSON(s.extent),spatialReference:m,pixelSize:p,pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}})}const{signal:a}=i,c=(0,Kt.g)(t.url,t.sourceJSON,{signal:a,query:t.ioConfig.customFetchParameters}),u=s.hasMultidimensions?t.request(`${t.url}/slices`,{query:{f:"json"},signal:a}).then(h=>h.data&&h.data.slices).catch(()=>null):null,f=yield Promise.all([c,u]);return t._slices=f[1],f[0]})()}_fixScaleInServiceInfo(){const{sourceJSON:i}=this;i.minScale&&i.minScale<0&&(i.minScale=0),i.maxScale&&i.maxScale<0&&(i.maxScale=0)}_fixGCSShift(i){const{extent:t,spatialReference:s}=i;0===t.xmin&&360===t.xmax&&s.wkid&&s.isGeographic&&(i.nativeExtent=i.extent,i.transform=new Xt.Z,i.extent=i.transform.forwardTransform(t))}};(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],Fe.prototype,"datasetFormat",void 0),(0,P._)([(0,k.Cb)()],Fe.prototype,"tileType",void 0),Fe=(0,P._)([(0,ue.j)("esri.layers.support.rasterDatasets.ImageServerRaster")],Fe);const Qt=Fe;var qt=C(60295),er=C(44853);const ce=new Map;ce.set("Int8","s8"),ce.set("UInt8","u8"),ce.set("Int16","s16"),ce.set("UInt16","u16"),ce.set("Int32","s32"),ce.set("UInt32","u32"),ce.set("Float32","f32"),ce.set("Float64","f32"),ce.set("Double64","f32");const de=new Map;de.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),de.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),de.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),de.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});let be=class extends Ie{constructor(){super(...arguments),this._files=null,this._storageIndex=null,this.datasetFormat="MRF"}open(i){var t=this;return(0,E.Z)(function*(){var b,I;yield t.init(),t.datasetName=t.url.slice(t.url.lastIndexOf("/")+1);const s=i?(0,M.Wg)(i.signal):null,a=yield t.request(t.url,{responseType:"xml",signal:s}),{rasterInfo:c,files:u}=t._parseHeader(a.data);if(-1===(null==(b=t.ioConfig.skipExtensions)?void 0:b.indexOf("aux.xml"))){const R=yield t._fetchAuxiliaryData(i);null!=R&&(c.statistics=null!=(I=R.statistics)?I:c.statistics,c.histograms=R.histograms,R.histograms&&(0,M.Wi)(c.statistics)&&(c.statistics=(0,Ze.Oh)(R.histograms)))}t._set("rasterInfo",c),t._files=u;const f=yield t.request(u.index,{responseType:"array-buffer",signal:s});t._storageIndex=t._parseIndex(f.data);const{blockWidth:h,blockHeight:d}=t.rasterInfo.storageInfo,m=t.rasterInfo.storageInfo.pyramidScalingFactor,{width:p,height:x}=t.rasterInfo,g=[],y=t._getBandSegmentCount();let v=0,S=-1;for(;v<t._storageIndex.length;){S++;const R=Math.ceil(p/h/m**S)-1,w=Math.ceil(x/d/m**S)-1;v+=(R+1)*(w+1)*y*4,g.push({maxRow:w,maxCol:R,minCol:0,minRow:0})}t.rasterInfo.storageInfo.blockBoundary=g,S>0&&(t.rasterInfo.storageInfo.firstPyramidLevel=1,t.rasterInfo.storageInfo.maximumPyramidLevel=S),t.updateTileInfo()})()}fetchRawTile(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){const{blockWidth:u,blockHeight:f,blockBoundary:h}=c.rasterInfo.storageInfo,d=h[i];if(!d||d.maxRow<t||d.maxCol<s||d.minRow>t||d.minCol>s)return null;const{bandCount:m,pixelType:p}=c.rasterInfo,{ranges:x,actualTileWidth:g,actualTileHeight:y}=c._getTileLocation(i,t,s);if(!x||0===x.length)return null;if(0===x[0].from&&0===x[0].to){const B=new Uint8Array(u*f);return new qt.Z({width:u,height:f,pixels:null,mask:B,validPixelCount:0})}const{bandIds:v}=c.ioConfig,S=c._getBandSegmentCount(),b=[];let I=0;for(I=0;I<S;I++)(!v||v.indexOf[I]>-1)&&b.push(c.request(c._files.data,{range:{from:x[I].from,to:x[I].to},responseType:"array-buffer",signal:a.signal}));const R=yield Promise.all(b),w=R.map(B=>B.data.byteLength).reduce((B,H)=>B+H),Z=new Uint8Array(w);let O=0;for(I=0;I<S;I++)Z.set(new Uint8Array(R[I].data),O),O+=R[I].data.byteLength;const z=de.get(c.rasterInfo.storageInfo.compression).decoderFormat,F=yield c.decodePixelBlock(Z.buffer,{width:u,height:f,format:z,planes:(null==v?void 0:v.length)||m,pixelType:p});if((0,M.pC)(c.rasterInfo.noDataValue)&&"lerc"!==z&&!F.mask){const B=c.rasterInfo.noDataValue[0];if(null!=B){const H=F.width*F.height,L=new Uint8Array(H);if(Math.abs(B)>1e24)for(I=0;I<H;I++)Math.abs((F.pixels[0][I]-B)/B)>1e-6&&(L[I]=1);else for(I=0;I<H;I++)F.pixels[0][I]!==B&&(L[I]=1);F.mask=L}}let T=0,D=0;if(g!==u||y!==f){let B=F.mask;if(B)for(I=0;I<f;I++)if(D=I*u,I<y)for(T=g;T<u;T++)B[D+T]=0;else for(T=0;T<u;T++)B[D+T]=0;else for(B=new Uint8Array(u*f),F.mask=B,I=0;I<y;I++)for(D=I*u,T=0;T<g;T++)B[D+T]=1}return F})()}_parseIndex(i){if(i.byteLength%16>0)throw"invalid array buffer must be multiples of 16";let t,s,a,c,u,f;if(er.f){for(s=new Uint8Array(i),c=new ArrayBuffer(i.byteLength),a=new Uint8Array(c),u=0;u<i.byteLength/4;u++)for(f=0;f<4;f++)a[4*u+f]=s[4*u+3-f];t=new Uint32Array(c)}else t=new Uint32Array(i);return t}_getBandSegmentCount(){return de.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}_getTileLocation(i,t,s){const{blockWidth:a,blockHeight:c,pyramidScalingFactor:u}=this.rasterInfo.storageInfo,{width:f,height:h}=this.rasterInfo,d=this._getBandSegmentCount();let m,p,x,g=0,y=0;for(x=0;x<i;x++)y=u**x,m=Math.ceil(f/a/y),p=Math.ceil(h/c/y),g+=m*p;y=u**i,m=Math.ceil(f/a/y),p=Math.ceil(h/c/y),g+=t*m+s,g*=4*d;const v=this._storageIndex.subarray(g,g+4*d);let S=0,b=0;const I=[];for(let R=0;R<d;R++)S=v[4*R+0]*2**32+v[4*R+1],b=S+v[4*R+2]*2**32+v[4*R+3],I.push({from:S,to:b});return{ranges:I,actualTileWidth:s<m-1?a:Math.ceil(f/y)-a*(m-1),actualTileHeight:t<p-1?c:Math.ceil(h/y)-c*(p-1)}}_parseHeader(i){const t=ie(i,"MRF_META/Raster");if(!t)throw new j.Z("mrf:open","not a valid MRF format");const s=ie(t,"Size"),a=parseInt(s.getAttribute("x"),10),c=parseInt(s.getAttribute("y"),10),u=parseInt(s.getAttribute("c"),10),f=(ae(t,"Compression")||"none").toLowerCase();if(!de.has(f))throw new j.Z("mrf:open","currently does not support compression "+f);const h=ae(t,"DataType")||"UInt8",d=ce.get(h);if(null==d)throw new j.Z("mrf:open","currently does not support pixel type "+h);const m=ie(t,"PageSize"),p=parseInt(m.getAttribute("x"),10),x=parseInt(m.getAttribute("y"),10),g=ie(t,"DataValues");let y,v;if(g&&(v=g.getAttribute("NoData"),null!=v&&(y=v.trim().split(" ").map(H=>parseFloat(H)))),ie(i,"MRF_META/CachedSource"))throw new j.Z("mrf:open","currently does not support MRF referencing other data files");const S=ie(i,"MRF_META/GeoTags"),b=ie(S,"BoundingBox");let I,R=!1;if(null!=b){const H=parseFloat(b.getAttribute("minx")),L=parseFloat(b.getAttribute("miny")),G=parseFloat(b.getAttribute("maxx")),re=parseFloat(b.getAttribute("maxy")),N=ae(S,"Projection")||"";let $;if("LOCAL_CS[]"!==N)if(N.toLowerCase().startsWith("epsg:")){const Y=Number(N.slice(5));isNaN(Y)||0===Y||($=new ne.Z({wkid:Y}))}else $=Ee(N);else R=!0,$=new ne.Z({wkid:3857});I=new ee.Z(H,L,G,re),I.spatialReference=$}else R=!0,I=new ee.Z({xmin:-.5,ymin:.5-c,xmax:a-.5,ymax:.5,spatialReference:new ne.Z({wkid:3857})});const w=ie(i,"MRF_META/Rsets"),Z=parseInt(w&&w.getAttribute("scale")||"2",10),O=I.spatialReference,z=new we.Z({origin:new te.Z({x:I.xmin,y:I.ymax,spatialReference:O}),blockWidth:p,blockHeight:x,pyramidBlockWidth:p,pyramidBlockHeight:x,compression:f,pyramidScalingFactor:Z}),F=new te.Z({x:I.width/a,y:I.height/c,spatialReference:O}),T=new Te.Z({width:a,height:c,extent:I,isPseudoSpatialReference:R,spatialReference:O,bandCount:u,pixelType:d,pixelSize:F,noDataValue:y,storageInfo:z}),D=ae(i,"datafile"),B=ae(i,"IndexFile");return{rasterInfo:T,files:{mrf:this.url,index:B||this.url.replace(".mrf",".idx"),data:D||this.url.replace(".mrf",de.get(f).blobExtension)}}}_fetchAuxiliaryData(i){var t=this;return(0,E.Z)(function*(){try{const{data:s}=yield t.request(t.url+".aux.xml",{responseType:"xml",signal:null==i?void 0:i.signal});return $e(s)}catch(s){return null}})()}};(0,P._)([(0,k.Cb)()],be.prototype,"_files",void 0),(0,P._)([(0,k.Cb)()],be.prototype,"_storageIndex",void 0),(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],be.prototype,"datasetFormat",void 0),be=(0,P._)([(0,ue.j)("esri.layers.support.rasterIO.MRFRaster")],be);const tr=be;var Be=C(93122),Le=C(635);const at=(i,t)=>{const s=i.get(t);return s&&s.values},We=(i,t)=>{const s=i.get(t);return s&&s.values[0]};let ge=class extends Ie{constructor(){super(...arguments),this._files=null,this._headerInfo=null,this._bufferSize=1048576,this.datasetFormat="TIFF"}open(i){var t=this;return(0,E.Z)(function*(){var $,Y,Q,V;yield t.init();const s=i?(0,M.Wg)(i.signal):null,{data:a}=yield t.request(t.url,{range:{from:0,to:t._bufferSize},responseType:"array-buffer",signal:s});if(!a)throw new j.Z("tiffraster:open","failed to open url "+t.url);t.datasetName=t.url.slice(t.url.lastIndexOf("/")+1);const{littleEndian:c,firstIFD:u,isBigTiff:f}=(0,Be.cK)(a),h=[];yield t._readIFDs(h,a,c,u,0,f?8:4,s);const d=(0,Be.FI)(h),{width:m,height:p,tileWidth:x,tileHeight:g,planes:y,pixelType:v,compression:S,firstPyramidLevel:b,maximumPyramidLevel:I,pyramidBlockWidth:R,pyramidBlockHeight:w,tileBoundary:Z,affine:O,metadata:z}=d;let T=Ee((null==($=d.extent.spatialReference)?void 0:$.wkt)||(null==(Y=d.extent.spatialReference)?void 0:Y.wkid)),D=!1;null==T&&(D=!0,T=new ne.Z({wkid:3857}));const B=new ee.Z(q(A({},d.extent),{spatialReference:T})),H=new te.Z(B?{x:B.xmin,y:B.ymax,spatialReference:T}:{x:0,y:0}),L=new we.Z({blockWidth:x,blockHeight:g,pyramidBlockWidth:R,pyramidBlockHeight:w,compression:S,origin:H,firstPyramidLevel:b,maximumPyramidLevel:I,blockBoundary:Z}),G=new te.Z({x:(B.xmax-B.xmin)/m,y:(B.ymax-B.ymin)/p,spatialReference:T}),N=new Te.Z({width:m,height:p,bandCount:y,pixelType:v,compression:S,pixelSize:G,storageInfo:L,spatialReference:T,isPseudoSpatialReference:D,keyProperties:z?{BandProperties:z.bandProperties,DataType:z.dataType}:{},extent:B,statistics:z?z.statistics:null});if(null!=O&&O.length&&(N.nativeExtent=new ee.Z({xmin:-.5,ymin:.5-p,xmax:m-.5,ymax:.5,spatialReference:T}),N.transform=new _e.Z({polynomialOrder:1,forwardCoefficients:[O[2]+O[0]/2,O[5]-O[3]/2,O[0],O[3],-O[1],-O[4]]}),N.extent=N.transform.forwardTransform(N.nativeExtent),N.pixelSize=new te.Z({x:(B.xmax-B.xmin)/m,y:(B.ymax-B.ymin)/p,spatialReference:T}),L.origin.x=-.5,L.origin.y=.5),null==(Q=t.ioConfig.skipExtensions)||!Q.includes("aux.xml")){const W=yield t._fetchAuxiliaryData(i);if(null!=W){if(N.statistics=null!=(V=W.statistics)?V:N.statistics,N.histograms=W.histograms,W.histograms&&(0,M.Wi)(N.statistics)&&(N.statistics=(0,Ze.Oh)(W.histograms)),W.transform&&!O){N.transform=W.transform,N.nativeExtent=N.extent;const oe=N.transform.forwardTransform(N.nativeExtent);N.pixelSize=new te.Z({x:(oe.xmax-oe.xmin)/m,y:(oe.ymax-oe.ymin)/p,spatialReference:T}),N.extent=oe}N.spatialReference||(N.spatialReference=W.spatialReference)}}if(t._set("rasterInfo",N),t._headerInfo=A({littleEndian:c,isBigTiff:f,ifds:h},d),!t._headerInfo.isSupported)throw new j.Z("tiffraster:open","this tiff is not supported: "+t._headerInfo.message);t.updateTileInfo()})()}fetchRawTile(i,t,s,a={}){var c=this;return(0,E.Z)(function*(){var z;if(null==(z=c._headerInfo)||!z.isSupported||c.isBlockOutside(i,t,s))return null;const u=c._getTileLocation(i,t,s);if(!u)return null;const{ranges:f,actualTileWidth:h,actualTileHeight:d,ifd:m}=u,p=f.map(F=>c.request(c.url,{range:F,responseType:"array-buffer",signal:a.signal})),x=yield Promise.all(p),g=x.map(F=>F.data.byteLength).reduce((F,T)=>F+T),y=1===x.length?x[0].data:new ArrayBuffer(g),v=[0],S=[0];if(x.length>1){const F=new Uint8Array(y);for(let T=0,D=0;T<x.length;T++){const B=x[T].data;F.set(new Uint8Array(B),D),v[T]=D,D+=B.byteLength,S[T]=B.byteLength}}const{blockWidth:b,blockHeight:I}=c.getBlockWidthHeight(i),R=yield c.decodePixelBlock(y,{format:"tiff",customOptions:{headerInfo:c._headerInfo,ifd:m,offsets:v,sizes:S},width:b,height:I,planes:null,pixelType:null});let w,Z,O;if(h!==b||d!==I){let F=R.mask;if(F)for(w=0;w<I;w++)if(O=w*b,w<d)for(Z=h;Z<b;Z++)F[O+Z]=0;else for(Z=0;Z<b;Z++)F[O+Z]=0;else for(F=new Uint8Array(b*I),R.mask=F,w=0;w<d;w++)for(O=w*b,Z=0;Z<h;Z++)F[O+Z]=1}return R})()}_readIFDs(i,t,s,a,c,u=4,f){var h=this;return(0,E.Z)(function*(){if(!a)return null;(a>=t.byteLength||a<0)&&(t=(yield h.request(h.url,{range:{from:a+c,to:a+c+h._bufferSize},responseType:"array-buffer",signal:f})).data,c=a+c,a=0);const d=yield h._readIFD(t,s,a,c,Le.Z.TIFF_TAGS,u,f);if(i.push(d.ifd),!d.nextIFD)return null;yield h._readIFDs(i,t,s,d.nextIFD-c,c,u,f)})()}_readIFD(i,t,s,a,c=Le.Z.TIFF_TAGS,u=4,f){var h=this;return(0,E.Z)(function*(){if(!i)return null;const d=(0,Be.vr)(i,t,s,a,c,u);if(d.success){const m=[];if(d.ifd.forEach(p=>{p.values||m.push(p)}),m.length>0){const p=m.map(g=>g.offlineOffsetSize),x=Math.min.apply(null,p.map(g=>g[0]));if(Math.min.apply(null,p.map(g=>g[0]+g[1]))-x<=h._bufferSize){const{data:g}=yield h.request(h.url,{range:{from:x,to:x+h._bufferSize},responseType:"array-buffer",signal:f});i=g,a=x,m.forEach(y=>(0,Be.Dq)(i,t,y,a))}}if(d.ifd.has("GEOKEYDIRECTORY")){const p=d.ifd.get("GEOKEYDIRECTORY"),x=p.values;if(x&&x.length>4){const g=x[0]+"."+x[1]+"."+x[2],y=yield h._readIFD(i,t,p.valueOffset+6-a,a,Le.Z.GEO_KEYS,2,f);p.data=y.ifd,p.data&&p.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[g]})}}return d}return d.requiredBufferSize&&d.requiredBufferSize!==i.byteLength?(i=(yield h.request(h.url,{range:{from:a,to:a+d.requiredBufferSize+4},responseType:"array-buffer",signal:f})).data).byteLength<d.requiredBufferSize?null:h._readIFD(i,t,0,a,Le.Z.TIFF_TAGS,4,f):void 0})()}_getTileLocation(i,t,s){const{firstPyramidLevel:a,blockBoundary:c}=this.rasterInfo.storageInfo,u=0===i?0:i-(a-1),f=this._headerInfo.ifds[u];if(!f)return null;const h=(0,Be.If)(f,this._headerInfo),d=at(f,"TILEOFFSETS");if(void 0===d)return null;const m=at(f,"TILEBYTECOUNTS"),{minRow:p,minCol:x,maxRow:g,maxCol:y}=c[u];if(t>g||s>y||t<p||s<x)return null;const v=We(f,"IMAGEWIDTH"),S=We(f,"IMAGELENGTH"),b=We(f,"TILEWIDTH"),I=We(f,"TILELENGTH"),R=h?this.rasterInfo.bandCount:1,w=R*t*(y+1)+s,Z=[{from:d[w],to:d[w+R-1]+m[w+R-1]-1}];if(h){let F=!0;for(let T=0;T<R;T++)if(d[w+T]+m[w+T]!==d[w+T+1]){F=!1;break}if(!F)for(let T=0;T<R;T++)Z[T]={from:d[w+T],to:d[w+T]+m[w+T]-1}}return null==d[w]||null==m[w]?null:{ranges:Z,ifd:f,actualTileWidth:s===y?v%b:b,actualTileHeight:t===g?S%I:I}}_fetchAuxiliaryData(i){var t=this;return(0,E.Z)(function*(){try{const{data:s}=yield t.request(t.url+".aux.xml",{responseType:"xml",signal:null==i?void 0:i.signal});return $e(s)}catch(s){return null}})()}};(0,P._)([(0,k.Cb)()],ge.prototype,"_files",void 0),(0,P._)([(0,k.Cb)()],ge.prototype,"_headerInfo",void 0),(0,P._)([(0,k.Cb)()],ge.prototype,"_bufferSize",void 0),(0,P._)([(0,k.Cb)({type:String,json:{write:!0}})],ge.prototype,"datasetFormat",void 0),ge=(0,P._)([(0,ue.j)("esri.layers.support.rasterDatasets.TIFFRaster")],ge);const rr=ge,K=new Map;K.set("CRF",{desc:"Cloud Raster Format",constructor:Jt}),K.set("MRF",{desc:"Meta Raster Format",constructor:tr}),K.set("TIFF",{desc:"GeoTIFF",constructor:rr}),K.set("RasterTileServer",{desc:"Raster Tile Server",constructor:Qt}),K.set("JPG",{desc:"JPG Raster Format",constructor:Ne}),K.set("PNG",{desc:"PNG Raster Format",constructor:Ne}),K.set("GIF",{desc:"GIF Raster Format",constructor:Ne}),K.set("BMP",{desc:"BMP Raster Format",constructor:Ne});var ir=C(49430);let J=class extends((0,It.h)((0,Bt.M)((0,Pt.q)((0,Mt.I)((0,vt.N)(wt((0,kt.n)((0,Ft.Q)((0,dt.R)(xt.Z)))))))))){constructor(...i){super(...i),this.bandIds=null,this.interpolation=null,this.legendEnabled=!0,this.isReference=null,this.listMode="show",this.sourceJSON=null,this.version=null,this.title=null,this.type="imagery-tile",this.operationalLayerType="ArcGISTiledImageServiceLayer",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null}normalizeCtorArgs(i,t){return"string"==typeof i?A({url:i},t):i}load(i){const t=(0,M.pC)(i)?i.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},i).catch(Se.r9).then(()=>this._openRaster(t))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){var c,u,f;let i=[new Re.Z({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})];const t=null==(u=null==(c=this.rasterInfo)?void 0:c.attributeTable)?void 0:u.fields;if(t){const h=t.filter(d=>"oid"!==d.type&&"value"!==d.name.toLowerCase()).map(d=>{const m=d.clone();return m.name="Raster."+d.name,m});i=i.concat(h)}const a=this.rasterInfo.dataType;if(("vector-magdir"===a||"vector-uv"===a)&&(0,M.pC)(this.rasterInfo.multidimensionalInfo)){const h=null==(f=this.rasterInfo.multidimensionalInfo.variables[0].unit)?void 0:f.trim();i.push(new Re.Z({name:"Raster.Magnitude",alias:"Magnitude"+(h?` (${h})`:""),domain:null,editable:!1,type:"double"})),i.push(new Re.Z({name:"Raster.Direction",alias:"Direction (\xb0)",domain:null,editable:!1,type:"double"}))}return i}set renderer(i){this._set("renderer",i),this.updateRenderer()}readRenderer(i,t,s){const c=(0,ke.ij)(t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,s)||void 0;if(null!=c)return c}createPopupTemplate(i){return(0,ir.eZ)({fields:this.rasterFields,title:this.title},i)}write(i,t){const{raster:s}=this;return(this.loaded?"RasterTileServer"===s.datasetFormat&&("Raster"===s.tileType||"Map"===s.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))?super.write(i,t):(t&&t.messages&&t.messages.push(new j.Z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${t.origin}/${t.layerContainerType||"operational-layers"}'`,{layer:this})),null)}_openRaster(i){var t=this;return(0,E.Z)(function*(){t.raster?(t.raster.rasterInfo||(yield t.raster.open()),t.url=t.raster.url):t.raster=yield class nr{static get supportedFormats(){const t=new Set;return K.forEach((s,a)=>t.add(a)),t}static open(t){var s=this;return(0,E.Z)(function*(){const{url:a,ioConfig:c,sourceJSON:u}=t;let f=t.datasetFormat;null==f&&a.lastIndexOf(".")&&(f=a.slice(a.lastIndexOf(".")+1).toUpperCase()),"OVR"===f||"TIF"===f?f="TIFF":"JPG"!==f&&"JPEG"!==f&&"JFIF"!==f||(f="JPG"),a.toLowerCase().includes("/imageserver")&&!a.toLowerCase().includes("/wcsserver")&&(f="RasterTileServer");const h={url:a,sourceJSON:u,datasetFormat:f,ioConfig:c||{bandIds:null,sampling:null}};let d,m;if(s.supportedFormats.has(f)){if("CRF"===f&&!c.enableCRF)throw new j.Z("rasterfactory:open",`cannot open raster: ${a}`);return d=K.get(f).constructor,m=new d(h),yield m.open({signal:t.signal}),m}if(f)throw new j.Z("rasterfactory:open","not a supported format "+f);const p=Array.from(K.keys());let x=0;const g=()=>(f=p[x++],f&&("CRF"!==f||c.enableCRF)?(d=K.get(f).constructor,m=new d(h),m.open({signal:t.signal}).then(()=>m).catch(()=>g())):null);return g()})()}static register(t,s,a){K.has(t.toUpperCase())||K.set(t.toUpperCase(),{desc:s,constructor:a})}}.open({url:t.url,sourceJSON:t.sourceJSON,ioConfig:q(A({sampling:"closest"},t.ioConfig),{customFetchParameters:t.customParameters}),signal:i});const{rasterInfo:s}=t.raster;if(!s)throw new j.Z("imagery-tile-layer:load","cannot load resources on "+t.url);if(t.sourceJSON=t.sourceJSON||t.raster.sourceJSON,null!=t.sourceJSON){const a="Map"===t.raster.tileType&&null!=t.sourceJSON.minLOD&&null!=t.sourceJSON.maxLOD?t.sourceJSON:q(A({},t.sourceJSON),{minScale:0,maxScale:0});t.read(a,{origin:"service"})}null==t.title&&(t.title=t.raster.datasetName),"Map"===t.raster.tileType&&(t.popupEnabled=!1),t._configDefaultSettings(),t.own((0,mt.YP)(()=>t.customParameters,a=>{t.raster.ioConfig.customFetchParameters=a}))})()}};(0,P._)([(0,k.Cb)({type:[pt.z8],json:{write:{overridePolicy(){var i;return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==(null==(i=this.bandIds)?void 0:i.join(","))}}}}})],J.prototype,"bandIds",void 0),(0,P._)([(0,k.Cb)({json:{write:{overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,yt.J)(Dt.c)],J.prototype,"interpolation",void 0),(0,P._)([(0,k.Cb)({json:{write:!0}})],J.prototype,"multidimensionalDefinition",void 0),(0,P._)([(0,k.Cb)(Je.rn)],J.prototype,"legendEnabled",void 0),(0,P._)([(0,k.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],J.prototype,"isReference",void 0),(0,P._)([(0,k.Cb)({type:["show","hide"]})],J.prototype,"listMode",void 0),(0,P._)([(0,k.Cb)({json:{read:!0,write:!0}})],J.prototype,"blendMode",void 0),(0,P._)([(0,k.Cb)()],J.prototype,"sourceJSON",void 0),(0,P._)([(0,k.Cb)({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],J.prototype,"version",void 0),(0,P._)([(0,k.Cb)()],J.prototype,"title",void 0),(0,P._)([(0,k.Cb)({readOnly:!0,json:{read:!1}})],J.prototype,"type",void 0),(0,P._)([(0,k.Cb)({type:["ArcGISTiledImageServiceLayer"]})],J.prototype,"operationalLayerType",void 0),(0,P._)([(0,k.Cb)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(i,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer(i,t,s){t[s]=!i}}}})],J.prototype,"popupEnabled",void 0),(0,P._)([(0,k.Cb)({type:ft.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],J.prototype,"popupTemplate",void 0),(0,P._)([(0,k.Cb)({readOnly:!0})],J.prototype,"defaultPopupTemplate",null),(0,P._)([(0,k.Cb)({readOnly:!0,type:[Re.Z]})],J.prototype,"fields",void 0),(0,P._)([(0,k.Cb)({readOnly:!0,type:[Re.Z]})],J.prototype,"rasterFields",null),(0,P._)([(0,k.Cb)({types:ke.dr,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy(){var t;const i="raster-stretch"===(null==(t=this.renderer)?void 0:t.type)&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!i}}},origins:{"web-scene":{types:ke.FK,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:i=>({enabled:i&&"vector-field"!==i.type&&"flow"!==i.type})}}}}})],J.prototype,"renderer",null),(0,P._)([(0,gt.r)("renderer")],J.prototype,"readRenderer",null),J=(0,P._)([(0,ue.j)("esri.layers.ImageryTileLayer")],J);const sr=J}}]);