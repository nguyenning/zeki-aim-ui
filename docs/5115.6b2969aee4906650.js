"use strict";var $r=Object.defineProperty,li=Object.getOwnPropertySymbols,Br=Object.prototype.hasOwnProperty,Dr=Object.prototype.propertyIsEnumerable,si=(re,Z,v)=>Z in re?$r(re,Z,{enumerable:!0,configurable:!0,writable:!0,value:v}):re[Z]=v,ae=(re,Z)=>{for(var v in Z||(Z={}))Br.call(Z,v)&&si(re,v,Z[v]);if(li)for(var v of li(Z))Dr.call(Z,v)&&si(re,v,Z[v]);return re};(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[5115],{59990:(re,Z,v)=>{function S(V){var te;const B=V.layer;return"floorInfo"in B&&(null==(te=B.floorInfo)?void 0:te.floorField)&&"floors"in V.view?Q(V.view.floors,B.floorInfo.floorField):null}function q(V,B){var te;return"floorInfo"in B&&(null==(te=B.floorInfo)?void 0:te.floorField)?Q(V,B.floorInfo.floorField):null}function Q(V,B){if(null==V||!V.length)return null;const te=V.filter(O=>""!==O).map(O=>`'${O}'`);return te.push("''"),`${B} IN (${te.join(",")}) OR ${B} IS NULL`}v.d(Z,{c:()=>S,f:()=>q})},13410:(re,Z,v)=>{v.d(Z,{FN:()=>V,QV:()=>Q,ac:()=>te});var S=v(62208),q=v(31283);function Q(O,X,C){return X.flatten(({sublayers:x})=>x).length!==O.length||!!O.some(x=>x.originIdOf("minScale")>C||x.originIdOf("maxScale")>C||x.originIdOf("renderer")>C||x.originIdOf("labelingInfo")>C||x.originIdOf("opacity")>C||x.originIdOf("labelsVisible")>C||x.originIdOf("source")>C)||!B(O,X)}function V(O,X,C){return!!O.some(N=>{const x=N.source;return!(!x||"map-layer"===x.type&&x.mapLayerId===N.id&&((0,S.Wi)(x.gdbVersion)||x.gdbVersion===C))||N.originIdOf("renderer")>q.s3.SERVICE||N.originIdOf("labelingInfo")>q.s3.SERVICE||N.originIdOf("opacity")>q.s3.SERVICE||N.originIdOf("labelsVisible")>q.s3.SERVICE})||!B(O,X)}function B(O,X){if(!O||!O.length||(0,S.Wi)(X))return!0;const C=X.slice().reverse().flatten(({sublayers:j})=>j&&j.toArray().reverse()).map(j=>j.id).toArray();if(O.length>C.length)return!1;let N=0;const x=C.length;for(const{id:j}of O){for(;N<x&&C[N]!==j;)N++;if(N>=x)return!1}return!0}function te(O){return!!O&&O.some(X=>null!=X.minScale||X.layerDefinition&&null!=X.layerDefinition.minScale)}},50134:(re,Z,v)=>{v.d(Z,{e:()=>B,s:()=>te}),v(8314);var q=v(26584),Q=v(62208),V=v(70137);function B(x){return(0,Q.Wi)(x)||"simple"===x.type||"unique-value"===x.type||"class-breaks"===x.type||"dictionary"===x.type||"heatmap"===x.type}function te(x){if((0,Q.Wi)(x))return null;if(!B(x))return new q.Z("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${x.type||x.declaredClass}'`,{renderer:x});switch(x.type){case"simple":return function X(x){return O(x,(0,V.q)(x.symbol).error)}(x);case"unique-value":return function C(x){const j=x.uniqueValueInfos.map(K=>(0,V.q)(K.symbol).error).filter(K=>!!K),ee=(0,V.q)(x.defaultSymbol);return ee.error&&j.unshift(ee.error),O(x,j)}(x);case"class-breaks":return function N(x){const j=x.classBreakInfos.map(K=>(0,V.q)(K.symbol).error).filter(K=>!!K),ee=(0,V.q)(x.defaultSymbol);return ee.error&&j.unshift(ee.error),O(x,j)}(x);case"dictionary":case"heatmap":return null}return null}function O(x,j){if(!j)return null;let ee;if(ee=Array.isArray(j)?j:[j],ee.length>0){const K=ee.map(M=>M.details.symbol.type||M.details.symbol.declaredClass).filter(M=>!!M);K.sort();const Ge=[];return K.forEach((M,ve)=>{0!==ve&&M===K[ve-1]||Ge.push(M)}),new q.Z("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${Ge.join(", ")}) which are not supported in 3D`,{renderer:x,symbolErrors:ee})}return null}},38943:(re,Z,v)=>{v.r(Z),v.d(Z,{default:()=>Pr});var S=v(17626),q=v(72392),Q=v(62208),V=v(32917),B=v(83960),O=(v(85931),v(8314)),X=v(66656),C=v(77712),N=v(76898),x=v(10391),ee=(v(52515),v(14517)),K=v(46160),M=(v(90912),v(15861)),ve=v(91558),ni=v(24263),gt=v(84792),bt=v(20383),ai=v(2076),vt=v(63290),ue=v(10699),oe=v(23841),oi=v(21726),Ae=v(31283),Ue=v(58817),ci=v(29538),_t=v(53390);let se=class extends ee.Z{constructor(l){super(l),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,O.Z)("mapview-transitions-duration"),this.effects=[]}set effect(l){if(this._get("effect")!==(l=l||"")){this._set("effect",l);try{this._transitionTo(Lt(l))}catch(s){this._transitionTo([]),vt.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:l,error:s})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(l){this._updateForScale(l)}get transitioning(){return null!==this._to}canTransitionTo(l){try{return this.scale>0&&wt(this._current,Lt(l),this.scale)}catch(s){return!1}}transitionStep(l,s){this._applyTimeTransition(l),this._updateForScale(s)}end(){this._applyTimeTransition(this.duration)}_transitionTo(l){this.scale>0&&wt(this._current,l,this.scale)?(this._final=l,this._to=(0,Ue.d9)(l),function di(l,s,a){var h,f;const o=l.length>s.length?l:s,c=l.length>s.length?s:l,d=c[c.length-1],u=null!=(h=null==d?void 0:d.scale)?h:a,y=null!=(f=null==d?void 0:d.effects)?f:[];for(let m=c.length;m<o.length;m++)c.push({scale:u,effects:[...y]});for(let m=0;m<o.length;m++)c[m].scale=-1===c[m].scale?a:c[m].scale,o[m].scale=-1===o[m].scale?a:o[m].scale,(0,_t.uF)(c[m].effects,o[m].effects)}(this._current,this._to,this.scale),this._from=(0,Ue.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=l),this._set("effects",this._current[0]?(0,Ue.d9)(this._current[0].effects):[])}_applyTimeTransition(l){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=l;const s=Math.min(1,this._time/this.duration);for(let a=0;a<this._current.length;a++){const o=this._current[a],c=this._from[a],d=this._to[a];o.scale=ui(c.scale,d.scale,s);for(let u=0;u<o.effects.length;u++)o.effects[u].interpolate(c.effects[u],d.effects[u],s)}1===s&&(this._current=this._final,this._set("effects",this._current[0]?(0,Ue.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(l){if(this._set("scale",l),0===this._current.length)return;const s=this._current,a=this._current.length-1;let o,c,d=1;if(1===s.length||l>=s[0].scale)c=o=s[0].effects;else if(l<=s[a].scale)c=o=s[a].effects;else for(let u=0;u<a;u++){const y=s[u],h=s[u+1];if(y.scale>=l&&h.scale<=l){d=(l-y.scale)/(h.scale-y.scale),o=y.effects,c=h.effects;break}}for(let u=0;u<this.effects.length;u++)this.effects[u].interpolate(o[u],c[u],d)}};function Lt(l){const s=(0,ci.Q)(l)||[];return function yi(l){const s=l[0];return!!s&&"type"in s}(s)?[{scale:-1,effects:s}]:s}function wt(l,s,a){var o,c,d,u;return null==(o=l[0])||!o.effects||null==(c=s[0])||!c.effects||!((-1===(null==(d=l[0])?void 0:d.scale)||-1===(null==(u=s[0])?void 0:u.scale))&&(l.length>1||s.length>1)&&a<=0)&&(0,_t.AS)(l[0].effects,s[0].effects)}function ui(l,s,a){return l+(s-l)*a}(0,S._)([(0,C.Cb)()],se.prototype,"_to",void 0),(0,S._)([(0,C.Cb)()],se.prototype,"duration",void 0),(0,S._)([(0,C.Cb)({value:""})],se.prototype,"effect",null),(0,S._)([(0,C.Cb)({readOnly:!0})],se.prototype,"effects",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],se.prototype,"hasEffects",null),(0,S._)([(0,C.Cb)({value:0})],se.prototype,"scale",null),(0,S._)([(0,C.Cb)({readOnly:!0})],se.prototype,"transitioning",null),se=(0,S._)([(0,N.j)("esri.layers.effects.EffectView")],se);var hi=v(71149),fi=v(14772),pi=v(36630),mi=v(33474),gi=v(50134),bi=v(24729),St=v(56445),vi=v(71131),_i=v(34057),ne=v(3854),fe=v(86606),Li=v(80239),Pe=v(88380),Ci=v(26831),Je=v(74741),Ii=v(66960);const Ct={HH:315,HL:45,LL:135,LH:225},Ei={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function Ri(l){if(!l)return;const{type:s}=l;if(s.includes("3d"))return(0,Ii.getSymbolLayerFill)(l.symbolLayers.getItemAt(0));if("simple-line"===s){const a=(0,Je.mx)(l);return a&&a.color}if("simple-marker"===l.type&&("x"===l.style||"cross"===l.style)){const a=(0,Je.mx)(l);return a&&a.color}return(0,Je._M)(l)}function Vi(l,s){const a=s.HH.label,o=s.LL.label,c=s.HL.label,d=s.LH.label;switch(l){case"HH":default:return{top:a,bottom:o,left:c,right:d};case"HL":return{top:c,bottom:d,left:o,right:a};case"LL":return{top:o,bottom:a,left:d,right:c};case"LH":return{top:d,bottom:c,left:a,right:o}}}function It(l){let s=Ct[l];return l&&null==s&&(s=Ct.HH),s||0}var ce=v(98494),ye=v(18722),pe=v(38570),zi=v(64183),_e=v(57213),Ti=v(52068);const Et=[255,255,255],Rt=[200,200,200],Le=[128,128,128];function Di(l,s){const a=l.length-1;return l.map((o,c)=>(0,ye.MN)(o,c,a,s))}function Oi(l,s,a,o,c,d){return Ke.apply(this,arguments)}function Ke(){return Ke=(0,M.Z)(function*(l,s,a,o,c,d){const u=s.legendOptions,y=u&&u.customValues,h=yield ki(l,a),_=s.stops&&s.stops.length>1;if(!h||!y&&!(null!=s.minSize&&null!=s.maxSize||_&&!s.target))return;const w=(0,fe.YW)(h);let R=null,I=null,P=null;I=w&&!_?(0,ce.NM)([s.minDataValue,s.maxDataValue]):y||(yield Zi(s,h,o,c));const b=null==l?void 0:l.authoringInfo,F="univariate-color-size"===(null==b?void 0:b.type),z=F&&"above-and-below"===(null==b?void 0:b.univariateTheme);if(!I&&_&&(I=s.stops.map(U=>U.value),R=s.stops.some(U=>!!U.label),"flow"===l.type&&(I=(0,ce.NM)(I)),R&&(P=s.stops.map(U=>U.label))),w&&(null==I?void 0:I.length)>2&&!z&&(I=[I[0],I[I.length-1]]),!I)return null;F&&5!==(null==I?void 0:I.length)&&(I=zt({minSize:I[0],maxSize:I[I.length-1]}));const A=w?Ui(l,I):null,D=(0,fe.Y6)(h),G=R?null:Di(I,d);return(yield Promise.all(I.map(function(){var U=(0,M.Z)(function*(H,J){const Fe=w?A[J]:yield we(s,h,H,o,c);return{value:H,symbol:Yi(z&&"class-breaks"===l.type?Ni(l,J):h,Fe),label:R?P[J]:G[J],size:Fe,outlineSize:D}});return function(H,J){return U.apply(this,arguments)}}()))).reverse()}),Ke.apply(this,arguments)}function Ui(l,s){const a=null==l?void 0:l.authoringInfo,o="univariate-color-size"===(null==a?void 0:a.type);let c=[12,30];if(o){const d=s[0],u=s[s.length-1],y=12,h=30;c=s.map(f=>y+(f-d)/(u-d)*(h-y))}return o&&"below"===(null==a?void 0:a.univariateTheme)&&c.reverse(),c}function Ni(l,s){const a=l.classBreakInfos,o=a.length,c=o<2||!(s>=2)?a[0].symbol.clone():a[o-1].symbol.clone();return l.visualVariables.some(d=>"color"===d.type)&&(c.type.includes("3d")?Vt(c):xt(c)),c}function ki(l,s){return qe.apply(this,arguments)}function qe(){return(qe=(0,M.Z)(function*(l,s){var c;if("flow"===l.type)return(0,ye.y$)(l,s);if("pie-chart"===l.type)return new _e.Z({color:null,outline:null!=(c=l.outline)&&c.width?l.outline:new Ti.Z});let a=null,o=null;if("simple"===l.type)a=l.symbol;else if("class-breaks"===l.type){const d=l.classBreakInfos;a=d&&d[0]&&d[0].symbol,o=d.length>1}else if("unique-value"===l.type){const d=l.uniqueValueInfos;a=d&&d[0]&&d[0].symbol,o=d.length>1}return!a||Hi(a)?null:(a=a.clone(),(s||o)&&(a.type.includes("3d")?Vt(a):xt(a)),a)})).apply(this,arguments)}function Hi(l){return!!l&&((0,bt.dU)(l)?!!l.symbolLayers&&l.symbolLayers.some(s=>s&&"fill"===s.type):l.type.includes("fill"))}function Vt(l){l.symbolLayers.forEach("line-3d"===l.type?s=>{s.material={color:Le}}:s=>{"icon"!==s.type||s.resource&&s.resource.href?s.material={color:Rt}:(s.material={color:Et},s.outline={color:Le,size:1.5})})}function xt(l){var a,o;const s=(0,zi.$o)();"cim"===l.type?(0,St.ZB)(l,new ve.Z(Rt)):l.type.includes("line")?l.color=Le:(l.color=s?Le:Et,"simple-marker"===l.type&&(l.outline?"#ffffff"===(null==(o=null==(a=l.outline)?void 0:a.color)?void 0:o.toHex())&&(l.outline.color=Le):l.outline={color:Le,width:1.5}))}function Zi(l,s,a,o){return et.apply(this,arguments)}function et(){return(et=(0,M.Z)(function*(l,s,a,o){const c=(yield Promise.resolve().then(v.bind(v,81808))).getSizeRangeAtScale(l,a,o),d=c&&zt(c);if(!c&&!d)return;let u=d.map(y=>Wi(y,l,c));u=(0,ce.NM)(u);for(let y=1;y<u.length-1;y++){const h=yield ji(l,s,u[y],u[y-1],a,o);h&&(u[y]=h[0],d[y]=h[1])}return u})).apply(this,arguments)}function zt(l){const s=l.minSize,c=(l.maxSize-s)/4,d=[];for(let u=0;u<5;u++)d.push(s+c*u);return d}function Wi(l,s,a){const o=a.minSize,c=a.maxSize,d=s.minDataValue,u=s.maxDataValue;let y=null;return y=l<=o?d:l>=c?u:(l-o)/(c-o)*(u-d)+d,y}function ji(l,s,a,o,c,d){return tt.apply(this,arguments)}function tt(){return(tt=(0,M.Z)(function*(l,s,a,o,c,d){const u=yield we(l,s,a,c,d),y=yield we(l,s,o,c,d),h=(0,ce.D2)(a);let g=h.integer,_=null,L=null;a>0&&a<1&&(_=10**h.fractional,g=(0,ce.D2)(a*=_).integer);for(let w=g-1;w>=0;w--){const R=10**w;let I=Math.floor(a/R)*R,P=Math.ceil(a/R)*R;null!=_&&(I/=_,P/=_);let b=(I+P)/2;[,b]=(0,ce.NM)([I,b,P],{indexes:[1]});const F=yield we(l,s,I,c,d),z=yield we(l,s,P,c,d),A=yield we(l,s,b,c,d),D=(0,ce.f1)(u,F,y,null),G=(0,ce.f1)(u,z,y,null),U=(0,ce.f1)(u,A,y,null);let H=D.previous<=20,J=G.previous<=20;if(H&&J&&(D.previous<=G.previous?(H=!0,J=!1):(J=!0,H=!1)),H?L=[I,F]:J?L=[P,z]:U.previous<=20&&(L=[b,A]),L)break}return L})).apply(this,arguments)}function we(l,s,a,o,c){return it.apply(this,arguments)}function it(){return(it=(0,M.Z)(function*(l,s,a,o,c){const{getSize:d}=yield Promise.resolve().then(v.bind(v,81808));return d(l,a,{scale:o,view:c,shape:"simple-marker"===s.type?s.style:null})})).apply(this,arguments)}function Yi(l,s){const a=l.clone();if((0,bt.dU)(a))(0,fe.YW)(a)||a.symbolLayers.forEach(o=>{"fill"!==o.type&&(o.size=s)});else if(function Mi(l){return"esri.symbols.SimpleMarkerSymbol"===l.declaredClass}(a))a.size=s;else if(function Pi(l){return"esri.symbols.PictureMarkerSymbol"===l.declaredClass}(a)){const o=a.width,c=a.height;a.height=s,a.width=s*(o/c)}else!function $i(l){return"esri.symbols.SimpleLineSymbol"===l.declaredClass}(a)?function Bi(l){return"esri.symbols.TextSymbol"===l.declaredClass}(a)&&a.font&&(a.font.size=s):a.width=s;return a}v(88411);var Tt=v(15348);v(64831);var Ft=v(88493);const he=vt.Z.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),Ne=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,qi=new ai.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),At={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},ke=new _e.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),er=new Ft.Z({style:"solid"});function rt(l){return"flow"===l.type}function Mt(l){return"vector-field"===l.type}function Pt(l){return"raster-colormap"===l.type}function $t(l){return"raster-stretch"===l.type}function Bt(l){return"raster-shaded-relief"===l.type}function Se(l){return"esri.renderers.SimpleRenderer"===l.declaredClass}function Ce(l){return"esri.renderers.ClassBreaksRenderer"===l.declaredClass}function lt(l){return"esri.renderers.UniqueValueRenderer"===l.declaredClass}function Dt(l){return"esri.renderers.HeatmapRenderer"===l.declaredClass}function st(l){return"esri.renderers.PointCloudClassBreaksRenderer"===l.declaredClass}function nt(l){return"esri.renderers.PointCloudStretchRenderer"===l.declaredClass}function at(l){return"esri.renderers.PointCloudUniqueValueRenderer"===l.declaredClass}function Ot(l){return"esri.renderers.DotDensityRenderer"===l.declaredClass}function Ut(l){return"esri.renderers.PieChartRenderer"===l.declaredClass}function Nt(l){return"esri.layers.BuildingSceneLayer"===l.declaredClass}function kt(l){return"esri.layers.MapImageLayer"===l.declaredClass}function $e(l){return"esri.layers.ImageryLayer"===l.declaredClass}function ot(l){return"esri.layers.ImageryTileLayer"===l.declaredClass}const hr=new _e.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Ie={},k=class extends ee.Z{constructor(l){super(l),this._handles=new q.Z,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new K.Z,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const l=()=>this.notifyChange("ready");this._handles.add([(0,V.on)(()=>this.children,"change",s=>{const{added:a,removed:o}=s,c=this._handles;a.forEach(d=>{const u=`activeLayerInfo-ready-watcher-${d.layer.uid}`;c.add((0,V.YP)(()=>d.ready,l,V.nn),u)}),o.forEach(d=>c.remove(d.layer.uid)),l()})]),this.keepCacheOnDestroy||(Ie={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Ie=null)}get effectList(){const l=this.layer;let s=null;return"effect"in l&&l.effect&&(s=new se,s.effect=l.effect,s.end(),s.scale=this.scale),s}get opacity(){var c;const l=this.layer.opacity,s=null==(c=this.parent)?void 0:c.opacity,a=this.layer.parent,o=a&&"uid"in a?this._getParentLayerOpacity(a):null;return null!=s?s*l:null!=o?o*l:l}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const l=this.layer;if(null===l)return!1;if("effect"in l&&l.effect&&Array.isArray(l.effect))return!0;if("featureReduction"in l&&l.featureReduction){if("cluster"===l.featureReduction.type)return!0;if("binning"===l.featureReduction.type&&"renderer"in l.featureReduction&&l.featureReduction.renderer)return this._isRendererScaleDriven(l.featureReduction.renderer)}return"renderer"in l&&l.renderer?this._isRendererScaleDriven(l.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}buildLegendElementsForFeatureCollections(l){var s=this;return(0,M.Z)(function*(){if(s.hideLayersNotInCurrentView&&!(yield s._isLayerInCurrentView()))return s.legendElements=[],void s.notifyChange("ready");const a=Array.from(l,o=>{if(function or(l){return"esri.layers.FeatureLayer"===l.declaredClass}(o))return s._getRendererLegendElements(o.renderer,{title:o.title});if(o.featureSet&&o.featureSet.features.length){const c=o.layerDefinition,d=c&&c.drawingInfo,u=d&&(0,mi.i)(d.renderer),y=qi.read(c.geometryType);return u?s._getRendererLegendElements(u,{title:o.name,geometryType:y}):(he.warn("drawingInfo not available!"),null)}return null});try{const o=[];yield(0,ue.as)(a).then(c=>{c.forEach(({value:d})=>d&&o.push(...d))}),s.legendElements=o,s.notifyChange("ready")}catch(o){he.warn("error while building legend for layer!",o)}})()}buildLegendElementsForRenderer(l){var s=this;return(0,M.Z)(function*(){try{const a=!s.hideLayersNotInCurrentView||(yield s._isLayerInCurrentView());s.legendElements=a?yield s._getRendererLegendElements(l):[],s.notifyChange("ready")}catch(a){he.warn("error while building legend for layer!",a)}})()}buildLegendElementsForTools(){var l=this;return(0,M.Z)(function*(){var a,o;const s=l.layer;if(function lr(l){return"esri.layers.VoxelLayer"===l.declaredClass}(s))l._constructLegendElementsForVoxellayer();else if(function nr(l){return"esri.layers.WMTSLayer"===l.declaredClass}(s))l._constructLegendElementsForWMTSlayer();else if(function sr(l){return"esri.layers.WMSLayer"===l.declaredClass}(s))yield l._constructLegendElementsForWMSSublayers();else if(Nt(s))yield l._constructLegendElementsForBuildingSceneLayer();else if(kt(s)||function ar(l){return"esri.layers.TileLayer"===l.declaredClass}(s)||Nt(s))yield l._constructLegendElementsForSublayers();else{l._handles.remove("imageryLayers-watcher");let c="default";$e(s)&&(c=((null==(a=null==s?void 0:s.renderingRule)?void 0:a.functionName)||"default")+"_"+(null!=(o=s.bandIds)&&o.length?s.bandIds.join(""):"###")),yield l._getLegendLayers(`${s.uid}-${c}`).then(function(){var d=(0,M.Z)(function*(u){l.legendElements=[],l.notifyChange("ready");const y=u.map(function(){var h=(0,M.Z)(function*(f){if($e(s)||ot(s)){const g=(0,V.YP)(()=>["renderingRule"in s&&s.renderingRule,s.bandIds],()=>(0,ue.Ds)((0,M.Z)(function*(){Ie.default=null,s.renderer?yield l.buildLegendElementsForRenderer(s.renderer):yield l.buildLegendElementsForTools()}))());l._handles.add(g,"imageryLayers-watcher")}const m=l._generateSymbolTableElementForLegendLayer(f);m&&m.infos.length&&($e(s)&&(m.title=s.title),l.legendElements.push(m)),l.notifyChange("ready")});return function(f){return h.apply(this,arguments)}}());yield(0,ue.as)(y)});return function(u){return d.apply(this,arguments)}}()).catch(d=>{he.warn("Request to server for legend has failed!",d)})}})()}_isLayerInCurrentView(){var l=this;return(0,M.Z)(function*(){const s=l.layer,a=l.layerView,o=a&&"createQuery"in a&&"queryFeatureCount"in a;if(!(o||a&&"createQuery"in s&&"queryFeatureCount"in s))return!0;yield(0,V.N1)(()=>!a.updating);const c=o?"createQuery"in a&&a.createQuery():"createQuery"in s&&s.createQuery();return c.geometry=l.view.extent,0!==(o?"queryFeatureCount"in a&&(yield a.queryFeatureCount(c)):"queryFeatureCount"in s&&(yield s.queryFeatureCount(c)))})()}_getParentLayerOpacity(l){let s=1;const a=l.parent;return a&&"uid"in a&&(s=this._getParentLayerOpacity(a)),l.opacity*s}_isGroupActive(){const l=this.children;return!!l.length&&l.some(s=>s.ready)}_isRendererScaleDriven(l){if("dot-density"===l.type)return!0;if(Ne.test("valueExpression"in l&&l.valueExpression))return!0;const a="visualVariables"in l&&l.visualVariables;return!!a&&a.some(o=>this._isScaleDrivenSizeVariable(o))}_isScaleDrivenSizeVariable(l){if(l&&"size"!==l.type)return!1;const s=l,a=s.minSize,o=s.maxSize;return"object"==typeof a&&a?this._isScaleDrivenSizeVariable(a):"object"==typeof o&&o?this._isScaleDrivenSizeVariable(o):!!s.expression||Ne.test(s.valueExpression)}_isLayerScaleDriven(l){if("minScale"in l&&l.minScale>0||"maxScale"in l&&l.maxScale>0)return!0;if("sublayers"in l&&l.sublayers)return l.sublayers.some(a=>this._isLayerScaleDriven(a));const s=l.parent;if(!1===l.loaded&&s&&kt(s)&&"source"in l&&l.source&&"map-layer"===l.source.type)for(const a of s.sourceJSON.layers)if(a.id===l.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0;return!1}_constructLegendElementsForVoxellayer(){var l=this;return(0,M.Z)(function*(){var u;l.legendElements=[],l._handles.remove("voxel-style-watcher");const s=l.layer;l._handles.add((0,V.YP)(()=>s.currentVariableId,()=>l._constructLegendElementsForVoxellayer()),"voxel-style-watcher");const a=(0,Q.Wg)(s.getVariableStyle(null)),o=[];if(a)if(null!=(u=a.uniqueValues)&&u.length){const y=[];a.uniqueValues.forEach(h=>{h.enabled&&y.push({label:h.label||`${h.value}`,value:h.value,symbol:new Ft.Z({color:h.color,outline:null})})}),y.length&&o.push({type:"symbol-table",title:a.label,infos:y})}else if(a.transferFunction){const{colorStops:y,stretchRange:h}=a.transferFunction,f=y.toArray().reverse(),m=h.map((_,L)=>`${0===L?ye.zZ:ye.Eh} ${function Gi(l){const a=Math.floor(Math.log10(Math.abs(l)))+1,o=a<4||a>6?4:a,d=Math.abs(l)>=1e6?"compact":"standard";return(0,Tt.uf)(l,{notation:d,minimumSignificantDigits:2,maximumSignificantDigits:o})}(_)}`).reverse(),g=f.map(_=>({color:_.color,value:null,label:null}));g[0].label=m[0],g[g.length-1].label=m[1],o.push({type:"color-ramp",title:a.label,infos:g,preview:(0,ne.jT)(f.map(_=>_.color))})}const c=s.opacity,d=o.reduce((y,h)=>y.concat(l._getAllInfos(h)),[]).filter(y=>!(null==y||!y.symbol)).map(y=>l._getSymbolPreview(y,c));yield(0,ue.as)(d),l.legendElements=o,l.notifyChange("ready")})()}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const l=this.layer.activeLayer;if(this._handles.add((0,V.YP)(()=>{const{layer:s}=this;return s&&"activeLayer"in s&&s.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher"),l.styleId&&l.styles){let s=null;l.styles.some(a=>l.styleId===a.id&&(s=a.legendUrl,!0)),s&&(this.legendElements=[{type:"symbol-table",title:l.title,infos:[{src:s,opacity:this.opacity}]}])}this.notifyChange("ready")}_constructLegendElementsForWMSSublayers(){var l=this;return(0,M.Z)(function*(){l.legendElements=[],l._handles.remove("wms-sublayers-watcher");const s=l.layer;let a=null;(s.customParameters||s.customLayerParameters)&&(a=ae(ae({},s.customParameters),s.customLayerParameters)),l._handles.add((0,V.YP)(()=>{const{layer:o}=l;return o&&"sublayers"in o&&o.sublayers},()=>l._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),l.legendElements=yield l._generateLegendElementsForWMSSublayers(s.sublayers,a),l.notifyChange("ready")})()}_generateLegendElementsForWMSSublayers(l,s){var a=this;return(0,M.Z)(function*(){const o=[];a._handles.add(l.on("change",()=>a._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const c=l.toArray();for(const d of c){const u=(0,V.YP)(()=>[d.title,d.visible,d.legendEnabled],()=>a._constructLegendElementsForWMSSublayers());if(a._handles.add(u,"wms-sublayers-watcher"),!a.respectLayerVisibility||d.visible&&d.legendEnabled){const y=yield a._generateSymbolTableElementForWMSSublayer(d,s);y&&y.infos.length&&o.unshift(y)}}return o})()}_generateSymbolTableElementForWMSSublayer(l,s){var a=this;return(0,M.Z)(function*(){if(!l.legendUrl&&l.sublayers){const o=(yield a._generateLegendElementsForWMSSublayers(l.sublayers,s)).filter(c=>c);return{type:"symbol-table",title:l.title,infos:o}}return a._generateSymbolTableElementForLegendUrl(l,s)})()}_generateSymbolTableElementForLegendUrl(l,s){return(0,M.Z)(function*(){var u;let a=l.legendUrl;if(!a)return;const o={type:"symbol-table",title:l.title||l.name||l.id&&l.id+"",infos:[]};s&&(a=(0,oi.fl)(a,s));let c=null;const d=null==(u=l.layer)?void 0:u.opacity;try{c=(yield(0,gt.default)(a,{responseType:"image"})).data,c&&(c.style.opacity=d)}catch(y){}return o.infos.push({src:a,preview:c,opacity:d}),o})()}_getLegendLayers(l,s){const a=Ie&&Ie[l];return a?Promise.resolve(a):this._legendRequest(s).then(o=>{const c=o.layers;return Ie[l]=c,c})}_legendRequest(l){const s=this.layer;let a={f:"json",dynamicLayers:l};if($e(s)){const c=s.exportImageServiceParameters.renderingRule;if(c&&(a.renderingRule=JSON.stringify(c.rasterFunctionDefinition||c.toJSON())),s.bandIds&&(a.bandIds=s.bandIds.join()),s.raster||s.viewId||s.customParameters){const{raster:d,viewId:u,customParameters:y}=s;a=ae(ae({raster:d,viewId:u},a),y)}}let o=s.url.replace(/(\/)+$/,"");if("version"in s&&s.version>=10.01){const c=o.indexOf("?");c>-1?o=o.substring(0,c)+"/legend"+o.substring(c):o+="/legend"}else{const c=o.toLowerCase().indexOf("/rest/"),d=o.substring(0,c)+o.substring(c+5,o.length);o="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(d)+"&returnbytes=true"}return(0,gt.default)(o,{query:a}).then(c=>c.data)}_constructLegendElementsForBuildingSceneLayer(){var l=this;return(0,M.Z)(function*(){l.legendElements=[],l._handles.remove("sublayers-watcher");const s=l.layer;l._handles.add((0,V.YP)(()=>s.sublayers,()=>l._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{l.legendElements=yield l._generateLegendElementsForBuildingSublayers(s.sublayers,l.opacity),l.notifyChange("ready")}catch(a){he.warn("Request to server for legend has failed!",a)}})()}_generateLegendElementsForBuildingSublayers(l,s){var a=this;return(0,M.Z)(function*(){let o=[];a._handles.add(l.on("change",()=>a._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const c=l.toArray();for(const d of c){const u=(0,V.YP)(()=>["renderer"in d&&d.renderer,d.opacity,d.title,d.visible],()=>a._constructLegendElementsForBuildingSceneLayer());if(a._handles.add(u,"sublayers-watcher"),!a.respectLayerVisibility||d.visible){const y=d&&null!=d.opacity?d.opacity:null,h=null!=y?y*s:s;if("building-group"===d.type){const f={type:"symbol-table",title:d.title,infos:[]},m=yield a._generateLegendElementsForBuildingSublayers(d.sublayers,h);f.infos.push(...m),o=[f,...o]}else d.renderer&&(o=[...yield a._getRendererLegendElements(d.renderer,{title:d.title,opacity:h,sublayer:d}),...o])}}return o.filter(d=>!!d&&(!("infos"in d)||d.infos.length>0))})()}_constructLegendElementsForSublayers(){var l=this;return(0,M.Z)(function*(){l.legendElements=[],l._handles.remove("sublayers-watcher");const s=l.layer;l._handles.add((0,V.YP)(()=>s.sublayers,()=>l._constructLegendElementsForSublayers),"sublayers-watcher");try{l.legendElements=yield l._generateLegendElementsForSublayers(s.sublayers,l.opacity),l.notifyChange("ready")}catch(a){he.warn("Request to server for legend has failed!",a)}})()}_generateLegendElementsForSublayers(l,s,a){var o=this;return(0,M.Z)(function*(){const c=o.layer;let d=[];o._handles.add(l.on("change",()=>o._constructLegendElementsForSublayers()),"sublayers-watcher");let u=l.toArray();!a&&o.sublayerIds&&o.sublayerIds.length&&(u=o.sublayerIds.map(y=>c.findSublayerById(y)).filter(Boolean));for(const y of u){const h=(0,V.YP)(()=>[y.renderer,y.opacity,y.title,y.visible,y.legendEnabled],()=>o._constructLegendElementsForSublayers());if(o._handles.add(h,"sublayers-watcher"),!o.respectLayerVisibility||y.visible&&y.legendEnabled&&o._isSublayerInScale(y)){const f=y&&null!=y.opacity?y.opacity:null,m=null!=f?f*s:s;if(y.renderer&&!y.sublayers&&y.originIdOf("renderer")>Ae.s3.SERVICE)yield y.load(),d=[...yield o._getRendererLegendElements(y.renderer,{title:y.title,opacity:m,sublayer:y}),...d];else{const g=yield o._generateSymbolTableElementForSublayer(y,m,a);g&&d.unshift(g)}}}return d.filter(y=>!!y&&(!("infos"in y)||y.infos.length>0))})()}_generateSymbolTableElementForSublayer(l,s,a){var o=this;return(0,M.Z)(function*(){if(!a){a=new Map;const d=o.layer,u=l.source;let y=null;if(u&&("map-layer"!==u.type||u.mapLayerId!==l.id||u.gdbVersion&&u.gdbVersion!==("gdbVersion"in d&&d.gdbVersion))||l.originIdOf("renderer")>Ae.s3.SERVICE||l.originIdOf("labelingInfo")>Ae.s3.SERVICE||l.originIdOf("labelsVisible")>Ae.s3.SERVICE){const f=new fi.R({layer:o.layer});y=f.hasDynamicLayers?f.dynamicLayers:null,f.destroy()}const h=y||`${d.uid}-default`;(yield o._getLegendLayers(h,y)).forEach(f=>a.set(f.layerId,f))}const c=a.get(l.id);if((!c||(null==c?void 0:c.subLayerIds)&&c.defaultVisibility)&&l.sublayers){const d=yield o._generateLegendElementsForSublayers(l.sublayers,s,a);return{type:"symbol-table",title:l.title,infos:d}}return o._generateSymbolTableElementForLegendLayer(c,l,s)})()}_generateSymbolTableElementForLegendLayer(l,s,a){var y;if(!l||!l.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(l,s))return null;const o=null==s?void 0:s.renderer;let c=(null==s?void 0:s.title)||l.layerName;if(o&&(!s||(null==s?void 0:s.originIdOf("renderer"))>Ae.s3.SERVICE)){const h=(null==s?void 0:s.title)||this._getRendererTitle(o,s);h&&(c&&"string"!=typeof h&&"title"in h&&(h.title=c),c=h)}const d={type:"symbol-table",title:c,legendType:l.legendType?l.legendType:null,infos:[]},u=s?this._sanitizeLegendForSublayer(l.legend.slice(),s):l.legend;return(null==(y=l.legendGroups)?void 0:y.length)>0?l.legendGroups.forEach(h=>{var m;const f={type:"symbol-table",title:h.heading,legendType:l.legendType?l.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(u.filter(g=>g.groupId===h.id),l.layerId,a)};(null==(m=f.infos)?void 0:m.length)>0&&d.infos.push(f)}):d.infos=this._generateSymbolTableElementInfosForLegendLayer(u,l.layerId,a),d.infos.length>0?d:null}_generateSymbolTableElementInfosForLegendLayer(l,s,a){return l.map(o=>{let c=o.url;if(o.imageData&&o.imageData.length>0)c=`data:image/png;base64,${o.imageData}`;else{if(0===c.indexOf("http"))return null;c=(0,ni.Dp)(`${this.layer.url}/${s}/images/${c}`)}return{label:o.label,src:c,opacity:null==a?this.opacity:a,width:o.width,height:o.height}}).filter(o=>!!o)}_isSublayerInScale(l){const s=l.minScale||0;return!(s>0&&s<this.scale||(l.maxScale||0)>this.scale)}_isLegendLayerInScale(l,s){const a=s||this.layer;let o=null,c=null,d=!0;return!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0===l.minScale&&a.tileInfo&&(o=a.tileInfo.lods[0].scale),0===l.maxScale&&a.tileInfo&&(c=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(o=Math.min(a.minScale,l.minScale)||a.minScale||l.minScale,c=Math.max(a.maxScale,l.maxScale)),(o>0&&o<this.scale||c>this.scale)&&(d=!1),d}_sanitizeLegendForSublayer(l,s){if("version"in this.layer&&this.layer.version<10.1||0===l.length)return l;const a=s.renderer,o=l.some(u=>u.values);let c=null,d=null;return o&&l.some((u,y)=>(u.values||(c=y,d=u,d.label||(d.label="others")),null!=d)),a?"unique-value"===a.type?d&&(l.splice(c,1),l.push(d)):"class-breaks"===a.type&&(d&&l.splice(c,1),l.reverse(),d&&l.push(d)):d&&(l.splice(c,1),l.push(d)),l}_getRendererLegendElements(l,s={}){var a=this;return(0,M.Z)(function*(){return function rr(l,s){return Se(l)||Ce(l)||lt(l)||Dt(l)||Ot(l)||Ut(l)?"2d"===s.type||(0,gi.e)(l):$t(l)||Pt(l)||Bt(l)||st(l)||nt(l)||at(l)||Mt(l)||rt(l)}(l,a.view)?function tr(l){return st(l)||nt(l)||at(l)||function ir(l){return"esri.renderers.PointCloudRGBRenderer"===l.declaredClass}(l)}(l)?a._constructPointCloudRendererLegendElements(l,s):Ot(l)?a._constructDotDensityRendererLegendElements(l):Ut(l)?a._constructPieChartRendererLegendElements(l):a._constructRendererLegendElements(l,s):(he.warn(`Renderer of type '${l.type}' not supported!`),[])})()}_getPointCloudRendererTitle(l){return l.legendOptions&&l.legendOptions.title||l.field}_constructPointCloudRendererLegendElements(l,s={}){const a=s.title,o=[];let c=null,d=null;if(st(l))c={type:"symbol-table",title:a||this._getPointCloudRendererTitle(l),infos:[]},l.colorClassBreakInfos.forEach(y=>{c.infos.unshift({label:y.label||y.minValue+" - "+y.maxValue,value:[y.minValue,y.maxValue],symbol:this._getAppliedCloneSymbol(ke,y.color)})});else if(nt(l)){const y=l.stops;let h=null;if(y.length&&(1===y.length&&(h=y[0].color),!h)){const m=y[0].value,g=y[y.length-1].value;null!=m&&null!=g&&(h=(0,Pe.QQ)(m+(g-m)/2,y))}c={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(ke,h||ke.color)}]};const f=(0,Pe.NA)(l.stops);d={type:"color-ramp",title:a||this._getPointCloudRendererTitle(l),infos:f,preview:(0,ne.jT)(f.map(m=>m.color))}}else at(l)&&(c={type:"symbol-table",title:a||this._getPointCloudRendererTitle(l),infos:[]},l.colorUniqueValueInfos.forEach(y=>{c.infos.push({label:y.label||y.values.join(", "),value:y.values.join(", "),symbol:this._getAppliedCloneSymbol(ke,y.color)})}));c&&c.infos.length&&o.push(c),d&&d.infos.length&&o.push(d);const u=o.reduce((y,h)=>y.concat(h.infos),[]).filter(y=>!!y.symbol).map(y=>this._getSymbolPreview(y,this.opacity,{symbolConfig:{applyColorModulation:!!l.colorModulation}}));return(0,ue.as)(u).then(()=>o)}_getElementInfoForDotDensity(l,s){var _;const{backgroundColor:a,outline:o,dotSize:c}=l,d=null==(_=this.effectList)?void 0:_.effects.map(L=>L.toJSON()),u=(0,hi.rM)(d),y=c+"-"+s+"-"+a+"-"+(o&&JSON.stringify(o.toJSON()))+"-"+u,h=this._dotDensityUrlCache,f=h.has(y)?h.get(y):(0,ne.k)(l,s);h.set(y,f);const g=(0,_i.w)([[{shape:{type:"image",x:0,y:0,width:f.width,height:f.height,src:f.src},fill:null,stroke:null,offset:[0,0]}]],[f.width,f.height],{effectView:this.effectList});return{opacity:1,src:f.src,preview:g,width:f.width,height:f.height}}_constructDotDensityRendererLegendElements(l){const s=l.calculateDotValue(this.view.scale),a=l.legendOptions&&l.legendOptions.unit,o={type:"symbol-table",title:{value:s&&Math.round(s),unit:a||""},infos:[]};return l.attributes.forEach(c=>{const d=this._getElementInfoForDotDensity(l,c.color);d.label=c.label||c.valueExpressionTitle||c.field,o.infos.push(d)}),Promise.resolve([o])}_constructPieChartRendererLegendElements(l){var s=this;return(0,M.Z)(function*(){var f,m,g,_;const a=s.layer.opacity,o=[],c="Others",d=l.outline;l.attributes.forEach(L=>{const w=new _e.Z({color:L.color,outline:d});o.push({label:L.label||L.valueExpressionTitle||L.field,symbol:w})});const u=o.length?[...o]:[];if((null==(f=l.othersCategory)?void 0:f.color)&&0!==(null==(m=l.othersCategory)?void 0:m.threshold)){const L=new _e.Z({color:l.othersCategory.color,outline:d});o.push({label:l.othersCategory.label||c,symbol:L})}if(null!=(g=l.defaultColor)&&g.a){const L=new _e.Z({color:l.defaultColor,outline:d});o.push({label:l.defaultLabel,symbol:L})}const y=(yield s._getVisualVariableLegendElements(l,s.layer))||[];if(o.length){y.unshift({type:"symbol-table",title:null,infos:o});const L=u.filter(R=>R.label!==c).map(R=>R.symbol.color).filter(Boolean),w=(0,ne.LC)(L,{holePercentage:l.holePercentage,backgroundColor:null==(_=l.backgroundFillSymbol)?void 0:_.color,effectList:s.effectList,outline:d});y.unshift({type:"pie-chart-ramp",title:s._getRendererTitle(l,s.layer),infos:o,preview:w})}const h=y.reduce((L,w)=>L.concat(s._getAllInfos(w)),[]).filter(L=>!(null==L||!L.symbol||null!=L&&L.preview)).map(L=>s._getSymbolPreview(L,a,{effectList:s.effectList}));return yield(0,ue.as)(h),y})()}_constructRendererLegendElements(l,s={}){var a=this;return(0,M.Z)(function*(){var P;const{title:o,sublayer:c}=s,d=c||a.layer;let u=yield a._loadRenderer(l);a._hasColorRamp=!1,a._hasOpacityRamp=!1,a._hasSizeRamp=!1,a._scaleDrivenSizeVariable=null;const y=(yield a._getVisualVariableLegendElements(u,d))||[],h={type:"symbol-table",title:o||a._getRendererTitle(u,d),infos:[]};let f=null,m=!1;const g=new Set;if(rt(u)&&!a._hasSizeRamp){const b=yield(0,ye.y$)(u);h.infos.push({label:null,symbol:b})}else if(function ur(l){var s;return"univariate-color-size"===(null==(s="authoringInfo"in l&&(null==l?void 0:l.authoringInfo))?void 0:s.type)}(u)){let b=o;const F=function yr(l){const s="authoringInfo"in l&&(null==l?void 0:l.authoringInfo);return"univariate-color-size"===(null==s?void 0:s.type)&&"above-and-below"===(null==s?void 0:s.univariateTheme)}(u)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",z=y.findIndex(H=>"color-ramp"===H.type),A=-1!==z?y.splice(z,1)[0]:null,D=y.findIndex(H=>"size-ramp"===H.type),G=-1!==D?y.splice(D,1)[0]:null,U=[];A&&(b=A.title,U.push(A)),G&&(b=G.title,U.push(G)),U.length>0&&y.push({type:F,title:b,infos:U})}else if(Dt(u)){const b=(0,Ci.h)(u);y.push({type:"heatmap-ramp",title:o||(null==(P=u.legendOptions)?void 0:P.title),infos:b,preview:(0,ne.jT)(b.map(F=>F.color),{effectList:a.effectList})})}else if(lt(u)){const b=u&&u.authoringInfo;if(b&&"relationship"===b.type){const{focus:F,numClasses:z,field1:A,field2:D}=b;if(z&&A&&D){const G=[A,D];let U=It(F)||0;for(const J of G){const{field:Fe,normalizationField:be,label:mt}=J,Ye=mt||{field:a._getFieldAlias(Fe,d),normField:be&&a._getFieldAlias(be,d)},Oe=hr.clone();Oe.angle=U,h.infos.push({label:Ye,symbol:Oe}),g.add(Oe),U+=90}const H=function xi(l){const{focus:s,infos:a,numClasses:o}=l,c=Ei[o],d={};a.forEach(y=>{d[y.value]={label:y.label,fill:Ri(y.symbol)}});const u=[];for(let y=0;y<o;y++){const h=[];for(let f=0;f<o;f++)h.push(d[c[y][f]].fill);u.push(h)}return{type:"relationship-ramp",numClasses:o,focus:s,colors:u,labels:Vi(s,d),rotation:It(s)}}({focus:F,numClasses:z,infos:u.uniqueValueInfos});y.unshift(H)}}else{const F=u.field;u.uniqueValueInfos.forEach(z=>{z.symbol&&h.infos.push({label:z.label||a._getDomainName(F,z.value,d)||z.value,value:z.value,symbol:z.symbol})})}u.defaultSymbol&&(h.infos.push({label:u.defaultLabel||"others",symbol:u.defaultSymbol}),m=!0)}else if(Ce(u))f=a._isUnclassedRenderer(u),(!f||!a._hasSizeRamp)&&(u.classBreakInfos.forEach(b=>{b.symbol&&h.infos.unshift({label:b.label||(f?null:b.minValue+" - "+b.maxValue),value:[b.minValue,b.maxValue],symbol:b.symbol})}),f&&(h.title=null),a._updateInfosforClassedSizeRenderer(u,h.infos)),u.defaultSymbol&&!f&&(h.infos.push({label:u.defaultLabel||"others",symbol:u.defaultSymbol}),m=!0);else if($t(u))if(ot(a.layer)||function cr(l){return"esri.layers.WCSLayer"===l.declaredClass}(a.layer)){const b=a._constructTileImageryStretchRendererElements(u);!function dr(l){return"stretch-ramp"===l.type}(b)?h.infos=b:y.push(b)}else{const b=a.layer;let F,z;u.statistics&&u.statistics.length&&(F=null!=u.statistics[0].min?u.statistics[0].min:u.statistics[0][0],z=null!=u.statistics[0].max?u.statistics[0].max:u.statistics[0][1]);let A=[];const D=(0,Q.Wg)(b.renderingRule?yield b.generateRasterInfo(b.renderingRule):b.serviceRasterInfo),G=D.keyProperties.BandProperties,U=At[b.rasterInfo.pixelType.toLowerCase()];1===D.bandCount||b.bandIds&&1===b.bandIds.length?(F=null!=F?F:D.statistics?D.statistics[b.bandIds[0]].min:U[0],z=null!=z?z:D.statistics?D.statistics[b.bandIds[0]].max:U[1],F||z?y.push(a._getStretchLegendElements(u,{min:F,max:z})):a._getServerSideLegend()):D.bandCount>=3?G&&G.length>=D.bandCount?b.bandIds&&3===b.bandIds.length?(A=b.bandIds.map(H=>G[H].BandName),h.infos=a._createSymbolTableElementMultiBand(A)):"lerc"===b.format?(A=[0,1,2].map(H=>G[H].BandName),h.infos=a._createSymbolTableElementMultiBand(A)):a._getServerSideLegend():"lerc"===b.format?(A=["band1","band2","band3"],h.infos=a._createSymbolTableElementMultiBand(A)):a._getServerSideLegend():a._getServerSideLegend()}else if(Pt(u))u.colormapInfos.forEach(b=>{h.infos.push({label:b.label,value:b.value,symbol:a._getAppliedCloneSymbol(er,b.color)})});else if(Se(u)){let b=u.symbol;switch(s.geometryType){case"point":b="pointSymbol"in d&&d.pointSymbol;break;case"polyline":b="lineSymbol"in d&&d.lineSymbol;break;case"polygon":b="polygonSymbol"in d&&d.polygonSymbol}u.symbol&&!a._hasSizeRamp&&h.infos.push({label:u.label,symbol:b})}else if(Mt(u)){u.outputUnit&&(a.title="("+u.toJSON().outputUnit+")"),h.title=u.attributeField;const b=u.getClassBreakInfos();null!=b&&b.length?b.forEach(F=>{h.infos.push({label:F.minValue+" - "+F.maxValue,symbol:F.symbol})}):h.infos.push({label:u.attributeField,symbol:u.getDefaultSymbol()})}else Bt(u)&&y.push(a._getStretchLegendElements(u,{min:0,max:255}));const _=u.defaultSymbol;!_||m||Se(u)||f&&!a._hasColorRamp&&!a._hasSizeRamp&&!a._hasOpacityRamp||y.push({type:"symbol-table",infos:[{label:u.defaultLabel||"others",symbol:_}]}),h.infos.length&&y.unshift(h);const L=null==s.opacity?a.opacity:s.opacity,w=a._isTallSymbol("visualVariables"in u&&u.visualVariables),R=$e(a.layer)||ot(a.layer),I=y.reduce((b,F)=>b.concat(a._getAllInfos(F)),[]).filter(b=>!(null==b||!b.symbol)).map(b=>a._getSymbolPreview(b,L,{isDefault:b.symbol===_,applyScaleDrivenSize:!g.has(b.symbol),symbolConfig:{isTall:w,isSquareFill:R},effectList:g.has(b.symbol)?null:a.effectList}));return u=null,yield(0,ue.as)(I),y})()}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(l){const s=null==l?void 0:l.infos;return s?s.reduce((a,o)=>a.concat(this._getAllInfos(o)),[]):[l]}_constructTileImageryStretchRendererElements(l){var m,g;const s=this.layer,a=s.rasterInfo,o=a.bandCount||l.statistics.length;let c,d,u=[];const y=a.keyProperties&&a.keyProperties.BandProperties,h=null!=(m=null==l?void 0:l.statistics)&&m.length?l.statistics:null==a?void 0:a.statistics;if(h)c=void 0!==h[0].min?h[0].min:h[0][0],d=h[0].max||h[0][1];else{const _=At[s.rasterInfo.pixelType.toLowerCase()];c=_[0],d=_[1]}if(s.hasStandardTime()&&(c=s.getStandardTimeValue(c),d=s.getStandardTimeValue(d)),1===a.bandCount||1===(null==(g=s.bandIds)?void 0:g.length))return this._getStretchLegendElements(l,{min:c,max:d});function f(_){var w;const L=(null!=(w=null==s?void 0:s.bandIds)&&w.length?s.bandIds:Array.from(Array(Math.min(a.bandCount,3)).keys())).map(R=>_&&_[R]&&_[R].BandName||"band"+(R+1));return L.length<3?L.push(L[1]):L.length>3&&L.splice(3),L}return u=y&&y.length>=o?f(y):f(),this._createSymbolTableElementMultiBand(u)}_getStretchLegendElements(l,s){const o=(0,Pe.fD)(l.colorRamp,s);return{type:"stretch-ramp",title:"",infos:o,preview:(0,ne.jT)(o.map(c=>c.color))}}_getSizeLegendElement(l,s,a,o){var c=this;return(0,M.Z)(function*(){return{type:"size-ramp",title:c._hasClusterSizeVariable?c._getClusterTitle(s):l,infos:yield Oi(a,s,yield(0,ye.jb)(a),c.scale,c.view.type,o)}})()}_createSymbolTableElementMultiBand(l){const s=[],a=["red","green","blue"];return l.forEach((o,c)=>{var d;s.push({label:{colorName:a[c],bandName:o},src:ye.uY[c],opacity:null!=(d=this.opacity)?d:1})}),s}_updateInfosforClassedSizeRenderer(l,s){const a=l.authoringInfo&&"class-breaks-size"===l.authoringInfo.type,o=l.classBreakInfos.some(c=>(0,fe.YW)(c.symbol));if(a&&o){const c=30,u=l.classBreakInfos.length,y=(c-12)/(u>1?u-1:u);s.forEach((h,f)=>{h.size=c-y*f})}}_isTallSymbol(l){let s=!1,a=!1;if(l)for(let o=0;o<l.length&&(!s||!a);o++){const c=l[o];"size"===c.type&&("height"===c.axis&&(s=!0),"width-and-depth"===c.axis&&(a=!0))}return s&&a}_getSymbolPreview(l,s,a){var o=this;return(0,M.Z)(function*(){let c=null!=a&&a.isDefault||null!=l.size||!o._hasSizeRamp?l.size:(0,oe.Wz)(vi.b_.size);if(o._scaleDrivenSizeVariable&&(null==a?void 0:a.applyScaleDrivenSize)){const{getSize:d}=yield Promise.resolve().then(v.bind(v,81808));c=d(o._scaleDrivenSizeVariable,null,{view:o.view.type,scale:o.scale,shape:"simple-marker"===l.symbol.type?l.symbol.style:null})}return(0,ne.l3)(l.symbol,{size:c,opacity:s,scale:!1,symbolConfig:null==a?void 0:a.symbolConfig,effectView:null==a?void 0:a.effectList}).then(d=>(l.preview=d,l)).catch(()=>(l.preview=null,l))})()}_loadRenderer(l){var s=this;return(0,M.Z)(function*(){var u,y;const a=[],o=s.layer;l=l.clone(),s._hasClusterSizeVariable=!1;const c="visualVariables"in l&&(null==(u=l.visualVariables)?void 0:u.some(h=>"size"===h.type&&"outline"!==h.target&&!Ne.test(h.valueExpression)));if(l&&"visualVariables"in l&&!c&&"featureReduction"in o&&"cluster"===(null==(y=o.featureReduction)?void 0:y.type)){const f=(0,Q.Wg)(function Si(l,s){if(!l||!("visualVariables"in l)||!l.visualVariables)return null;const a=l.visualVariables.find(c=>"size"===c.type),o=((l,s)=>{const a=l.featuresTilingScheme.getClosestInfoForScale(l.scale).level;return null!=s&&s.levels?s.levels[a]:null})(s,a);return o?new Li.Z({field:a.field,minSize:o[2].size,minDataValue:o[2].value,maxSize:o[3].size,maxDataValue:o[3].value}):null}(s.layerView._effectiveRenderer,s.view));if(f){const m=o.featureReduction;if("clusterMinSize"in m&&"clusterMaxSize"in m){const{clusterMinSize:_,clusterMaxSize:L}=m;f.legendOptions=new bi.Z({showLegend:_!==L})}l.visualVariables=(l.visualVariables||[]).concat([f]),s._hasClusterSizeVariable=!0}}const d=yield(0,ye.jb)(l);if(Ce(l)||lt(l)){const h=(l.classBreakInfos||l.uniqueValueInfos).map(f=>s._fetchSymbol(f.symbol,d).then(m=>{f.symbol=m}).catch(()=>{f.symbol=null}));Array.prototype.push.apply(a,h)}return a.push(s._fetchSymbol(l.symbol||l.defaultSymbol,l.defaultSymbol?null:d).then(h=>{s._applySymbolToRenderer(l,h,Se(l))}).catch(()=>{s._applySymbolToRenderer(l,null,Se(l))})),(0,ue.as)(a).then(()=>l)})()}_applySymbolToRenderer(l,s,a){a?l.symbol=s:l.defaultSymbol=s}_fetchSymbol(l,s){var a=this;return(0,M.Z)(function*(){if(!l)throw new Error;if("web-style"===l.type){const o=a._webStyleSymbolCache;try{const c=yield"2d"===a.view.type?l.fetchCIMSymbol({cache:o}):l.fetchSymbol({cache:o});return a._getAppliedCloneSymbol(c,s)}catch(c){throw he.warn("Fetching web-style failed!"),new Error}}return a._getAppliedCloneSymbol(l,s)})()}_getAppliedCloneSymbol(l,s){if(!l||!s)return l;const a=l.clone(),o=s&&s.toRgba();return a.type.includes("3d")?this._applyColorTo3dSymbol(a,o):"cim"===a.type?(0,St.ZB)(a,s):a.color&&(a.color=new ve.Z(o||a.color)),a}_applyColorTo3dSymbol(l,s){s&&l.symbolLayers.forEach(a=>{a&&(a.material||(a.material={}),a.material.color=new ve.Z(s))})}_getVisualVariableLegendElements(l,s){var a=this;return(0,M.Z)(function*(){if(!("visualVariables"in l)||!l.visualVariables||"vector-field"===l.type)return null;const o=l.visualVariables,c=[],d=[],u=[];for(const g of o)"color"===g.type?c.push(g):"size"===g.type?d.push(g):"opacity"===g.type&&u.push(g);const y=[...c,...d,...u];let h,f;if(0===c.length&&Ce(l)&&l.classBreakInfos&&1===l.classBreakInfos.length){const g=l.classBreakInfos[0];h=g&&g.symbol}if(0===c.length&&Se(l)&&(h=l.symbol),h)if(h.type.includes("3d")){const g=h.symbolLayers.getItemAt(0);"water"===g.type?(0,Q.pC)(g.color)&&(f=g.color):(0,Q.pC)(g.material)&&(0,Q.pC)(g.material.color)&&(f=g.material.color)}else h.url||(f=h.color);const m=a.effectList;return(yield Promise.all(y.map(function(){var g=(0,M.Z)(function*(_){if(!_.legendOptions||!1!==_.legendOptions.showLegend){const L=rt(l)?_.field:a._getRampTitle(_,s);let w=null;const R="getField"in s&&s.getField&&s.getField(_.field),I=R&&(0,pi.y2)(R);if("color"===_.type){const P=yield(0,Pe.pO)(_,null,I);w={type:"color-ramp",title:L,infos:P,preview:(0,ne.jT)(P.map(b=>b.color),{effectList:m})},a._hasColorRamp||(a._hasColorRamp=!(null==w.infos||!w.infos.length))}else if("size"===_.type&&"outline"!==_.target)Ne.test(_.valueExpression)?a._hasClusterSizeVariable||(a._scaleDrivenSizeVariable=_):(w=yield a._getSizeLegendElement(L,_,l,I),a._hasSizeRamp||(a._hasSizeRamp=!(null==w.infos||!w.infos.length)));else if("opacity"===_.type){const P=yield(0,Pe.pO)(_,f,I);w={type:"opacity-ramp",title:L,infos:P,preview:(0,ne.jT)(P.map(b=>b.color),{effectList:m})},a._hasOpacityRamp||(a._hasOpacityRamp=!(null==w.infos||!w.infos.length))}return w&&w.infos?w:null}});return function(_){return g.apply(this,arguments)}}()))).filter(g=>!!g)})()}_getDomainName(l,s,a){if(l&&"function"!=typeof l){const o="getField"in a&&a.getField&&a.getField(l),c=o&&"getFieldDomain"in a&&a.getFieldDomain?a.getFieldDomain(o.name):null;return c&&"coded-value"===c.type?c.getName(s):null}return null}_getClusterTitle(l){const s=this.layer,a=l.field;if("featureReduction"in s&&s.featureReduction&&"cluster"===s.featureReduction.type){const o=s.featureReduction,c="popupTemplate"in o&&o.popupTemplate,d=c&&c.fieldInfos;if(d)for(const u of d)if(u.fieldName===a)return"cluster_count"===a?u.label||{showCount:!0}:u.label}return{showCount:!0}}_getRampTitle(l,s){let a=l.field,o=l.normalizationField,c=!1,d=!1,u=!1,y=null;a="function"==typeof a?null:a,o="function"==typeof o?null:o;const h=l.legendOptions&&l.legendOptions.title;if(null!=h)y=h;else if(l.valueExpressionTitle)y=l.valueExpressionTitle;else{if("renderer"in s&&s.renderer&&"authoringInfo"in s.renderer&&s.renderer.authoringInfo&&s.renderer.authoringInfo.visualVariables){const f=s.renderer.authoringInfo.visualVariables;for(let m=0;m<f.length;m++){const g=f[m];if("color"===g.type){if("ratio"===g.style){c=!0;break}if("percent"===g.style){d=!0;break}if("percent-of-total"===g.style){u=!0;break}}}}y={field:a&&this._getFieldAlias(a,s),normField:o&&this._getFieldAlias(o,s),ratio:c,ratioPercent:d,ratioPercentTotal:u}}return y}_getRendererTitle(l,s){const a=l;if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;let o=a.field,c=null,d=null;Ce(a)&&(c=a.normalizationField,d="percent-of-total"===a.normalizationType),o="function"==typeof o?null:o,c="function"==typeof c?null:c;let u=null;return(o||c)&&(u={field:o&&this._getFieldAlias(o,s),normField:c&&this._getFieldAlias(c,s),normByPct:d}),u}_getFieldAlias(l,s){const a="popupTemplate"in s&&s.popupTemplate,o=a&&a.fieldInfos;let c=null;o&&o.some(h=>l===h.fieldName&&(c=h,!0));let d=null;"getField"in s&&s.getField?d=s.getField(l):"fieldsIndex"in s&&s.fieldsIndex&&(d=s.fieldsIndex.get(l));const u=c||d;let y=null;return u&&(y=c&&c.label||d&&d.alias||"name"in u&&u.name||"fieldName"in u&&u.fieldName),y}_isUnclassedRenderer(l){const s=l.visualVariables;let a=!1;return Ce(l)&&l.classBreakInfos&&1===l.classBreakInfos.length&&s&&(a=l.field?s.some(o=>!(!o||l.field!==o.field||(l.normalizationField||o.normalizationField)&&l.normalizationField!==o.normalizationField)):!!s.length),a}};(0,S._)([(0,C.Cb)()],k.prototype,"children",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],k.prototype,"effectList",null),(0,S._)([(0,C.Cb)()],k.prototype,"layerView",void 0),(0,S._)([(0,C.Cb)()],k.prototype,"layer",void 0),(0,S._)([(0,C.Cb)()],k.prototype,"legendElements",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],k.prototype,"opacity",null),(0,S._)([(0,C.Cb)()],k.prototype,"parent",void 0),(0,S._)([(0,C.Cb)({readOnly:!0,dependsOn:[]})],k.prototype,"ready",null),(0,S._)([(0,C.Cb)()],k.prototype,"hideLayersNotInCurrentView",void 0),(0,S._)([(0,C.Cb)()],k.prototype,"keepCacheOnDestroy",void 0),(0,S._)([(0,C.Cb)()],k.prototype,"respectLayerVisibility",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],k.prototype,"scale",null),(0,S._)([(0,C.Cb)()],k.prototype,"sublayerIds",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],k.prototype,"isScaleDriven",null),(0,S._)([(0,C.Cb)()],k.prototype,"title",void 0),(0,S._)([(0,C.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],k.prototype,"version",null),(0,S._)([(0,C.Cb)()],k.prototype,"view",void 0),k=(0,S._)([(0,N.j)("esri.widgets.Legend.support.ActiveLayerInfo")],k);const Ht=k;var fr=v(56683);const Zt=K.Z.ofType(Ht),pr=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],Wt="view.basemapView.baseLayerViews",jt="view.groundView.layerViews",Yt="view.basemapView.referenceLayerViews",mr=[Wt,jt,"view.layerViews",Yt];let ie=class extends ee.Z{constructor(l){super(l),this._handles=new q.Z,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new K.Z,this.activeLayerInfos=new Zt,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add((0,V.YP)(()=>this.view,()=>this._viewHandles(),V.nn),"view"),this._handles.add((0,fr.qe)(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove("state"),this.view&&this._handles.add((0,V.YP)(()=>this.state,()=>this._stateHandles(),V.nn),"state")}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove(["all-layer-views","legend-properties"]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(l){this._handles.remove(l);const s=this._activeLayerInfosByLayerViewId[l];delete this._activeLayerInfosByLayerViewId[l],s&&s.parent&&s.parent.children.remove(s)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:l}=this.view;l.length&&this._refresh(),this._handles.add(l.on("change",s=>this._allLayerViewsChangeHandle(s)),"all-layer-views"),this._handles.add((0,V.YP)(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),"legend-properties")}_allLayerViewsChangeHandle(l){l.removed.forEach(s=>this._destroyViewActiveLayerInfo(s.uid)),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(l){if(l.length<2)return;const s=[];l.forEach(o=>{if(!o.parent){const c=o.layer.parent,d=c&&"uid"in c&&this._layerViewByLayerId[c.uid],u=d&&this._activeLayerInfosByLayerViewId[d.uid];u&&l.includes(u)&&(s.push(o),o.parent=u,u.children.add(o),this._sortActiveLayerInfos(u.children))}}),l.removeMany(s);const a={};this.view.allLayerViews.forEach((o,c)=>a[o.layer.uid]=c),l.sort((o,c)=>(a[c.layer.uid]||0)-(a[o.layer.uid]||0))}_generateLayerViews(){const l=[];return mr.filter(this._filterLayerViews,this).map(this.get,this).filter(s=>null!=s).forEach(this._collectLayerViews("layerViews",l)),l}_filterLayerViews(l){return!(!this.basemapLegendVisible&&(l===Wt||l===Yt)||!this.groundLegendVisible&&l===jt)}_collectLayerViews(l,s){const a=o=>(o&&o.forEach(c=>{s.push(c),a(c[l])}),s);return a}_filterLayerViewsByLayerInfos(l){const s=this.layerInfos;return!s||!s.length||s.some(a=>this._hasLayerInfo(a,l))}_hasLayerInfo(l,s){const a=this._isLayerUIDMatching(l.layer,s.layer.uid);return a&&(this._layerInfosByLayerViewId[s.uid]=l),a}_isLayerUIDMatching(l,s){return l&&(l.uid===s||this._hasLayerUID(l.layers,s))}_hasLayerUID(l,s){return l&&l.some(a=>this._isLayerUIDMatching(a,s))}_isLayerViewSupported(l){return!!pr.includes(l.layer.declaredClass)&&(this._layerViewByLayerId[l.layer.uid]=l,!0)}_generateActiveLayerInfo(l){this._isLayerActive(l)?this._buildActiveLayerInfo(l):(this._handles.remove(l.uid),this._handles.add((0,V.YP)(()=>{var s;return[l.legendEnabled,null==(s=l.layer)?void 0:s.legendEnabled]},()=>this._layerActiveHandle(l)),l.uid))}_layerActiveHandle(l){this._isLayerActive(l)&&(this._handles.remove(l.uid),this._buildActiveLayerInfo(l))}_isLayerActive(l){return!this.respectLayerVisibility||l.legendEnabled&&l.get("layer.legendEnabled")}_buildActiveLayerInfo(l){var u;const s=l.layer,a=l.uid,o=this._layerInfosByLayerViewId[a];let c=this._activeLayerInfosByLayerViewId[a];c||(c=new Ht({layer:s,layerView:l,title:o&&void 0!==o.title&&o.layer.uid===s.uid?o.title:s.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:o&&o.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[a]=c);const d=s.parent&&"uid"in s.parent&&this._layerViewByLayerId[null==(u=s.parent)?void 0:u.uid];if(c.parent=this._activeLayerInfosByLayerViewId[null==d?void 0:d.uid],!this._handles.has(a)){const y=[(0,V.YP)(()=>s.title,h=>this._titleHandle(h,c)),(0,V.YP)(()=>[s.opacity,"renderer"in s&&s.renderer,"pointSymbol"in s&&s.pointSymbol,"lineSymbol"in s&&s.lineSymbol,"polygonSymbol"in s&&s.polygonSymbol],()=>this._constructLegendElements(c)),(0,V.gx)(()=>{var h;return!0===(null==(h=this.view)?void 0:h.stationary)},()=>this._scaleHandle(c),V.nn),(0,V.YP)(()=>l._effectiveRenderer,()=>this._constructLegendElements(c)),(0,V.YP)(()=>"effect"in s&&s.effect,()=>this._constructLegendElements(c))];if(this.respectLayerVisibility){const h=(0,V.YP)(()=>l.legendEnabled,m=>this._legendEnabledHandle(m,c)),f=(0,V.YP)(()=>s.legendEnabled,m=>this._legendEnabledHandle(m,c));y.push(h,f)}this._handles.add(y,a)}c.isScaleDriven||this._constructLegendElements(c),this._addActiveLayerInfo(c)}_titleHandle(l,s){s.title=l,this._constructLegendElements(s)}_legendEnabledHandle(l,s){l?this._addActiveLayerInfo(s):this._removeActiveLayerInfo(s)}_scaleHandle(l){(l.isScaleDriven||l.hideLayersNotInCurrentView)&&this._constructLegendElements(l)}_addActiveLayerInfo(l){var o;const{layerView:s,layer:a}=l;if(this._isLayerActive(s)&&!this.activeLayerInfos.includes(l)){const c=l.parent;if(c)c.children.includes(l)||c.children.push(l),this._sortActiveLayerInfos(c.children);else{const d=null==(o=this.layerInfos)?void 0:o.some(u=>u.layer.uid===a.uid);a.parent&&"uid"in a.parent&&!d?this._activeLayerInfosWithNoParent.add(l):(this.activeLayerInfos.add(l),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const d=[];this._activeLayerInfosWithNoParent.forEach(u=>{const y=u.layer.parent,h=y&&"uid"in y&&this._layerViewByLayerId[null==y?void 0:y.uid],f=this._activeLayerInfosByLayerViewId[null==h?void 0:h.uid];f&&(d.push(u),u.parent=f)}),d.length&&(this._activeLayerInfosWithNoParent.removeMany(d),d.forEach(u=>this._addActiveLayerInfo(u)))}}}_removeActiveLayerInfo(l){const s=l.parent;s?s.children.remove(l):this.activeLayerInfos.remove(l)}_constructLegendElements(l){var a;const s=l.layer;"featureCollections"in s&&s.featureCollections?l.buildLegendElementsForFeatureCollections(s.featureCollections):"featureReduction"in s&&"binning"===(null==(a=s.featureReduction)?void 0:a.type)&&"renderer"in s.featureReduction?l.buildLegendElementsForRenderer(s.featureReduction.renderer):"renderer"in s&&s.renderer?l.buildLegendElementsForRenderer(s.renderer):"url"in s&&s.url?l.buildLegendElementsForTools():l.children.forEach(o=>this._constructLegendElements(o))}};(0,S._)([(0,C.Cb)({type:Zt})],ie.prototype,"activeLayerInfos",void 0),(0,S._)([(0,C.Cb)()],ie.prototype,"basemapLegendVisible",void 0),(0,S._)([(0,C.Cb)()],ie.prototype,"groundLegendVisible",void 0),(0,S._)([(0,C.Cb)()],ie.prototype,"hideLayersNotInCurrentView",void 0),(0,S._)([(0,C.Cb)()],ie.prototype,"keepCacheOnDestroy",void 0),(0,S._)([(0,C.Cb)()],ie.prototype,"respectLayerVisibility",void 0),(0,S._)([(0,C.Cb)()],ie.prototype,"layerInfos",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],ie.prototype,"state",null),(0,S._)([(0,C.Cb)()],ie.prototype,"view",void 0),ie=(0,S._)([(0,N.j)("esri.widgets.Legend.LegendViewModel")],ie);const gr=ie;var de=v(30695),p=v(94450);const $_squareTableRow="esri-relationship-ramp--square__table-row",$_squareTableCell="esri-relationship-ramp--square__table-cell",$_squareTableLabel="esri-relationship-ramp--square__table-label";function Gt(l,s,a,o){const{focus:c,labels:d}=l,u=!!c,y=function vr(l,s,a,o,c=60){const{focus:d,numClasses:u,colors:y,rotation:h}=l,f=!!d,m=Math.sqrt(c**2+c**2)+(f?0:5),g=[],_=[],L=[],w=(c||75)/u;for(let J=0;J<u;J++){const Fe=J*w;for(let be=0;be<u;be++){const mt=be*w,Ye=(0,de.jA)(y[J][be]),Oe=(0,de.kQ)(null),ri={type:"rect",x:mt,y:Fe,width:w,height:w};g.push((0,de.ch)(Ye)),_.push((0,de.vq)(ri,Ye.fill,Oe,null)),L.push((0,de.A5)(ri))}}let F=null;f||(F="margin: -15px -15px -18px -15px");const z=Jt("left",d,s),A=Jt("right",d,s),D=(0,de.al)(L),G=(0,de.iL)(D,m,m,0,!1,h,!1),U=(0,de.iL)(D,m,m,0,!1,f?-45:null,!1),H={filter:(0,fe.wJ)(o),opacity:null==a?null:`${a}`};return(0,p.u)("div",{styles:H,class:f?"esri-relationship-ramp--diamond__middle-column--ramp":$_squareTableCell},(0,p.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:m,height:m,style:F},(0,p.u)("defs",null,(0,p.u)("marker",{id:`${s}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,p.u)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,p.u)("marker",{id:`${s}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,p.u)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),g),(0,p.u)("g",{transform:G},_),(0,p.u)("g",{transform:U},(0,p.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":z.markerStart,"marker-end":z.markerEnd,x1:-10,y1:c-15,x2:-10,y2:15}),(0,p.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":A.markerStart,"marker-end":A.markerEnd,x1:15,y1:c+10,x2:c-15,y2:c+10}))))}(l,s,a,o),f=(0,pe.dZ)();return u?(0,p.u)("div",{class:"esri-relationship-ramp--diamond__container",styles:{justifyContent:"center"}},(0,p.u)("div",{class:"esri-relationship-ramp--diamond__left-column"},f?d.right:d.left),(0,p.u)("div",{class:"esri-relationship-ramp--diamond__middle-column"},(0,p.u)("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},d.top),y,(0,p.u)("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},d.bottom)),(0,p.u)("div",{class:"esri-relationship-ramp--diamond__right-column"},f?d.left:d.right)):(0,p.u)("div",{class:"esri-relationship-ramp--square__table"},(0,p.u)("div",{class:$_squareTableRow},(0,p.u)("div",{class:(0,pe.Sh)($_squareTableCell,$_squareTableLabel,"esri-relationship-ramp--square__table-label--right-bottom")},f?d.top:d.left),(0,p.u)("div",{class:$_squareTableCell}),(0,p.u)("div",{class:(0,pe.Sh)($_squareTableCell,$_squareTableLabel,"esri-relationship-ramp--square__table-label--left-bottom")},f?d.left:d.top)),(0,p.u)("div",{class:$_squareTableRow},(0,p.u)("div",{class:$_squareTableCell}),y,(0,p.u)("div",{class:$_squareTableCell})),(0,p.u)("div",{class:$_squareTableRow},(0,p.u)("div",{class:(0,pe.Sh)($_squareTableCell,$_squareTableLabel,"esri-relationship-ramp--square__table-label--right-top")},f?d.right:d.bottom),(0,p.u)("div",{class:$_squareTableCell}),(0,p.u)("div",{class:(0,pe.Sh)($_squareTableCell,$_squareTableLabel,"esri-relationship-ramp--square__table-label--left-top")},f?d.bottom:d.right)))}function Jt(l,s,a){const o=`${a}_arrowStart`,c=`${a}_arrowEnd`,d="left"===l,u={markerStart:null,markerEnd:null};switch(s){case"HL":d?u.markerStart=`url(#${c})`:u.markerEnd=`url(#${o})`;break;case"LL":u.markerStart=`url(#${c})`;break;case"LH":d?u.markerEnd=`url(#${o})`:u.markerStart=`url(#${c})`;break;default:u.markerEnd=`url(#${o})`}return u}v(50645);const Lr=(0,v(62996).E)();function wr(l="vertical"){const s="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===l?(0,p.u)("svg",{height:"4",width:"10"},(0,p.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:s})):(0,p.u)("svg",{height:"10",width:"10"},(0,p.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:s}))}function Sr(l,s="vertical"){const a=document.createElement("div");return a.style.height="20px",a.className="esri-univariate-above-and-below-ramp__symbol",null!=l&&(a.style.opacity=l.toString()),Lr.append(a,wr.bind(null,s)),a}function Xt(l,s,a="vertical",o){l.infos.forEach((c,d)=>{if(o&&2===d)c.preview=Sr(s,a);else{const u=(0,oe.F2)(c.size)+("horizontal"===a?20:10),y="div"===c.preview.tagName.toLowerCase(),h=y?c.preview:document.createElement("div");h.className="esri-univariate-above-and-below-ramp__symbol","horizontal"===a?h.style.width=`${u}px`:h.style.height=`${u}px`,y||h.appendChild(c.preview),c.preview=h}})}function Ze(l,s="classic"){const a=l.infos;return"classic"===s?((0,oe.F2)(a[0].size)+10)/2:((0,oe.F2)(a[0].size)-(0,oe.F2)(a[a.length-1].size))/2}function Ee(l,s){if(!l)return null;const a=l.infos.map(c=>c.color),o=(0,ne.jT)("full"===s.type?a:"above"===s.type?a.slice(0,3):a.slice(2,5),{width:s.width,height:s.height,align:s.rampAlignment,effectList:s.effectList});return o.className="esri-legend__color-ramp",null!=s.opacity&&(o.style.opacity=s.opacity.toString()),o}function yt(l,s,a,o="vertical"){let c=0;const d=l.infos,u=Math.floor(d.length/2),h="full"===s||"below"===s?d.length-1:u;for(let f="full"===s||"above"===s?0:u;f<=h;f++)c+=a&&f===u?"horizontal"===o?10:20:(0,oe.F2)(d[f].size)+("horizontal"===o?20:10);return Math.round(c)}function Re(l,s,a,o="vertical"){const c=yt(l,s,a,o),d=l.infos,u=Math.floor(d.length/2),y="full"===s||"above"===s?0:u,h="full"===s||"below"===s?d.length-1:u,m=a?"vertical"===o?20:10:0,g="vertical"===o?10*("full"===s?2:1):20*("full"===s?2:1);return Math.round(c-((0,oe.F2)("full"===s?d[y].size+d[h].size:"above"===s?d[y].size:d[h].size)/2+m/2+g/2))}function Kt(l,s,a="vertical"){const o=l.infos;let c=o.find(({type:u})=>"size-ramp"===u),d=o.find(({type:u})=>"color-ramp"===u);return c&&(c=ae({},c),c.infos=[...c.infos],Xt(c,s,a,!0)),d&&(d=ae({},d),d.infos=[...d.infos]),"horizontal"===a&&(null==c||c.infos.reverse(),null==d||d.infos.reverse()),{sizeRampElement:c,colorRampElement:d}}function qt(l,s="vertical"){const a=l.infos;let o=a.find(({type:d})=>"size-ramp"===d),c=a.find(({type:d})=>"color-ramp"===d);return o&&(o=ae({},o),o.infos=[...o.infos],Xt(o,null,s,!1)),c&&(c=ae({},c),c.infos=[...c.infos]),"horizontal"===s&&(null==o||o.infos.reverse(),null==c||c.infos.reverse()),{sizeRampElement:o,colorRampElement:c}}var ht=v(97059);function W(l){l.appendChild(this)}function Ve(l,s,a){if(!s)return;if("string"==typeof s||"number"==typeof s)return s;if("value"in s||"unit"in s)return(0,ht.n)(l.dotValue,s);if("colorName"in s||"bandName"in s)return l[s.colorName]+": "+(l[s.bandName]||s.bandName);if("showCount"in s)return s.showCount?l.clusterCountTitle:null;let o=null;return function Cr(l,s){return s}(0,a)?o=s.ratioPercentTotal?"showRatioPercentTotal":s.ratioPercent?"showRatioPercent":s.ratio?"showRatio":s.normField?"showNormField":s.field?"showField":null:ei(0,a)&&(o=s.normField?"showNormField":s.normByPct?"showNormPct":s.field?"showField":null),o?(0,ht.n)("showField"===o?"{field}":l[o],{field:s.field,normField:s.normField}):null}function ei(l,s){return!s}function ti(l,s){return!!(s&&"Stretched"===s&&l.version>=10.3&&"esri.layers.ImageryLayer"===l.declaredClass)}var Be=v(13065),Ir=v(24940),We=v(25552);const E_layerRow="esri-legend--card__layer-row",E_rampLabel="esri-legend--card__ramp-label",E_symbol="esri-legend--card__symbol",E_symbolContainer="esri-legend--card__symbol-container",E_layerInfo="esri-legend__layer-cell esri-legend__layer-cell--info";var De,l;(l=De||(De={})).Auto="auto",l.Stack="stack",l.SideBySide="side-by-side";const xe=window.devicePixelRatio;let le=class extends x.Z{constructor(l,s){super(l,s),this._handles=new q.Z,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=De.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own((0,V.YP)(()=>this.activeLayerInfos,l=>{this._handles.removeAll(),this._watchForSectionChanges(l)}))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===De.Auto&&this.view.container.clientWidth<=768||this.layout===De.Stack;const l=this.activeLayerInfos,s=l&&l.toArray().map(y=>this._renderLegendForLayer(y)).filter(y=>!!y);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const a=this._sectionNames.length,o=this._sectionNames.map((y,h)=>{const f=(0,ht.n)(this.messagesCommon.pagination.pageText,{index:h+1,total:a});return(0,p.u)("div",{key:y,role:"tab",id:y,"aria-label":f,"aria-controls":`${y}-panel`,"aria-selected":(this._selectedSectionName===y).toString(),tabIndex:this._selectedSectionName===y?0:-1,title:f,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes("esri-legend--card__carousel-indicator",{"esri-legend--card__carousel-indicator--activated":this._selectedSectionName===y}),"data-section-name":y})}),c=this._hasIndicators&&a>1?(0,p.u)("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation",role:"tablist"},o):null,d=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):s&&s.length?s:null;return(0,p.u)("div",{class:this.classes("esri-legend--card",{"esri-legend--stacked":this._hasIndicators})},d||(0,p.u)("div",{class:"esri-legend--card__message"},this.messages.noLegend),c)}_selectSection(l){const s=l.target.getAttribute("data-section-name");s&&(this._selectedSectionName=s)}_focusSection(l){switch(l.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(l);break;case"Enter":case" ":this._selectSection(l)}}_switchSectionOnArrowPress(l){const s=l.key,a="ArrowLeft"===s?-1:1,o=l.target.getAttribute("data-section-name"),c=this._sectionNames.indexOf(o),d=this._sectionNames;let u=null;-1!==c&&(d[c+a]?u=document.getElementById(d[c+a]):"ArrowLeft"===s?u=document.getElementById(d[d.length-1]):"ArrowRight"===s&&(u=document.getElementById(d[0])),u&&u.focus())}_watchForSectionChanges(l){if(this._generateSectionNames(),l){l.forEach(a=>{const o=`activeLayerInfo-${a.layer.uid}-version-change`;this._handles.remove(o),this._watchForSectionChanges(a.children),this._handles.add((0,V.YP)(()=>a.version,()=>this._generateSectionNames()),o)});const s="activeLayerInfos-collection-change";this._handles.remove(s),this._handles.add(l.on("change",()=>this._watchForSectionChanges(l)),s)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(l,s,a){return`${this.id}${l.uid}-type-${s.type}-${a}`}_generateSectionNamesForActiveLayerInfo(l){l.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),l.legendElements&&l.legendElements.forEach((s,a)=>{this._sectionNames.push(this._getSectionName(l.layer,s,a))})}_renderLegendForLayer(l){if(!l.ready)return null;if(l.children.length){const s=l.children.map(a=>this._renderLegendForLayer(a)).toArray();return(0,p.u)("div",{key:l.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},(0,p.u)("div",{class:"esri-legend--card__service-caption-container"},l.title),s)}{const s=l.legendElements;if(s&&!s.length)return null;const a=s.some(d=>"relationship-ramp"===d.type),o=s.map((d,u)=>this._renderLegendForElement(d,l,u,a)).filter(d=>!!d);return o.length?(0,p.u)("div",{key:l.layer.uid,class:this.classes("esri-legend--card__service",{"esri-legend--card__group-layer-child":!!l.parent})},(0,p.u)("div",{class:"esri-legend--card__service-caption-container"},(0,p.u)("div",{class:"esri-legend--card__service-caption-text"},l.title)),(0,p.u)("div",{class:"esri-legend--card__service-content"},o)):null}}_renderLegendForElement(l,s,a,o=!1){const u="size-ramp"===l.type,y=s.layer;let h=null;if("string"==typeof l.title)h=l.title;else if(l.title){const w=l.title,R=Ve(this.messages,w,"color-ramp"===l.type||"opacity-ramp"===l.type);h=w.title?`${w.title} (${R})`:R}const f=this._getSectionName(y,l,a),m=this._hasIndicators?(0,p.u)("div",null,(0,p.u)(Be.X6,{level:this.headingLevel,class:"esri-legend--card__carousel-title"},s.title),(0,p.u)(Be.X6,{level:(0,Be.MJ)(this.headingLevel),class:"esri-legend--card__layer-caption"},h)):h?(0,p.u)(Be.X6,{level:this.headingLevel,class:"esri-legend--card__layer-caption"},h):null,g=s.effectList;let _=null;if("symbol-table"===l.type){const w=l.infos.map((R,I)=>this._renderLegendForElementInfo(R,s,l.legendType,I)).filter(R=>!!R);w.length&&(_=(0,p.u)("div",{class:this.classes({"esri-legend--card__label-container":!(w[0].properties.classes&&w[0].properties.classes["esri-legend--card__symbol-row"]||o),"esri-legend--card__relationship-label-container":o})},w))}else"color-ramp"===l.type||"opacity-ramp"===l.type||"heatmap-ramp"===l.type?_=this._renderLegendForRamp(l,y.opacity,g):u?_=this._renderSizeRamp(l,y.opacity):"pie-chart-ramp"===l.type?_=this._renderPieChartRamp(l):"relationship-ramp"===l.type?_=Gt(l,this.id,y.opacity,g):"univariate-above-and-below-ramp"===l.type?_=this._renderUnivariateAboveAndBelowRamp(l,y.opacity,g):"univariate-color-size-ramp"===l.type&&(_=this._renderUnivariateColorSizeRamp(l,y.opacity,g));if(!_)return null;const L=(0,p.u)("div",{key:f,class:"esri-legend--card__section",id:`${f}-panel`,role:"tabpanel","aria-labelledby":f,tabIndex:0},[m,_]);return this._sectionMap.set(f,L),L}_renderPieChartRamp(l){return(0,p.u)("div",{class:"esri-legend--card__pie-chart-ramp-preview",bind:l.preview,afterCreate:W})}_renderUnivariateAboveAndBelowRamp(l,s,a){const{sizeRampElement:o,colorRampElement:c}=Kt(l,s,"horizontal");if(!o)return null;const d=yt(o,"full",!0,"horizontal"),u=Re(o,"above",!0,"horizontal"),y=Re(o,"below",!0,"horizontal"),f=Ee(c,{width:u,height:12,rampAlignment:"horizontal",opacity:s,type:"above",effectList:a}),m=Ee(c,{width:y,height:12,rampAlignment:"horizontal",opacity:s,type:"below",effectList:a}),g=Ze(o,"card"),_=o.infos.map(F=>F.label),L=_.length-1,w=_.map((F,z)=>0===z||z===L?(0,p.u)("div",{key:z},F):null),P={marginTop:"3px",display:"flex"};(0,pe.dZ)(this.container)?P.marginRight=`${g}px`:P.marginLeft=`${g}px`;const b={width:`${d}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,p.u)("div",{class:E_layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,p.u)("div",{class:this.classes(E_symbolContainer,"esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},o.infos.map((F,z)=>(0,p.u)("div",{key:z,class:E_symbol,bind:F.preview,afterCreate:W}))),f?(0,p.u)("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:P,key:"color-ramp-preview"},(0,p.u)("div",{bind:f,afterCreate:W}),(0,p.u)("div",{bind:m,afterCreate:W})):null,(0,p.u)("div",{class:E_layerInfo},(0,p.u)("div",{class:"esri-legend__ramp-labels",styles:b},w)))}_renderUnivariateColorSizeRamp(l,s,a){const{sizeRampElement:o,colorRampElement:c}=qt(l,"horizontal");if(!o)return null;const d=yt(o,"full",!1,"horizontal"),y=Ee(c,{width:Re(o,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:s,type:"full",effectList:a}),h=Ze(o,"card"),f=o.infos.length-1,m=o.infos.map((R,I)=>0===I||I===f?(0,p.u)("div",{key:I},R.label):null),L={marginTop:"3px",display:"flex"};(0,pe.dZ)(this.container)?L.marginRight=`${h}px`:L.marginLeft=`${h}px`;const w={width:`${d}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,p.u)("div",{class:E_layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,p.u)("div",{class:this.classes(E_symbolContainer,"esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},o.infos.map((R,I)=>(0,p.u)("div",{key:I,class:E_symbol,bind:R.preview,afterCreate:W}))),(0,p.u)("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:L,key:"color-ramp-preview"},(0,p.u)("div",{bind:y,afterCreate:W})),(0,p.u)("div",{class:E_layerInfo},(0,p.u)("div",{class:"esri-legend__ramp-labels",styles:w},m)))}_renderLegendForElementInfo(l,s,a,o){var u,y;const c=s.layer;if(l.type)return this._renderLegendForElement(l,s,o);const d=ti(c,a);if(l.preview){if(!l.symbol||!l.symbol.type.includes("simple-fill")){if(!l.label)return(0,p.u)("div",{key:o,bind:l.preview,afterCreate:W});const A={"esri-legend--card__symbol-cell":this._hasIndicators};return(0,p.u)("div",{key:o,class:this.classes(E_layerRow,{"esri-legend--card__symbol-row":this._hasIndicators})},(0,p.u)("div",{class:this.classes(A),bind:l.preview,afterCreate:W}),(0,p.u)("div",{class:this.classes("esri-legend--card__image-label",{"esri-legend--card__label-cell":this._hasIndicators})},Ve(this.messages,l.label,!1)||""))}let h=255,f=255,m=255,g=0,_=255,L=255,w=255,R=0;const I=l.symbol.color&&l.symbol.color.a,P=l.symbol.outline&&l.symbol.outline.color&&l.symbol.outline.color.a;I&&(h=l.symbol.color.r,f=l.symbol.color.g,m=l.symbol.color.b,g=l.symbol.color.a*c.opacity),P&&(_=l.symbol.outline.color.r,L=l.symbol.outline.color.g,w=l.symbol.outline.color.b,R=l.symbol.outline.color.a*c.opacity);const b=null==(y=null==(u=l.symbol.color)?void 0:u.isBright)||y,F=b?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",z={background:I?`rgba(${h}, ${f}, ${m}, ${g})`:"none",color:b?"black":"white",textShadow:`-1px -1px 0 ${F},\n                                              1px -1px 0 ${F},\n                                              -1px 1px 0 ${F},\n                                              1px 1px 0 ${F}`,border:P?`1px solid rgba(${_}, ${L}, ${w}, ${R})`:"none",filter:(0,fe.wJ)(s.effectList)};return(0,p.u)("div",{key:o,class:E_layerRow},(0,p.u)("div",{class:"esri-legend--card__label-element",styles:z}," ",l.label," "))}if(l.src){const h=this._renderImage(l,c,d);return(0,p.u)("div",{key:o,class:E_layerRow},h,(0,p.u)("div",{class:"esri-legend--card__image-label"},l.label||""))}}_renderImage(l,s,a){const{label:o,src:c,opacity:d}=l,u={"esri-legend--card__imagery-layer-image--stretched":a,[E_symbol]:!a},y={opacity:`${null!=d?d:s.opacity}`};return(0,p.u)("img",{alt:Ve(this.messages,o,!1),src:c,border:0,width:l.width,height:l.height,class:this.classes(u),styles:y})}_renderSizeRampLines(l){const s=l.infos,a=s[0],o=s[s.length-1],c=a.symbol,d=this._hasIndicators,u=(0,oe.F2)(a.size+a.outlineSize)*xe,y=(0,oe.F2)(o.size+o.outlineSize)*xe,h=d?u:u+50*xe,f=d?u/2+50*xe:u,m=function Fr(l){if(l){if(l.type.includes("3d")){const s=l.symbolLayers&&l.symbolLayers.length;if(!s)return;const a=l.symbolLayers.getItemAt(s-1).get("resource.primitive");return"triangle"===a||"cone"===a||"tetrahedron"===a}return"triangle"===l.style}}(c),g=function Tr(l){if(l){if(l.type.includes("3d")){const s=l.symbolLayers&&l.symbolLayers.length;if(!s)return;const a=l.symbolLayers.getItemAt(s-1),o=a.resource&&a.resource.primitive;return"circle"===o||"cross"===o||"kite"===o||"sphere"===o||"cube"===o||"diamond"===o}{const s=l.style;return"circle"===s||"diamond"===s||"cross"===s}}}(c),_=document.createElement("canvas");_.width=h,_.height=f,_.style.width=_.width/xe+"px",_.style.height=_.height/xe+"px";const L=_.getContext("2d");if(d){L.beginPath();const I=h/2-y/2,P=f;L.moveTo(0,0),L.lineTo(I,P);const z=h/2+y/2,A=f;L.moveTo(h,0),L.lineTo(z,A)}else{L.beginPath();const I=h,P=0;L.moveTo(0,f/2-y/2),L.lineTo(I,P);const z=h,A=f;L.moveTo(0,f/2+y/2),L.lineTo(z,A)}return L.strokeStyle="#ddd",L.stroke(),(0,p.u)("div",{bind:_,afterCreate:W,styles:d?{display:"flex",marginTop:`-${m?0:g?u/2:0}px`,marginBottom:`-${m?y:g?y/2:0}px`}:{display:"flex",marginRight:`-${m?0:g?u/2:0}px`,marginLeft:`-${m?0:g?y/2:0}px`}})}_renderSizeRamp(l,s){const a=l.infos,o=a[0].label,c=a[a.length-1].label;let d=a[0].preview,u=a[a.length-1].preview;const y=this._hasIndicators,h={"flex-direction":y?"column":"row-reverse"};d&&(d=d.cloneNode(!0),d.style.display="flex"),u&&(u=u.cloneNode(!0),u.style.display="flex");const f={opacity:null!=s?`${s}`:""};return(0,p.u)("div",{class:this.classes(E_layerRow,{"esri-legend--card__size-ramp-row":y})},(0,p.u)("div",{class:E_rampLabel},y?o:c),(0,p.u)("div",{class:"esri-legend--card__size-ramp-container",styles:h},(0,p.u)("div",{bind:d,afterCreate:W,class:"esri-legend--card__size-ramp-preview",styles:f}),this._renderSizeRampLines(l),(0,p.u)("div",{bind:u,afterCreate:W,class:"esri-legend--card__size-ramp-container",styles:f})),(0,p.u)("div",{class:E_rampLabel},y?c:o))}_renderLegendForRamp(l,s,a){const o=l.infos,c="heatmap-ramp"===l.type,d=o.length-1,y=d>2&&!c?25*d:100,h=y+20,m=o.slice(0).reverse();m.forEach((A,D)=>{A.offset=c?A.ratio:D/d});const g=m.length-1,_=m.length%2!=0&&m[m.length/2|0],L=_&&(0,p.u)("div",{class:"esri-legend--card__interval-separators-container"},(0,p.u)("div",{class:"esri-legend--card__interval-separator"},"|"),(0,p.u)("div",{class:E_rampLabel},_.label)),w=o[o.length-1].label,R=o[0].label,P=(0,de.KB)([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:m[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:y,height:25},fill:{type:"linear",x1:10,y1:0,x2:y+10,y2:0,colors:m},stroke:{width:0}},{shape:{type:"path",path:`M${y+10} 0 L${h} 12.5 L${y+10} 25 Z`},fill:m[g].color,stroke:{width:0}}]],h,25),{messages:b}=this,F={filter:(0,fe.wJ)(a),opacity:null==s?null:`${s}`};return(0,p.u)("div",{class:E_layerRow,styles:{justifyContent:"center"}},(0,p.u)("div",{class:E_rampLabel},c?b[w]:w),(0,p.u)("div",{class:E_symbolContainer},(0,p.u)("div",{styles:F},P),L),(0,p.u)("div",{class:E_rampLabel},c?b[R]:R))}};(0,S._)([(0,C.Cb)()],le.prototype,"activeLayerInfos",void 0),(0,S._)([(0,C.Cb)()],le.prototype,"headingLevel",void 0),(0,S._)([(0,C.Cb)()],le.prototype,"layout",void 0),(0,S._)([(0,C.Cb)(),(0,We.H)("esri/widgets/Legend/t9n/Legend")],le.prototype,"messages",void 0),(0,S._)([(0,C.Cb)(),(0,We.H)("esri/t9n/common")],le.prototype,"messagesCommon",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],le.prototype,"type",void 0),(0,S._)([(0,C.Cb)()],le.prototype,"view",void 0),(0,S._)([(0,Ir.h)()],le.prototype,"_selectSection",null),le=(0,S._)([(0,N.j)("esri.widgets.Legend.styles.Card")],le);const ft=le,T_layerBody="esri-legend__layer-body",T_layerRow="esri-legend__layer-row",T_layerInfo="esri-legend__layer-cell esri-legend__layer-cell--info",T_symbolContainer="esri-legend__layer-cell esri-legend__layer-cell--symbols",T_symbol="esri-legend__symbol",T_sizeRamp="esri-legend__size-ramp",T_rampLabel="esri-legend__ramp-label",ii={display:"flex",alignItems:"flex-start"},pt={marginLeft:"3px"},ze={display:"table-cell",verticalAlign:"middle"};let ge=class extends x.Z{constructor(l,s){super(l,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const l=this.activeLayerInfos,s=l&&l.toArray().map(a=>this._renderLegendForLayer(a)).filter(a=>!!a);return(0,p.u)("div",null,s&&s.length?s:(0,p.u)("div",{class:"esri-legend__message"},this.messages.noLegend))}_renderLegendForLayer(l){if(!l.ready)return null;const s=!!l.children.length,a=`esri-legend__${l.layer.uid}-version-${l.version}`,o=l.title?(0,Be.X6)({level:this.headingLevel,class:this.classes("esri-widget__heading","esri-legend__service-label")},l.title):null;if(s){const c=l.children.map(d=>this._renderLegendForLayer(d)).toArray();return(0,p.u)("div",{key:a,class:this.classes("esri-legend__service","esri-legend__group-layer")},o,c)}{const c=l.legendElements;if(c&&!c.length)return null;const d=c.map(y=>this._renderLegendForElement(y,l.layer,l.effectList)).filter(y=>!!y);return d.length?(0,p.u)("div",{key:a,class:this.classes("esri-legend__service",{"esri-legend__group-layer-child":!!l.parent}),tabIndex:0},o,(0,p.u)("div",{class:"esri-legend__layer"},d)):null}}_renderLegendForElement(l,s,a,o){const c="color-ramp"===l.type,d="opacity-ramp"===l.type,u="size-ramp"===l.type;let y=null;if("symbol-table"===l.type||u){const L=l.infos.map(w=>this._renderLegendForElementInfo(w,s,a,u,l.legendType)).filter(w=>!!w);L.length&&(y=(0,p.u)("div",{class:T_layerBody},L))}else"color-ramp"===l.type||"opacity-ramp"===l.type||"heatmap-ramp"===l.type||"stretch-ramp"===l.type?y=this._renderLegendForRamp(l,s.opacity):"relationship-ramp"===l.type?y=Gt(l,this.id,s.opacity,a):"pie-chart-ramp"===l.type?y=this._renderPieChartRamp(l):"univariate-above-and-below-ramp"===l.type?y=this._renderUnivariateAboveAndBelowRamp(l,s.opacity,a):"univariate-color-size-ramp"===l.type&&(y=this._renderUnivariateColorSizeRamp(l,s.opacity,a));if(!y)return null;const h=l.title;let f=null;if("string"==typeof h)f=h;else if(h){const L=Ve(this.messages,h,c||d);f=ei(0,c||d)&&h.title?`${h.title} (${L})`:L}const m=o?"esri-legend__layer-child-table":"esri-legend__layer-table",g=f?(0,p.u)("div",{class:"esri-legend__layer-caption"},f):null;return(0,p.u)("div",{class:this.classes(m,{"esri-legend__layer-table--size-ramp":u||!o})},g,y)}_renderPieChartRamp(l){return(0,p.u)("div",{bind:l.preview,afterCreate:W})}_renderUnivariateAboveAndBelowRamp(l,s,a){const{sizeRampElement:o,colorRampElement:c}=Kt(l,s);if(!o)return null;const d=Re(o,"above",!0),u=Re(o,"below",!0),h=Ee(c,{width:12,height:d,rampAlignment:"vertical",opacity:s,type:"above",effectList:a}),f=Ee(c,{width:12,height:u,rampAlignment:"vertical",opacity:s,type:"below",effectList:a}),m=Ze(o),g=o.infos.map(z=>z.label),_=g.map((z,A)=>0===A?(0,p.u)("div",{key:A,class:z?h?"esri-univariate-above-and-below-ramp__label":T_rampLabel:null},z):2===A?(0,p.u)("div",null):null),L=g.length-1,w=Math.floor(g.length/2),R=g.map((z,A)=>A===w||A===L?(0,p.u)("div",{key:A,class:z?h?"esri-univariate-above-and-below-ramp__label":T_rampLabel:null},z):null),I={display:"table-cell",verticalAlign:"middle"},P={marginTop:`${m}px`},b={height:`${d}px`},F={height:`${u}px`};return(0,p.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:ii},(0,p.u)("div",{class:T_layerBody},o.infos.map((z,A)=>(0,p.u)("div",{class:this.classes(T_layerRow,T_sizeRamp)},(0,p.u)("div",{class:T_symbol,styles:I,bind:z.preview,afterCreate:W}),h||A%2!=0?null:(0,p.u)("div",{class:T_layerInfo},g[A])))),h?(0,p.u)("div",{styles:P,key:"color-ramp-preview"},(0,p.u)("div",{styles:pt},(0,p.u)("div",{styles:ze},(0,p.u)("div",{class:"esri-legend__ramps",bind:h,afterCreate:W})),(0,p.u)("div",{styles:ze},(0,p.u)("div",{class:"esri-legend__ramp-labels",styles:b},_))),(0,p.u)("div",{styles:pt},(0,p.u)("div",{styles:ze},(0,p.u)("div",{class:"esri-legend__ramps",bind:f,afterCreate:W})),(0,p.u)("div",{styles:ze},(0,p.u)("div",{class:"esri-legend__ramp-labels",styles:F},R)))):null)}_renderUnivariateColorSizeRamp(l,s,a){const{sizeRampElement:o,colorRampElement:c}=qt(l);if(!o)return null;const d=Ze(o),y=Re(o,"full",!1),h=Ee(c,{width:12,height:y,rampAlignment:"vertical",opacity:s,type:"full",effectList:a}),f=o.infos.length-1,m=o.infos.map((w,R)=>0===R||R===f?(0,p.u)("div",{key:R,class:w.label?c?"esri-univariate-above-and-below-ramp__label":T_rampLabel:null},w.label):null),g={display:"table-cell",verticalAlign:"middle"},_={marginTop:`${d}px`},L={height:`${y}px`};return(0,p.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:ii},(0,p.u)("div",{class:T_layerBody},o.infos.map(w=>(0,p.u)("div",{class:this.classes(T_layerRow,T_sizeRamp)},(0,p.u)("div",{class:T_symbol,styles:g,bind:w.preview,afterCreate:W})))),(0,p.u)("div",{styles:_,key:"color-ramp-preview"},(0,p.u)("div",{styles:pt},(0,p.u)("div",{styles:ze},(0,p.u)("div",{class:"esri-legend__ramps",bind:h,afterCreate:W})),(0,p.u)("div",{styles:ze},(0,p.u)("div",{class:"esri-legend__ramp-labels",styles:L},m)))))}_renderLegendForRamp(l,s){const a=l.infos,c="heatmap-ramp"===l.type,d="stretch-ramp"===l.type,u=l.preview;u.className="esri-legend__color-ramp "+("opacity-ramp"===l.type?"esri-legend__opacity-ramp":""),null!=s&&(u.style.opacity=s.toString());const h=a.map(g=>(0,p.u)("div",{class:g.label?T_rampLabel:null},c?this.messages[g.label]||g.label:d?this._getStretchStopLabel(g):g.label)),m={height:u.style.height};return(0,p.u)("div",{class:T_layerRow},(0,p.u)("div",{class:T_symbolContainer,styles:{width:"24px"}},(0,p.u)("div",{class:"esri-legend__ramps",bind:u,afterCreate:W})),(0,p.u)("div",{class:T_layerInfo},(0,p.u)("div",{class:"esri-legend__ramp-labels",styles:m},h)))}_getStretchStopLabel(l){return l.label?this.messages[l.label]+": "+("string"==typeof l.value?l.value:(0,Tt.uf)(l.value,{style:"decimal",notation:l.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(l,s,a,o,c){if(l.type)return this._renderLegendForElement(l,s,a,!0);let d=null;const u=ti(s,c);if(l.preview?d=(0,p.u)("div",{class:T_symbol,bind:l.preview,afterCreate:W}):l.src&&(d=this._renderImage(l,s,u)),!d)return null;const y={"esri-legend__imagery-layer-info--stretched":u};return(0,p.u)("div",{class:T_layerRow},(0,p.u)("div",{class:this.classes(T_symbolContainer,{"esri-legend__imagery-layer-info--stretched":u,[T_sizeRamp]:!u&&o})},d),(0,p.u)("div",{class:this.classes(T_layerInfo,y)},Ve(this.messages,l.label,!1)||""))}_renderImage(l,s,a){const{label:o,src:c,opacity:d}=l,u={"esri-legend__imagery-layer-image--stretched":a,[T_symbol]:!a},y={opacity:`${null!=d?d:s.opacity}`};return(0,p.u)("img",{alt:Ve(this.messages,o,!1),src:c,border:0,width:l.width,height:l.height,class:this.classes(u),styles:y})}};(0,S._)([(0,C.Cb)()],ge.prototype,"activeLayerInfos",void 0),(0,S._)([(0,C.Cb)()],ge.prototype,"headingLevel",void 0),(0,S._)([(0,C.Cb)(),(0,We.H)("esri/widgets/Legend/t9n/Legend")],ge.prototype,"messages",void 0),(0,S._)([(0,C.Cb)({readOnly:!0})],ge.prototype,"type",void 0),ge=(0,S._)([(0,N.j)("esri.widgets.Legend.styles.Classic")],ge);const Te=ge;let Y=class extends x.Z{constructor(l,s){super(l,s),this._handles=new q.Z,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass="esri-icon-layer-list",this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new Te,this.view=null,this.viewModel=new gr}initialize(){this.own([(0,V.on)(()=>this.view,"resize",()=>this.scheduleRender()),(0,V.on)(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),(0,V.YP)(()=>this.headingLevel,l=>{const{style:s}=this;s&&(s.headingLevel=l)}),(0,V.YP)(()=>this.style,(l,s)=>{s&&l!==s&&s.destroy(),l&&(l.activeLayerInfos=this.activeLayerInfos,"card"===l.type&&(l.view=this.view),l.headingLevel=this.headingLevel)},V.nn)])}destroy(){this._handles=(0,Q.SC)(this._handles)}castStyle(l){if(l instanceof ft||l instanceof Te)return l;if("string"==typeof l)return"card"===l?new ft:new Te;if(l&&"string"==typeof l.type){const s=ae({},l);return delete s.type,new("card"===l.type?ft:Te)(s)}return new Te}render(){return(0,p.u)("div",{class:this.classes("esri-legend","esri-widget",this.style instanceof Te?"esri-widget--panel":null)},this.style.render())}_refreshActiveLayerInfos(l){this._handles.removeAll(),l.forEach(s=>this._renderOnActiveLayerInfoChange(s)),this.scheduleRender()}_renderOnActiveLayerInfoChange(l){const s=(0,V.YP)(()=>l.version,()=>this.scheduleRender());this._handles.add(s,`version_${l.layer.uid}`);const a=(0,V.on)(()=>l.children,"change",()=>l.children.forEach(o=>this._renderOnActiveLayerInfoChange(o)),V.nn);this._handles.add(a,`children_${l.layer.uid}`),l.children.forEach(o=>this._renderOnActiveLayerInfoChange(o))}};(0,S._)([(0,B.B)("viewModel.activeLayerInfos")],Y.prototype,"activeLayerInfos",void 0),(0,S._)([(0,B.B)("viewModel.basemapLegendVisible")],Y.prototype,"basemapLegendVisible",void 0),(0,S._)([(0,B.B)("viewModel.groundLegendVisible")],Y.prototype,"groundLegendVisible",void 0),(0,S._)([(0,C.Cb)()],Y.prototype,"headingLevel",void 0),(0,S._)([(0,B.B)("viewModel.hideLayersNotInCurrentView")],Y.prototype,"hideLayersNotInCurrentView",void 0),(0,S._)([(0,B.B)("viewModel.keepCacheOnDestroy")],Y.prototype,"keepCacheOnDestroy",void 0),(0,S._)([(0,B.B)("viewModel.respectLayerVisibility")],Y.prototype,"respectLayerVisibility",void 0),(0,S._)([(0,C.Cb)()],Y.prototype,"iconClass",void 0),(0,S._)([(0,C.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Y.prototype,"label",void 0),(0,S._)([(0,B.B)("viewModel.layerInfos")],Y.prototype,"layerInfos",void 0),(0,S._)([(0,C.Cb)(),(0,We.H)("esri/widgets/Legend/t9n/Legend")],Y.prototype,"messages",void 0),(0,S._)([(0,C.Cb)()],Y.prototype,"style",void 0),(0,S._)([(0,X.p)("style")],Y.prototype,"castStyle",null),(0,S._)([(0,B.B)("viewModel.view")],Y.prototype,"view",void 0),(0,S._)([(0,C.Cb)()],Y.prototype,"viewModel",void 0),Y=(0,S._)([(0,N.j)("esri.widgets.Legend")],Y);const Pr=Y}}]);