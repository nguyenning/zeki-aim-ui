"use strict";var hn=Object.defineProperty,vn=Object.defineProperties,mn=Object.getOwnPropertyDescriptors,bt=Object.getOwnPropertySymbols,_n=Object.prototype.hasOwnProperty,gn=Object.prototype.propertyIsEnumerable,Ut=(G,L,e)=>L in G?hn(G,L,{enumerable:!0,configurable:!0,writable:!0,value:e}):G[L]=e,dt=(G,L)=>{for(var e in L||(L={}))_n.call(L,e)&&Ut(G,e,L[e]);if(bt)for(var e of bt(L))gn.call(L,e)&&Ut(G,e,L[e]);return G},ht=(G,L)=>vn(G,mn(L));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[977],{19902:(G,L,e)=>{e.r(L),e.d(L,{default:()=>un});var v=e(15861),o=e(17626),g=e(14517),b=e(46160),p=e(62208),O=e(32917),c=e(77712),V=(e(85931),e(8314),e(90912)),A=e(76898),W=e(1437),y=e(54024),j=e(26242),N=e(91558);e(29132);var X=e(79608),$=e(23719),nt=e(66656),it=e(2004),E=e(49672);let U=class extends X.j{constructor(n){super(n),this.type="length",this.startPoint=null,this.endPoint=null,this.axis="horizontal",this.offset=0,this.heading=0}get extent(){if((0,p.Wi)(this.startPoint))return null;const n=it.Z.fromPoint(this.startPoint);return(0,p.pC)(this.endPoint)&&n.union(it.Z.fromPoint(this.endPoint)),n}};(0,o._)([(0,c.Cb)({type:["length"]})],U.prototype,"type",void 0),(0,o._)([(0,c.Cb)({type:E.Z})],U.prototype,"startPoint",void 0),(0,o._)([(0,c.Cb)({type:E.Z})],U.prototype,"endPoint",void 0),(0,o._)([(0,c.Cb)({type:["horizontal","vertical","direct"],nonNullable:!0})],U.prototype,"axis",void 0),(0,o._)([(0,c.Cb)({type:Number,nonNullable:!0})],U.prototype,"offset",void 0),(0,o._)([(0,c.Cb)({type:Number,nonNullable:!0}),(0,nt.p)(n=>$.BV.normalize((0,V.q9)(n),0,!0))],U.prototype,"heading",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],U.prototype,"extent",null),U=(0,o._)([(0,A.j)("esri.analysis.LengthDimension")],U);const S=U;var I=e(80542),J=e(72392),F=e(10699),Z=e(84786),d=e(23841);const m={main:new N.Z([255,127,0])};class f{constructor(){this.color=m.main,this.opacity=.5,this.radius=5}}class M{constructor(){this.fontSize=14}get height(){return 1.5*(0,d.F2)(this.fontSize)}get offset(){return this.height+20}}const u=new class h{constructor(){this.pointManipulators=new f,this.labels=new M}};var _=e(19142),T=e(96813),D=e(8859),P=e(50017),z=e(75079),x=e(466),Q=e(26777),k=e(79682),q=e(83308),rt=e(14380),Wt=e(44725),At=e(94033),St=e(28093),jt=e(42930),wt=e(97126),It=e(60507),Ht=e(75897),zt=e(70211);let ct=class extends I.r{constructor(n){super(n),this.availability=0,this._ids=new Set,this.tmpP=(0,St.c)()}destroy(){this.workerHandle.destroy(),this.workerHandle=null}initialize(){this.workerHandle=new Bt(this.schedule,{fetchAllEdgeLocations:(n,i)=>this._fetchAllEdgeLocations(n,i)})}fetchCandidates(n,i){var a=this;return(0,v.Z)(function*(){const l=n.coordinateHelper.toXYZ(n.point);a.view.renderCoordsHelper.toRenderCoords(l,n.coordinateHelper.spatialReference,l);const C="number"==typeof n.distance?n.distance:n.distance.pixelSize,R=yield a.workerHandle.invoke({bounds:(0,wt.f)(l[0],l[1],l[2],C),types:n.types},i),K=n.coordinateHelper;return R.candidates.sort((Y,at)=>Y.distance-at.distance),R.candidates.map(Y=>a._convertCandidate(K,Y))})()}add(n,i){var a=this;return(0,v.Z)(function*(){a._ids.add(n.id),yield a.workerHandle.invokeMethod("add",n,i)})()}remove(n,i){var a=this;return(0,v.Z)(function*(){a._ids.delete(n.id),yield a.workerHandle.invokeMethod("remove",n,i)})()}_convertCandidate(n,i){switch(i.type){case"edge":return new Ht.L({coordinateHelper:n,objectId:i.objectId,targetPoint:this._convertRenderCoordinate(n,i.target),edgeStart:this._convertRenderCoordinate(n,i.start),edgeEnd:this._convertRenderCoordinate(n,i.end),elevationInfo:It.jG});case"vertex":return new zt.x({coordinateHelper:n,objectId:i.objectId,targetPoint:this._convertRenderCoordinate(n,i.target),elevationInfo:It.jG})}}_convertRenderCoordinate(n,i){return this.view.renderCoordsHelper.fromRenderCoords(i,this.tmpP,n.spatialReference),n.fromXYZ(this.tmpP)}_fetchAllEdgeLocations(n,i){var a=this;return(0,v.Z)(function*(){const l=[],C=[];for(const{id:R,uid:K}of n.components)a._ids.has(R)&&l.push((0,v.Z)(function*(){const Y=yield a.fetchEdgeLocations(R,i.signal);return C.push(Y.locations.buffer),{id:R,uid:K,objectIds:Y.objectIds,locations:Y.locations.buffer,origin:Y.origin,type:Y.type}})());return{result:{components:(yield Promise.all(l)).filter(({id:R})=>a._ids.has(R))},transferList:C}})()}};(0,o._)([(0,c.Cb)({constructOnly:!0})],ct.prototype,"view",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0})],ct.prototype,"fetchEdgeLocations",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0})],ct.prototype,"schedule",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],ct.prototype,"availability",void 0),ct=(0,o._)([(0,A.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],ct);class Bt extends jt.q{constructor(i,a){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},i,{strategy:"dedicated",client:a})}}let pt=class extends I.r{constructor(n){super(n),this.availability=1,this.abortController=new AbortController}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){this.abortController=(0,p.IM)(this.abortController)}initialize(){var n=this;const i=this.view.resourceController;var a;this.edgeWorker=new At.Z(a=>i.schedule(a)),this.workerHandle=new ct({view:this.view,schedule:a=>i.schedule(a),fetchEdgeLocations:(a=(0,v.Z)(function*(l,C){if((0,p.Wi)(n.tracker))throw new Error("tracker-not-initialized");return n.tracker.fetchEdgeLocations(l,n.edgeWorker,C)}),function(C,R){return a.apply(this,arguments)})}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([(0,y.ed)(this.workerHandle),(0,y.ed)(this.edgeWorker)])}fetchCandidates(n,i){var a=this;return(0,v.Z)(function*(){return a.workerHandle.fetchCandidates(n,i)})()}refresh(){}_setupLayerView(){var n=this;return(0,v.Z)(function*(){const i=yield n.view.whenLayerView(n.layer);if("scene-layer-graphics-3d"===i.type)return;const a={add:(l,C)=>n.updatingHandles.addPromise(n.workerHandle.add({id:l,bounds:C},n.abortController.signal)),remove:l=>n.updatingHandles.addPromise(n.workerHandle.remove({id:l},n.abortController.signal))};n.tracker=i.trackSnappingSources(a),n.handles.add(n.tracker)})()}};(0,o._)([(0,c.Cb)({constructOnly:!0})],pt.prototype,"layerSource",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0})],pt.prototype,"view",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],pt.prototype,"updating",null),(0,o._)([(0,c.Cb)({readOnly:!0})],pt.prototype,"availability",void 0),pt=(0,o._)([(0,A.j)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],pt);var Vt=e(25858);let ut=class extends g.Z{constructor(n){super(n),this.options=null,this._snappingSources=new b.Z}initialize(){this.own([this.view.on("layerview-create",({layerView:n})=>this._createSource(n)),this.view.on("layerview-destroy",({layerView:n})=>this._removeSource(n))]);for(const n of this.view.allLayerViews.items)this._createSource(n)}destroy(){this.options=null,this._snappingSources.drain(n=>n.destroy())}get updating(){return this._snappingSources.some(n=>n.updating)}get _types(){return q.r.EDGE|q.r.VERTEX}fetchCandidates(n,i,a){var l=this;return(0,v.Z)(function*(){const{view:C,options:R}=l,{coordinateHelper:K,elevationInfo:Y}=i,at=(0,p.pC)(R)?R.distance:1,Et=(0,Vt.$r)(n,K,Y,C,j.WM.get()),gt=at*C.state.camera.computeScreenPixelSizeAt(Et),lt=l._types,Pt=l._snappingSources.items.map(xt=>xt.fetchCandidates({point:n,coordinateHelper:K,distance:gt,types:lt},a)),Ot=(yield Promise.all(Pt)).flat();return(0,Wt.lQ)(n,Ot),Ot})()}_createSource(n){if("scene-layer-3d"!==n.type)return;const i=new pt({layerSource:new rt.Z({layer:n.layer}),view:this.view});this._snappingSources.push(i)}_removeSource(n){const i=this._snappingSources.findIndex(a=>a.layerSource.layer===n.layer);-1!==i&&this._snappingSources.removeAt(i).destroy()}};(0,o._)([(0,c.Cb)({constructOnly:!0})],ut.prototype,"view",void 0),(0,o._)([(0,c.Cb)()],ut.prototype,"updating",null),(0,o._)([(0,c.Cb)()],ut.prototype,"options",void 0),(0,o._)([(0,c.Cb)()],ut.prototype,"_snappingSources",void 0),ut=(0,o._)([(0,A.j)("esri.views.interactive.snapping.SceneSnappingEngine")],ut);var Gt=e(45390);const Mt=new Map;function Nt(n){return new Gt.N({view:n,snappingEnginesFactory:(i,a)=>[new ut({view:n,options:a})]})}var Ft=e(9773),Yt=e(94009),Xt=e(53912);let vt=class extends I.r{constructor(n){super(n),this.stagedDimension=null,this._dimensionManipulators=new Map,this._dimensionHandles=new J.Z,this._snappingPipeline=new Yt.n,this._snappingManagerResult=function Kt(n){Mt.has(n)||Mt.set(n,{referenceCount:0,snappingManager:Nt(n)});const i=Mt.get(n);i.referenceCount++;const a=(0,y.kB)(()=>function Zt(n,i){i.referenceCount--,i.referenceCount>0||(0,k.Y)(()=>{0===i.referenceCount&&(i.snappingManager.destroy(),Mt.delete(n))})}(n,i));return dt({snappingManager:i.snappingManager},a)}(n.view),this.own(this._snappingManagerResult)}initialize(){this._snappingOperation=new Xt.y({view:this.view}),this.own([this._dimensionHandles,(0,O.YP)(()=>this._snappingOperation.stagedPoint,n=>{(0,p.pC)(this.stagedDimension)&&(this.stagedDimension.endPoint=(0,p.yw)(n,i=>(0,Z.WG)(i,new E.Z)))},O.Z_)])}destroy(){this._snappingOperation=(0,p.SC)(this._snappingOperation)}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get _snappingManager(){return this._snappingManagerResult.snappingManager}addDimension(n,i){if(this._dimensionManipulators.has(n))return;const a=this._createPointManipulator(n,{isStart:!0}),l=this._createPointManipulator(n,{isStart:!1}),C={startManipulator:a,endManipulator:l};this._setupDimensionToManipulatorsSync(n,C),this._dimensionManipulators.set(n,C),i.add(a),i.add(l)}removeDimension(n,i){const a=this._dimensionManipulators.get(n);if((0,p.Wi)(a))return;this._dimensionHandles.remove(n);const{startManipulator:l,endManipulator:C}=a;this._dimensionManipulators.delete(n),i.remove(l),i.remove(C)}getManipulatorsForDimension(n){return this._dimensionManipulators.get(n)}onDeactivate(){this._snappingManager.doneSnapping()}onUnstagedClick({mapPoint:n,pointerType:i}){const a=this._snappingContext(i),l=(0,Z.WG)(this._snappingManager.update(n,a),new E.Z),C=new S({startPoint:l,endPoint:null});return this.stagedDimension=C,this._snappingManager.doneSnapping(),C}onStagedClick({mapPoint:n,pointerType:i}){if((0,p.Wi)(this.stagedDimension))return;const a=this._snappingContext(i),l=(0,Z.WG)(this._snappingManager.update(n,a),new E.Z);this.stagedDimension.endPoint=l,this.stagedDimension=null,this._snappingManager.doneSnapping()}onPointerMove({mapPoint:n,pointerType:i}){const a=this._snappingContext(i);this.updatingHandles.addPromise((0,F.R8)(this._snappingOperation.snap(n,this._snappingManager,a)))}_setupDimensionToManipulatorsSync(n,i){const{startManipulator:a,endManipulator:l}=i;this._dimensionHandles.add([(0,O.YP)(()=>({startPoint:n.startPoint,endPoint:n.endPoint,stagedDimension:this.stagedDimension}),({startPoint:C,endPoint:R,stagedDimension:K})=>{(0,p.pC)(C)?(a.available=(0,p.Wi)(K)||K===n,a.location=C):a.available=!1,(0,p.pC)(R)?(l.available=(0,p.Wi)(K),l.location=R):l.available=!1},O.tX)],n)}_createPointManipulator(n,i){const{isStart:a}=i,l=a?"startPoint":"endPoint",C=(0,_.aD)(this.view,N.Z.toUnitRGB(u.pointManipulators.color),u.pointManipulators.opacity);C.available=!1,C.radius=u.pointManipulators.radius;const R=(0,z.Xd)(C,(K,Y,at,Et)=>{const gt=(0,D.J4)(K);Y.next(gt).next((0,D.gv)(this.view)).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(Et),snappingManager:this._snappingManager,cancel:at,updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(lt=>{const Pt=(0,Z.WG)(lt.mapEnd,new E.Z);n[l]=Pt}),at.next(gt).next((0,z.di)(n,[l]))});return this._dimensionHandles.add(R,n),C}_snappingContext(n){return new Ft.N({elevationInfo:{mode:"absolute-height",offset:0},pointer:n,editGeometryOperations:new Q.c(new x.XE("point",(0,P.Y6)(!0,!1,this.view.spatialReference))),visualizer:new T._})}};(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],vt.prototype,"view",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],vt.prototype,"updating",null),(0,o._)([(0,c.Cb)()],vt.prototype,"stagedDimension",void 0),vt=(0,o._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionSubTool")],vt);var mt,n,$t=e(62483),Jt=e(67857),Qt=e(22712),kt=e(41900);(n=mt||(mt={})).Ready="ready",n.Creating="creating",n.Created="created";let tt=class extends Qt.f{constructor(n){super(n),this.preferManipulatorCursor=!0,this.analysisViewData=null}initialize(){this._intersector=(0,$t.Z8)(this.view.state.viewingMode),this._intersector.options.store=Jt.eC.MIN,this._lengthDimensionSubTool=new vt({view:this.view}),this.own((0,y.ed)(this._lengthDimensionSubTool));for(const n of this.analysis.dimensions.items)this._addDimension(n);this.own(this.analysis.dimensions.on("change",n=>{for(const i of n.added)this._addDimension(i);for(const i of n.removed)this._removeDimension(i)})),this.own((0,O.YP)(()=>this.state,n=>{n===mt.Created&&this.finishToolCreation()},O.tX))}get state(){return this.analysis.dimensions.some(n=>"length"===n.type)?(0,p.pC)(this._activeSubTool)?mt.Creating:mt.Created:mt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}getManipulatorsForDimension(n){return this._lengthDimensionSubTool.getManipulatorsForDimension(n)}onInputEvent(n){switch(n.type){case"immediate-click":this._clickHandler(n);break;case"immediate-double-click":this._doubleClickHandler(n);break;case"pointer-move":this._pointerMoveHandler(n)}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,p.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),(0,p.pC)(this._activeSubTool.stagedDimension)&&(this.analysis.dimensions.remove(this._activeSubTool.stagedDimension),this._activeSubTool.stagedDimension=null),this._activeSubTool=null)}_clickHandler(n){if((0,p.Wi)(this._activeSubTool))return;const i=this._intersectScreen(n);if(!(0,p.Wi)(i)){if((0,p.Wi)(this._activeSubTool.stagedDimension)){const a=this._activeSubTool.onUnstagedClick({mapPoint:i,pointerType:n.pointerType});this.analysis.dimensions.add(a)}else this._activeSubTool.onStagedClick({mapPoint:i,pointerType:n.pointerType});n.stopPropagation()}}_doubleClickHandler(n){this.view.activeTool=null,n.stopPropagation()}_pointerMoveHandler(n){if((0,p.Wi)(this._activeSubTool)||this.hasFocusedManipulators)return;const i=this._intersectScreen(n);(0,p.Wi)(i)||this._activeSubTool.onPointerMove({mapPoint:i,pointerType:n.pointerType})}_intersectScreen(n){const i=(0,kt.Sj)(n);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const a=this._intersector.results.min,l=j.WM.get();return a.getIntersectionPoint(l)?this.view.renderCoordsHelper.fromRenderCoords(l,this.view.spatialReference):null}_addDimension(n){this._lengthDimensionSubTool.addDimension(n,this.manipulators)}_removeDimension(n){this._lengthDimensionSubTool.removeDimension(n,this.manipulators)}};(0,o._)([(0,c.Cb)({constructOnly:!0})],tt.prototype,"view",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0})],tt.prototype,"analysis",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],tt.prototype,"state",null),(0,o._)([(0,c.Cb)({readOnly:!0})],tt.prototype,"updating",null),(0,o._)([(0,c.Cb)({readOnly:!0})],tt.prototype,"cursor",null),(0,o._)([(0,c.Cb)({readOnly:!0})],tt.prototype,"preferManipulatorCursor",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0})],tt.prototype,"analysisViewData",void 0),(0,o._)([(0,c.Cb)()],tt.prototype,"_activeSubTool",void 0),(0,o._)([(0,c.Cb)()],tt.prototype,"_lengthDimensionSubTool",void 0),tt=(0,o._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.DimensioningTool")],tt);var qt=e(15572),H=e(84161),tn=e(4794),nn=e(78172),en=e(15348),sn=e(67214),Tt=e(87469),yt=e(64770),on=e(40723),an=e(54889);let ft=class extends g.Z{constructor(n){super(n),this._directSegment=new yt.y$,this._dimensionSegment=new yt.y$,this._offsetAxis=(0,St.c)(),this._startOffsetSegment=new yt.y$(this._directSegment.startRenderSpace,this._dimensionSegment.startRenderSpace),this._endOffsetSegment=new yt.y$(this._directSegment.endRenderSpace,this._dimensionSegment.endRenderSpace),this._labelSegment=new yt.y$,this._hasValidGeometry=!1;const i={view:n.view,attached:!0,width:1,color:(0,tn.f)(1,.5,0,1),renderOccluded:on.yD.OccludeAndTransparent},a=ht(dt({},i),{stipplePattern:(0,an.z5)(5)});this._dimensionVisualElement=new Tt.r(i),this._startOffsetVisualElement=new Tt.r(a),this._endOffsetVisualElement=new Tt.r(a),this._label=new sn.Kc({view:n.view,attached:!0,distance:0,fontSize:u.labels.fontSize})}initialize(){this.own([(0,y.ed)(this._dimensionVisualElement),(0,y.ed)(this._startOffsetVisualElement),(0,y.ed)(this._endOffsetVisualElement),(0,y.ed)(this._label)]);const{computation:n,view:i}=this,{dimension:a}=n;this.own([(0,O.YP)(()=>({startPoint:a.startPoint,endPoint:a.endPoint,offset:a.offset,axis:a.axis,heading:a.heading}),l=>{this._updateGeometry(l),this._updateLines(),this._updateLabelGeometry(i.state.camera)},O.nn),(0,O.YP)(()=>n.length,l=>this._updateLabelContent(l),O.nn),(0,O.YP)(()=>i.state.camera,l=>this._updateLabelGeometry(l),O.nn)])}get testInfo(){return{dimensionVisualElement:this._dimensionVisualElement,label:this._label}}_updateGeometry({startPoint:n,endPoint:i,offset:a,axis:l}){const{renderCoordsHelper:C}=this.view,R=this._directSegment;if((0,p.Wi)(n)||(0,p.Wi)(i)||!C.toRenderCoords(n,R.startRenderSpace)||!C.toRenderCoords(i,R.endRenderSpace))return void(this._hasValidGeometry=!1);const{startRenderSpace:K,endRenderSpace:Y}=R,at=R.eval(.5,j.WM.get()),Et=C.worldUpAtPosition(at,j.WM.get()),gt=C.worldBasisAtPosition(at,nn.R.X,j.WM.get()),lt=this._offsetAxis;!function rn(n,i,a,l,C,R){switch(C){case"horizontal":return(0,H.c)(n,l);case"vertical":return(0,H.e)(i,l)<(0,H.e)(a,l)?(0,H.v)(n,a,i):(0,H.v)(n,i,a),(0,H.f)(n,n,l),(0,H.z)(n,St.Z)?(0,H.c)(n,R):((0,H.f)(n,n,l),(0,H.n)(n,n),n);case"direct":(0,H.e)(i,R)>(0,H.e)(a,R)?(0,H.v)(n,a,i):(0,H.v)(n,i,a),(0,H.f)(n,n,l),(0,H.z)(n,St.Z)?(0,H.c)(n,R):(0,H.n)(n,n)}}(lt,K,Y,Et,l,gt);const Pt=a/C.unitInMeters,[Ot,xt]=function ln(n,i,a,l=0){const C=(0,H.e)(i,a),R=(0,H.e)(n,a),K=Math.abs(C-R)+l;return C>R?[K,l]:[l,K]}(K,Y,lt,Pt),Lt=this._dimensionSegment;(0,H.C)(Lt.startRenderSpace,R.startRenderSpace,lt,Ot),(0,H.C)(Lt.endRenderSpace,R.endRenderSpace,lt,xt),this._hasValidGeometry=!0}_updateLines(){if(!this._hasValidGeometry)return this._dimensionVisualElement.visible=!1,this._startOffsetVisualElement.visible=!1,void(this._endOffsetVisualElement.visible=!1);this._dimensionVisualElement.setGeometryFromSegment(this._dimensionSegment),this._startOffsetVisualElement.setGeometryFromSegment(this._startOffsetSegment),this._endOffsetVisualElement.setGeometryFromSegment(this._endOffsetSegment),this._dimensionVisualElement.visible=!0,this._startOffsetVisualElement.visible=!0,this._endOffsetVisualElement.visible=!0}_updateLabelContent(n){if((0,p.Wi)(n)||!this._hasValidGeometry)return this._label.text="",void(this._label.visible=!1);const{value:i}=(0,qt.nn)(n,"meters");this._label.text=`${(0,en.uf)(i,{minimumFractionDigits:2,maximumFractionDigits:2})} m`,this._label.visible=!0}_updateLabelGeometry(n){if(!this._hasValidGeometry)return void(this._label.visible=!1);const{offset:i}=this.computation.dimension,a=n.computeRenderPixelSizeAt(this._dimensionSegment.eval(.5,j.WM.get())),l=(Math.sign(i)>=0?1:-1)*u.labels.offset*a;(function dn(n,i,a,l){(0,H.C)(n.startRenderSpace,i.startRenderSpace,a,l),(0,H.C)(n.endRenderSpace,i.endRenderSpace,a,l)})(this._labelSegment,this._dimensionSegment,this._offsetAxis,l),this._label.geometry={type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1}}};(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"computation",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"view",void 0),ft=(0,o._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionVisualization")],ft);let Ct=class extends g.Z{constructor(n){super(n),this._dimensionVisualizations=new Map}initialize(){for(const n of this.computations)this._addComputation(n);this.own(this.computations.on("change",({added:n,removed:i})=>{for(const a of i)this._removeComputation(a);for(const a of n)this._addComputation(a)}))}destroy(){this._dimensionVisualizations.forEach(n=>{n.destroy()}),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values())}}_addComputation(n){this._dimensionVisualizations.has(n)||this._dimensionVisualizations.set(n,new ft({computation:n,view:this.view}))}_removeComputation(n){const i=this._dimensionVisualizations.get(n);(0,p.Wi)(i)||(i.destroy(),this._dimensionVisualizations.delete(n))}};(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"view",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"computations",void 0),Ct=(0,o._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.DimensioningVisualization")],Ct);let Dt=class extends g.Z{constructor(n){super(n),this.dimension=null}};(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Dt.prototype,"dimension",void 0),Dt=(0,o._)([(0,A.j)("esri.views.3d.analysis.LengthDimensionResult")],Dt);const cn=Dt;var pn=e(71572);let _t=class extends g.Z{constructor(n){super(n)}initialize(){this._set("result",new cn({dimension:this.dimension}))}get length(){const{startPoint:n,endPoint:i,axis:a}=this.dimension;if((0,p.Wi)(n)||(0,p.Wi)(i))return null;const l=(0,pn.Uy)(n,i);return(0,p.Wi)(l)?null:l[a]}};(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],_t.prototype,"dimension",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],_t.prototype,"result",void 0),(0,o._)([(0,c.Cb)()],_t.prototype,"length",null),_t=(0,o._)([(0,A.j)("esri.views.3d.analysis.LengthDimensionComputation")],_t);var Rt=e(95925);let st=class extends((0,W.p)(g.Z)){constructor(n){super(n),this.type="dimensioning-view-3d",this.tool=null,this._computations=new b.Z,this._dimensionsToResults=new Map,this._placementTask=null}initialize(){this.own([(0,Rt.Lp)(this,tt),(0,O.on)(()=>this.analysis.dimensions,"change",({added:n,removed:i})=>{for(const a of i)this._removeDimension(a);for(const a of n)this._addDimension(a)},{onListenerAdd:n=>{for(const i of n)this._addDimension(i)},onListenerRemove:n=>{for(const i of n)this._removeDimension(i)}})]),this._analysisVisualization=new Ct({view:this.view,computations:this._computations})}destroy(){this._placementTask=(0,p.IM)(this._placementTask),this._analysisVisualization=(0,p.SC)(this._analysisVisualization),this._computations.drain(n=>n.destroy()),(0,Rt.Yq)(this)}get results(){return this.analysis.dimensions.map(n=>this._dimensionsToResults.get(n))}get testInfo(){return{visualization:this._analysisVisualization}}createLengthDimensions(n){var i=this;return(0,v.Z)(function*(){return i._placementTask=(0,p.IM)(i._placementTask),i._placementTask=(0,Rt.P9)(i,tt,n),i._placementTask.promise})()}_addDimension(n){const i=this._dimensionsToResults;if(i.has(n))return;const a=this._computations,l=new _t({dimension:n});a.add(l),i.set(n,l.result)}_removeDimension(n){const i=this._computations,a=this._dimensionsToResults,l=i.findIndex(R=>R.dimension===n),C=i.removeAt(l);a.delete(n),(0,p.SC)(C)}};(0,o._)([(0,c.Cb)({readOnly:!0})],st.prototype,"type",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],st.prototype,"analysis",void 0),(0,o._)([(0,c.Cb)()],st.prototype,"tool",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],st.prototype,"results",null),(0,o._)([(0,c.Cb)()],st.prototype,"_analysisVisualization",void 0),(0,o._)([(0,c.Cb)()],st.prototype,"_computations",void 0),(0,o._)([(0,c.Cb)()],st.prototype,"_dimensionsToResults",void 0),(0,o._)([(0,c.Cb)()],st.prototype,"_placementTask",void 0),st=(0,o._)([(0,A.j)("esri.views.3d.analysis.DimensioningAnalysisView3D")],st);const un=st},8859:(G,L,e)=>{e.d(L,{G:()=>nt,J4:()=>Z,Sp:()=>S,VG:()=>it,_N:()=>B,_y:()=>E,bB:()=>w,gv:()=>d,zP:()=>J});var F,h,v=e(62208),o=e(23841),g=e(84161),b=e(28093),p=e(55915),O=e(90014),c=e(70562),ot=e(34054),et=e(26242),V=e(60507),A=e(26046),W=e(62483),y=e(67857),j=e(40841),N=e(75079);function B(h,u){return X(h,()=>u)}function w(h){return X(h,u=>u.plane)}function X(h,u){const _=(0,b.c)(),T=(0,b.c)();let D=!1;return P=>{const z=u(P);if("start"===P.action){const k=(0,o.md)(P.screenStart,(0,o.c$)(et.qW.get())),q=(0,A.u4)(h.state.camera,k,M);(0,v.pC)(q)&&(D=(0,O.BR)(z,q,_))}if(!D)return null;const x=(0,o.md)(P.screenEnd,(0,o.c$)(et.qW.get())),Q=(0,A.u4)(h.state.camera,x,M);return(0,v.Wi)(Q)?null:(0,O.BR)(z,Q,T)?ht(dt({},P),{renderStart:_,renderEnd:T,plane:z,ray:Q}):null}}function nt(h,u,_,T=null,D=null){return function $(h,u,_,T=null,D=null){let P=null;return z=>{if("start"===z.action&&(P=h.sceneIntersectionHelper.intersectElevationFromScreen((0,o.s1)(z.screenStart.x,z.screenStart.y),u,_,D),(0,v.pC)(P)&&(0,v.pC)(T)&&!(0,p.nF)(P,P,T))||(0,v.Wi)(P))return null;const x=h.sceneIntersectionHelper.intersectElevationFromScreen((0,o.s1)(z.screenEnd.x,z.screenEnd.y),u,_,D);return(0,v.pC)(x)?(0,v.pC)(T)&&!(0,p.nF)(x,x,T)?null:ht(dt({},z),{mapStart:P,mapEnd:x}):null}}(h,_,(0,V.Ou)(u,h,_),T,D)}function it(h,u,_,T=null,D=null){return nt(h,_,(0,V.RL)(u),T,D)}function E(h,u,_,T){const D=u.toMap(h.screenStart,{include:[_]});return(0,v.pC)(D)?it(u,_,D,T):null}function S(h,u,_){let T=null;const D=new N.hM;return D.next(B(h,function U(h,u){const _=m,T=f,D=(0,O.Ue)();h.renderCoordsHelper.worldUpAtPosition(u,_);const P=(0,g.f)(D,_,(0,g.b)(T,u,h.state.camera.eye));return(0,g.f)(P,P,_),(0,O.Yq)(u,P,D)}(h,u))).next(function I(h,u){const _=(0,b.c)(),T=(0,g.l)(u);h.renderCoordsHelper.worldUpAtPosition(u,_);const D=(0,b.c)(),P=(0,b.c)(),z=x=>((0,g.b)(x,x,u),(0,ot.nF)(_,x,x),"global"===h.viewingMode&&(0,g.l)(x)*Math.sign((0,g.e)(_,x))<.001-T&&(0,g.b)(x,(0,g.g)(x,_,.001),u),(0,g.a)(x,x,u),x);return x=>(x.renderStart=z((0,g.c)(D,x.renderStart)),x.renderEnd=z((0,g.c)(P,x.renderEnd)),x)}(h,u)).next(J(h,_)).next(P=>{P.mapEnd.x=P.mapStart.x,P.mapEnd.y=P.mapStart.y,T=P}),P=>(T=null,D.execute(P),T)}function J(h,u){const _=h.renderCoordsHelper;return T=>{const D=_.fromRenderCoords(T.renderStart,u),P=_.fromRenderCoords(T.renderEnd,u);return(0,v.pC)(D)&&(0,v.pC)(P)?ht(dt({},T),{mapStart:D,mapEnd:P}):null}}function Z(h){let u=null;return _=>{switch(_.action){case"start":u=h.disableDisplay();break;case"end":case"cancel":(0,v.pC)(u)&&(u.remove(),u=null)}return _}}function d(h,u=null){const _=(0,W.Z8)(h.state.viewingMode);_.options.selectionMode=!0,_.options.store=y.eC.MIN,_.options.hud=!1;const T=(0,o.s1)(),D={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},P=(0,b.c)(),z=(0,v.Pt)(u,h.spatialReference),x=k=>{h.map.ground&&h.map.ground.opacity<1?D.exclude.add(j.cy):D.exclude.delete(j.cy),h.sceneIntersectionHelper.intersectIntersectorScreen((0,o.md)(k,T),_,D);const q=_.results.min;let rt;if(q.getIntersectionPoint(P))rt=q.intersector===y.q7.TERRAIN?F.GROUND:F.OTHER;else{if(!_.results.ground.getIntersectionPoint(P))return null;rt=F.GROUND}return{location:h.renderCoordsHelper.fromRenderCoords(P,z),surfaceType:rt}};let Q;return k=>{if("start"===k.action){const rt=x(k.screenStart);Q=(0,v.pC)(rt)?rt.location:null}if((0,v.Wi)(Q))return null;const q=x(k.screenEnd);return(0,v.pC)(q)&&(0,v.pC)(q.location)?ht(dt({},k),{mapStart:Q,mapEnd:q.location,surfaceType:q.surfaceType}):null}}(h=F||(F={}))[h.GROUND=0]="GROUND",h[h.OTHER=1]="OTHER";const m=(0,b.c)(),f=(0,b.c)(),M=(0,c.Ue)()},9773:(G,L,e)=>{e.d(L,{N:()=>v});class v{constructor(g){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.editGeometryOperations=g.editGeometryOperations,this.elevationInfo=g.elevationInfo,this.pointer=g.pointer,this.vertexHandle=g.vertexHandle,this.excludeFeature=g.excludeFeature,this.visualizer=g.visualizer}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}}},94009:(G,L,e)=>{e.d(L,{n:()=>ot});var v=e(15861),o=e(62208),g=e(10699),b=e(53639),p=e(75079),O=e(9773),c=e(87091);class ot{constructor(){this.next=new p.hM}createSnapDragEventPipelineStep({predicate:V=(()=>!0),cancel:A,snappingManager:W,snappingContext:y,updatingHandles:j}){var N=this;if((0,o.Wi)(W))return E=>E;let B=null,w=null;const X=()=>{B=(0,o.IM)(B),W.doneSnapping(),(0,o.pC)(w)&&w.frameTask.remove(),w=null};A.next(E=>(X(),E)),this.next=new p.hM;const $=(0,g.Ds)(function(){var E=(0,v.Z)(function*({frameTask:U,point:S,context:I,event:J,dx:F,dy:Z},d){const m=yield U.schedule(()=>W.snap(S,I,d),d);if(m.valid){let f=yield U.schedule(()=>m.apply(),d);S!==nt&&(f=W.update(nt,I)),(0,b.k)(f,it)||(J.mapEnd.x=f.x+F,J.mapEnd.y=f.y+Z,N.next.execute(J))}});return function(U,S){return E.apply(this,arguments)}}());let nt,it;return E=>{if(!V(E))return E;if("start"===E.action){const U="3d"===W.view.type?W.view.resourceController.scheduler.registerTask(c.T8.SNAPPING):c.sq;w={context:new O.N({editGeometryOperations:y.editGeometryOperations,elevationInfo:y.elevationInfo,pointer:y.pointer,vertexHandle:(0,o.pC)(E.info)?E.info.handle:null,excludeFeature:y.excludeFeature,visualizer:y.visualizer}),originalPos:(0,o.pC)(E.snapOrigin)?y.coordinateHelper.vectorToDehydratedPoint(E.snapOrigin):E.mapStart,frameTask:U}}if((0,o.pC)(w)){const U=w.context.coordinateHelper.vectorToDehydratedPoint(w.context.coordinateHelper.arrayToVector([w.originalPos.x,w.originalPos.y,w.originalPos.z]));U.x+=E.mapEnd.x-E.mapStart.x,U.y+=E.mapEnd.y-E.mapStart.y;const S=E.mapStart.x-w.originalPos.x,I=E.mapStart.y-w.originalPos.y,J=ht(dt({},E),{action:"update"}),F=w.context,Z=W.update(U,w.context);if(it=Z,E.mapEnd.x=Z.x+S,E.mapEnd.y=Z.y+I,nt=U,"end"!==E.action){const d=w.frameTask;(0,o.pC)(B)||(B=new AbortController),j.addPromise((0,g.R8)($({frameTask:d,event:J,context:F,point:U,dx:S,dy:I},B.signal)))}}return"end"===E.action&&X(),E}}}},53912:(G,L,e)=>{e.d(L,{y:()=>W});var v=e(15861),o=e(17626),g=e(14517),b=e(62208),p=e(10699),O=e(77712),V=(e(85931),e(8314),e(90912),e(76898)),A=e(87091);let W=class extends g.Z{constructor(y){var j;super(y),j=this,this.stagedPoint=null,this._abortController=null,this._snap=(0,p.Ds)(function(){var N=(0,v.Z)(function*(B,w,X,$){const nt=yield j._frameTask.schedule(()=>w.snap(B,X,$),$);nt.valid&&(yield j._frameTask.schedule(()=>{j.stagedPoint=nt.apply(),B!==j._snapMapPoint&&(j.stagedPoint=w.update(j._snapMapPoint,X))},$))});return function(B,w,X,$){return N.apply(this,arguments)}}())}initialize(){var j,N;const y="3d"===this.view.type?null==(N=null==(j=this.view)?void 0:j.resourceController)?void 0:N.scheduler:null;this._frameTask=(0,b.pC)(y)?y.registerTask(A.T8.SNAPPING):A.sq}destroy(){this._abortController=(0,b.IM)(this._abortController),this._frameTask=(0,b.hw)(this._frameTask)}snap(y,j,N){var B=this;return(0,v.Z)(function*(){return B.stagedPoint=j.update(y,N),B._snapMapPoint=y,(0,b.Wi)(B._abortController)&&(B._abortController=new AbortController),B._snap(y,j,N,B._abortController.signal)})()}abort(){this._abortController=(0,b.IM)(this._abortController)}};(0,o._)([(0,O.Cb)({constructOnly:!0})],W.prototype,"view",void 0),(0,o._)([(0,O.Cb)()],W.prototype,"stagedPoint",void 0),W=(0,o._)([(0,V.j)("esri.views.interactive.snapping.SnappingOperation")],W)},13459:(G,L,e)=>{e.d(L,{a:()=>c});var v=e(54024),o=e(80985),g=e(62160),b=e(80221),p=e(19038),O=e(86842);class c{draw(et,V){const A=this._getUniqueHints(et),W=[];for(const y of A)y instanceof o.w&&W.push(this.visualizeIntersectionPoint(y,V)),y instanceof g.w&&W.push(this.visualizeLine(y,V)),y instanceof b.L&&W.push(this.visualizeParallelSign(y,V)),y instanceof O.y&&W.push(this.visualizeRightAngleQuad(y,V)),y instanceof p.n&&W.push(this.visualizePoint(y,V));return(0,v.AL)(W)}_getUniqueHints(et){const V=[];for(const A of et){let W=!0;for(const y of V)if(A.equals(y)){W=!1;break}W&&V.push(A)}return V}}},19038:(G,L,e)=>{e.d(L,{n:()=>g});var v=e(44725),o=e(5286);class g extends o.r{constructor(p,O){super(O),this.point=p}equals(p){return p instanceof g&&(0,v.Xv)(this.point,p.point)}}},71572:(G,L,e)=>{e.d(L,{Cr:()=>it,FN:()=>X,Sx:()=>V,Uy:()=>W,_e:()=>N,g1:()=>B,qS:()=>et,qj:()=>$,xI:()=>j});var v=e(62208),o=e(15572),g=e(16730),b=e(84161),p=e(28093),O=e(55915),c=e(37053),ot=e(66601);function et(d){return A(d,"direct")}function V(d){return A(d,"horizontal")}function A(d,m){const{hasZ:f,spatialReference:M}=d,h=(0,ot.m)(M);let u=0;const _=(0,g.j5)(h);if((0,v.Wi)(_))return null;const T="direct"===m?X:$;for(const D of d.paths){if(D.length<2)continue;const P=D.length-1;for(let z=0;z<P;++z){const x=D[z];S[0]=x[0],S[1]=x[1],S[2]=f?x[2]:0;const Q=D[z+1];I[0]=Q[0],I[1]=Q[1],I[2]=f?Q[2]:0;const k=T(S,I,M);if((0,v.Wi)(k))return null;u+=k.value}}return(0,o.yG)(u,_)}function W(d,m){const{spatialReference:f}=d;return(0,c.fS)(f,m.spatialReference)?(S[0]=d.x,S[1]=d.y,S[2]=d.hasZ?d.z:0,I[0]=m.x,I[1]=m.y,I[2]=m.hasZ?m.z:0,function w(d,m,f){const M=U(d,m,f);return(0,v.pC)(M)?{direct:(0,o.yG)(M.direct,M.unit),horizontal:(0,o.yG)(M.horizontal,M.unit),vertical:(0,o.yG)(M.vertical,M.unit)}:null}(S,I,f)):null}function j(d,m){const{spatialReference:f}=d;return(0,c.fS)(f,m.spatialReference)?(S[0]=d.x,S[1]=d.y,S[2]=d.hasZ?d.z:0,I[0]=m.x,I[1]=m.y,I[2]=m.hasZ?m.z:0,$(S,I,f)):null}function N(d,m){const{spatialReference:f}=d;return(0,c.fS)(f,m.spatialReference)?(S[0]=d.x,S[1]=d.y,S[2]=d.hasZ?d.z:0,I[0]=m.x,I[1]=m.y,I[2]=m.hasZ?m.z:0,it(S,I,f)):null}function B(d){return S[0]=d.x,S[1]=d.y,S[2]=d.hasZ?d.z:0,function E(d,m){const f=(0,g.y)(m);return(0,v.pC)(f)?(0,o.yG)(d[2],f):null}(S,d.spatialReference)}function X(d,m,f){const M=U(d,m,f,"direct");return(0,v.pC)(M)?(0,o.yG)(M.direct,M.unit):null}function $(d,m,f){const M=U(d,m,f,"horizontal");return(0,v.pC)(M)?(0,o.yG)(M.horizontal,M.unit):null}function it(d,m,f){const M=U(d,m,f,"vertical");return(0,v.pC)(M)?(0,o.yG)(M.verticalSigned,M.unit):null}function U(d,m,f,M){const h=(0,ot.m)(f),u=(0,g.j5)(h);if((0,v.Wi)(u))return null;const _=m[2]-d[2];if("vertical"===M)return{verticalSigned:_,unit:u};if(!(0,O.SH)(d,f,J,h)||!(0,O.SH)(m,f,F,h))return null;if("direct"===M)return{direct:(0,b.i)(F,J),unit:u};if((0,b.s)(Z,d[0],d[1],m[2]),!(0,O.SH)(Z,f,Z,h))return null;const T=(0,b.i)(Z,F);return"horizontal"===M?{horizontal:T,unit:u}:{direct:(0,b.i)(F,J),horizontal:T,vertical:Math.abs(_),unit:u}}const S=(0,p.c)(),I=(0,p.c)(),J=(0,p.c)(),F=(0,p.c)(),Z=(0,p.c)()},66601:(G,L,e)=>{e.d(L,{m:()=>g});var v=e(55915),o=e(12080);function g(b){const p=(0,o.rS)(b),O=p===o.GG?o.wY:p;return(0,v.Up)(b,O)?O:b}}}]);