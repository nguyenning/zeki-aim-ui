"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[15],{80015:(V,E,r)=>{r.r(E),r.d(E,{default:()=>b});var n=r(17626),v=r(88879),O=r(63290),i=r(62208),y=r(32917),o=r(77712),D=(r(90912),r(85931),r(76898)),I=r(10410),f=r(98624),P=r(59990),d=r(96854),p=r(35560),M=r(89770),F=r(52836),j=r(19702),u=r(3493),R=r(2694),g=r(22498),c=r(52565),S=r(86152),A=r(94443),L=r(72537),U=r(41941),h=r(42964),W=r(89476),T=r(67966),x=r(40465),B=r(57610),K=r(41632),Q=r(78465),m=r(87091);const C=(0,T.v)();let l=class extends((0,M.N)((0,W.l)((0,x.i)((0,j.A)(Q.Z))))){constructor(){super(...arguments),this.type="scene-layer-3d",this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._interactiveEditingSessions=new Map,this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(e,t){return e.url===this.layer.url&&this.i3sOverrides.isEmpty?e.load(t).then(()=>{var a;(0,h.tq)(this.layer,e,this.i3sOverrides),this.layer=e,this.i3sOverrides.destroy();const s=null==(a=this.view.resourceController)?void 0:a.memoryController;this.i3sOverrides=new S.v({view:this.view,layer:e,memoryController:s}),this.resetHighlights()}):null}get layerPopupEnabled(){return this.layer.popupEnabled}get filter(){return this._get("filter")}set filter(e){this._set("filter",g.z.checkSupport(e)?e:null)}get viewFilter(){const e=this.filter,t=this.layerFilter;if((0,i.Wi)(e)&&(0,i.Wi)(t))return null;const s=this._get("viewFilter");return(0,i.Wi)(s)?new g.z({layerFilter:t,viewFilter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:a=>this._loadAsyncModule(a),addSqlFilter:(a,_)=>this.addSqlFilter(a,_,this.logError)}):(s.viewFilter=e,s.layerFilter=t,s)}get requiredFields(){var e,t;return null!=(t=null==(e=this._fieldsHelper)?void 0:e.requiredFields)?t:[]}get _floorFilterClause(){const e=(0,P.c)(this);return(0,i.pC)(e)?I.WhereClause.create(e,this.layer.fieldsIndex):null}get _excludeObjectIdsSorted(){let e=this.layer.excludeObjectIds.toArray();return(0,p.Rx)()&&this.i3sOverrides.is3DOFL&&this.i3sOverrides.geometryChangedObjectIds.length>0&&(e=e.concat(this.i3sOverrides.geometryChangedObjectIds)),e.length?e.sort((t,s)=>t-s):null}get _objectQualitySettings(){var e,t,s;return null==(s=null==(t=null==(e=this.view)?void 0:e.qualitySettings)?void 0:t.sceneService)?void 0:s.object}get lodFactor(){var e,t;return null!=(t=null==(e=this._objectQualitySettings)?void 0:e.lodFactor)?t:1}get lodCrossfadeinDuration(){var e;return null!=(e=this._objectQualitySettings.lodCrossfadeinDuration)?e:0}get lodCrossfadeoutDuration(){var e;return null!=(e=this._objectQualitySettings.lodCrossfadeoutDuration)?e:0}get lodCrossfadeUncoveredDuration(){var e;return null!=(e=this._objectQualitySettings.lodCrossfadeUncoveredDuration)?e:0}get updatingProgressValue(){var e,t;return null!=(t=null==(e=this._controller)?void 0:e.updatingProgress)?t:0}initialize(){this._fieldsHelper=new B.K({layerView:this}),this.updatingHandles.add(()=>this.layer.rangeInfos,t=>this._rangeInfosChanged(t),y.nn),this.updatingHandles.add(()=>this.layer.renderer,t=>this.updatingHandles.addPromise(this._rendererChange(t)),y.nn);const e=()=>this._filterChange();this.updatingHandles.add(()=>this.parsedDefinitionExpression,e),this.updatingHandles.add(()=>this.filter,e),this.updatingHandles.add(()=>this._floorFilterClause,e),this.updatingHandles.add(()=>this._excludeObjectIdsSorted,e),this.updatingHandles.add(()=>(0,i.pC)(this.viewFilter)?this.viewFilter.sortedObjectIds:null,e),this.updatingHandles.add(()=>(0,i.pC)(this.viewFilter)?this.viewFilter.parsedWhereClause:null,e),this.updatingHandles.add(()=>[(0,i.pC)(this.viewFilter)?this.viewFilter.parsedGeometry:null,(0,i.pC)(this.filter)?this.filter.spatialRelationship:null,(0,i.pC)(this.layer.filter)?this.layer.filter.spatialRelationship:null],()=>this._geometryFilterChange()),this.handles.add(this.layer.on("apply-edits",t=>this.updatingHandles.addPromise(t.result))),this.handles.add(this.layer.on("edits",t=>this._handleEdits(t)))}destroy(){this._fieldsHelper=(0,i.SC)(this._fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&O.Z.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return(0,i.pC)(this.filter)?this.filter.createQuery(e):new d.Z(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null==t?void 0:t.signal).then(s=>{if(null==s||!s.features)return s;const a=this.layer;for(const _ of s.features)_.layer=a,_.sourceLayer=a;return s})}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null==t?void 0:t.signal)}_ensureQueryEngine(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){var t;const e=(0,R.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new A.u({layerView:this,priority:m.T8.FEATURE_QUERY_ENGINE,spatialIndex:new U.I({featureAdapter:new L.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:null!=(t=this.layer.attributeStorageInfo)?t:[],getFeatureExtent:e}),forAllFeatures:(s,a)=>this._forAllFeatures((_,w,H)=>s({id:_,index:w,meta:H}),a,F.u.ALL_IN_CLIPPING_AREA),getFeatureExtent:e,sourceSpatialReference:(0,h.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e){const t=this._highlights;if(e instanceof d.Z){const{set:s,handle:a}=t.acquireSet();return this.queryObjectIds(e).then(_=>t.setFeatureIds(s,_)),a}return super.highlight(e)}createInteractiveEditSession(e){return(0,u.sw)(this._attributeEditingContext,e)}_createLayerGraphic(e){const t=new v.Z(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}getFilters(){const e=super.getFilters(),t=this._excludeObjectIdsSorted;return(0,i.pC)(t)&&e.push(s=>(0,h.Yb)(t,!1,s)),this._floorFilterClause&&this.addSqlFilter(e,this._floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),(0,i.pC)(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||(0,i.pC)(this.viewFilter)&&this.viewFilter.updating||(0,i.pC)(this.i3sOverrides)&&this.i3sOverrides.updating}_ensureQuery(e){return this._addDefinitionExpressionToQuery((0,i.Wi)(e)?this.createQuery():d.Z.from(e))}get _attributeEditingContext(){var e;return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:t=>this._forAllNodes(s=>(0,i.pC)(s)?t(s.node,s.featureIds):null),attributeStorageInfo:null!=(e=this.i3slayer.attributeStorageInfo)?e:[],i3sOverrides:this.i3sOverrides,getAttributeData:t=>this.getAttributeData(t),setAttributeData:(t,s)=>this.setAttributeData(t,s),clearMemCache:()=>this.clearMemCache()}}_handleEdits(e){(0,p.Rx)()&&(0,u.ZS)(this._attributeEditingContext,e),(0,u.Z6)(this._attributeEditingContext,e)}get hasGeometryFilter(){const e=this.viewFilter;return(0,i.pC)(e)&&(0,i.pC)(e.parsedGeometry)}computeNodeFiltering(e){const t=this.viewFilter;return(0,i.Wi)(t)||!this.view.spatialReference||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?c.U_.Unmodified:c.U_.Culled}};(0,n._)([(0,o.Cb)()],l.prototype,"i3slayer",null),(0,n._)([(0,o.Cb)(K.q)],l.prototype,"updatingProgress",void 0),(0,n._)([(0,o.Cb)({type:f.Z})],l.prototype,"filter",null),(0,n._)([(0,o.Cb)({readOnly:!0})],l.prototype,"viewFilter",null),(0,n._)([(0,o.Cb)(C.requiredFields)],l.prototype,"requiredFields",null),(0,n._)([(0,o.Cb)(C.availableFields)],l.prototype,"availableFields",void 0),(0,n._)([(0,o.Cb)()],l.prototype,"_fieldsHelper",void 0),(0,n._)([(0,o.Cb)()],l.prototype,"_floorFilterClause",null),(0,n._)([(0,o.Cb)()],l.prototype,"_excludeObjectIdsSorted",null),(0,n._)([(0,o.Cb)()],l.prototype,"_objectQualitySettings",null),(0,n._)([(0,o.Cb)()],l.prototype,"lodFactor",null),(0,n._)([(0,o.Cb)()],l.prototype,"updatingProgressValue",null),l=(0,n._)([(0,D.j)("esri.views.3d.layers.SceneLayerView3D")],l);const b=l}}]);