"use strict";var ue=Object.defineProperty,D=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,A=(b,c,o)=>c in b?ue(b,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):b[c]=o,V=(b,c)=>{for(var o in c||(c={}))pe.call(c,o)&&A(b,o,c[o]);if(D)for(var o of D(c))he.call(c,o)&&A(b,o,c[o]);return b};(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[8740],{78740:(b,c,o)=>{o.r(c),o.d(c,{FeatureServiceSnappingSource:()=>v});var p=o(15861),s=o(17626),E=o(14517),Z=o(80542),k=o(54024),u=o(62208),I=o(10699),h=o(32917),a=o(77712),H=(o(90912),o(85931),o(76898)),W=o(84395),J=o(60507),R=o(68511),$=o(84161),L=o(4794),x=o(41743);function T(e,t){return(0,x.g)(t.extent,z),(0,x.h)(z,(0,$.s)(Y,e.x,e.y,0))}const z=(0,x.a)(),Y=(0,L.c)();var G=o(93579);let m=class extends E.Z{get tiles(){const e=this.tilesCoveringView,t=(0,u.pC)(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort((n,i)=>T(t,n)-T(t,i)),e}_scaleEnabled(){return(0,G.rs)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||(0,u.Wi)(this.tileInfo))return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:n}=t,i=[];for(const{row:r,colFrom:d,colTo:y}of e)for(let l=d;l<=y;l++){const S=t.normalizeCol(l),f=new R.f(null,n,r,S);this.tileInfo.updateTileInfo(f),i.push(f)}return i}get tileInfo(){var e,t;return null!=(t=null==(e=this.view.featuresTilingScheme)?void 0:e.tileInfo)?t:null}get tileSize(){return(0,u.pC)(this.tileInfo)?this.tileInfo.size[0]:256}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.addHandles((0,h.YP)(()=>{var e,t;return null==(t=null==(e=this.view)?void 0:e.state)?void 0:t.viewpoint},()=>this.notifyChange("tilesCoveringView"),h.Z_))}};(0,s._)([(0,a.Cb)({readOnly:!0})],m.prototype,"tiles",null),(0,s._)([(0,a.Cb)({readOnly:!0})],m.prototype,"_scaleEnabled",null),(0,s._)([(0,a.Cb)({readOnly:!0})],m.prototype,"tilesCoveringView",null),(0,s._)([(0,a.Cb)({readOnly:!0})],m.prototype,"tileInfo",null),(0,s._)([(0,a.Cb)({readOnly:!0})],m.prototype,"tileSize",null),(0,s._)([(0,a.Cb)({constructOnly:!0})],m.prototype,"view",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],m.prototype,"layer",void 0),(0,s._)([(0,a.Cb)()],m.prototype,"pointOfInterest",void 0),m=(0,s._)([(0,H.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],m);var B=o(27351);let C=class extends Z.r{get tiles(){const e=this.tilesCoveringView,t=this._effectivePointOfInterest;if((0,u.pC)(t)){const n=e.map(i=>T(t,i));for(let i=1;i<n.length;i++)if(n[i-1]>n[i])return e.sort((r,d)=>T(t,r)-T(t,d)),e.slice()}return e}get tilesCoveringView(){var e,t;return this._filterTiles(null==(t=null==(e=this.view.featureTiles)?void 0:e.tiles)?void 0:t.toArray()).map(K)}get tileInfo(){var e,t;return null!=(t=null==(e=this.view.featureTiles)?void 0:e.tilingScheme.toTileInfo())?t:null}get tileSize(){var e,t;return null!=(t=null==(e=this.view.featureTiles)?void 0:e.tileSize)?t:256}get _effectivePointOfInterest(){var t;const e=this.pointOfInterest;return(0,u.pC)(e)?e:null==(t=this.view.pointsOfInterest)?void 0:t.focus.location}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.handles.add((0,h.YP)(()=>this.view.featureTiles,e=>{this.handles.remove(U),e&&this.handles.add(e.addClient(),U)},h.nn))}_filterTiles(e){return(0,u.Wi)(e)?[]:e.filter(t=>Math.abs(t.measures.screenRect[3]-t.measures.screenRect[1])>Q&&t.measures.visibility===B.E.VISIBLE_ON_SURFACE)}};function K({lij:[e,t,n],extent:i}){return new R.f(`${e}/${t}/${n}`,e,t,n,i)}(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"tiles",null),(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"tilesCoveringView",null),(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"tileInfo",null),(0,s._)([(0,a.Cb)({readOnly:!0})],C.prototype,"tileSize",null),(0,s._)([(0,a.Cb)({constructOnly:!0})],C.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],C.prototype,"pointOfInterest",void 0),(0,s._)([(0,a.Cb)()],C.prototype,"_effectivePointOfInterest",null),C=(0,s._)([(0,H.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],C);const Q=50,U="feature-tiles";var M=o(9218),X=o(72392),q=o(37118),N=o(65401),ee=o(73187);let F=class extends ee.q{constructor(e){super(e),this._handles=new X.Z}initialize(){const e=setInterval(()=>this._fetchDebugInfo(),2e3);this._handles.add((0,k.kB)(()=>clearInterval(e)))}destroy(){this._handles.destroy()}getTiles(){if(!this._debugInfo)return[];const e=new Map,t=new Map;this._debugInfo.storedTiles.forEach(r=>{e.set(r.data.id,r.featureCount)}),this._debugInfo.pendingTiles.forEach(r=>{e.set(r.data.id,r.featureCount),t.set(r.data.id,r.state)});const n=r=>{var l;const d=t.get(r),y=null!=(l=e.get(r))?l:"?";return d?`${d}:${y}\n${r}`:`store:${y}\n${r}`},i=new Map;return this._debugInfo.storedTiles.forEach(r=>{i.set(r.data.id,r.data)}),this._debugInfo.pendingTiles.forEach(r=>{i.set(r.data.id,r.data)}),Array.from(i.values()).map(r=>({lij:[r.level,r.row,r.col],geometry:q.Z.fromExtent((0,N.HH)(r.extent,this.view.spatialReference)),label:n(r.id)}))}_fetchDebugInfo(){this.handle.getDebugInfo(null).then(e=>{this._debugInfo=e,this.update()})}};(0,s._)([(0,a.Cb)({constructOnly:!0})],F.prototype,"handle",void 0),F=(0,s._)([(0,H.j)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],F);var te=o(42930),ne=o(71774),ie=o(38114);let g=class extends Z.r{get updating(){return this.updatingHandles.updating||this._workerHandleUpdating}constructor(e){super(e),this.schedule=null,this.hasZ=!1,this.elevationAlignPointsInFeatures=function(){var t=(0,p.Z)(function*(n){const i=[];for(const{points:r}of n)for(const{z:d}of r)i.push(d);return{elevations:i,drapedObjectIds:new Set,failedObjectIds:new Set}});return function(n){return t.apply(this,arguments)}}(),this.queryForSymbologySnapping=(0,p.Z)(function*(){return{candidates:[],sourceCandidateIndices:[]}}),this.availability=0,this._workerHandleUpdating=!0,this._editId=0}destroy(){this._workerHandle.destroy()}initialize(){var t,e=this;this._workerHandle=new re(this.schedule,{alignElevation:(t=(0,p.Z)(function*(n,{signal:i}){return{result:yield e.elevationAlignPointsInFeatures(n.points,i)}}),function(i,r){return t.apply(this,arguments)}),getSymbologyCandidates:function(){var t=(0,p.Z)(function*(n,{signal:i}){return{result:yield e.queryForSymbologySnapping(n,i)}});return function(i,r){return t.apply(this,arguments)}}()}),this.handles.add([this._workerHandle.on("notify-updating",({updating:t})=>this._workerHandleUpdating=t),this._workerHandle.on("notify-availability",({availability:t})=>this._set("availability",t))])}setup(e,t){var n=this;return(0,p.Z)(function*(){var d;const i=n._serviceInfoFromLayer(e.layer);if((0,u.Wi)(i))return;const r={configuration:n._convertConfiguration(e.configuration),serviceInfo:i,spatialReference:e.spatialReference.toJSON(),hasZ:n.hasZ,elevationInfo:null==(d=e.layer.elevationInfo)?void 0:d.toJSON()};yield n.updatingHandles.addPromise(n._workerHandle.invokeMethod("setup",r,t)),n.updatingHandles.addPromise(n._workerHandle.invokeMethod("whenNotUpdating",{},t))})()}configure(e,t){var n=this;return(0,p.Z)(function*(){const i=n._convertConfiguration(e);yield n.updatingHandles.addPromise(n._workerHandle.invokeMethod("configure",i,t)),n.updatingHandles.addPromise(n._workerHandle.invokeMethod("whenNotUpdating",{},t))})()}refresh(e){var t=this;return(0,p.Z)(function*(){yield t.updatingHandles.addPromise(t._workerHandle.invokeMethod("refresh",{},e)),t.updatingHandles.addPromise(t._workerHandle.invokeMethod("whenNotUpdating",{},e))})()}fetchCandidates(e,t){var n=this;return(0,p.Z)(function*(){const i=e.point,r={distance:e.distance,mode:e.mode,point:(0,ie.Tx)(i[0],i[1],i[2],e.coordinateHelper.spatialReference.toJSON()),types:e.types,filter:(0,u.pC)(e.filter)?e.filter.toJSON():null};return n._workerHandle.invoke(r,t)})()}updateTiles(e,t){var n=this;return(0,p.Z)(function*(){const i={tiles:e.tiles,tileInfo:(0,u.pC)(e.tileInfo)?e.tileInfo.toJSON():null,tileSize:e.tileSize};yield n.updatingHandles.addPromise(n._workerHandle.invokeMethod("updateTiles",i,t)),n.updatingHandles.addPromise(n._workerHandle.invokeMethod("whenNotUpdating",{},t))})()}applyEdits(e,t){var n=this;return(0,p.Z)(function*(){var l,S,f,O,j,_;const i=n._editId++,r={id:i};yield n.updatingHandles.addPromise(n._workerHandle.invokeMethod("beginApplyEdits",r,t));const d=yield n.updatingHandles.addPromise((0,I.Hl)(e.result,t)),y={id:i,edits:{addedFeatures:null!=(S=null==(l=d.addedFeatures)?void 0:l.map(({objectId:P})=>P).filter(u.pC))?S:[],deletedFeatures:null!=(O=null==(f=d.deletedFeatures)?void 0:f.map(({objectId:P,globalId:de})=>({objectId:P,globalId:de})))?O:[],updatedFeatures:null!=(_=null==(j=d.updatedFeatures)?void 0:j.map(({objectId:P})=>P).filter(u.pC))?_:[]}};yield n.updatingHandles.addPromise(n._workerHandle.invokeMethod("endApplyEdits",y,t)),n.updatingHandles.addPromise(n._workerHandle.invokeMethod("whenNotUpdating",{},t))})()}getDebugInfo(e){return this._workerHandle.invokeMethod("getDebugInfo",{},e)}notifyElevationSourceChange(){var e=this;return(0,p.Z)(function*(){yield e._workerHandle.invokeMethod("notifyElevationSourceChange",{})})()}notifySymbologyChange(){var e=this;return(0,p.Z)(function*(){yield e._workerHandle.invokeMethod("notifySymbologyChange",{})})()}setSymbologySnappingSupported(e){var t=this;return(0,p.Z)(function*(){yield t._workerHandle.invokeMethod("setSymbologySnappingSupported",e)})()}_convertConfiguration(e){return{filter:(0,u.pC)(e.filter)?e.filter.toJSON():null,customParameters:e.customParameters,viewType:e.viewType}}_serviceInfoFromLayer(e){var t,n,i;return"multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:null!=(n=null==(t=e.parsedUrl)?void 0:t.path)?n:"",fields:e.fields.map(r=>r.toJSON()),geometryType:ne.M.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:null==(i=e.timeInfo)?void 0:i.toJSON()}}};(0,s._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"schedule",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"hasZ",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"elevationAlignPointsInFeatures",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"queryForSymbologySnapping",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],g.prototype,"updating",null),(0,s._)([(0,a.Cb)({readOnly:!0})],g.prototype,"availability",void 0),(0,s._)([(0,a.Cb)()],g.prototype,"_workerHandleUpdating",void 0),g=(0,s._)([(0,H.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],g);class re extends te.q{constructor(t,n){super("FeatureServiceSnappingSourceWorker","fetchCandidates",{},t,{strategy:"dedicated",client:n})}}var oe=o(72642),se=o(72258),ae=o(2584);let w=class extends E.Z{get tiles(){return[new R.f("0/0/0",0,0,0,(0,N.al)(-1e8,-1e8,1e8,1e8))]}get tileInfo(){return new ae.Z({origin:new oe.Z({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new se.Z({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}constructor(e){super(e),this.pointOfInterest=null}};(0,s._)([(0,a.Cb)({readOnly:!0})],w.prototype,"tiles",null),(0,s._)([(0,a.Cb)({readOnly:!0})],w.prototype,"tileInfo",null),(0,s._)([(0,a.Cb)({readOnly:!0})],w.prototype,"tileSize",null),(0,s._)([(0,a.Cb)({constructOnly:!0})],w.prototype,"layer",void 0),(0,s._)([(0,a.Cb)()],w.prototype,"pointOfInterest",void 0),w=(0,s._)([(0,H.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],w);var le=o(66463);let v=class extends((0,Z.p)(E.Z)){get _updateTilesParameters(){return{tiles:this._tilesOfInterest.tiles,tileInfo:this._tilesOfInterest.tileInfo,tileSize:this._tilesOfInterest.tileSize}}get updating(){var e;return(null==(e=this._workerHandle)?void 0:e.updating)||this.updatingHandles.updating}get configuration(){const{view:e}=this,t=(0,u.pC)(e)?e.type:"2d";return{filter:this._layer.createQuery(),customParameters:this._layer.customParameters,viewType:t}}get availability(){var e,t;return null!=(t=null==(e=this._workerHandle)?void 0:e.availability)?t:0}get _layer(){return this.layerSource.layer}constructor(e){super(e),this._workerHandle=null,this._debug=null}initialize(){var n;let e;const t=this.view;if((0,u.pC)(t))switch(t.type){case"2d":this._tilesOfInterest=new m({view:t,layer:this._layer}),e=this._workerHandle=new g;break;case"3d":{const{resourceController:i}=t,r=this._layer,d=t.whenLayerView(r);this._tilesOfInterest=new C({view:t}),e=this._workerHandle=new g({schedule:l=>i.immediate.schedule(l),hasZ:this._layer.hasZ&&(null==(n=this._layer.returnZ)||n),elevationAlignPointsInFeatures:(l=(0,p.Z)(function*(S,f){const O=yield d;return(0,I.k_)(f),O.elevationAlignPointsInFeatures(S,f)}),function(f,O){return l.apply(this,arguments)}),queryForSymbologySnapping:function(){var l=(0,p.Z)(function*(S,f){const O=yield d;return(0,I.k_)(f),O.queryForSymbologySnapping(S,f)});return function(f,O){return l.apply(this,arguments)}}()});const y=new W.f(null);d.then(l=>y.set(l)),this.addHandles([t.elevationProvider.on("elevation-change",({context:l})=>{const{elevationInfo:S}=r;(0,J.W_)(l,S)&&(0,I.R8)(e.notifyElevationSourceChange())}),(0,h.YP)(()=>r.elevationInfo,()=>(0,I.R8)(e.notifyElevationSourceChange()),h.nn),(0,h.YP)(()=>(0,u.yw)(y.get(),({processor:l})=>null==l?void 0:l.renderer),()=>(0,I.R8)(e.notifySymbologyChange()),h.nn),(0,h.YP)(()=>(0,u.R2)(y.get(),!1,l=>l.symbologySnappingSupported),l=>(0,I.R8)(e.setSymbologySnappingSupported(l)),h.nn),(0,h.on)(()=>{var l;return null==(l=(0,u.WG)(y.get()))?void 0:l.layer},["edits","apply-edits","graphic-update"],()=>e.notifySymbologyChange())]);break}}else this._tilesOfInterest=new w({layer:this._layer}),e=this._workerHandle=new g;var l;this.handles.add([(0,k.ed)(e)]),(0,I.R8)(e.setup({layer:this._layer,spatialReference:this.spatialReference,configuration:this.configuration},null)),this.updatingHandles.add(()=>this._updateTilesParameters,()=>(0,I.R8)(e.updateTiles(this._updateTilesParameters,null)),h.nn),this.handles.add([(0,h.YP)(()=>this.configuration,i=>(0,I.R8)(e.configure(i,null)),h.Z_)]),(0,u.pC)(t)&&this.handles.add((0,h.YP)(()=>le.Z.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES,i=>{i&&!this._debug?(this._debug=new F({view:t,handle:e}),this.handles.add((0,k.ed)(this._debug),"debug")):!i&&this._debug&&this.handles.remove("debug")},h.nn)),this.handles.add(this.layerSource.layer.on("apply-edits",i=>{(0,I.R8)(e.applyEdits(i,null))}))}refresh(){var e;null==(e=this._workerHandle)||e.refresh(null)}fetchCandidates(e,t){var n=this;return(0,p.Z)(function*(){const{coordinateHelper:i,point:r}=e;n._tilesOfInterest.pointOfInterest=i.arrayToPoint(r);const d=n._getGroundElevation;return(yield n._workerHandle.fetchCandidates(V({},e),t)).candidates.map(y=>(0,M.X)(y,d))})()}getDebugInfo(e){return this._workerHandle.getDebugInfo(e)}get _getGroundElevation(){return(0,M.g)(this.view)}};(0,s._)([(0,a.Cb)({constructOnly:!0})],v.prototype,"spatialReference",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],v.prototype,"layerSource",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],v.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],v.prototype,"_tilesOfInterest",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],v.prototype,"_updateTilesParameters",null),(0,s._)([(0,a.Cb)({readOnly:!0})],v.prototype,"updating",null),(0,s._)([(0,a.Cb)({readOnly:!0})],v.prototype,"configuration",null),(0,s._)([(0,a.Cb)({readOnly:!0})],v.prototype,"availability",null),(0,s._)([(0,a.Cb)()],v.prototype,"_getGroundElevation",null),v=(0,s._)([(0,H.j)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],v)}}]);