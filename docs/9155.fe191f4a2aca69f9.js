"use strict";var Ee=Object.defineProperty,ue=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,ce=(W,C,o)=>C in W?Ee(W,C,{enumerable:!0,configurable:!0,writable:!0,value:o}):W[C]=o,le=(W,C)=>{for(var o in C||(C={}))ve.call(C,o)&&ce(W,o,C[o]);if(ue)for(var o of ue(C))Be.call(C,o)&&ce(W,o,C[o]);return W};(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[9155],{36592:(W,C,o)=>{o.d(C,{Q:()=>S});var b=o(85931),$=o(62208),K=o(77029),w=o(14259);class S{constructor(e=9,i){this._compareMinX=L,this._compareMinY=g,this._toBBox=s=>s,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this._toBBox=i:this._initFormat(i)),this.clear()}destroy(){this.clear(),z.prune(),k.prune(),Y.prune(),ee.prune()}all(e){this._all(this._data,e)}search(e,i){let s=this._data;const l=this._toBBox;if(N(e,s))for(z.clear();s;){for(let d=0,f=s.children.length;d<f;d++){const p=s.children[d],v=s.leaf?l(p):p;N(e,v)&&(s.leaf?i(p):y(e,v)?this._all(p,i):z.push(p))}s=z.pop()}}collides(e){let i=this._data;const s=this._toBBox;if(!N(e,i))return!1;for(z.clear();i;){for(let l=0,d=i.children.length;l<d;l++){const f=i.children[l],p=i.leaf?s(f):f;if(N(e,p)){if(i.leaf||y(e,p))return!0;z.push(f)}}i=z.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let s=0,l=e.length;s<l;s++)this.insert(e[s]);return this}let i=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===i.height)this._splitRoot(this._data,i);else{if(this._data.height<i.height){const s=this._data;this._data=i,i=s}this._insert(i,this._data.height-i.height-1,!0)}else this._data=i;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new te([]),this}remove(e){var v;if(!e)return this;let i,s=this._data,l=null,d=0,f=!1;const p=this._toBBox(e);for(Y.clear(),ee.clear();s||Y.length>0;){if(s||(s=(0,$.j0)(Y.pop()),l=Y.data[Y.length-1],d=null!=(v=ee.pop())?v:0,f=!0),s.leaf&&(i=(0,b.cq)(s.children,e,s.children.length,s.indexHint),-1!==i))return s.children.splice(i,1),Y.push(s),this._condense(Y),this;f||s.leaf||!y(s,p)?l?(d++,s=l.children[d],f=!1):s=null:(Y.push(s),ee.push(d),d=0,l=s,s=s.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,i){var l;let s=e;for(k.clear();s;){if(!0===s.leaf)for(const d of s.children)i(d);else k.pushArray(s.children);s=null!=(l=k.pop())?l:null}}_build(e,i,s,l){const d=s-i+1;let f=this._maxEntries;if(d<=f){const T=new te(e.slice(i,s+1));return M(T,this._toBBox),T}l||(l=Math.ceil(Math.log(d)/Math.log(f)),f=Math.ceil(d/f**(l-1)));const p=new ie([]);p.height=l;const v=Math.ceil(d/f),P=v*Math.ceil(Math.sqrt(f));X(e,i,s,P,this._compareMinX);for(let T=i;T<=s;T+=P){const Z=Math.min(T+P-1,s);X(e,T,Z,v,this._compareMinY);for(let H=T;H<=Z;H+=v){const ae=Math.min(H+v-1,Z);p.children.push(this._build(e,H,ae,l-1))}}return M(p,this._toBBox),p}_chooseSubtree(e,i,s,l){for(;l.push(i),!0!==i.leaf&&l.length-1!==s;){let d,f=1/0,p=1/0;for(let v=0,P=i.children.length;v<P;v++){const T=i.children[v],Z=B(T),H=ne(e,T)-Z;H<p?(p=H,f=Z<f?Z:f,d=T):H===p&&Z<f&&(f=Z,d=T)}i=d||i.children[0]}return i}_insert(e,i,s){const d=s?e:(0,this._toBBox)(e);Y.clear();const f=this._chooseSubtree(d,this._data,i,Y);for(f.children.push(e),G(f,d);i>=0&&Y.data[i].children.length>this._maxEntries;)this._split(Y,i),i--;this._adjustParentBBoxes(d,Y,i)}_split(e,i){const s=e.data[i],l=s.children.length,d=this._minEntries;this._chooseSplitAxis(s,d,l);const f=this._chooseSplitIndex(s,d,l);if(!f)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const p=s.children.splice(f,s.children.length-f),v=s.leaf?new te(p):new ie(p);v.height=s.height,M(s,this._toBBox),M(v,this._toBBox),i?e.data[i-1].children.push(v):this._splitRoot(s,v)}_splitRoot(e,i){this._data=new ie([e,i]),this._data.height=e.height+1,M(this._data,this._toBBox)}_chooseSplitIndex(e,i,s){let l,d,f;l=d=1/0;for(let p=i;p<=s-i;p++){const v=j(e,0,p,this._toBBox),P=j(e,p,s,this._toBBox),T=m(v,P),Z=B(v)+B(P);T<l?(l=T,f=p,d=Z<d?Z:d):T===l&&Z<d&&(d=Z,f=p)}return f}_chooseSplitAxis(e,i,s){const l=e.leaf?this._compareMinX:L,d=e.leaf?this._compareMinY:g;this._allDistMargin(e,i,s,l)<this._allDistMargin(e,i,s,d)&&e.children.sort(l)}_allDistMargin(e,i,s,l){e.children.sort(l);const d=this._toBBox,f=j(e,0,i,d),p=j(e,s-i,s,d);let v=R(f)+R(p);for(let P=i;P<s-i;P++){const T=e.children[P];G(f,e.leaf?d(T):T),v+=R(f)}for(let P=s-i-1;P>=i;P--){const T=e.children[P];G(p,e.leaf?d(T):T),v+=R(p)}return v}_adjustParentBBoxes(e,i,s){for(let l=s;l>=0;l--)G(i.data[l],e)}_condense(e){for(let i=e.length-1;i>=0;i--){const s=e.data[i];if(0===s.children.length)if(i>0){const l=e.data[i-1],d=l.children;d.splice((0,b.cq)(d,s,d.length,l.indexHint),1)}else this.clear();else M(s,this._toBBox)}}_initFormat(e){const i=["return a"," - b",";"];this._compareMinX=new Function("a","b",i.join(e[0])),this._compareMinY=new Function("a","b",i.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function M(h,e){j(h,0,h.children.length,e,h)}function j(h,e,i,s,l){l||(l=new te([])),l.minX=1/0,l.minY=1/0,l.maxX=-1/0,l.maxY=-1/0;for(let d,f=e;f<i;f++)d=h.children[f],G(l,h.leaf?s(d):d);return l}function G(h,e){h.minX=Math.min(h.minX,e.minX),h.minY=Math.min(h.minY,e.minY),h.maxX=Math.max(h.maxX,e.maxX),h.maxY=Math.max(h.maxY,e.maxY)}function L(h,e){return h.minX-e.minX}function g(h,e){return h.minY-e.minY}function B(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function R(h){return h.maxX-h.minX+(h.maxY-h.minY)}function ne(h,e){return(Math.max(e.maxX,h.maxX)-Math.min(e.minX,h.minX))*(Math.max(e.maxY,h.maxY)-Math.min(e.minY,h.minY))}function m(h,e){const i=Math.max(h.minX,e.minX),s=Math.max(h.minY,e.minY),l=Math.min(h.maxX,e.maxX),d=Math.min(h.maxY,e.maxY);return Math.max(0,l-i)*Math.max(0,d-s)}function y(h,e){return h.minX<=e.minX&&h.minY<=e.minY&&e.maxX<=h.maxX&&e.maxY<=h.maxY}function N(h,e){return e.minX<=h.maxX&&e.minY<=h.maxY&&e.maxX>=h.minX&&e.maxY>=h.minY}function X(h,e,i,s,l){const d=[e,i];for(;d.length;){const f=(0,$.j0)(d.pop()),p=(0,$.j0)(d.pop());if(f-p<=s)continue;const v=p+Math.ceil((f-p)/s/2)*s;(0,w.q)(h,v,p,f,l),d.push(p,v,v,f)}}const z=new K.Z,k=new K.Z,Y=new K.Z,ee=new K.Z({deallocator:void 0});class oe extends class re{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}{constructor(){super(...arguments),this.height=1,this.indexHint=new b.SO}}class te extends oe{constructor(e){super(),this.children=e,this.leaf=!0}}class ie extends oe{constructor(e){super(),this.children=e,this.leaf=!1}}},61256:(W,C,o)=>{o.d(C,{H:()=>G});var b=o(8314),$=o(36592),K=o(65401);const S={minX:0,minY:0,maxX:0,maxY:0};class G{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new $.Q(9,(0,b.Z)("esri-csp-restrictions")?g=>({minX:g[0],minY:g[1],maxX:g[2],maxY:g[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const g=new Array(this._idByBounds.size);let B=0;this._idByBounds.forEach((R,ne)=>{g[B++]=ne}),this._indexInvalid=!1,this._index.clear(),this._index.load(g)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(g=>this._idByBounds.has(g))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const g=(0,K.cS)();for(const B of this._boundsById.values())B&&(g[0]=Math.min(B[0],g[0]),g[1]=Math.min(B[1],g[1]),g[2]=Math.max(B[2],g[2]),g[3]=Math.max(B[3],g[3]));return g}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(g){const B=this._boundsById.get(g);this._boundsById.delete(g),B&&(this._idByBounds.delete(B),this._indexInvalid||this._index.remove(B))}forEachInBounds(g,B){this._loadIndex(),function j(L,g,B){(function M(L){S.minX=L[0],S.minY=L[1],S.maxX=L[2],S.maxY=L[3]})(g),L.search(S,B)}(this._index,g,R=>B(this._idByBounds.get(R)))}get(g){return this._boundsById.get(g)}has(g){return this._boundsById.has(g)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(g,B){if(!this._indexInvalid){const R=this._boundsById.get(g);R&&(this._index.remove(R),this._idByBounds.delete(R))}this._boundsById.set(g,B),B&&(this._idByBounds.set(B,g),this._indexInvalid||(this._boundsToLoad.push(B),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(W,C,o)=>{o.d(C,{Z:()=>R});var b=o(26584),$=o(61885),K=o(63290),w=o(62208),S=o(5548),M=o(65401),j=o(82054),G=o(61256),L=o(92794),g=o(6185);const B=(0,S.Ue)();class R{constructor(m){this.geometryInfo=m,this._boundsStore=new G.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new $.Z,this.featureAdapter=L.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let m=0;return this._featuresById.forEach(y=>{(0,w.pC)(y.geometry)&&y.geometry.coords&&(m+=y.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:m/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(m){if((0,w.Wi)(this.fullBounds))return null;const[y,N,X,z]=this.fullBounds;return{xmin:y,ymin:N,xmax:X,ymax:z,spatialReference:(0,g.S2)(m)}}add(m){this._add(m),this._emitChanged()}addMany(m){for(const y of m)this._add(y);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(m){const y=this._featuresById.get(m);return y?(this._remove(y),this._emitChanged(),y):null}removeManyById(m){this._boundsStore.invalidateIndex();for(const y of m){const N=this._featuresById.get(y);N&&this._remove(N)}this._emitChanged()}forEachBounds(m,y){for(const N of m){const X=this._boundsStore.get(N.objectId);X&&y((0,S.JR)(B,X))}}getFeature(m){return this._featuresById.get(m)}has(m){return this._featuresById.has(m)}forEach(m){this._featuresById.forEach(y=>m(y))}forEachInBounds(m,y){this._boundsStore.forEachInBounds(m,N=>{y(this._featuresById.get(N))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let m=!1;this._featuresById.forEach((y,N)=>{this._markedIds.has(N)||(m=!0,this._remove(y))}),this._markedIds.clear(),m&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(m){if(!m)return;const y=m.objectId;if(null==y)return void K.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new b.Z("featurestore:invalid-feature","feature id is missing",{feature:m}));const N=this._featuresById.get(y);let X;if(this._markedIds.add(y),N?(m.displayId=N.displayId,X=this._boundsStore.get(y),this._boundsStore.delete(y)):(0,w.pC)(this.onFeatureAdd)&&this.onFeatureAdd(m),(0,w.Wi)(m.geometry)||!m.geometry.coords||!m.geometry.coords.length)return this._boundsStore.set(y,null),void this._featuresById.set(y,m);X=(0,j.$)((0,w.pC)(X)?X:(0,M.Ue)(),m.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,w.pC)(X)&&this._boundsStore.set(y,X),this._featuresById.set(y,m)}_remove(m){(0,w.pC)(this.onFeatureRemove)&&this.onFeatureRemove(m);const y=m.objectId;return this._markedIds.delete(y),this._boundsStore.delete(y),this._featuresById.delete(y),m}}},92794:(W,C,o)=>{o.d(C,{n:()=>S});var b=o(62208),$=o(77044),K=o(66385),w=o(88071);const S={getObjectId:M=>M.objectId,getAttributes:M=>M.attributes,getAttribute:(M,j)=>M.attributes[j],cloneWithGeometry:(M,j)=>new K.u_(j,M.attributes,null,M.objectId),getGeometry:M=>M.geometry,getCentroid:(M,j)=>((0,b.Wi)(M.centroid)&&(M.centroid=(0,$.Y)(new w.Z,M.geometry,j.hasZ,j.hasM)),M.centroid)}},39155:(W,C,o)=>{o.r(C),o.d(C,{default:()=>xe});var b=o(15861),K=(o(29132),o(84792)),w=o(59213),S=o(26584),M=o(63290),j=o(10699),G=o(21726),L=o(55915),g=o(15994),B=o(37053),R=o(46367),ne=o(66385),m=o(88071),y=o(3579),N=o(82959),X=o(58175),z=o(75327),k=o(36630);const Y=/^\s*"([\S\s]*)"\s*$/,ee=/""/g,oe=[","," ",";","|","\t"];function*te(c,r,t){let n=0;for(;n<=c.length;){const a=c.indexOf(r,n),u=c.substring(n,a>-1?a:void 0);n+=u.length+r.length,t&&!u.trim()||(yield u)}}function ie(c){const r=c.includes("\r\n")?"\r\n":"\n";return te(c,r,!0)}function h(c,r){return te(c,r,!1)}function*i(c,r,t,n=(()=>Object.create(null))){const a=ie(c);a.next();let u="",x="",I=0,_=n(),D=0;e:for(const J of a){const A=h(J,t);for(const U of A)if(u+=x+U,x="",I+=d(U),I%2==0){if(I>0){const Q=Y.exec(u);if(!Q){_=n(),D=0,u="",I=0;continue e}_[r[D]]=Q[1].replace(ee,'"'),D++}else _[r[D]]=u,D++;u="",I=0}else x=t;0===I?(yield _,_=n(),D=0):x="\n"}}function s(c,r){const t=l(c,r).filter(a=>null!=a),n=t.map(a=>(0,k.q6)(a));for(let a=n.length-1;a>=0;a--)n[a]||(n.splice(a,1),t.splice(a,1));return{names:n,aliases:t}}function l(c,r){if(null==c||!c.length)return[];const t=[];let n="",a="",u=0;const x=h(c,r);for(const I of x)if(n+=a+I,a="",u+=d(I),u%2==0){if(u>0){const _=Y.exec(n);_&&t.push(_[1].replace(ee,'"'))}else t.push(n);n="",u=0}else a=r;return t}function d(c){let r=0,t=0;for(t=c.indexOf('"',t);t>=0;)r++,t=c.indexOf('"',t+1);return r}function f(c,r,t){var x,I;r=null==(x=(0,k.q6)(r))?void 0:x.toLowerCase(),t=null==(I=(0,k.q6)(t))?void 0:I.toLowerCase();const n=c.map(_=>_.toLowerCase()),a=r?c[n.indexOf(r)]:null,u=t?c[n.indexOf(t)]:null;return{longitudeFieldName:a||c[n.indexOf(fe.find(_=>n.includes(_)))],latitudeFieldName:u||c[n.indexOf(ae.find(_=>n.includes(_)))]}}function v(c){if(!c.length)return"string";const r=/[^+-.,0-9]/;return c.map(t=>{let n=!1;if(""!==t){if(r.test(t))n=!0;else{let a=T(t);if(!isNaN(a))return/[.,]/.test(t)||!Number.isInteger(a)||a>214783647||a<-214783648?"double":"integer";if(t.includes("E")){if(a=Number(t),!isNaN(a))return"double";if(t.includes(",")){if(t=t.replace(",","."),a=Number(t),!isNaN(a))return"double";n=!0}else n=!0}else n=!0}return n?/^[-]?\d*[.,]?\d*$/.test(t)?"string":P(new Date(t),t)?"date":"string":"string"}}).reduce((t,n)=>void 0===t?n:void 0===n?t:t===n?n:"string"===t||"string"===n?"string":"double"===t||"double"===n?"double":void 0)}function P(c,r){if(!c||"[object Date]"!==Object.prototype.toString.call(c)||isNaN(c.getTime()))return!1;let t=!0;if(!H&&/\d+\W*$/.test(r)){const n=r.match(/[a-zA-Z]{2,}/);if(n){let a=!1,u=0;for(;!a&&u<=n.length;)a=!Z.test(n[u]),u++;t=!a}}return t}const T=function(){const c=(0,z.lt)(),r=new RegExp("^"+c.regexp+"$"),t=new RegExp("["+c.group+"\\s\\xa0]","g"),n=c.factor;return a=>{const u=r.exec(a);if(c.factor=n,!u)return NaN;let x=u[1];if(!u[1]){if(!u[2])return NaN;x=u[2],c.factor*=-1}return x=x.replace(t,"").replace(c.decimal,"."),+x*c.factor}}(),Z=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,H=Number.isNaN(new Date("technology 10").getTime()),ae=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],fe=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"];var de=o(56554),he=o(60466),me=o(65234);const _e=(0,de.bU)("esriGeometryPoint"),ge=["csv"],ye=[0,0];class pe{constructor(r,t){this.x=r,this.y=t}}class xe{constructor(){var r=this;this._queryEngine=null,this._snapshotFeatures=function(){var t=(0,b.Z)(function*(n){const a=yield r._fetch(n);return r._createFeatures(a)});return function(n){return t.apply(this,arguments)}}()}destroy(){var r;null==(r=this._queryEngine)||r.destroy(),this._queryEngine=null}load(r,t={}){var n=this;return(0,b.Z)(function*(){var D;n._loadOptions=r;const[a]=yield Promise.all([n._fetch(t.signal),n._checkProjection(null==(D=null==r?void 0:r.parsingOptions)?void 0:D.spatialReference)]),u=function Ie(c,r){var se,E,V;const t=r.parsingOptions||{},n={delimiter:t.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:t.latitudeField,longitudeFieldName:t.longitudeField}},a=n.layerDefinition={name:(0,G.vt)(r.url,ge)||"csv",drawingInfo:_e,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:t.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:t.spatialReference||{wkid:4326}}},u=ie(c),x=null==(se=u.next().value)?void 0:se.trim(),I=null==(E=u.next().value)?void 0:E.trim();if(!x)throw new S.Z("csv-layer:empty-csv","CSV is empty",{csv:c});const{delimiter:_,locationInfo:D}=function e(c,r,t){var x;c=c.trim(),r=null==r?void 0:r.trim();const n=[],a=Array.from(new Set([null==t?void 0:t.delimiter,...oe])).filter(I=>null!=I);for(const I of a){const _=l(c,I).length,D=null!=(x=l(r,I).length)?x:_;_>1&&n.push({weight:Math.min(_,D),delimiter:I})}const u=n.sort(({weight:I},{weight:_})=>_-I).map(({delimiter:I})=>I);for(const I of u){const _=f(s(c,I).names,null==t?void 0:t.longitudeField,null==t?void 0:t.latitudeField);if(_.longitudeFieldName&&_.latitudeFieldName)return{delimiter:I,locationInfo:_}}return{delimiter:u[0],locationInfo:null}}(x,I,t);if(!_)throw new S.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV",{firstLine:x,secondLine:I,parsingOptions:t});if(!D)throw new S.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file",{firstLine:x,secondLine:I,parsingOptions:t});n.locationInfo=D,n.delimiter=_;const{names:J,aliases:A}=s(x,_),U=function p(c,r,t,n,a){const u=[],x=i(c,t,r),I=[];for(const _ of x){if(10===I.length)break;I.push(_)}for(let _=0;_<t.length;_++){const D=t[_],J=n[_];if(D===a.longitudeFieldName||D===a.latitudeFieldName)u.push({name:D,type:"esriFieldTypeDouble",alias:J});else{let A,U;switch(v(I.map(Q=>Q[D]))){case"integer":A="esriFieldTypeInteger";break;case"double":A="esriFieldTypeDouble";break;case"date":A="esriFieldTypeDate",U=36;break;default:A="esriFieldTypeString",U=255}u.push({name:D,type:A,alias:J,length:U})}}return u}(c,n.delimiter,J,A,n.locationInfo);if(null!=(V=t.fields)&&V.length){const F=new he.Z(t.fields);for(const O of U){const q=F.get(O.name);q&&Object.assign(O,q)}}if(!U.some(F=>"esriFieldTypeOID"===F.type&&(a.objectIdField=F.name,!0))){const F={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};a.objectIdField=F.name,U.unshift(F)}a.fields=U;const Q=new he.Z(a.fields);if(n.locationInfo&&(n.locationInfo.latitudeFieldName=Q.get(n.locationInfo.latitudeFieldName).name,n.locationInfo.longitudeFieldName=Q.get(n.locationInfo.longitudeFieldName).name),a.timeInfo){const F=a.timeInfo;if(F.startTimeField){const O=Q.get(F.startTimeField);O?(F.startTimeField=O.name,O.type="esriFieldTypeDate"):F.startTimeField=null}if(F.endTimeField){const O=Q.get(F.endTimeField);O?(F.endTimeField=O.name,O.type="esriFieldTypeDate"):F.endTimeField=null}if(F.trackIdField){const O=Q.get(F.trackIdField);F.trackIdField=O?O.name:null}F.startTimeField||F.endTimeField||(a.timeInfo=null)}return n}(a,r);n._locationInfo=u.locationInfo,n._delimiter=u.delimiter,n._queryEngine=n._createQueryEngine(u);const x=yield n._createFeatures(a);n._queryEngine.featureStore.addMany(x);const{fullExtent:I,timeExtent:_}=yield n._queryEngine.fetchRecomputedExtents();if(u.layerDefinition.extent=I,_){const{start:J,end:A}=_;u.layerDefinition.timeInfo.timeExtent=[J,A]}return u})()}applyEdits(){return(0,b.Z)(function*(){throw new S.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(r={},t={}){var n=this;return(0,b.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQuery(r,t.signal)})()}queryFeatureCount(r={},t={}){var n=this;return(0,b.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForCount(r,t.signal)})()}queryObjectIds(r={},t={}){var n=this;return(0,b.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForIds(r,t.signal)})()}queryExtent(r={},t={}){var n=this;return(0,b.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForExtent(r,t.signal)})()}querySnapping(r,t={}){var n=this;return(0,b.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForSnapping(r,t.signal)})()}refresh(r){var t=this;return(0,b.Z)(function*(){var u;t._loadOptions.customParameters=r,null==(u=t._snapshotTask)||u.abort(),t._snapshotTask=(0,w.vr)(t._snapshotFeatures),t._snapshotTask.promise.then(x=>{t._queryEngine.featureStore.clear(),x&&t._queryEngine.featureStore.addMany(x)},x=>{t._queryEngine.featureStore.clear(),(0,j.D_)(x)||M.Z.getLogger("esri.layers.CSVLayer").error(new S.Z("csv-layer:refresh","An error occurred during refresh",{error:x}))}),yield t._waitSnapshotComplete();const{fullExtent:n,timeExtent:a}=yield t._queryEngine.fetchRecomputedExtents();return{extent:n,timeExtent:a}})()}_waitSnapshotComplete(){var r=this;return(0,b.Z)(function*(){if(r._snapshotTask&&!r._snapshotTask.finished){try{yield r._snapshotTask.promise}catch(t){}return r._waitSnapshotComplete()}})()}_fetch(r){var t=this;return(0,b.Z)(function*(){const{url:n,customParameters:a}=t._loadOptions;if(!n)throw new S.Z("csv-layer:invalid-source","url not defined");const u=(0,G.mN)(n);return(yield(0,K.default)(u.path,{query:le(le({},u.query),a),responseType:"text",signal:r})).data})()}_createQueryEngine(r){const{objectIdField:t,fields:n,extent:a,timeInfo:u}=r.layerDefinition,x=new y.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new X.q({fields:n,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:u,objectIdField:t,spatialReference:a.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:x})}_createFeatures(r){var t=this;return(0,b.Z)(function*(){const{latitudeFieldName:n,longitudeFieldName:a}=t._locationInfo,{objectIdField:u,fieldsIndex:x,spatialReference:I}=t._queryEngine;let _=[];const D=[],J=x.fields.filter(E=>E.name!==u).map(E=>E.name);let A=0;const U={};for(const E of x.fields)if("esriFieldTypeOID"!==E.type&&"esriFieldTypeGlobalID"!==E.type){const V=(0,k.os)(E);void 0!==V&&(U[E.name]=V)}const Q=i(r,J,t._delimiter,(0,de.Dm)(U,u));for(const E of Q){const V=t._parseCoordinateValue(E[n]),F=t._parseCoordinateValue(E[a]);if(null!=F&&null!=V&&!isNaN(V)&&!isNaN(F)){E[n]=V,E[a]=F;for(const O in E)if(O!==n&&O!==a)if(x.isDateField(O)){const q=new Date(E[O]);E[O]=P(q,E[O])?q.getTime():null}else if(x.isNumericField(O)){const q=T(E[O]);E[O]=isNaN(q)?null:q}E[u]=A,A++,_.push(new pe(F,V)),D.push(E)}}if(!(0,B.fS)({wkid:4326},I))if((0,B.sS)(I))for(const E of _)[E.x,E.y]=(0,R.hG)(E.x,E.y,ye);else _=(0,L.oj)(g.N,_,me.Z.WGS84,I,null,null);const se=[];for(let E=0;E<_.length;E++){const{x:V,y:F}=_[E],O=D[E];O[u]=E+1,se.push(new ne.u_(new m.Z([],[V,F]),O,null,O[u]))}return se})()}_parseCoordinateValue(r){if(null==r||""===r)return null;let t=T(r);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(r)),t}_checkProjection(r){return(0,b.Z)(function*(){try{yield(0,N._W)(B.Zn,r)}catch(t){throw new S.Z("csv-layer:projection-not-supported","Projection not supported")}})()}}}}]);