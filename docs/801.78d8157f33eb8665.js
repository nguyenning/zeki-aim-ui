"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[801],{11369:(ce,G,z)=>{z.r(G),z.d(G,{CIMSymbolRasterizer:()=>ne,GeometryStyle:()=>S});var U=z(15861),V=z(91558),b=z(84792),te=z(10699),x=z(23841),N=z(77275),H=z(91179),_=z(53141),re=z(57052),R=z(44654),Z=z(31375),L=z(47139),y=z(80991);class ${constructor(e){this._resourceManager=e}dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,t,s){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){const[h,n,f]=R.fN.rasterizeSimpleFill(this._rasterizationCanvas,e.style,t);return{size:[n,f],image:new Uint32Array(h.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type||"line"===e.type&&e.dashTemplate){let h,n;if("simple-line"===e.type||"esriSLS"===e.type)switch(h=(0,R.U1)(e.style,e.cap),e.cap){case"butt":n="Butt";break;case"square":n="Square";break;default:n="Round"}else h=e.dashTemplate,n=e.cim.capStyle;const[f,g,d]=R.fN.rasterizeSimpleLine(h,n);return{size:[g,d],image:new Uint32Array(f.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let r,a,o;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(r=R.B$.fromSimpleMarker(e),o=(0,L.Fp)(r)):e.cim&&"CIMHatchFill"===e.cim.type?(r=R.B$.fromCIMHatchFill(e.cim),a=new Z.Z(r.frame.xmin,-r.frame.ymax,r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin)):e.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.cim.markerPlacement.type?(r=R.B$.fromCIMInsidePolygon(e.cim),a=new Z.Z(r.frame.xmin,-r.frame.ymax,r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin)):(r=e.cim,o=(0,L.Fp)(r)),o&&!s){const[h,n,f]=(0,L.RL)(o);return h?{size:[n,f],image:new Uint32Array(h.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[i,l,c,m,C]=R.B$.rasterize(this._rasterizationCanvas,r,a,this._resourceManager,!s);return i?{size:[l,c],image:new Uint32Array(i.buffer),sdf:!1,simplePattern:!1,anchorX:m,anchorY:C}:null}rasterizeImageResource(e,t,s,r){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const a=this._rasterizationCanvas.getContext("2d");s instanceof ImageData?a.putImageData(s,0,0):(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`),a.drawImage(s,0,0,e,t));const o=a.getImageData(0,0,e,t),i=new Uint8Array(o.data);if(r)for(const n of r)if(n&&n.oldColor&&4===n.oldColor.length&&n.newColor&&4===n.newColor.length){const[f,g,d,I]=n.oldColor,[v,w,P,F]=n.newColor;if(f===v&&g===w&&d===P&&I===F)continue;for(let M=0;M<i.length;M+=4)f===i[M]&&g===i[M+1]&&d===i[M+2]&&I===i[M+3]&&(i[M]=v,i[M+1]=w,i[M+2]=P,i[M+3]=F)}let l;for(let n=0;n<i.length;n+=4)l=i[n+3]/255,i[n]=i[n]*l,i[n+1]=i[n+1]*l,i[n+2]=i[n+2]*l;let c=i,m=e,C=t;const h=512;if(m>=h||C>=h){const n=m/C;n>1?(m=h,C=Math.round(h/n)):(C=h,m=Math.round(h*n)),c=new Uint8Array(4*m*C);const f=new Uint8ClampedArray(c.buffer);(0,y.TT)(i,e,t,f,m,C,!1)}return{size:[m,C],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}var S,p,ae=z(68937),ie=z(56445),u=z(37519);(p=S||(S={})).Legend="legend",p.Preview="preview";const A=(p,e,t)=>{if(p&&p.targetSize){let s;if(t){const r=Math.max(t.frame.xmax-t.frame.xmin,t.frame.ymax-t.frame.ymin);s=p.targetSize/(0,x.F2)(r)}else s=p.targetSize/e.referenceSize;return s}return p&&p.scaleFactor?p.scaleFactor:1},J={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:2,ymin:-2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:2,ymin:-2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};class ne{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._pictureMarkerCache=new Map,this._textRasterizer=new ae.Z,this._cimResourceManager=new re.Z,this._rasterizer=new $(this._cimResourceManager)}rasterizeCIMSymbolAsync(e,t,s,r,a,o,i,l){var c=this;return(0,U.Z)(function*(){r=r||(t?null!=t.centroid?"esriGeometryPolygon":(0,H.Ji)(t.geometry):null)||function he(p){if(!(p&&p.data&&p.data.symbol))return null;switch(p.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}(e);const m=yield c.analyzeCIMSymbol(e,t?function me(p){return(p?Object.keys(p):[]).map(e=>({name:e,alias:e,type:"string"==typeof p[e]?"esriFieldTypeString":"esriFieldTypeDouble"}))}(t.attributes):null,s,r,l);return c.rasterizeCIMSymbol(m,t,r,a,o,i)})()}analyzeCIMSymbol(e,t,s,r,a){var o=this;return(0,U.Z)(function*(){const i=[],l=t?{geometryType:r,spatialReference:o._spatialReference,fields:t}:null;let c;yield(0,_.c)(e.data,l,o._cimResourceManager,i,o._avoidSDF),(0,te.k_)(a);for(const m of i)"CIMPictureMarker"!==m.cim.type&&"CIMPictureFill"!==m.cim.type&&"CIMPictureStroke"!==m.cim.type||(c||(c=[]),c.push(o._fetchPictureMarkerResource(m,a))),s&&"text"===m.type&&"string"==typeof m.text&&m.text.includes("[")&&(m.text=(0,y.Qs)(s,m.text,m.cim.textCase));return c&&(yield Promise.all(c)),i})()}_fetchPictureMarkerResource(e,t){var s=this;return(0,U.Z)(function*(){const r=e.materialHash;if(!s._pictureMarkerCache.get(r)){const a=(yield(0,b.default)(e.cim.url,{responseType:"image",signal:t&&t.signal})).data;s._pictureMarkerCache.set(r,a)}})()}rasterizeCIMSymbol(e,t,s,r,a,o){const i=[];for(const l of e){r&&"function"==typeof r.scaleFactor&&(r.scaleFactor=r.scaleFactor(t,a,o));const c=this._getRasterizedResource(l,t,s,r,a,o);if(!c)continue;let m=0,C=c.anchorX||0,h=c.anchorY||0,n=!1,f=0,g=0;if("esriGeometryPoint"===s){const d=A(r,l,null);if(f=(0,y.hf)(l.offsetX,t,a,o)*d||0,g=(0,y.hf)(l.offsetY,t,a,o)*d||0,"marker"===l.type)m=(0,y.hf)(l.rotation,t,a,o)||0,n=!!l.rotateClockwise&&l.rotateClockwise;else if("text"===l.type){if(m=(0,y.hf)(l.angle,t,a,o)||0,void 0!==l.horizontalAlignment)switch(l.horizontalAlignment){case"left":C=-.5;break;case"right":C=.5;break;default:C=0}if(void 0!==l.verticalAlignment)switch(l.verticalAlignment){case"top":h=.5;break;case"bottom":h=-.5;break;case"baseline":h=-.25;break;default:h=0}}}null!=c&&i.push({angle:m,rotateClockWise:n,anchorX:C,anchorY:h,offsetX:f,offsetY:g,rasterizedResource:c})}return this.getSymbolImage(i)}getSymbolImage(e){const t=document.createElement("canvas"),s=t.getContext("2d");let r=0,a=0,o=0,i=0;const l=[];for(let h=0;h<e.length;h++){const n=e[h],f=n.rasterizedResource;if(!f)continue;const g=f.size,d=n.offsetX,I=n.offsetY,v=n.anchorX,w=n.anchorY,P=n.rotateClockWise||!1;let F=n.angle,M=(0,x.F2)(d)-g[0]*(.5+v),k=(0,x.F2)(I)-g[1]*(.5+w),T=M+g[0],Y=k+g[1];if(F){P&&(F=-F);const D=Math.sin(F*Math.PI/180),X=Math.cos(F*Math.PI/180),W=M*X-k*D,j=M*D+k*X,Q=M*X-Y*D,se=M*D+Y*X,le=T*X-Y*D,K=T*D+Y*X,q=T*X-k*D,ee=T*D+k*X;M=Math.min(W,Q,le,q),k=Math.min(j,se,K,ee),T=Math.max(W,Q,le,q),Y=Math.max(j,se,K,ee)}r=M<r?M:r,a=k<a?k:a,o=T>o?T:o,i=Y>i?Y:i;const B=s.createImageData(f.size[0],f.size[1]);B.data.set(new Uint8ClampedArray(f.image.buffer)),l.push({offsetX:d,offsetY:I,rotateClockwise:P,angle:F,rasterizedImage:B,anchorX:v,anchorY:w})}t.width=o-r,t.height=i-a;const c=-r,m=i;for(let h=0;h<l.length;h++){const n=l[h],f=this._imageDataToCanvas(n.rasterizedImage),I=c-n.rasterizedImage.width*(.5+n.anchorX),v=m-n.rasterizedImage.height*(.5-n.anchorY);if(n.angle){const w=(360-n.angle)*Math.PI/180;s.save(),s.translate((0,x.F2)(n.offsetX),-(0,x.F2)(n.offsetY)),s.translate(c,m),s.rotate(w),s.translate(-c,-m),s.drawImage(f,I,v),s.restore()}else s.drawImage(f,I+(0,x.F2)(n.offsetX),v-(0,x.F2)(n.offsetY))}const C=new u.e({x:c/t.width-.5,y:m/t.height-.5});return{imageData:0!==t.width&&0!==t.height?s.getImageData(0,0,t.width,t.height):s.createImageData(1,1),anchorPosition:C}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const t=this._imageDataCanvas,s=t.getContext("2d");return t.width=e.width,t.height=e.height,s.putImageData(e,0,0),t}_imageTo32Array(e,t,s,r){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const a=this._imageDataCanvas,o=a.getContext("2d");if(a.width=t,a.height=s,o.drawImage(e,0,0,t,s),r){o.save();const i=new V.Z(r);o.fillStyle=i.toHex(),o.globalCompositeOperation="multiply",o.fillRect(0,0,t,s),o.globalCompositeOperation="destination-atop",o.drawImage(e,0,0,t,s),o.restore()}return new Uint32Array(o.getImageData(0,0,t,s).data.buffer)}_getRasterizedResource(e,t,s,r,a,o){let i,l,c,m,C=null,h=null;if("esriGeometryPolyline"===s||"esriGeometryPolygon"===s){const f=r&&r.style?r.style:S.Legend,g="esriGeometryPolyline"===s?J.stroke[f]:J.fill[f];if("line"===e.type){if("CIMSolidStroke"!==e.cim.type){if("CIMPictureStroke"===e.cim.type){const d=(0,y.hf)(e.width,t,a,o),I=(0,y.hf)(e.color,t,a,o),{image:v,width:w,height:P}=this._getPictureResource(e,d,I);return this._rasterizePictureResource(e,v,w,P,g,d)}return null}({analyzedCIM:i,hash:c}=O(e,t,a,o)),l=this._embedCIMLayerInVectorMarker(i,g)}else if("marker"===e.type){if("CIMPictureMarker"===e.cim.type){const d=(0,y.hf)(e.size,t,a,o),I=(0,y.hf)(e.color,t,a,o),{image:v,width:w,height:P}=this._getPictureResource(e,d,I);return this._rasterizePictureResource(e,v,w,P,g,d)}if("CIMVectorMarker"!==e.cim.type)return null;e.cim.offsetX=(0,y.hf)(e.offsetX,t,a,o),e.cim.offsetY=(0,y.hf)(e.offsetY,t,a,o),e.cim.rotation=(0,y.hf)(e.rotation,t,a,o),e.cim.markerPlacement=e.markerPlacement,({analyzedCIM:i}=O(e,t,a,o)),c=(0,N.hP)(JSON.stringify(i)).toString(),l=this._embedCIMLayerInVectorMarker(i,g),C=(0,y.hf)(e.size,t,a,o),h=e.path}else{if("text"===e.type)return null;if("fill"===e.type){if("CIMHatchFill"===e.cim.type||"CIMVectorMarker"===e.cim.type||"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){const d=e.cim.size||e.cim.height;let I,v,w;if("CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type)({image:I,width:v,height:w}=this._getPictureResource(e,d,(0,y.hf)(e.color,t,a,o)));else{({analyzedCIM:i,hash:c}=O(e,t,a,o));const P=this._rasterizer.rasterizeJSONResource({cim:i,type:e.type,url:e.url,mosaicHash:c,size:d,path:h},1,this._avoidSDF);I=P.image,v=P.size[0],w=P.size[1]}return this._rasterizePictureResource(e,I,v,w,g,null)}if("CIMSolidFill"!==e.cim.type)return null;({analyzedCIM:i,hash:c}=O(e,t,a,o)),l=this._embedCIMLayerInVectorMarker(i,g)}}}else{if("text"===e.type)return m=this._rasterizeTextResource(e,t,r,a,o),m;({analyzedCIM:i,hash:c}=O(e,t,a,o));const f=A(r,e,null);if("CIMPictureMarker"===e.cim.type){const g=(0,y.hf)(e.size,t,a,o)*f,{image:d,width:I,height:v}=this._getPictureResource(e,g,(0,y.hf)(e.color,t,a,o));return m={image:d,size:[I,v],sdf:!1,simplePattern:!1,anchorX:e.anchorPoint?e.anchorPoint.x:0,anchorY:e.anchorPoint?e.anchorPoint.y:0},m}(0,ie.FW)(i,f,{preserveOutlineWidth:!1}),l=i}c+=s,r&&(c+=JSON.stringify(r));const n=this._resourceCache;return n.has(c)?n.get(c):(m=this._rasterizer.rasterizeJSONResource({cim:l,type:e.type,url:e.url,mosaicHash:c,size:C,path:h},window.devicePixelRatio||1,this._avoidSDF),n.set(c,m),m)}_rasterizeTextResource(e,t,s,r,a){const o=A(s,e,null),i=(0,y.hf)(e.text,t,r,a);if(!i||0===i.length)return null;const l=(0,y.hf)(e.fontName,t,r,a),c=(0,y.hf)(e.style,t,r,a),m=(0,y.hf)(e.weight,t,r,a),C=(0,y.hf)(e.decoration,t,r,a),h=(0,y.hf)(e.size,t,r,a)*o,n=(0,y.hf)(e.horizontalAlignment,t,r,a),f=(0,y.hf)(e.verticalAlignment,t,r,a),g=(0,y.nn)((0,y.hf)(e.color,t,r,a)),d=(0,y.nn)((0,y.hf)(e.outlineColor,t,r,a)),I={color:g,size:h,horizontalAlignment:n,verticalAlignment:f,font:{family:l,style:c,weight:m,decoration:C},halo:{size:(0,y.hf)(e.outlineSize,t,r,a)||0,color:d,style:c},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(i,I)}_rasterizePictureResource(e,t,s,r,a,o){const i=document.createElement("canvas"),l=i.getContext("2d");i.height=(0,x.F2)(Math.max(a.frame.ymax-a.frame.ymin,o)),i.width=(0,x.F2)(a.frame.xmax-a.frame.xmin);const c=l.createImageData(s,r);c.data.set(new Uint8ClampedArray(t.buffer));const m=this._imageDataToCanvas(c),C=l.createPattern(m,"repeat"),h=Math.cos((-e.cim.rotation||0)*Math.PI/180),n=Math.sin((-e.cim.rotation||0)*Math.PI/180);C.setTransform({m11:h,m12:n,m21:-n,m22:h,m41:(0,x.F2)(e.cim.offsetX)||0,m42:(0,x.F2)(e.cim.offsetY)||0});const f=a.canvasPaths;let g,d,I;(0,H.oU)(f)?(g=f.rings,l.fillStyle=C,d=l.fill,I=["evenodd"]):(0,H.l9)(f)&&(g=f.paths,l.strokeStyle=C,l.lineWidth=o,d=l.stroke,g[0][0][1]=i.height/2,g[0][1][1]=i.height/2),l.beginPath();for(const P of g){const F=P?P.length:0;if(F>1){let M=P[0];l.moveTo((0,x.F2)(M[0]),(0,x.F2)(M[1]));for(let k=1;k<F;++k)M=P[k],l.lineTo((0,x.F2)(M[0]),(0,x.F2)(M[1]));l.closePath()}}d.apply(l,I);const v=l.getImageData(0,0,i.width,i.height),w=new Uint8Array(v.data);return{size:[i.width,i.height],image:new Uint32Array(w.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t,s){const r=this._pictureMarkerCache.get(e.materialHash);if(!r)return null;const a=r.height/r.width,o=t?a>1?(0,x.F2)(t):(0,x.F2)(t)/a:r.width,i=t?a>1?(0,x.F2)(t)*a:(0,x.F2)(t):r.height;return{image:this._imageTo32Array(r,o,i,s),width:o,height:i}}_embedCIMLayerInVectorMarker(e,t){const s=(0,H.oU)(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol",r=t.frame;return{type:"CIMVectorMarker",frame:r,size:r.ymax-r.ymin,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:s,symbolLayers:[e]}}]}}}function O(p,e,t,s){let r,a;return"function"==typeof p.materialHash?(r=(0,p.materialHash)(e,t,s),a=(0,_.S)(p.cim,p.materialOverrides)):(r=p.materialHash,a=p.cim),{analyzedCIM:a,hash:r}}},39351:(ce,G,z)=>{z.d(G,{$0:()=>Z,AI:()=>b,By:()=>o,C1:()=>q,CQ:()=>fe,CU:()=>oe,Ex:()=>J,I_:()=>N,Ic:()=>e,Ij:()=>r,Ip:()=>Q,Iv:()=>de,Iw:()=>ne,MI:()=>K,SD:()=>Ce,Tz:()=>ue,Uh:()=>ee,V4:()=>B,XJ:()=>j,_6:()=>pe,a:()=>D,aK:()=>d,e0:()=>ge,eV:()=>L,f2:()=>a,fL:()=>W,iJ:()=>t,jk:()=>Me,kF:()=>C,m4:()=>w,mx:()=>i,nM:()=>s,oK:()=>ye,pU:()=>g,ru:()=>x,tQ:()=>T,uG:()=>P,xl:()=>f,xm:()=>y,yP:()=>h});const b=1e-30,x=4294967295,N=512,Z=8,L=10,y=29,J=24,ne=8,e=0,t=1,s=2,r=3,a=4,o=5,i=6,C=5,h=6,f=1,g=2,d=3,w=2,P=1,T=1.05,B=5,oe=6,D=1.15,W=2,j=8,Q=500,K=10,q=1024,ee=2,fe=0,ue=1,ye=4,ge=8,de=16,pe=4,Ce=1,Me=4},5254:(ce,G,z)=>{z.d(G,{Au:()=>L,Jz:()=>$,UJ:()=>E});const U=new Float32Array(1);function L(u){return[255&u,(65280&u)>>>8,(16711680&u)>>>16,(4278190080&u)>>>24]}function E(u,S){return 65535&u|S<<16}function $(u,S,A,J){return 255&u|(255&S)<<8|(255&A)<<16|J<<24}new Uint32Array(U.buffer)}}]);