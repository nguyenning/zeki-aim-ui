"use strict";var Ae=Object.defineProperty,Ve=Object.defineProperties,Te=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,be=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable,ye=(T,m,s)=>m in T?Ae(T,m,{enumerable:!0,configurable:!0,writable:!0,value:s}):T[m]=s,X=(T,m)=>{for(var s in m||(m={}))be.call(m,s)&&ye(T,s,m[s]);if(ve)for(var s of ve(m))Ie.call(m,s)&&ye(T,s,m[s]);return T},J=(T,m)=>Ve(T,Te(m));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[727],{60595:(T,m,s)=>{s.d(m,{T:()=>C});var r=s(15861),M=s(84792),a=s(26584),d=s(62208);function C(_,V,E,b,w,f){return S.apply(this,arguments)}function S(){return(S=(0,r.Z)(function*(_,V,E,b,w,f){let y=null;if((0,d.pC)(E)){const h=`${_}/nodepages/`,B=h+Math.floor(E.rootIndex/E.nodesPerPage);try{return{type:"page",rootPage:(yield(0,M.default)(B,{query:{f:"json",token:b},responseType:"json",signal:f})).data,rootIndex:E.rootIndex,pageSize:E.nodesPerPage,lodMetric:E.lodSelectionMetricType,urlPrefix:h}}catch(W){(0,d.pC)(w)&&w.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",B,W),y=W}}if(!V)return null;const L=`${_}/nodes/`,Q=L+(V&&V.split("/").pop());try{return{type:"node",rootNode:(yield(0,M.default)(Q,{query:{f:"json",token:b},responseType:"json",signal:f})).data,urlPrefix:L}}catch(h){throw new a.Z("sceneservice:root-node-missing","Root node missing.",{pageError:y,nodeError:h,url:Q})}})).apply(this,arguments)}},1437:(T,m,s)=>{s.d(m,{p:()=>E});var r=s(17626),M=s(54024),a=s(62208),d=s(60330),C=s(77712),V=(s(90912),s(85931),s(76898));const E=b=>{let w=class extends((0,d.v)(b)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(f){this._userInteractive=f}get updating(){return!1}get visible(){return!(0,a.pC)(this.parent)||this.parent.visible&&!this.parent.suspended}set visible(f){this._overrideIfSome("visible",f)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,M.kB)(()=>this._interactiveViewModelCount--)}};return(0,r._)([(0,C.Cb)({readOnly:!0})],w.prototype,"type",void 0),(0,r._)([(0,C.Cb)({constructOnly:!0})],w.prototype,"analysis",void 0),(0,r._)([(0,C.Cb)({constructOnly:!0})],w.prototype,"parent",void 0),(0,r._)([(0,C.Cb)({constructOnly:!0})],w.prototype,"view",void 0),(0,r._)([(0,C.Cb)({type:Boolean})],w.prototype,"interactive",null),(0,r._)([(0,C.Cb)()],w.prototype,"_userInteractive",void 0),(0,r._)([(0,C.Cb)({readOnly:!0})],w.prototype,"updating",null),(0,r._)([(0,C.Cb)()],w.prototype,"visible",null),(0,r._)([(0,C.Cb)()],w.prototype,"_interactiveViewModelCount",void 0),w=(0,r._)([(0,V.j)("esri.views.3d.analysis.AnalysisView3D")],w),w}},25601:(T,m,s)=>{s.d(m,{O:()=>C,s:()=>S});const r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",M="data:image/png;base64,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";var a=s(81695);const d={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function C(_){return _.fromData(r,()=>new a.x(r,d))}function S(_){return _.fromData(M,()=>new a.x(M,d))}},1042:(T,m,s)=>{s.r(m),s.d(m,{default:()=>me});var r=s(17626),M=s(14517),a=s(62208),d=s(77712),_=(s(90912),s(85931),s(76898)),V=s(1437),E=s(25706),b=s(72392),w=s(63290),f=s(32917),y=s(41743),L=s(44917),Q=s(49410),h=s(96298),B=s(54865),W=s(94573);const U="esri.views.3d.analysis.Slice.SliceController",G=w.Z.getLogger(U);let j=class extends M.Z{constructor(e){super(e),this._handles=new b.Z,this._internalChange=!1,this._currentSlicePlane=null}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const t=e.item;null!=t&&(t instanceof L.Z||t instanceof Q.Z)?t instanceof L.Z&&function $(e){switch(e.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,W.Bg)(e.type),!1}}(t)?(G.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(G.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),function ie(e,t){var i;K.has(e)||K.set(e,{all:[],activeController:null}),null==(i=K.get(e))||i.all.push(t)}(this.view,this),this._handles.add([(0,f.YP)(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),(0,f.YP)(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),(0,f.YP)(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),(0,f.YP)(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([(0,f.YP)(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function ne(e,t){var u;if(!K.has(e))throw new Error("view expected in global slice register");const i=K.get(e),n=null!=(u=null==i?void 0:i.all.lastIndexOf(t))?u:-1;if(!i||-1===n)throw new Error("controller expected in global slice register");i.all.splice(n,1),0===i.all.length&&K.delete(e)}(this.view,this),this._handles.destroy(),this.set("view",null)}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(h.lR).flatMap(({sublayerViews:t})=>t.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if((0,a.Wi)(t)&&(0,a.Wi)(e)||(0,a.pC)(t)&&(0,a.pC)(e)&&e.equals(t))return;let i=null,n=null;if((0,a.pC)(e)&&(0,a.pC)(e.position)){const u=e.position.spatialReference,g=(0,h.m3)(e,this.view);(0,a.Wi)(g)&&(0,B.e)(this.analysis,u,G),i=(0,h.oP)(g,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,y.a)()),(0,a.pC)(i)&&(n={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=n,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const t=(0,h.Hq)(this.analysisViewData.plane,this.view,this.view.spatialReference,new E.Z);let i=null;(0,a.pC)(t)&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(q)return;const e=k(this.view);if(e)if(this.analysisViewData.active)(0,a.pC)(e.activeController)&&e.activeController!==this?(q=!0,e.activeController.analysisViewData.active=!1,q=!1):(0,a.pC)(e.activeController),this._updateLayerViews(),e.activeController=this;else{if((0,a.pC)(e.activeController)&&e.activeController!==this)return;(0,a.pC)(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){!function se(e){var i;const t=null==(i=k(e))?void 0:i.activeController;e.slicePlane=(0,a.pC)(t)&&(0,a.pC)(t.analysisViewData.plane)&&t.analysisViewData.visible?t.analysisViewData.plane:null}(this.view)}_updateLayerViews(){const e=(0,a.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=n=>{"layers"in n?n.layers.forEach(i):t.push(n)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(n=>{n.destroyed||("slicePlaneEnabled"in n&&(n.slicePlaneEnabled=e&&!t.includes(n.layer)),"sublayerViews"in n&&n.sublayerViews.forEach(u=>{u.slicePlaneEnabled=e&&!t.includes(u.sublayer)}))}),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};(0,r._)([(0,d.Cb)()],j.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"analysis",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"analysisViewData",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"_allLayerAndSubLayerViews",null),j=(0,r._)([(0,_.j)(U)],j);const K=new Map;let q=!1;function k(e){return K.get(e)}var oe,le=s(84244),re=s(50618),Z=s(23841),F=s(28347),l=s(84161),v=s(28093),p=s(90014),D=s(70562),c=s(26242),o=s(2589),A=s(25601),P=s(19142),R=s(8859),H=s(26046),x=s(62483),N=s(67857),_e=s(22712),ae=s(75079),ee=s(41900);let I=oe=class extends _e.f{constructor(e){super(e),this._clock=le.m,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new b.Z,this._viewHandles=new b.Z,this._frameTask=null,this._pointerMoveTimerMs=o.N3,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=(0,y.a)(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=(0,Z.vW)(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=(0,x.Z8)(e.view.state.viewingMode),this._intersector.options.store=N.eC.MIN}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=(0,A.O)(this.view.toolViewManager.textures),this._rotateTiltImage=(0,A.s)(this.view.toolViewManager.textures);const e=i=>{this._updateManipulatorsInteractive(i),i.grabbing||((0,a.pC)(this.analysisViewData.plane)&&(0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=(0,h.Pt)(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",i=>{this._onShiftGrab(i),e(this.shiftManipulator)}),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=(0,h.Ju)(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",i=>{this._onRotateHeadingGrab(i),e(this.rotateHeadingManipulator)}),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=(0,h.Ju)(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",i=>{this._onRotateTiltGrab(i),e(this.rotateTiltManipulator)}),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((i,n)=>{const u=(0,h.vw)(this.view,i);return u.events.on("grab-changed",g=>{this._onResizeGrab(g,n),e(u)}),this._handles.add(this._createResizeDragPipeline(u)),u}),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=(0,h.R_)(this.view),this._previewPlaneOutlineVisualElement=(0,h.i3)(this.view),this._previewPlaneOutlineVisualElement.width=o.q7,this._handles.add((0,f.YP)(()=>this.analysisViewData.plane,()=>this._updateManipulators(),f.Z_));const t=(0,f.YP)(()=>this.state,i=>{"sliced"===i&&this.finishToolCreation()},f.tX);this._handles.add([t,(0,f.YP)(()=>this.view.state.camera,()=>this._onCameraChange())])}destroy(){this._rotateHeadingImage=(0,a.RY)(this._rotateHeadingImage),this._rotateTiltImage=(0,a.RY)(this._rotateTiltImage),this._handles=(0,a.SC)(this._handles),this._viewHandles=(0,a.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,a.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,a.SC)(this._previewPlaneGridVisualElement)}get state(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,a.pC)(this._creatingPointerId)?"grabbing":null}set analysis(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this.analysisViewData.showGrid=(0,a.pC)(e)&&"resize"===e.type,this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return(0,a.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){(0,a.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){(0,a.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}onInputEvent(e){switch(e.type){case"pointer-drag":if(!he(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!he(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!he(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}_onPointerDrag(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&(0,a.pC)(t)&&"shift"===t.type){const i=(0,ee.vT)(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane((0,ee.vT)(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){if(e.pointerId===this._creatingPointerId&&(0,a.pC)(this.analysisViewData.plane)){const t=(0,ee.vT)(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),(0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const t=(0,ee.vT)(e),i=(0,y.a)();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if((0,y.c)(i,this._startPlane),this.analysis.shape=(0,h.Hq)(i,this.view,this.view.spatialReference,new E.Z),"pointer-drag"===e.type){const n=this._calculatePickRay(t);this.inputState=de(n,e.pointerId,i.origin,i)}return!0}}return!1}_onClickExcludeLayer(e){return!("exclude"!==this.layersMode||!this.created||(this.view.hitTest((0,ee.vT)(e)).then(t=>{if(t.results.length){const i=t.results[0],n="graphic"===(null==i?void 0:i.type)&&i.graphic;if(n){const u=n.sourceLayer||n.layer;u&&this.analysis.excludedLayers.push(u)}}else t.ground.layer?this.analysis.excludedLayers.push(t.ground.layer):this.analysis.excludeGroundSurface=!0}),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),0))}_onKeyDown(e){return(e.key===o.GI||e.key===o.tW)&&(this._activeKeyModifiers[e.key]=!0,(0,a.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==o.GI&&e.key!==o.tW||!this._activeKeyModifiers[e.key]||(delete this._activeKeyModifiers[e.key],(0,a.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),0))}_onShiftGrab(e){if("start"!==e.action||(0,a.Wi)(this.analysisViewData.plane)||!e.screenPoint)return;const t=this._calculatePickRay(e.screenPoint);(0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState=de(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(e){return(0,ae.Xd)(e,(t,i,n)=>{const u=this.inputState;if((0,a.Wi)(u)||"shift"!==u.type)return;const g=(0,a.pC)(this.analysisViewData.plane)?(0,y.c)(this.analysisViewData.plane,(0,y.a)()):null;i.next((0,R._N)(this.view,u.shiftPlane)).next(this._shiftDragAdjustSensitivity(u)).next(this._shiftDragUpdatePlane(u)),n.next(()=>{(0,a.pC)(g)&&this._updateBoundedPlane(g)})})}_shiftDragAdjustSensitivity(e){return t=>{if((0,a.Wi)(this.analysisViewData.plane))return null;const n=Math.min((1-Math.abs((0,l.e)((0,y.n)(this.analysisViewData.plane),t.ray.direction)/(0,l.l)(t.ray.direction)))/.001,1),u=-(0,p.jH)(this._startPlane.plane,t.renderEnd),g=-(0,p.jH)(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-n)+u*n-g,t}}_shiftDragUpdatePlane(e){return()=>{if((0,a.Wi)(this.analysisViewData.plane))return;const t=(0,l.c)(c.WM.get(),this._startPlane.origin),i=(0,l.c)(c.WM.get(),(0,y.n)(this._startPlane));(0,l.g)(i,i,-e.depth),(0,l.a)(i,i,t);const n=(0,y.f)(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,(0,y.a)());this._updateBoundedPlane(n)}}_onRotateHeadingGrab(e){if("start"!==e.action||(0,a.Wi)(this.analysisViewData.plane)||!e.screenPoint)return;const t=(0,h.Rd)(this.analysisViewData.plane,this.view.renderCoordsHelper,h.aZ.HEADING,(0,p.Ue)()),i=this._calculatePickRay(e.screenPoint),n=(0,v.c)();(0,p.BR)(t,i,n)&&((0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:n})}_createRotateHeadingDragPipeline(e){return(0,ae.Xd)(e,(t,i,n)=>{const u=this.inputState;if((0,a.Wi)(u)||"rotate"!==u.type)return;const g=(0,a.pC)(this.analysisViewData.plane)?(0,y.c)(this.analysisViewData.plane,(0,y.a)()):null;i.next((0,R._N)(this.view,u.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(u)).next(this._rotateDragUpdatePlaneFromRotate()),n.next(()=>{(0,a.pC)(g)&&this._updateBoundedPlane(g)})})}_onRotateTiltGrab(e){if("start"!==e.action||(0,a.Wi)(this.analysisViewData.plane)||!e.screenPoint)return;const t=(0,h.Rd)(this.analysisViewData.plane,this.view.renderCoordsHelper,h.aZ.TILT,(0,p.Ue)()),i=this._calculatePickRay(e.screenPoint),n=(0,v.c)();(0,p.BR)(t,i,n)&&((0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:n})}_createRotateTiltDragPipeline(e){return(0,ae.Xd)(e,(t,i,n)=>{const u=this.inputState;if((0,a.Wi)(u)||"rotate"!==u.type)return;const g=(0,a.pC)(this.analysisViewData.plane)?(0,y.c)(this.analysisViewData.plane,(0,y.a)()):null;i.next((0,R._N)(this.view,u.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(u)).next(this._rotateDragUpdatePlaneFromRotate()),n.next(()=>{(0,a.pC)(g)&&this._updateBoundedPlane(g)})})}_rotateDragRenderPlaneToRotate(e){return t=>{if((0,a.Wi)(this.analysisViewData.plane))return null;const i=(0,p.mJ)(e.rotatePlane),n=(0,P.Gd)(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return J(X({},t),{rotateAxis:i,rotateAngle:n})}}_rotateDragUpdatePlaneFromRotate(){return e=>{if((0,a.Wi)(this.analysisViewData.plane))return;const t=(0,F.d)(c.MP.get(),e.rotateAngle,e.rotateAxis);if((0,a.Wi)(t))return;const i=(0,l.m)(c.WM.get(),this._startPlane.basis1,t),n=(0,l.m)(c.WM.get(),this._startPlane.basis2,t),u=(0,y.f)(this.analysisViewData.plane.origin,i,n,(0,y.a)());this._updateBoundedPlane(u)}}_onResizeGrab(e,t){if("start"!==e.action||(0,a.Wi)(this.analysisViewData.plane)||!e.screenPoint)return;const i=this._calculatePickRay(e.screenPoint),n=c.WM.get();(0,p.BR)(this.analysisViewData.plane.plane,i,n)&&((0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,v.a)(n)})}_createResizeDragPipeline(e){return(0,ae.Xd)(e,(t,i,n)=>{const u=this.inputState;if((0,a.Wi)(u)||"resize"!==u.type||(0,a.Wi)(this.analysisViewData.plane))return;const g=(0,y.c)(this.analysisViewData.plane,(0,y.a)());i.next((0,R._N)(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(u)),n.next(()=>{this._updateBoundedPlane(g)})})}_resizeDragUpdatePlane(e){return t=>{if((0,a.Wi)(this.analysisViewData.plane))return;const n=(0,h.Q3)(this._resizeHandles[e.activeHandleIdx],e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,(0,y.c)(this.analysisViewData.plane));this._updateBoundedPlane(n)}}_updateBoundedPlane(e){const t=this.analysisViewData;if(!(0,a.pC)(t))throw new Error("valid internal object expected");t.plane=e}_updatePreviewPlane(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,(0,a.Wi)(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const n=(0,a.pC)(i)?i:(0,y.a)();if(i=(0,a.pC)(i)?(0,y.c)(i,ge):null,this._pickPlane(e,!0,t,n)){const u=o.Vj;let g=!1;(0,a.pC)(i)&&(g=(0,l.e)(i.plane,n.plane)<u||(0,l.e)((0,l.n)(c.WM.get(),i.basis1),(0,l.n)(c.WM.get(),n.basis1))<u),g&&(this._previewPlaneOpacity=0),this._previewPlane=n}}(0,a.pC)(this._previewPlane)&&(0,a.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,re.A)({update:({deltaTime:n})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+n/(1e3*o.Fj),1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):(0,a.Wi)(this._previewPlane)&&(0,a.pC)(this._frameTask)?this._removeFrameTask():(0,a.pC)(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){this._frameTask=(0,a.hw)(this._frameTask)}_calculatePickRay(e){const t=(0,D.Ue)(),i=(0,Z.md)(e,De);return(0,H.u4)(this.view.state.camera,i,t),(0,l.n)(t.direction,t.direction),t}_pickMinResult(e){const t=(0,Z.md)(e,c.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,n){const u=this._pickMinResult(e),g=c.WM.get();if(!u.getIntersectionPoint(g))return!1;const O=u.getTransformedNormal(c.WM.get()),te=this.view.state.camera;(0,l.e)(O,te.viewForward)>0&&(0,l.g)(O,O,-1);const ue=(0,h.fT)(g,te),Me=(t?1:-1)*ue*o.go,pe=(0,l.g)(c.WM.get(),O,Me);return(0,l.a)(pe,pe,g),(0,h.j6)(pe,O,ue,ue,te,i[o.GI]?h.ww.VERTICAL:i[o.tW]?h.ww.HORIZONTAL:this.analysis.tiltEnabled?h.ww.TILTED:h.ww.HORIZONTAL_OR_VERTICAL,this.view.renderCoordsHelper,n),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,a.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=h.do,this.rotateHeadingManipulator.state|=h.do,this.rotateTiltManipulator.state|=h.do,this._prevPointerMoveTimeout=this._clock.setTimeout(()=>{this.shiftManipulator.state&=~h.do,this.rotateHeadingManipulator.state&=~h.do,this.rotateTiltManipulator.state&=~h.do},this._pointerMoveTimerMs)}_updateManipulators(){if(oe.disableEngineLayers)return;let e,t=!1;if((0,a.pC)(this.analysisViewData.plane))e=this.analysisViewData.plane,t=!1;else{if(!(0,a.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(O=>O.available=!1),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=(0,h.zY)(e,c.MP.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(O=>O.available=!1),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach(O=>O.available=!0),(0,h.tF)(this.shiftManipulator,i,e,this.view.state.camera),(0,h.A5)(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),(0,h.wj)(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach((O,te)=>(0,h.EC)(O,this._resizeHandles[te],i,e)),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const n=(0,l.s)(c.WM.get(),(0,l.l)(e.basis1),(0,l.l)(e.basis2),1),u=(0,F.E)(c.MP.get(),n),g=(0,F.m)(u,i,u);this._previewPlaneOutlineVisualElement.transform=g,this._previewPlaneGridVisualElement.transform=g,this._updateMaterials()}_updateMaterials(){this._previewPlaneOutlineVisualElement.color=[o.hf[0],o.hf[1],o.hf[2],o.hf[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.backgroundColor=[o.wk[0],o.wk[1],o.wk[2],o.wk[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.gridColor=[0,0,0,0]}_updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach(t=>{t.interactive=!0});this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach(t=>{t.interactive=t===e})}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}}};function de(e,t,i,n){const u=(0,h.TA)(i,(0,y.n)(n),e.direction,(0,p.Ue)()),g=(0,v.c)();return(0,p.BR)(u,e,g)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:u,depth:0,startPoint:g}:null}function he(e){return"mouse"!==e.pointerType||0===e.button}I.disableEngineLayers=!1,(0,r._)([(0,d.Cb)()],I.prototype,"_clock",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],I.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],I.prototype,"analysisViewData",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],I.prototype,"state",null),(0,r._)([(0,d.Cb)({readOnly:!0})],I.prototype,"cursor",null),(0,r._)([(0,d.Cb)()],I.prototype,"analysis",null),(0,r._)([(0,d.Cb)()],I.prototype,"removeIncompleteOnCancel",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],I.prototype,"layersMode",void 0),(0,r._)([(0,d.Cb)({value:null})],I.prototype,"inputState",null),(0,r._)([(0,d.Cb)()],I.prototype,"_isPlacingSlicePlane",null),(0,r._)([(0,d.Cb)()],I.prototype,"_creatingPointerId",null),I=oe=(0,r._)([(0,_.j)("esri.views.3d.analysis.Slice.SliceTool")],I);const ge=(0,y.a)(),De=(0,Z.s1)(),Pe=I;var fe=s(4794),we=s(54889);let Y=class extends M.Z{constructor(e){super(e),this._handles=new b.Z,this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const e=this.analysisViewData;if((0,a.Wi)(e))throw new Error("expected internal object to be valid");this._gridVisualElement=(0,h.R_)(this.view),this._outlineVisualElement=(0,h.i3)(this.view),this._handles.add([(0,f.YP)(()=>({visible:(0,a.pC)(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid}),t=>this._updateMaterials(t),f.tX),(0,f.YP)(()=>e.plane,t=>this._updatePlane(t),f.tX)],"internal")}destroy(){this._handles.destroy(),this._gridVisualElement=(0,a.SC)(this._gridVisualElement),this._outlineVisualElement=(0,a.SC)(this._outlineVisualElement),this.set("view",null)}_updatePlane(e){if((0,a.Wi)(e))return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const t=(0,l.s)(c.WM.get(),(0,l.l)(e.basis1),(0,l.l)(e.basis2),1),i=(0,F.E)(c.MP.get(),t),n=(0,h.zY)(e,c.MP.get()),u=(0,F.m)(i,n,i);this._outlineVisualElement.transform=u,this._gridVisualElement.transform=u}_updateMaterials({visible:e,active:t,preview:i,showGrid:n}){this._outlineVisualElement.color=o.hf,this._outlineVisualElement.width=i?o.q7:o.kq,this._outlineVisualElement.stipplePattern=t?null:(0,we.z5)(5),this._gridVisualElement.backgroundColor=o.wk,this._gridVisualElement.gridColor=n?o.A:fe.Z,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};(0,r._)([(0,d.Cb)()],Y.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],Y.prototype,"analysis",void 0),(0,r._)([(0,d.Cb)()],Y.prototype,"analysisViewData",void 0),(0,r._)([(0,d.Cb)()],Y.prototype,"showGrid",void 0),(0,r._)([(0,d.Cb)()],Y.prototype,"preview",void 0),Y=(0,r._)([(0,_.j)("esri.views.3d.analysis.Slice.SliceVisualization")],Y);var ce=s(95925);let z=class extends((0,V.p)(M.Z)){constructor(e){super(e),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0}initialize(){this.analysisVisualization=new Y({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new j({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles((0,ce.Lp)(this,Pe))}destroy(){(0,ce.Yq)(this),this.analysisVisualization=(0,a.SC)(this.analysisVisualization),this.analysisController=(0,a.SC)(this.analysisController)}get showGrid(){var e,t;return null!=(t=null==(e=this.analysisVisualization)?void 0:e.showGrid)&&t}set showGrid(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}get editable(){return!this.analysisVisualization.preview}set editable(e){this.analysisVisualization.preview=!e}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,a.Wg)(this.tool)}}};(0,r._)([(0,d.Cb)({readOnly:!0})],z.prototype,"type",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],z.prototype,"analysis",void 0),(0,r._)([(0,d.Cb)()],z.prototype,"tool",void 0),(0,r._)([(0,d.Cb)()],z.prototype,"plane",void 0),(0,r._)([(0,d.Cb)()],z.prototype,"active",void 0),(0,r._)([(0,d.Cb)()],z.prototype,"showGrid",null),(0,r._)([(0,d.Cb)()],z.prototype,"editable",null),z=(0,r._)([(0,_.j)("esri.views.3d.analysis.SliceAnalysisView3D")],z);const me=z},8859:(T,m,s)=>{s.d(m,{G:()=>U,J4:()=>ne,Sp:()=>q,VG:()=>G,_N:()=>h,_y:()=>j,bB:()=>B,gv:()=>le,zP:()=>ie});var k,l,r=s(62208),M=s(23841),a=s(84161),d=s(28093),C=s(55915),S=s(90014),_=s(70562),V=s(34054),E=s(26242),b=s(60507),w=s(26046),f=s(62483),y=s(67857),L=s(40841),Q=s(75079);function h(l,v){return W(l,()=>v)}function B(l){return W(l,v=>v.plane)}function W(l,v){const p=(0,d.c)(),D=(0,d.c)();let c=!1;return o=>{const A=v(o);if("start"===o.action){const H=(0,M.md)(o.screenStart,(0,M.c$)(E.qW.get())),x=(0,w.u4)(l.state.camera,H,F);(0,r.pC)(x)&&(c=(0,S.BR)(A,x,p))}if(!c)return null;const P=(0,M.md)(o.screenEnd,(0,M.c$)(E.qW.get())),R=(0,w.u4)(l.state.camera,P,F);return(0,r.Wi)(R)?null:(0,S.BR)(A,R,D)?J(X({},o),{renderStart:p,renderEnd:D,plane:A,ray:R}):null}}function U(l,v,p,D=null,c=null){return function $(l,v,p=0,D=null,c=null){let o=null;return A=>{if("start"===A.action&&(o=l.sceneIntersectionHelper.intersectElevationFromScreen((0,M.s1)(A.screenStart.x,A.screenStart.y),v,p,c),(0,r.pC)(o)&&(0,r.pC)(D)&&!(0,C.nF)(o,o,D))||(0,r.Wi)(o))return null;const P=l.sceneIntersectionHelper.intersectElevationFromScreen((0,M.s1)(A.screenEnd.x,A.screenEnd.y),v,p,c);return(0,r.pC)(P)?(0,r.pC)(D)&&!(0,C.nF)(P,P,D)?null:J(X({},A),{mapStart:o,mapEnd:P}):null}}(l,p,(0,b.Ou)(v,l,p),D,c)}function G(l,v,p,D=null,c=null){return U(l,p,(0,b.RL)(v),D,c)}function j(l,v,p,D){const c=v.toMap(l.screenStart,{include:[p]});return(0,r.pC)(c)?G(v,p,c,D):null}function q(l,v,p){let D=null;const c=new Q.hM;return c.next(h(l,function K(l,v){const p=re,D=Z,c=(0,S.Ue)();l.renderCoordsHelper.worldUpAtPosition(v,p);const o=(0,a.f)(c,p,(0,a.b)(D,v,l.state.camera.eye));return(0,a.f)(o,o,p),(0,S.Yq)(v,o,c)}(l,v))).next(function se(l,v){const p=(0,d.c)(),D=(0,a.l)(v);l.renderCoordsHelper.worldUpAtPosition(v,p);const c=(0,d.c)(),o=(0,d.c)(),A=P=>((0,a.b)(P,P,v),(0,V.nF)(p,P,P),"global"===l.viewingMode&&(0,a.l)(P)*Math.sign((0,a.e)(p,P))<.001-D&&(0,a.b)(P,(0,a.g)(P,p,.001),v),(0,a.a)(P,P,v),P);return P=>(P.renderStart=A((0,a.c)(c,P.renderStart)),P.renderEnd=A((0,a.c)(o,P.renderEnd)),P)}(l,v)).next(ie(l,p)).next(o=>{o.mapEnd.x=o.mapStart.x,o.mapEnd.y=o.mapStart.y,D=o}),o=>(D=null,c.execute(o),D)}function ie(l,v){const p=l.renderCoordsHelper;return D=>{const c=p.fromRenderCoords(D.renderStart,v),o=p.fromRenderCoords(D.renderEnd,v);return(0,r.pC)(c)&&(0,r.pC)(o)?J(X({},D),{mapStart:c,mapEnd:o}):null}}function ne(l){let v=null;return p=>{switch(p.action){case"start":v=l.disableDisplay();break;case"end":case"cancel":(0,r.pC)(v)&&(v.remove(),v=null)}return p}}function le(l,v=null){const p=(0,f.Z8)(l.state.viewingMode);p.options.selectionMode=!0,p.options.store=y.eC.MIN,p.options.hud=!1;const D=(0,M.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},o=(0,d.c)(),A=(0,r.Pt)(v,l.spatialReference),P=H=>{l.map.ground&&l.map.ground.opacity<1?c.exclude.add(L.cy):c.exclude.delete(L.cy),l.sceneIntersectionHelper.intersectIntersectorScreen((0,M.md)(H,D),p,c);const x=p.results.min;let N;if(x.getIntersectionPoint(o))N=x.intersector===y.q7.TERRAIN?k.GROUND:k.OTHER;else{if(!p.results.ground.getIntersectionPoint(o))return null;N=k.GROUND}return{location:l.renderCoordsHelper.fromRenderCoords(o,A),surfaceType:N}};let R;return H=>{if("start"===H.action){const N=P(H.screenStart);R=(0,r.pC)(N)?N.location:null}if((0,r.Wi)(R))return null;const x=P(H.screenEnd);return(0,r.pC)(x)&&(0,r.pC)(x.location)?J(X({},H),{mapStart:R,mapEnd:x.location,surfaceType:x.surfaceType}):null}}(l=k||(k={}))[l.GROUND=0]="GROUND",l[l.OTHER=1]="OTHER";const re=(0,d.c)(),Z=(0,d.c)(),F=(0,_.Ue)()},10023:(T,m,s)=>{s.d(m,{V:()=>S,e:()=>d});var r=s(15861),M=s(62208),a=s(36630);function d(_){return C.apply(this,arguments)}function C(){return(C=(0,r.Z)(function*(_,V=_.popupTemplate){var B,W;if((0,M.Wi)(V))return[];const E=yield V.getRequiredFields(_.fieldsIndex),{lastEditInfoEnabled:b}=V,{objectIdField:w,typeIdField:f,globalIdField:y,relationships:L}=_;if(E.includes("*"))return["*"];const Q=b?yield(0,a.CH)(_):[],h=(0,a.Q0)(_.fieldsIndex,[...E,...Q]);return f&&h.push(f),h&&w&&(null==(B=_.fieldsIndex)?void 0:B.has(w))&&!h.includes(w)&&h.push(w),h&&y&&(null==(W=_.fieldsIndex)?void 0:W.has(y))&&!h.includes(y)&&h.push(y),L&&L.forEach($=>{var G;const{keyField:U}=$;h&&U&&(null==(G=_.fieldsIndex)?void 0:G.has(U))&&!h.includes(U)&&h.push(U)}),h})).apply(this,arguments)}function S(_,V){return _.popupTemplate?_.popupTemplate:(0,M.pC)(V)&&V.defaultPopupTemplateEnabled&&(0,M.pC)(_.defaultPopupTemplate)?_.defaultPopupTemplate:null}}}]);