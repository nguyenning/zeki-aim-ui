"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[1269],{21269:(U,y,i)=>{i.r(y),i.d(y,{default:()=>T});var m=i(15861),L=i(17626),p=i(62208),x=i(10699),S=(i(63290),i(90912),i(85931),i(26584),i(8314),i(76898)),u=i(84161),c=i(28093),v=i(13777),g=i(97126),C=i(83308),E=i(82274),P=i(17827);function b(t,e,n){const s=(0,g.c)(),o=(0,g.g)(s);return(0,u.z)(o,o,t,.5),(0,u.z)(o,o,e,.5),s[3]=(0,u.i)(o,t),(0,u.a)(o,o,n),s}let f=class{constructor(){this._idToComponent=new Map,this._components=new E.Z(t=>t.bounds),this._edges=new E.Z(t=>t.bounds),this._tmpLineSegment=(0,v.Ue)(),this._tmpP1=(0,c.c)(),this._tmpP2=(0,c.c)(),this._tmpP3=(0,c.c)(),this.remoteClient=null}fetchCandidates(t,e){var n=this;return(0,m.Z)(function*(){yield Promise.resolve(),(0,x.k_)(e),yield n._ensureEdgeLocations(t,e);const s=[];return n._edges.forEachNeighbor(o=>(n._addCandidates(t,o,s),s.length<1e3),t.bounds),{result:{candidates:s}}})()}_ensureEdgeLocations(t,e){var n=this;return(0,m.Z)(function*(){const s=[];if(n._components.forEachNeighbor(a=>{if((0,p.Wi)(a.info)){const{id:r,uid:d}=a;s.push({id:r,uid:d})}return!0},t.bounds),!s.length)return;const o={components:s},h=yield n.remoteClient.invoke("fetchAllEdgeLocations",o,(0,p.Pt)(e,{}));for(const a of h.components)n._setFetchEdgeLocations(a)})()}add(t){var e=this;return(0,m.Z)(function*(){const n=new j(t.id,t.bounds);return e._idToComponent.set(n.id,n),e._components.add([n]),{result:{}}})()}remove(t){var e=this;return(0,m.Z)(function*(){const n=e._idToComponent.get(t.id);if(n){const s=[];e._edges.forEachNeighbor(o=>(o.component===n&&s.push(o),!0),n.bounds),e._edges.remove(s),e._components.remove([n]),e._idToComponent.delete(n.id)}return{result:{}}})()}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if((0,p.Wi)(e)||t.uid!==e.uid)return;const n=P.n_.createView(t.locations),s=new Array(n.count),o=(0,c.c)(),h=(0,c.c)();for(let d=0;d<n.count;d++){n.position0.getVec(d,o),n.position1.getVec(d,h);const l=b(o,h,t.origin),Z=new I(e,d,l);s[d]=Z}this._edges.add(s);const{objectIds:a,origin:r}=t;e.info={locations:n,objectIds:a,origin:r}}_addCandidates(t,e,n){const{info:s}=e.component,{origin:o,objectIds:h}=s,a=s.locations,r=a.position0.getVec(e.index,this._tmpP1),d=a.position1.getVec(e.index,this._tmpP2);(0,u.a)(r,r,o),(0,u.a)(d,d,o);const l=h[a.componentIndex.get(e.index)];this._addEdgeCandidate(t,l,r,d,n),this._addVertexCandidate(t,l,r,n),this._addVertexCandidate(t,l,d,n)}_addEdgeCandidate(t,e,n,s,o){if(!(t.types&C.r.EDGE))return;const h=(0,g.g)(t.bounds),a=(0,v.zk)(n,s,this._tmpLineSegment),r=(0,v.nF)(a,h,this._tmpP3);(0,g.m)(t.bounds,r)&&o.push({type:"edge",objectId:e,target:(0,c.a)(r),distance:(0,u.i)(h,r),start:(0,c.a)(n),end:(0,c.a)(s)})}_addVertexCandidate(t,e,n,s){if(!(t.types&C.r.VERTEX))return;const o=(0,g.g)(t.bounds);(0,g.m)(t.bounds,n)&&s.push({type:"vertex",objectId:e,target:(0,c.a)(n),distance:(0,u.i)(o,n)})}};f=(0,L._)([(0,S.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],f);const T=f;let j=(()=>{class t{constructor(n,s){this.id=n,this.bounds=s,this.info=null,this.uid=++t.uid}}return t.uid=0,t})();class I{constructor(e,n,s){this.component=e,this.index=n,this.bounds=s}}}}]);