"use strict";var ae=Object.defineProperty,oe=Object.defineProperties,de=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,N=(u,o,n)=>o in u?ae(u,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[o]=n,j=(u,o)=>{for(var n in o||(o={}))ue.call(o,n)&&N(u,n,o[n]);if(Z)for(var n of Z(o))pe.call(o,n)&&N(u,n,o[n]);return u},W=(u,o)=>oe(u,de(o));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[5896],{78740:(u,o,n)=>{n.r(o),n.d(o,{FeatureServiceSnappingSource:()=>h});var v=n(15861),r=n(17626),C=n(14517),k=n(80542),w=n(54024),d=n(62208),g=n(32917),s=n(77712),O=(n(85931),n(8314),n(90912),n(76898)),A=n(84161),V=n(4794),E=n(41743);function H(e,t){return(0,E.g)(t.extent,F),(0,E.h)(F,(0,A.s)(J,e.x,e.y,0))}const F=(0,E.c)(),J=(0,V.c)();var L=n(93579);let p=class extends C.Z{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=(0,d.pC)(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort((i,a)=>H(t,i)-H(t,a)),e}_scaleEnabled(){return(0,L.rs)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||(0,d.Wi)(this.tileInfo))return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:i}=t,a=[];for(const{row:l,colFrom:f,colTo:m}of e)for(let I=f;I<=m;I++){const b={id:null,level:i,row:l,col:t.normalizeCol(I)};this.tileInfo.updateTileInfo(b),a.push(b)}return a}get tileInfo(){var e,t;return null!=(t=null==(e=this.view.featuresTilingScheme)?void 0:e.tileInfo)?t:null}get tileSize(){return(0,d.pC)(this.tileInfo)?this.tileInfo.size[0]:256}initialize(){this.own((0,g.YP)(()=>{var e,t;return null==(t=null==(e=this.view)?void 0:e.state)?void 0:t.viewpoint},()=>this.notifyChange("tilesCoveringView"),g.Z_))}};(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"tiles",null),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"_scaleEnabled",null),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"tilesCoveringView",null),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"tileInfo",null),(0,r._)([(0,s.Cb)({readOnly:!0})],p.prototype,"tileSize",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],p.prototype,"view",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],p.prototype,"layer",void 0),(0,r._)([(0,s.Cb)()],p.prototype,"pointOfInterest",void 0),p=(0,r._)([(0,O.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],p);var $=n(27351);let c=class extends k.r{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=this.effectivePointOfInterest;if((0,d.pC)(t)){const i=e.map(a=>H(t,a));for(let a=1;a<i.length;a++)if(i[a-1]>i[a])return e.sort((l,f)=>H(t,l)-H(t,f)),e.slice()}return e}get tilesCoveringView(){var e,t;return this._filterTiles(null==(t=null==(e=this.view.featureTiles)?void 0:e.tiles)?void 0:t.toArray()).map(B)}get tileInfo(){var e,t;return null!=(t=null==(e=this.view.featureTiles)?void 0:e.tilingScheme.toTileInfo())?t:null}get tileSize(){var e,t;return null!=(t=null==(e=this.view.featureTiles)?void 0:e.tileSize)?t:256}get effectivePointOfInterest(){var t;const e=this.pointOfInterest;return(0,d.pC)(e)?e:null==(t=this.view.pointsOfInterest)?void 0:t.focus.location}initialize(){this.handles.add((0,g.YP)(()=>this.view.featureTiles,e=>{this.handles.remove(U),e&&this.handles.add(e.addClient(),U)},g.nn))}_filterTiles(e){return(0,d.Wi)(e)?[]:e.filter(t=>Math.abs(t.measures.screenRect[3]-t.measures.screenRect[1])>Y&&t.measures.visibility===$.E.VISIBLE_ON_SURFACE)}};function B({lij:[e,t,i],extent:a}){return{id:`${e}/${t}/${i}`,level:e,row:t,col:i,extent:a}}(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tiles",null),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tilesCoveringView",null),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tileInfo",null),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"tileSize",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],c.prototype,"view",void 0),(0,r._)([(0,s.Cb)()],c.prototype,"pointOfInterest",void 0),(0,r._)([(0,s.Cb)()],c.prototype,"effectivePointOfInterest",null),c=(0,r._)([(0,O.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],c);const Y=50,U="feature-tiles";var G=n(9218),K=n(72392),Q=n(37118),R=n(65401),X=n(73187);let P=class extends X.q{constructor(e){super(e),this.handles=new K.Z}initialize(){const e=setInterval(()=>this._fetchDebugInfo(),2e3);this.handles.add((0,w.kB)(()=>clearInterval(e)))}destroy(){this.handles.destroy()}getTiles(){if(!this.debugInfo)return[];const e=new Map,t=new Map;this.debugInfo.storedTiles.forEach(l=>{e.set(l.data.id,l.featureCount)}),this.debugInfo.pendingTiles.forEach(l=>{e.set(l.data.id,l.featureCount),t.set(l.data.id,l.state)});const i=l=>{var I;const f=t.get(l),m=null!=(I=e.get(l))?I:"?";return f?`${f}:${m}\n${l}`:`store:${m}\n${l}`},a=new Map;return this.debugInfo.storedTiles.forEach(l=>{a.set(l.data.id,l.data)}),this.debugInfo.pendingTiles.forEach(l=>{a.set(l.data.id,l.data)}),Array.from(a.values()).map(l=>({lij:[l.level,l.row,l.col],geometry:Q.Z.fromExtent((0,R.HH)(l.extent,this.view.spatialReference)),label:i(l.id)}))}_fetchDebugInfo(){this.handle.getDebugInfo(null).then(e=>{this.debugInfo=e,this.update()})}};(0,r._)([(0,s.Cb)({constructOnly:!0})],P.prototype,"handle",void 0),P=(0,r._)([(0,O.j)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],P);var q=n(10699),_=n(42930),ee=n(71774);let y=class extends k.r{constructor(e){super(e),this.availability=0,this.workerHandleUpdating=!0,this.editId=0}get updating(){return this.updatingHandles.updating||this.workerHandleUpdating}destroy(){this.workerHandle.destroy()}initialize(){this.workerHandle=new te(this.schedule),this.handles.add([this.workerHandle.on("notify-updating",({updating:e})=>this.workerHandleUpdating=e),this.workerHandle.on("notify-availability",({availability:e})=>this._set("availability",e))])}setup(e,t){var i=this;return(0,v.Z)(function*(){const a=i._serviceInfoFromLayer(e.layer);if((0,d.Wi)(a))return;const l={configuration:i._convertConfiguration(e.configuration),serviceInfo:a,spatialReference:e.spatialReference.toJSON()};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("setup",l,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}configure(e,t){var i=this;return(0,v.Z)(function*(){const a=i._convertConfiguration(e);yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("configure",a,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}refresh(e){var t=this;return(0,v.Z)(function*(){yield t.updatingHandles.addPromise(t.workerHandle.invokeMethod("refresh",{},e)),t.updatingHandles.addPromise(t.workerHandle.invokeMethod("whenNotUpdating",{},e))})()}fetchCandidates(e,t){var i=this;return(0,v.Z)(function*(){const a={distance:e.distance,point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),types:e.types,filter:(0,d.pC)(e.filter)?e.filter.createQuery().toJSON():null};return i.workerHandle.invoke(a,t)})()}updateTiles(e,t){var i=this;return(0,v.Z)(function*(){const a={tiles:e.tiles,tileInfo:(0,d.pC)(e.tileInfo)?e.tileInfo.toJSON():null,tileSize:e.tileSize};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("updateTiles",a,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}applyEdits(e,t){var i=this;return(0,v.Z)(function*(){var I,b,M,z,D,x;const a=i.editId++,l={id:a};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("beginApplyEdits",l,t));const f=yield i.updatingHandles.addPromise((0,q.Hl)(e.result,t)),m={id:a,edits:{addedFeatures:null!=(b=null==(I=f.addedFeatures)?void 0:I.map(({objectId:T})=>T))?b:[],deletedFeatures:null!=(z=null==(M=f.deletedFeatures)?void 0:M.map(({objectId:T,globalId:le})=>({objectId:T,globalId:le})))?z:[],updatedFeatures:null!=(x=null==(D=f.updatedFeatures)?void 0:D.map(({objectId:T})=>T))?x:[]}};yield i.updatingHandles.addPromise(i.workerHandle.invokeMethod("endApplyEdits",m,t)),i.updatingHandles.addPromise(i.workerHandle.invokeMethod("whenNotUpdating",{},t))})()}getDebugInfo(e){return this.workerHandle.invokeMethod("getDebugInfo",{},e)}_convertConfiguration(e){return{filter:(0,d.pC)(e.filter)?e.filter.toJSON():null,customParameters:e.customParameters}}_serviceInfoFromLayer(e){var t;return"multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:e.parsedUrl.path,fields:e.fields.map(i=>i.toJSON()),geometryType:ee.Mk.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:null==(t=e.timeInfo)?void 0:t.toJSON()}}};(0,r._)([(0,s.Cb)({constructOnly:!0})],y.prototype,"schedule",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],y.prototype,"updating",null),(0,r._)([(0,s.Cb)({readOnly:!0})],y.prototype,"availability",void 0),(0,r._)([(0,s.Cb)()],y.prototype,"workerHandleUpdating",void 0),y=(0,r._)([(0,O.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],y);class te extends _.q{constructor(t){super("FeatureServiceSnappingSourceWorker","fetchCandidates",{},t,{strategy:"dedicated"})}}var ie=n(49672),ne=n(72258),re=n(2584);let S=class extends C.Z{constructor(e){super(e),this.pointOfInterest=null}get tiles(){return[{id:"0/0/0",level:0,row:0,col:0,extent:(0,R.al)(-1e8,-1e8,1e8,1e8)}]}get tileInfo(){return new re.Z({origin:new ie.Z({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new ne.Z({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}};(0,r._)([(0,s.Cb)({readOnly:!0})],S.prototype,"tiles",null),(0,r._)([(0,s.Cb)({readOnly:!0})],S.prototype,"tileInfo",null),(0,r._)([(0,s.Cb)({readOnly:!0})],S.prototype,"tileSize",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],S.prototype,"layer",void 0),(0,r._)([(0,s.Cb)()],S.prototype,"pointOfInterest",void 0),S=(0,r._)([(0,O.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],S);var se=n(66463);let h=class extends((0,k.p)(C.Z)){constructor(e){super(e)}get updateTilesParameters(){return{tiles:this.tilesOfInterest.tiles,tileInfo:this.tilesOfInterest.tileInfo,tileSize:this.tilesOfInterest.tileSize}}get updating(){return this.workerHandle.updating||this.updatingHandles.updating}get configuration(){return{filter:this.layer.createQuery(),customParameters:this.layer.customParameters}}get availability(){return this.workerHandle.availability}get layer(){return this.layerSource.layer}initialize(){const e=this.view;if((0,d.pC)(e))switch(e.type){case"2d":this.tilesOfInterest=new p({view:e,layer:this.layer}),this.workerHandle=new y;break;case"3d":{const t=e.resourceController;this.tilesOfInterest=new c({view:e}),this.workerHandle=new y({schedule:i=>t.schedule(i)});break}}else this.tilesOfInterest=new S({layer:this.layer}),this.workerHandle=new y;this.handles.add([(0,w.ed)(this.workerHandle)]),this.workerHandle.setup({layer:this.layer,spatialReference:this.spatialReference,configuration:this.configuration},null),this.updatingHandles.add(()=>this.updateTilesParameters,()=>this.workerHandle.updateTiles(this.updateTilesParameters,null),g.nn),this.handles.add([(0,g.YP)(()=>this.configuration,t=>this.workerHandle.configure(t,null),g.Z_)]),(0,d.pC)(e)&&this.handles.add((0,g.YP)(()=>se.Z.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES,t=>{t&&!this.debug?(this.debug=new P({view:e,handle:this.workerHandle}),this.handles.add((0,w.ed)(this.debug),"debug")):!t&&this.debug&&this.handles.remove("debug")},g.nn)),this.handles.add(this.layerSource.layer.on("apply-edits",t=>{this.workerHandle.applyEdits(t,null)}))}refresh(){this.workerHandle.refresh(null)}fetchCandidates(e,t){var i=this;return(0,v.Z)(function*(){return i.tilesOfInterest.pointOfInterest=e.coordinateHelper.vectorToPoint(e.point),(yield i.workerHandle.fetchCandidates(W(j({},e),{filter:null}),t)).candidates.map(a=>(0,G.X)(a,e.coordinateHelper,e.elevationInfo))})()}getDebugInfo(e){return this.workerHandle.getDebugInfo(e)}};(0,r._)([(0,s.Cb)({constructOnly:!0})],h.prototype,"spatialReference",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],h.prototype,"layerSource",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,r._)([(0,s.Cb)()],h.prototype,"tilesOfInterest",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],h.prototype,"updateTilesParameters",null),(0,r._)([(0,s.Cb)({readOnly:!0})],h.prototype,"updating",null),(0,r._)([(0,s.Cb)({readOnly:!0})],h.prototype,"configuration",null),(0,r._)([(0,s.Cb)({readOnly:!0})],h.prototype,"availability",null),h=(0,r._)([(0,O.j)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],h)},19038:(u,o,n)=>{n.d(o,{n:()=>C});var v=n(44725),r=n(5286);class C extends r.r{constructor(w,d){super(d),this.point=w}equals(w){return w instanceof C&&(0,v.Xv)(this.point,w.point)}}}}]);