"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[937],{20937:(W,m,s)=>{s.r(m),s.d(m,{default:()=>D});var r=s(17626),S=s(26584),g=s(32917),a=s(77712),u=(s(90912),s(85931),s(76898)),C=(s(29132),s(88879)),b=s(14517),M=s(80542),p=s(62208),O=s(60330),P=s(5075),U=s(20901),w=s(36967),j=s(71774);let y=class extends C.Z{getObjectId(){return this.objectId}};(0,r._)([(0,a.Cb)({type:Number,json:{read:!0}})],y.prototype,"objectId",void 0),y=(0,r._)([(0,u.j)("esri.layers.graphics.controllers.StreamGraphic")],y);class V{constructor(e){this.onUpdate=e,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(e){this._idToGraphic.set(e.objectId,e)}get(e){return this._idToGraphic.get(e)}forEach(e){this._idToGraphic.forEach(e)}removeById(e){const n=this._idToGraphic.get(e);return n?(n.sourceLayer=n.layer=null,this._idToGraphic.delete(e),n):null}update(e,n){this.onUpdate(e,n)}get size(){return this._idToGraphic.size}}let o=class extends((0,M.p)((0,O.v)(b.Z))){constructor(){super(...arguments),this.isPaused=!1,this.graphics=new w.g,this._updateInfo={websocket:0,client:0},this._updateIntervalId=null,this._outSpatialReference=null}initialize(){this.addResolvingPromise(this.layer.when(()=>this._startup()))}destroy(){this.clear()}_clearInterval(){null!==this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=null)}clear(){this._clearInterval(),this.connection=(0,p.SC)(this.connection),this.store=(0,p.SC)(this.store),this.graphics.clear(),this.handles.removeAll()}get updating(){return!this.connection||"connected"===this.connection.connectionStatus}_startup(){const{layer:t,layerView:e}=this,{spatialReference:n,definitionExpression:l,geometryDefinition:d,objectIdField:h,timeInfo:N,purgeOptions:A,maxReconnectionAttempts:Q,maxReconnectionInterval:z,customParameters:v}=t,B=t.geometryType?j.M.toJSON(t.geometryType):null,J=n,f=e.view.spatialReference,Y={geometry:d,where:l};this.clear(),this._set("connection",(0,U.createConnection)(t.parsedUrl,J,f,B,Y,Q,z,null!=v?v:void 0)),this._outSpatialReference=f.toJSON(),this.store=new V(this._onUpdate.bind(this)),this.featuresManager=new P.Qo(this.store,h,N.toJSON(),A);const I="startup-watches";this.handles.remove(I),this.handles.add([t.on("send-message-to-socket",c=>this.connection.sendMessageToSocket(c)),t.on("send-message-to-client",c=>this.connection.sendMessageToClient(c)),this.connection.on("data-received",c=>this._onFeature(c)),this.connection.on("message-received",c=>this._onWebSocketMessage(c)),(0,g.YP)(()=>[t.definitionExpression,t.geometryDefinition,t.purgeOptions],()=>this._startup())],I),this._initUpdateInterval()}_onWebSocketMessage(t){if(this.layerView.emit("message-received",t),"type"in t)switch(t.type){case"delete":if(t.objectIds)for(const e of t.objectIds)this.featuresManager.removeById(e);if(t.trackIds)for(const e of t.trackIds)this.featuresManager.removeByTrackId(e);break;case"clear":this.store.forEach(e=>this.featuresManager.removeById(e.objectId))}}_onFeature(t){this._updateInfo.websocket++,this.layerView.hasEventListener("data-received")&&this.layerView.emit("data-received",{attributes:t.attributes,centroid:t.centroid,geometry:t.geometry});try{(0,p.pC)(t.geometry)&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._outSpatialReference);const e=y.fromJSON(t);e.sourceLayer=e.layer=this.layer,this.featuresManager.add(e)}catch(e){}}_onUpdate(t,e){(0,p.pC)(e)&&this.graphics.removeMany(e),(0,p.pC)(t)&&(this._updateInfo.client+=t.length,this.graphics.addMany(t))}_initUpdateInterval(){this._clearInterval();const{updateInterval:t}=this.layer;let e=performance.now();this._updateIntervalId=setInterval(()=>{const n=performance.now(),l=n-e;if(l>2500){e=n;const d=Math.round(this._updateInfo.client/(l/1e3)),h=Math.round(this._updateInfo.websocket/(l/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit("update-rate",{client:d,websocket:h})}this.featuresManager.checkForUpdates()},t)}pauseStream(){this.isPaused=!0,this._clearInterval()}resumeStream(){this.isPaused=!1,this._initUpdateInterval()}};(0,r._)([(0,a.Cb)()],o.prototype,"isPaused",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],o.prototype,"layer",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],o.prototype,"layerView",void 0),(0,r._)([(0,a.Cb)()],o.prototype,"connection",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],o.prototype,"updating",null),o=(0,r._)([(0,u.j)("esri.layers.graphics.controllers.StreamController")],o);var E=s(96854),L=s(78448),R=s(19702),x=s(23147),G=s(45611),F=s(98624);const Z=t=>{let e=class extends t{constructor(...n){super(...n),this.connectionError=null,this.filter=null}get connectionStatus(){var n,l,d,h;return null!=(n=this.controller)&&n.isPaused?"paused":null!=(h=null==(d=null==(l=this.controller)?void 0:l.connection)?void 0:d.connectionStatus)?h:"disconnected"}};return(0,r._)([(0,a.Cb)({readOnly:!0})],e.prototype,"connectionError",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],e.prototype,"connectionStatus",null),(0,r._)([(0,a.Cb)({type:F.Z})],e.prototype,"filter",void 0),e=(0,r._)([(0,u.j)("esri.layers.mixins.StreamLayerView")],e),e};let i=class extends(Z((0,L.R)((0,R.A)(G.Z)))){constructor(){super(...arguments),this.type="stream-3d",this.updatePolicy=x.j.ASYNC,this.hasZ=!0,this.hasM=!1,this._isUserPaused=!1}initialize(){this.handles.add((0,g.YP)(()=>this.suspended,t=>{this.controller&&(t?this.controller.pauseStream():this._isUserPaused||this.controller.resumeStream())}))}get connectionError(){const t=this.get("controller.connection.errorString");if(t)return new S.Z("stream-controller",t)}pause(){this._isUserPaused=!0,this.controller.pauseStream()}resume(){this._isUserPaused=!1,this.controller.resumeStream()}createQuery(){return new E.Z({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryLatestObservations(t,e){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(t),null==e?void 0:e.signal)}createController(){return new o({layer:this.layer,layerView:this})}beforeSetController(){}};(0,r._)([(0,a.Cb)({readOnly:!0})],i.prototype,"updatePolicy",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],i.prototype,"connectionError",null),(0,r._)([(0,a.Cb)()],i.prototype,"controller",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],i.prototype,"hasZ",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],i.prototype,"hasM",void 0),i=(0,r._)([(0,u.j)("esri.views.3d.layers.StreamLayerView3D")],i);const D=i}}]);