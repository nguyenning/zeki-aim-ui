"use strict";var te=Object.defineProperty,ne=Object.defineProperties,ie=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,le=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,K=(g,d,u)=>d in g?te(g,d,{enumerable:!0,configurable:!0,writable:!0,value:u}):g[d]=u,R=(g,d)=>{for(var u in d||(d={}))le.call(d,u)&&K(g,u,d[u]);if(H)for(var u of H(d))oe.call(d,u)&&K(g,u,d[u]);return g},z=(g,d)=>ne(g,ie(d));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[2493],{42493:(g,d,u)=>{u.r(d),u.d(d,{ElevationQuery:()=>X,GeometryDescriptor:()=>E,getFinestLodIndex:()=>q});var f=u(15861),k=u(59213),x=u(26584),m=u(62208),Z=u(10699),C=u(16730),D=u(72854),V=u(72642),B=u(55214),I=u(55915),_=u(65401),O=u(13762),J=u(80403);class L{constructor(e,t=null){this.tile=e,(0,m.pC)(t)&&(0,m.pC)(e)&&(this._samplerData=new J.K(t,e.extent))}get zmin(){return(0,m.pC)(this._samplerData)?this._samplerData.data.minValue:0}get zmax(){return(0,m.pC)(this._samplerData)?this._samplerData.data.maxValue:0}sample(e,t){if((0,m.Wi)(this._samplerData))return;const{safeWidth:n,data:i,dx:o,dy:l,y1:s,x0:a}=this._samplerData,{width:r,values:c,noDataValue:p}=i,v=G(l*(s-t),0,n),h=G(o*(e-a),0,n),w=Math.floor(v),P=Math.floor(h),F=w*r+P,Q=F+r,M=c[F],S=c[Q],$=c[F+1],j=c[Q+1];if(M!==p&&S!==p&&$!==p&&j!==p){const N=h-P,b=M+($-M)*N;return b+(S+(j-S)*N-b)*(v-w)}}}function G(T,e,t){return T<e?e:T>t?t:T}var U=u(68511);class X{queryAll(e,t,n){var i=this;return(0,f.Z)(function*(){if(!(e=n&&n.ignoreInvisibleLayers?e.filter(c=>c.visible):e.slice()).length)throw new x.Z("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");const o=E.fromGeometry(t);let l=!1;n&&n.returnSampleInfo||(l=!0);const s=z(R(R({},A),n),{returnSampleInfo:!0}),a=yield i.query(e[e.length-1],o,s),r=yield i._queryAllContinue(e,a,s);return r.geometry=r.geometry.export(),l&&delete r.sampleInfo,r})()}query(e,t,n){var i=this;return(0,f.Z)(function*(){if(!e)throw new x.Z("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!t||!(t instanceof E)&&"point"!==t.type&&"multipoint"!==t.type&&"polyline"!==t.type)throw new x.Z("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");const o=R(R({},A),n),l=new Y(e,t.spatialReference,o),s=o.signal;return yield e.load({signal:s}),yield i._createGeometryDescriptor(l,t,s),yield i._selectTiles(l,s),yield i._populateElevationTiles(l,s),i._sampleGeometryWithElevation(l),i._createQueryResult(l,s)})()}createSampler(e,t,n){var i=this;return(0,f.Z)(function*(){if(!e)throw new x.Z("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!t||"extent"!==t.type)throw new x.Z("elevation-query:invalid-extent","Invalid or undefined extent");const o=R(R({},A),n);return i._createSampler(e,t,o)})()}createSamplerAll(e,t,n){var i=this;return(0,f.Z)(function*(){if(!(e=n&&n.ignoreInvisibleLayers?e.filter(s=>s.visible):e.slice()).length)throw new x.Z("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");if(!t||"extent"!==t.type)throw new x.Z("elevation-query:invalid-extent","Invalid or undefined extent");const o=z(R(R({},A),n),{returnSampleInfo:!0}),l=yield i._createSampler(e[e.length-1],t,o);return i._createSamplerAllContinue(e,t,l,o)})()}_createSampler(e,t,n,i){var o=this;return(0,f.Z)(function*(){const l=n.signal;yield e.load({signal:l});const s=t.spatialReference,a=e.tileInfo.spatialReference;s.equals(a)||(yield(0,I.iQ)([{source:s,dest:a}],{signal:l}),t=(0,I.iV)(t,a));const r=new ee(e,t,n,i);return yield o._selectTiles(r,l),yield o._populateElevationTiles(r,l),new O.Tl(r.elevationTiles,r.layer.tileInfo,r.options.noDataValue)})()}_createSamplerAllContinue(e,t,n,i){var o=this;return(0,f.Z)(function*(){if(e.pop(),!e.length)return n;const l=n.samplers.map(c=>(0,_.oJ)(c.extent)),s=yield o._createSampler(e[e.length-1],t,i,l);if(0===s.samplers.length)return n;const a=n.samplers.concat(s.samplers),r=new O.Tl(a,i.noDataValue);return o._createSamplerAllContinue(e,t,r,i)})()}_queryAllContinue(e,t,n){var i=this;return(0,f.Z)(function*(){const o=e.pop(),l=t.geometry.coordinates,s=t.sampleInfo;(0,m.O3)(s);const a=[],r=[];for(let h=0;h<l.length;h++){const w=s[h];w.demResolution>=0?w.source||(w.source=o):e.length&&(a.push(l[h]),r.push(h))}if(!e.length||0===a.length)return t;const c=t.geometry.clone(a),p=yield i.query(e[e.length-1],c,n),v=p.sampleInfo;if(!v)throw new Error("no sampleInfo");return r.forEach((h,w)=>{l[h].z=p.geometry.coordinates[w].z,s[h].demResolution=v[w].demResolution}),i._queryAllContinue(e,t,n)})()}_createQueryResult(e,t){var n=this;return(0,f.Z)(function*(){const i=yield e.geometry.project(e.outSpatialReference,t);(0,m.O3)(i);const o={geometry:i.export(),noDataValue:e.options.noDataValue};return e.options.returnSampleInfo&&(o.sampleInfo=n._extractSampleInfo(e)),e.geometry.coordinates.forEach(l=>{l.tile=null,l.elevationTile=null}),o})()}_createGeometryDescriptor(e,t,n){return(0,f.Z)(function*(){let i;const o=e.layer.tileInfo.spatialReference;if(t instanceof E?i=yield t.project(o,n):(yield(0,I.iQ)([{source:t.spatialReference,dest:o}],{signal:n}),i=(0,I.iV)(t,o)),!i)throw new x.Z("elevation-query:spatial-reference-mismatch",`Cannot query elevation in '${t.spatialReference.wkid}' on an elevation service in '${o.wkid}'`);e.geometry=E.fromGeometry(i)})()}_selectTiles(e,t){var n=this;return(0,f.Z)(function*(){const i=e.options.demResolution;if("geometry"===e.type&&n._preselectOutsideLayerExtent(e),"number"==typeof i)n._selectTilesClosestResolution(e);else if("finest-contiguous"===i)yield n._selectTilesFinestContiguous(e,t);else{if("auto"!==i)throw new x.Z("elevation-query:invalid-dem-resolution",`Invalid dem resolution value '${i}', expected a number, "finest-contiguous" or "auto"`);yield n._selectTilesAuto(e,t)}})()}_preselectOutsideLayerExtent(e){if((0,m.Wi)(e.layer.fullExtent))return;const t=new L(null);t.sample=()=>e.options.noDataValue,e.outsideExtentTile=t;const n=e.layer.fullExtent;e.geometry.coordinates.forEach(i=>{const o=i.x,l=i.y;(o<n.xmin||o>n.xmax||l<n.ymin||l>n.ymax)&&(i.elevationTile=t)})}_selectTilesClosestResolution(e){const n=this._findNearestDemResolutionLODIndex(e.layer.tileInfo,e.options.demResolution);e.selectTilesAtLOD(n)}_findNearestDemResolutionLODIndex(e,t){const n=t/(0,C.c9)(e.spatialReference);let i=e.lods[0],o=0;for(let l=1;l<e.lods.length;l++){const s=e.lods[l];Math.abs(s.resolution-n)<Math.abs(i.resolution-n)&&(i=s,o=l)}return o}_selectTilesFinestContiguous(e,t){var n=this;return(0,f.Z)(function*(){const i=q(e.layer.tileInfo,e.options.minDemResolution);yield n._selectTilesFinestContiguousAt(e,i,t)})()}_selectTilesFinestContiguousAt(e,t,n){var i=this;return(0,f.Z)(function*(){const o=e.layer;if(e.selectTilesAtLOD(t),t<0)return;const l=o.tilemapCache,s=e.getTilesToFetch();try{if(l)yield(0,Z.Hl)(Promise.all(s.map(a=>l.fetchAvailability(a.level,a.row,a.col,{signal:n}))),n);else if(yield i._populateElevationTiles(e,n),!e.allElevationTilesFetched())throw e.clearElevationTiles(),new x.Z("elevation-query:has-unavailable-tiles")}catch(a){(0,Z.r9)(a),yield i._selectTilesFinestContiguousAt(e,t-1,n)}})()}_populateElevationTiles(e,t){return(0,f.Z)(function*(){const n=e.getTilesToFetch(),i={},o=e.options.cache,l=e.options.noDataValue,s=n.map(function(){var a=(0,f.Z)(function*(r){if(null==r.id)return;const c=`${e.layer.uid}:${r.id}:${l}`,p=(0,m.pC)(o)?o.get(c):null,v=(0,m.pC)(p)?p:yield e.layer.fetchTile(r.level,r.row,r.col,{noDataValue:l,signal:t});(0,m.pC)(o)&&o.put(c,v),i[r.id]=new L(r,v)});return function(r){return a.apply(this,arguments)}}());yield(0,Z.Hl)((0,Z.as)(s),t),e.populateElevationTiles(i)})()}_selectTilesAuto(e,t){var n=this;return(0,f.Z)(function*(){n._selectTilesAutoFinest(e),n._reduceTilesForMaximumRequests(e);const i=e.layer.tilemapCache;if(!i)return n._selectTilesAutoPrefetchUpsample(e,t);const o=e.getTilesToFetch(),l={},s=o.map(function(){var a=(0,f.Z)(function*(r){const c=new U.f(null,0,0,0,(0,_.Ue)()),p=yield(0,k.q6)(i.fetchAvailabilityUpsample(r.level,r.row,r.col,c,{signal:t}));!1!==p.ok?null!=r.id&&(l[r.id]=c):(0,Z.r9)(p.error)});return function(r){return a.apply(this,arguments)}}());yield(0,Z.Hl)(Promise.all(s),t),e.remapTiles(l)})()}_reduceTilesForMaximumRequests(e){const t=e.layer.tileInfo;let n=0;const i={},o=a=>{null!=a.id&&(a.id in i?i[a.id]++:(i[a.id]=1,n++))},l=a=>{if(null==a.id)return;const r=i[a.id];1===r?(delete i[a.id],n--):i[a.id]=r-1};e.forEachTileToFetch(o,l);let s=!0;for(;s&&(s=!1,e.forEachTileToFetch(a=>{n<=e.options.maximumAutoTileRequests||(l(a),t.upsampleTile(a)&&(s=!0),o(a))},l),s););}_selectTilesAutoFinest(e){const t=q(e.layer.tileInfo,e.options.minDemResolution);e.selectTilesAtLOD(t,e.options.maximumAutoTileRequests)}_selectTilesAutoPrefetchUpsample(e,t){var n=this;return(0,f.Z)(function*(){const i=e.layer.tileInfo;yield n._populateElevationTiles(e,t);let o=!1;e.forEachTileToFetch((l,s)=>{i.upsampleTile(l)?o=!0:s()}),o&&(yield n._selectTilesAutoPrefetchUpsample(e,t))})()}_sampleGeometryWithElevation(e){e.geometry.coordinates.forEach(t=>{const n=t.elevationTile;let i=e.options.noDataValue;if(n){const o=n.sample(t.x,t.y);(0,m.pC)(o)?i=o:t.elevationTile=null}t.z=i})}_extractSampleInfo(e){const t=e.layer.tileInfo,n=(0,C.c9)(t.spatialReference);return e.geometry.coordinates.map(i=>{let o=-1;return i.elevationTile&&i.elevationTile!==e.outsideExtentTile&&(o=t.lodAt(i.elevationTile.tile.level).resolution*n),{demResolution:o}})}}class E{export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){const t=new E;return t.geometry=this.geometry,t.spatialReference=this.spatialReference,t.coordinates=e||this.coordinates.map(n=>n.clone()),t._exporter=this._exporter,t}project(e,t){var n=this;return(0,f.Z)(function*(){if(n.spatialReference.equals(e))return n.clone();yield(0,I.iQ)([{source:n.spatialReference,dest:e}],{signal:t});const i=new D.Z({spatialReference:n.spatialReference,points:n.coordinates.map(a=>[a.x,a.y])}),o=(0,I.iV)(i,e);if(!o)return null;const l=n.coordinates.map((a,r)=>{const c=a.clone(),p=o.points[r];return c.x=p[0],c.y=p[1],c}),s=n.clone(l);return s.spatialReference=e,s})()}static fromGeometry(e){const t=new E;if(t.geometry=e,t.spatialReference=e.spatialReference,e instanceof E)t.coordinates=e.coordinates.map(n=>n.clone()),t._exporter=(n,i)=>{const o=e.clone(n);return o.spatialReference=i,o};else switch(e.type){case"point":{const n=e,{hasZ:i,hasM:o}=n;t.coordinates=i&&o?[new y(n.x,n.y,n.z,n.m)]:i?[new y(n.x,n.y,n.z)]:o?[new y(n.x,n.y,null,n.m)]:[new y(n.x,n.y)],t._exporter=(l,s)=>e.hasM?new V.Z(l[0].x,l[0].y,l[0].z,l[0].m,s):new V.Z(l[0].x,l[0].y,l[0].z,s);break}case"multipoint":{const n=e,{hasZ:i,hasM:o}=n;t.coordinates=n.points.map(i&&o?l=>new y(l[0],l[1],l[2],l[3]):i?l=>new y(l[0],l[1],l[2]):o?l=>new y(l[0],l[1],null,l[2]):l=>new y(l[0],l[1])),t._exporter=(l,s)=>e.hasM?new D.Z({points:l.map(a=>[a.x,a.y,a.z,a.m]),hasZ:!0,hasM:!0,spatiaReference:s}):new D.Z(l.map(a=>[a.x,a.y,a.z]),s);break}case"polyline":{const n=e,i=[],o=[],{hasZ:l,hasM:s}=e;let a=0;for(const r of n.paths)if(o.push([a,a+r.length]),a+=r.length,l&&s)for(const c of r)i.push(new y(c[0],c[1],c[2],c[3]));else if(l)for(const c of r)i.push(new y(c[0],c[1],c[2]));else if(s)for(const c of r)i.push(new y(c[0],c[1],null,c[2]));else for(const c of r)i.push(new y(c[0],c[1]));t.coordinates=i,t._exporter=(r,c)=>{const p=r.map(e.hasM?h=>[h.x,h.y,h.z,h.m]:h=>[h.x,h.y,h.z]),v=o.map(h=>p.slice(h[0],h[1]));return new B.Z({paths:v,hasM:e.hasM,hasZ:!0,spatialReference:c})};break}}return t}}class y{constructor(e,t,n=null,i=null,o=null,l=null){this.x=e,this.y=t,this.z=n,this.m=i,this.tile=o,this.elevationTile=l}clone(){return new y(this.x,this.y,this.z,this.m)}}class W{constructor(e,t){this.layer=e,this.options=t}}class Y extends W{constructor(e,t,n){super(e,n),this.outSpatialReference=t,this.type="geometry"}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach(t=>{t.tile=null});else{const t=this.layer.tileInfo,n=t.lods[e].level;this.geometry.coordinates.forEach(i=>{i.tile=t.tileAt(n,i.x,i.y)})}}allElevationTilesFetched(){return!this.geometry.coordinates.some(e=>!e.elevationTile)}clearElevationTiles(){for(const e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){var t;for(const n of this.geometry.coordinates)!n.elevationTile&&(null==(t=n.tile)?void 0:t.id)&&(n.elevationTile=e[n.tile.id])}remapTiles(e){var t;for(const n of this.geometry.coordinates){const i=null==(t=n.tile)?void 0:t.id;n.tile=i?e[i]:null}}getTilesToFetch(){var n;const e={},t=[];for(const i of this.geometry.coordinates){const o=i.tile;if(!o)continue;const l=null==(n=i.tile)?void 0:n.id;i.elevationTile||!l||e[l]||(e[l]=o,t.push(o))}return t}forEachTileToFetch(e){for(const t of this.geometry.coordinates)t.tile&&!t.elevationTile&&e(t.tile,()=>{t.tile=null})}}class ee extends W{constructor(e,t,n,i){super(e,n),this.type="extent",this.elevationTiles=[],this._candidateTiles=[],this._fetchedCandidates=new Set,this.extent=t.intersection(e.fullExtent),this.maskExtents=i}selectTilesAtLOD(e,t){const n=this._maximumLodForRequests(t),i=Math.min(n,e);i<0?this._candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(i)}_maximumLodForRequests(e){const t=this.layer.tileInfo;if(!e)return t.lods.length-1;const n=this.extent;if((0,m.Wi)(n))return-1;for(let i=t.lods.length-1;i>=0;i--){const o=t.lods[i],s=o.resolution*t.size[1];if(Math.ceil(n.width/(o.resolution*t.size[0]))*Math.ceil(n.height/s)<=e)return i}return-1}allElevationTilesFetched(){return this._candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this._fetchedCandidates.clear()}populateElevationTiles(e){for(const t of this._candidateTiles){const n=t.id&&e[t.id];n&&(this._fetchedCandidates.add(t),this.elevationTiles.push(n))}}remapTiles(e){this._candidateTiles=this._uniqueNonOverlappingTiles(this._candidateTiles.map(t=>e[t.id]))}getTilesToFetch(){return this._candidateTiles}forEachTileToFetch(e,t){const n=this._candidateTiles;this._candidateTiles=[],n.forEach(i=>{if(this._fetchedCandidates.has(i))return void(t&&t(i));let o=!1;e(i,()=>o=!0),o?t&&t(i):this._candidateTiles.push(i)}),this._candidateTiles=this._uniqueNonOverlappingTiles(this._candidateTiles,t)}_uniqueNonOverlappingTiles(e,t){const n={},i=[];for(const l of e){const s=l.id;s&&!n[s]?(n[s]=l,i.push(l)):t&&t(l)}const o=i.sort((l,s)=>l.level-s.level);return o.filter((l,s)=>{for(let a=0;a<s;a++){const r=o[a].extent;if(r&&l.extent&&(0,_.r3)(r,l.extent))return t&&t(l),!1}return!0})}_selectCandidateTilesCoveringExtentAt(e){this._candidateTiles.length=0;const t=this.extent;if((0,m.Wi)(t))return;const n=this.layer.tileInfo,i=n.lods[e],o=n.tileAt(i.level,t.xmin,t.ymin),l=o.extent;if((0,m.Wi)(l))return;const a=i.resolution*n.size[1],r=Math.ceil((t.xmax-l[0])/(i.resolution*n.size[0])),c=Math.ceil((t.ymax-l[1])/a);for(let p=0;p<c;p++)for(let v=0;v<r;v++){const h=new U.f(null,o.level,o.row-p,o.col+v);n.updateTileInfo(h),this._tileIsMasked(h)||this._candidateTiles.push(h)}}_tileIsMasked(e){return!!this.maskExtents&&this.maskExtents.some(t=>e.extent&&(0,_.r3)(t,e.extent))}}function q(T,e=0){let t=T.lods.length-1;if(e>0){const n=e/(0,C.c9)(T.spatialReference),i=T.lods.findIndex(o=>o.resolution<n);0===i?t=0:i>0&&(t=i-1)}return t}const A={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0}}}]);