"use strict";var Lt=Object.defineProperty,bt=Object.defineProperties,St=Object.getOwnPropertyDescriptors,Ve=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable,Te=(z,C,i)=>C in z?Lt(z,C,{enumerable:!0,configurable:!0,writable:!0,value:i}):z[C]=i,A=(z,C)=>{for(var i in C||(C={}))ft.call(C,i)&&Te(z,i,C[i]);if(Ve)for(var i of Ve(C))wt.call(C,i)&&Te(z,i,C[i]);return z},T=(z,C)=>bt(z,St(C));(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[6212],{50978:(z,C,i)=>{i.d(C,{M:()=>I,b:()=>K});var o=i(2166),U=i(69960),l=i(65787),d=i(17625),ie=i(22355),w=i(16396);function K(Z){const L=new ie.kG;(0,o.S)(L,Z),L.vertex.uniforms.add(new l.p("width",f=>f.width)),L.attributes.add(w.T.POSITION,"vec3"),L.attributes.add(w.T.NORMAL,"vec3"),L.attributes.add(w.T.UV0,"vec2"),L.attributes.add(w.T.AUXPOS1,"float"),L.varyings.add("vtc","vec2"),L.varyings.add("vlength","float"),L.varyings.add("vradius","float"),L.vertex.code.add(d.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),L.fragment.uniforms.add([new l.p("outlineSize",f=>f.outlineSize),new U.N("outlineColor",f=>f.outlineColor),new l.p("stripeLength",f=>f.stripeLength),new U.N("stripeEvenColor",f=>f.stripeEvenColor),new U.N("stripeOddColor",f=>f.stripeOddColor)]);const W=1/Math.sqrt(2);return L.fragment.code.add(d.H`
    const float INV_SQRT2 = ${d.H.float(W)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),L}const I=Object.freeze(Object.defineProperty({__proto__:null,build:K},Symbol.toStringTag,{value:"Module"}))},96212:(z,C,i)=>{i.r(C),i.d(C,{default:()=>Ot});var o=i(17626),U=i(14517),l=i(62208),d=i(77712),I=(i(85931),i(8314),i(90912),i(76898)),Z=i(39691),L=i(1437),W=i(74554),f=i(72392),ve=i(63290),G=i(15572),_=i(32917),P=i(84161),O=i(28093),me=i(44766),X=i(55214),B=i(55915),h=i(12080),y=i(10049),R=i(54865),J=i(68);const Re=ve.Z.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController");let H=class extends U.Z{constructor(e){super(e),this._unitNormalizer=new J.D,this._handles=new f.Z,this._tempStartPosition=(0,O.c)(),this._tempEndPosition=(0,O.c)(),this._tempCornerPosition=(0,O.c)()}initialize(){this._handles.add((0,_.gx)(()=>{var e;return null==(e=this.view)?void 0:e.ready},()=>this._initialize(),{once:!0,sync:!0,initial:!0}))}destroy(){this._handles=(0,l.SC)(this._handles)}_initialize(){const e=this.view.spatialReference,t=(0,h.rS)(e),s=t===h.GG?h.wY:t;this._sphericalPCPF=s;const n=(0,B.Up)(e,s);this._unitNormalizer.spatialReference=n?s:e,this._handles.add([(0,_.YP)(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:a,startPoint:r})=>{a.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(r)},_.tX),(0,_.YP)(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:a,endPoint:r})=>{a.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(r)},_.tX),(0,_.YP)(()=>({result:this._computedResult,viewData:this.viewData}),({result:a,viewData:r})=>{r.result=a},_.tX)])}_applyProjectionAndElevationAlignment(e){if((0,l.Wi)(e))return e;const t=(0,R.G)(e,this.view.spatialReference,this.view.elevationProvider);return(0,l.Wi)(t)?((0,R.e)(this.analysis,e.spatialReference,Re),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:s}=this.viewData;if((0,l.Wi)(e)||(0,l.Wi)(t))return null;const n=this._euclideanDistances(e,t),a=this._geodesicDistance(e,t,n.horizontal.value),r=s===W.e.Geodesic||s===W.e.Auto&&n.horizontal.value>1e5?"geodesic":"euclidean";return{mode:r,distance:"euclidean"===r?n.direct:a,directDistance:n.direct,horizontalDistance:n.horizontal,verticalDistance:n.vertical,geodesicDistance:a}}_euclideanDistances(e,t){const s=e.clone();s.z=t.z;const n=this._tempStartPosition,a=this._tempEndPosition,r=this._tempCornerPosition,v=this.view.spatialReference,u=this._sphericalPCPF,c=(0,B.Up)(v,u)?u:v;(0,B.KC)(e,n,c),(0,B.KC)(t,a,c),(0,B.KC)(s,r,c);const g=(0,P.i)(n,a),m=(0,P.i)(r,a),b=Math.abs(t.z-e.z),S=he=>this._unitNormalizer.normalizeDistance(he),D=S(g),ee=S(m),de=S(b);return{direct:(0,G.EV)(D,"meters"),horizontal:(0,G.EV)(ee,"meters"),vertical:(0,G.EV)(de,"meters")}}_geodesicDistance(e,t,s){const n=e.spatialReference,a=new X.Z({spatialReference:n});a.addPath([e,t]);const r=n.isGeographic&&(0,y.Gb)(n)?(0,y.Jf)([a],"meters")[0]:n.isWebMercator?(0,me.geodesicLength)(a,"meters"):null,v=(0,l.pC)(r)?r:this._fallbackGeodesicDistance(e,t,s);return(0,G.EV)(v,"meters")}_fallbackGeodesicDistance(e,t,s){if((0,B.UY)(e,Ee)&&(0,B.UY)(t,Me)){const n={distance:0};return(0,y.cA)(n,Ee,Me),n.distance}return s}};(0,o._)([(0,d.Cb)()],H.prototype,"view",void 0),(0,o._)([(0,d.Cb)()],H.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],H.prototype,"viewData",void 0),(0,o._)([(0,d.Cb)()],H.prototype,"_computedResult",null),H=(0,o._)([(0,I.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],H);const Ee=(0,O.c)(),Me=(0,O.c)();var E,j,e,We=i(15861),Y=(i(52515),i(21286)),V=i(84600),q=i(23841),Le=i(16730),be=i(67831),Ge=i(67709);(e=E||(E={}))[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(j||(j={}));var pe=i(495),k=i(67214),se=i(87469),je=i(43703),_e=i(4794),ne=i(26242),Ue=i(53928),Ie=i(57521),F=i(40723),Be=i(19625),Ne=i(6945),ae=i(42743),Ke=i(60881),He=i(5894),N=i(16396),Fe=i(651),Qe=i(91056),ye=i(87601),Ze=i(39114),Se=i(88569),Xe=i(12407),Ye=i(41528),$e=i(50978),fe=i(67969),Ce=i(2078);class re extends Qe.A{constructor(t,s,n){super(t,s,n)}initializeProgram(t){const s=re.shader.get().build(this.configuration);return new Xe.$(t.rctx,s,Ze.i)}_setPipelineState(t){return(0,Ce.sm)({blending:this.configuration.transparent?t===ae.Am.NONE?Se.wu:(0,Se.j7)(t):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:fe.wb.LESS},depthWrite:Ce.LZ,colorWrite:Ce.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return fe.MX.TRIANGLE_STRIP}}re.shader=new Fe.J($e.M,()=>i.e(3368).then(i.bind(i,3368)));class oe extends Ye.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=ae.Am.NONE}}(0,o._)([(0,ye.o)()],oe.prototype,"polygonOffsetEnabled",void 0),(0,o._)([(0,ye.o)()],oe.prototype,"transparent",void 0),(0,o._)([(0,ye.o)({count:ae.Am.COUNT})],oe.prototype,"transparencyPassType",void 0);class Je extends F.F5{constructor(t){super(t,new ke),this.techniqueConfig=new oe}getConfiguration(t,s){var n;return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=null!=(n=null==s?void 0:s.transparencyPassType)?n:ae.Am.NONE,this.techniqueConfig}dispose(){}intersect(){}requiresSlot(t){return t===He.r.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===Ne.H.Color?new qe(t):null}createBufferWriter(){return new rt}}class qe extends Ke.Z{beginSlot(t){return this.ensureTechnique(re,t)}}class ke extends F.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=[1,.5,0,1],this.stripeLength=1,this.stripeEvenColor=[1,1,1,1],this.stripeOddColor=[1,.5,0,1],this.polygonOffset=!1}}const et=(0,Be.U$)().vec3f(N.T.POSITION).vec3f(N.T.NORMAL).vec2f(N.T.UV0).f32(N.T.AUXPOS1),tt=(0,O.c)(),it=(0,O.c)(),st=(0,O.c)(),nt=(0,O.c)(),at=(0,O.c)();class rt{constructor(){this.vertexBufferLayout=et}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 2*(t.indices.get(N.T.POSITION).length/2+1)}write(t,s,n,a){const r=s.vertexAttributes.get(N.T.POSITION).data,v=s.vertexAttributes.get(N.T.NORMAL).data,u=r.length/3,c=s&&s.indices&&s.indices.get(N.T.POSITION);c&&c.length!==2*(u-1)&&console.warn("MeasurementArrowMaterial does not support indices");const g=tt,m=it,b=st,S=nt,D=at,ee=t.transformation,de=t.invTranspTransformation,he=n.position,ze=n.normal,ce=n.uv0;let ue=0;for(let x=0;x<u;++x){const Oe=3*x;if((0,P.s)(g,r[Oe],r[Oe+1],r[Oe+2]),x<u-1){const $=3*(x+1);(0,P.s)(m,r[$],r[$+1],r[$+2]),(0,P.s)(D,v[$],v[$+1],v[$+2]),(0,P.n)(D,D),(0,P.b)(b,m,g),(0,P.n)(b,b),(0,P.f)(S,D,b),(0,P.n)(S,S)}const Mt=(0,P.i)(g,m);ee&&de&&((0,P.m)(g,g,ee),(0,P.m)(m,m,ee),(0,P.m)(S,S,de));const te=a+2*x,ge=te+1;he.setVec(te,g),he.setVec(ge,g),ze.setVec(te,S),ze.setVec(ge,S),ce.set(te,0,ue),ce.set(te,1,-1),ce.set(ge,0,ue),ce.set(ge,1,1),x<u-1&&(ue+=Mt)}const Et=n.auxpos1;for(let x=0;x<2*u;++x)Et.set(a+x,ue)}}class ot extends Ue._{constructor(t){super(t),this._parameters=lt,this._handles=null,this._origin=(0,O.c)(),this._originTransform=(0,je.c)(),this._arrowCenter=(0,O.c)(),this._renderOccluded=F.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:t}))}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(t){this._stripeLength=t,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(t){if(this._stripesEnabled=t,this.attached){const s=this.opacity,{arrowStripeEvenColor:n,arrowStripeOddColor:a}=this._parameters,r=(0,Y.H)(we,this._stripesEnabled?n:a,s);this._arrowMaterial.setParameters({stripeEvenColor:r})}}get opacity(){return this._opacity}set opacity(t){t!==this._opacity&&(this._opacity=t,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:t,arrowStripeOddColor:s,arrowOutlineColor:n}=this._parameters;this._arrowMaterial=new Je({outlineColor:n,stripeEvenColor:this._stripesEnabled?t:s,stripeOddColor:s,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new f.Z,this._handles.add((0,_.YP)(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(t){t(this._arrowMaterial)}createGeometries(t){if((0,l.Wi)(this._geometry)||(0,l.Wi)(this._geometry.startRenderSpace)||(0,l.Wi)(this._geometry.endRenderSpace))return;const s=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);t.addGeometry(s,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(t,s,n,a){const r=this.view.renderCoordsHelper,v=[],u=[],c=(g,m)=>{const b=ne.WM.get();(0,P.b)(b,g,n),v.push(b),u.push(m)};if("euclidean"===a.type){a.eval(.5,this._arrowCenter);const g=ne.WM.get();r.worldUpAtPosition(this._arrowCenter,g),c(t,g),c(s,g)}else{a.eval(.5,this._arrowCenter);const g=this._parameters.arrowSubdivisions+1&-2;for(let m=0;m<g;++m){const b=m/(g-1),S=ne.WM.get(),D=ne.WM.get();a.eval(b,S),r.worldUpAtPosition(S,D),c(S,D)}}return Ie.Z.createPolylineGeometry(v,u)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,l.pC)(this._geometry)){const t=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*t})}}_updateArrowOpacity(){const t=this.opacity,{arrowStripeEvenColor:s,arrowStripeOddColor:n,arrowOutlineColor:a}=this._parameters,r=(0,Y.H)(we,this._stripesEnabled?s:n,t),v=(0,Y.H)(dt,a,t),u=(0,Y.H)(ht,n,t);this._arrowMaterial.setParameters({stripeEvenColor:r,outlineColor:v,stripeOddColor:u})}}const lt={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},we=(0,_e.c)(),dt=(0,_e.c)(),ht=(0,_e.c)();var Ae,ct=i(77603),Q=i(64770),Pe=i(54889),ut=i(56683),gt=i(41840);!function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"}(Ae||(Ae={}));let M=class extends U.Z{constructor(e){super(e),this._params=A({},mt),this._handles=new f.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,O.c)(),this._endPosition=(0,O.c)(),this._cornerPosition=(0,O.c)(),this._startPositionAtSeaLevel=(0,O.c)(),this._endPositionAtSeaLevel=(0,O.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=j.Auto,this.triangleCollapseRatioThreshold=.03}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,l.Wi)(e)||(0,l.Wi)(t)||e.equals(t))return E.None;const s=this.analysisView.result;if((0,l.Wi)(s))return E.Direct;if("geodesic"===s.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?E.ProjectedGeodesic:E.Direct;const{verticalDistance:n,horizontalDistance:a}=s,r=n.value,v=a.value;return Math.min(r/v,v/r)<this.triangleCollapseRatioThreshold?E.Direct:E.Triangle}get actualVisualizedMeasurement(){if((0,l.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case W.e.Auto:case W.e.Euclidean:default:return"euclidean";case W.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,l.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,l.Wi)(this._triangleOrientationOverride)!==e&&(this._triangleOrientationOverride=(0,l.Wi)(this._triangleOrientationOverride)?this._actualVisualElementsOrientation:null)}get labels(){return{direct:this._segmentLabel,horizontal:"geodesic"===this.actualVisualizedMeasurement?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}initialize(){var e=this;const t=this._params,s={attached:!0,view:this.view};this._segmentVisualElement=new ot(T(A({},s),{geometry:null,renderOccluded:F.yD.OccludeAndTransparent})),this._triangleVisualElement=new se.r(T(A({},s),{width:t.triangleLineWidth,color:t.triangleColor,renderOccluded:F.yD.OccludeAndTransparent})),this._rightAngleQuad=new ct.R(T(A({},s),{color:le,renderOccluded:F.yD.OccludeAndTransparent}));const n=T(A({},s),{polygonOffset:!0,renderOccluded:F.yD.OccludeAndTransparent});this._projectedGeodesicLine=new se.r(T(A({},n),{width:t.geodesicProjectionLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,Pe.z5)(t.guideStippleLengthPixels)})),this._geodesicStartHint=new se.r(T(A({},n),{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,Pe.z5)(t.guideStippleLengthPixels)})),this._geodesicEndHint=new se.r(T(A({},n),{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,Pe.z5)(t.guideStippleLengthPixels)})),this._segmentLabel=new k.Kc(T(A({},s),{fontSize:t.direcLabelFontSize})),this._verticalLabel=new k.Kc(T(A({},s),{fontSize:t.verticalLabelFontSize})),this._horizontalLabel=new k.Kc(T(A({},s),{fontSize:t.horizontalLabelFontSize})),this._handles.add([(0,_.YP)(()=>{const{elevationAlignedStartPoint:a,elevationAlignedEndPoint:r}=this.analysisView,v=this.view;return{view:v,camera:v.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:a,elevationAlignedEndPoint:r,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},a=>this._updateGeometryAndViewMode(a),_.tX),(0,_.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateVisualElementVisibility(a),_.tX),(0,_.YP)(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),a=>this._updateLabelText(a),_.tX),(0,_.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateLabelVisibility(a),_.tX),(0,_.YP)(()=>this._measurementArrowStripeLength,a=>this._updateSegmentStripeLength(a),_.tX),(0,ut.qe)((0,We.Z)(function*(){return e._updateMessageBundle()}))]),this._updateMessageBundle()}destroy(){this._handles=(0,l.SC)(this._handles),this._segmentVisualElement=(0,l.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,l.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,l.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,l.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,l.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,l.SC)(this._geodesicEndHint),this._segmentLabel=(0,l.SC)(this._segmentLabel),this._verticalLabel=(0,l.SC)(this._verticalLabel),this._horizontalLabel=(0,l.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case E.None:break;case E.Direct:this._segmentVisualElement.visible=!0;break;case E.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case E.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:s,elevationAlignedStartPoint:n,elevationAlignedEndPoint:a,orientation:r,visualizedMeasurement:v,stripeLength:u}){const c=e.renderCoordsHelper;if((0,l.Wi)(c)||(0,l.Wi)(n)||(0,l.Wi)(a)||n.equals(a))return;let g=this._startPosition,m=this._endPosition;c.toRenderCoords(n,g),c.toRenderCoords(a,m);const b=r===j.AboveSegment?1:-1,S=b*(c.getAltitude(m)-c.getAltitude(g));S<0&&(g=this._endPosition,m=this._startPosition);const D="geodesic"===v?new Q.u4(this._startPosition,this._endPosition,c.spatialReference):new Q.y$(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=D,this._updateSegmentStripeLength(u),s){case E.Direct:this._updateSegment(D,r);break;case E.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:D,orientation:r,startPosition:g,endPosition:m,deltaSign:b,altitudeDelta:S});break;case E.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:r,startPosition:g,endPosition:m})}}_updateSegment(e,t){this._segmentLabel.anchor=t===j.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:s,orientation:n,startPosition:a,endPosition:r,deltaSign:v,altitudeDelta:u}){const c=this._cornerPosition;e.worldUpAtPosition(a,c),(0,P.g)(c,c,v*Math.abs(u)),(0,P.a)(c,c,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[c[0],c[1],c[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:a,center:c,next:r};const g=new Q.y$(a,c),m=new Q.y$(c,r),b=function vt(e,t,s,n,a){const r=pt,v=_t;a.projectToRenderScreen(s,r),a.projectToRenderScreen(t,v);const u={segment:"bottom",horizontal:"top",vertical:r[0]<v[0]?"left":"right"};{const c=yt,g=Ct;if((0,pe.c)(e,s,c,a),(0,pe.c)(e,t,g,a),(0,be.h)(c,g)>=De){const m=Math.sign(c[1])===Math.sign(g[1]);u.segment=m?(0,k.jB)(u.vertical):u.vertical}else{const m=Pt;(0,pe.c)(s,t,m,a),(0,be.h)(m,g)>=De&&(u.segment=Math.sign(m[0])===Math.sign(g[0])?(0,k.jB)(u.horizontal):u.horizontal)}}if(n===j.BelowSegment){const c=g=>"top"===g?"bottom":"top";u.segment=c(u.segment),u.horizontal=c(u.horizontal),u.vertical=c(u.vertical)}return u}(a,r,c,n,t);this._segmentLabel.anchor=b.segment,this._segmentLabel.geometry={type:"segment",segment:s,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:g,sampleLocation:"center"},this._verticalLabel.anchor=b.vertical,this._horizontalLabel.geometry={type:"segment",segment:m,sampleLocation:"center"},this._horizontalLabel.anchor=b.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:s,endPosition:n}){e.setAltitude(this._startPositionAtSeaLevel,0,s),e.setAltitude(this._endPositionAtSeaLevel,0,n);const a=new Q.u4(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new Q.y$(this._startPositionAtSeaLevel,s)),this._geodesicEndHint.setGeometryFromSegment(new Q.y$(this._endPositionAtSeaLevel,n)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=t===j.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){(0,l.pC)(e)?(this._segmentLabel.text="euclidean"===t?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const s=this._segmentLabel,n=this._horizontalLabel,a=this._verticalLabel;if(s.visible=!1,n.visible=!1,a.visible=!1,e)switch(t){case E.Direct:s.visible=!0;break;case E.Triangle:s.visible=!0,n.visible=!0,a.visible=!0;break;case E.ProjectedGeodesic:s.visible=!0}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if((0,l.Wi)(t)||(0,l.Wi)(e))return null;const{directDistance:s,horizontalDistance:n,verticalDistance:a,geodesicDistance:r}=t,v=this.analysisView.unit,u=c=>A({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},c);switch(v){case"metric":return u({euclideanDistance:s&&(0,V.Rd)(e,s),geodesicDistance:r&&(0,V.Rd)(e,r),horizontalDistance:n&&(0,V.Rd)(e,n),verticalDistance:a&&(0,V.Wv)(e,a)});case"imperial":return u({euclideanDistance:s&&(0,V.Ud)(e,s),geodesicDistance:r&&(0,V.Ud)(e,r),horizontalDistance:n&&(0,V.Ud)(e,n),verticalDistance:a&&(0,V.Zv)(e,a)});default:return u({euclideanDistance:s&&(0,V.VG)(e,s,v),geodesicDistance:r&&(0,V.VG)(e,r,v),horizontalDistance:n&&(0,V.VG)(e,n,v),verticalDistance:a&&(0,V.VG)(e,a,v)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,l.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,l.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===j.Auto?this.view.state.camera.aboveGround?j.AboveSegment:j.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(null==t||!t.state)return!1;const n=t.renderCoordsHelper,a=t.state.camera.computeScreenPixelSizeAt(e);return n.getAltitude(e)/a>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,l.Wi)(e))return null;let s=null;const n=e.directDistance;switch(t){case"metric":s=n&&(0,G.nn)(n,"meters");break;case"imperial":s=n&&(0,G.nn)(n,(0,Le.FN)(n.value,n.unit));break;default:s=n&&(0,G.nn)(n,t)}return(0,l.Wi)(s)?null:(0,Y.sk)(s.value/30)*(0,Le.En)(1,s.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,gt.ME)("esri/core/t9n/Units").then(e=>{this.messages=e}).finally(()=>{this.loadingMessages=!1})}get testData(){var e;return{labels:this.labels,stripeLength:null==(e=this._segmentVisualElement)?void 0:e.stripeLength}}};(0,o._)([(0,d.Cb)()],M.prototype,"_triangleOrientationOverride",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"messages",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"view",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"analysisView",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"loadingMessages",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"visible",null),(0,o._)([(0,d.Cb)()],M.prototype,"viewMode",null),(0,o._)([(0,d.Cb)()],M.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,d.Cb)()],M.prototype,"visualElementOrientation",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"triangleCollapseRatioThreshold",void 0),(0,o._)([(0,d.Cb)()],M.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,d.Cb)()],M.prototype,"labels",null),(0,o._)([(0,d.Cb)()],M.prototype,"_labelsText",null),(0,o._)([(0,d.Cb)()],M.prototype,"_actualVisualElementsOrientation",null),(0,o._)([(0,d.Cb)()],M.prototype,"_measurementArrowStripeLength",null),M=(0,o._)([(0,I.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],M);const le=(0,Ge.f)(1,.5,0,.75),mt={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:le,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:le,guideLineWidth:2,guideLineColor:le,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},De=Math.cos((0,Y.Vl)(12)),pt=(0,q.J$)(),_t=(0,q.J$)(),yt=(0,q.gX)(),Ct=(0,q.gX)(),Pt=(0,q.gX)();let p=class extends((0,L.p)(U.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=W.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new M({view:e,analysis:t,analysisView:this}),this._analysisController=new H({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,l.SC)(this._analysisController),this._analysisVisualization=(0,l.SC)(this._analysisVisualization)}get updating(){var e;return!(null==(e=this._analysisVisualization)||!e.loadingMessages)}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get unit(){return(0,l.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){var e;return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:T(A({},null==(e=this._analysisVisualization)?void 0:e.testData),{visualization:this._analysisVisualization,controller:this._analysisController})}};(0,o._)([(0,d.Cb)()],p.prototype,"updating",null),(0,o._)([(0,d.Cb)({readOnly:!0})],p.prototype,"type",void 0),(0,o._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],p.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],p.prototype,"result",void 0),(0,o._)([(0,d.Cb)()],p.prototype,"measurementMode",void 0),(0,o._)([(0,d.Cb)()],p.prototype,"elevationAlignedStartPoint",void 0),(0,o._)([(0,d.Cb)()],p.prototype,"elevationAlignedEndPoint",void 0),(0,o._)([(0,d.Cb)({readOnly:!0})],p.prototype,"viewMode",null),(0,o._)([(0,d.Cb)({readOnly:!0})],p.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,d.Cb)()],p.prototype,"visualElementOrientation",null),(0,o._)([(0,d.Cb)()],p.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,d.Cb)()],p.prototype,"triangleCollapseRatioThreshold",null),(0,o._)([(0,d.Cb)({readOnly:!0})],p.prototype,"directLabelText",null),(0,o._)([(0,d.Cb)({readOnly:!0})],p.prototype,"horizontalLabelText",null),(0,o._)([(0,d.Cb)({readOnly:!0})],p.prototype,"verticalLabelText",null),(0,o._)([(0,d.Cb)()],p.prototype,"_analysisVisualization",void 0),(0,o._)([(0,d.Cb)()],p.prototype,"_analysisController",void 0),(0,o._)([(0,d.Cb)()],p.prototype,"unit",null),(0,o._)([(0,d.Cb)(Z.Y)],p.prototype,"_defaultUnit",void 0),p=(0,o._)([(0,I.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],p);const Ot=p},77603:(z,C,i)=>{i.d(C,{R:()=>me});var o=i(72392),U=i(62208),l=i(32917),d=i(28347),ie=i(43703),w=i(84161),K=i(28093),I=i(993),Z=i(67709),L=i(26242),W=i(53928),f=i(52107),ve=i(57521),G=i(40723),_=i(16396),P=i(92972),O=i(92222);class me extends W._{constructor(h){super(h),this._handles=new o.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,K.c)(),this._up=(0,K.c)(),this._right=(0,K.c)(),this._renderOccluded=G.yD.OccludeAndTransparent,this._color=(0,Z.f)(1,0,0,1),this._outlineColor=(0,Z.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=G.yD.Opaque,this.applyProps(h)}get renderOccluded(){return this._renderOccluded}set renderOccluded(h){h!==this._renderOccluded&&(this._renderOccluded=h,this._updateQuadMaterial())}get color(){return this._color}set color(h){(0,I.c)(this._color,h),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(h){(0,I.c)(this._outlineColor,h),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(h){const y=0===this._outlineSize!=(0===h);this._outlineSize=h,y?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(h){h!==this._size&&(this._size=h,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(h){this._outlineRenderOccluded=h,this._updateOutlineMaterial()}set geometry({previous:h,center:y,next:R}){this._maxSize=Math.min((0,w.i)(y,h),(0,w.i)(y,R))/3,(0,w.n)(this._up,(0,w.b)(this._up,h,y)),(0,w.n)(this._right,(0,w.b)(this._right,R,y)),(0,w.c)(this._position,y),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new P.E(this.quadMaterialParameters),this._outlineMaterial=new O.U(this.outlineMaterialParameters),this._handles.add((0,l.YP)(()=>this.view.state.camera,()=>this._updateTransform()))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(h){h(this._quadMaterial),h(this._outlineMaterial)}createGeometries(h){this._createQuadGeometry(h),this._createOutlineGeometry(h),this._updateTransform(h)}_createQuadGeometry(h){const y=this._quadGeometryData(this._up,this._right);h.addGeometry(y,this._quadMaterial)}_createOutlineGeometry(h){if(0===this._outlineSize)return;const y=(0,w.a)(L.WM.get(),this._up,this._right),R=ve.Z.createPolylineGeometry([this._up,y,this._right]);h.addGeometry(R,this._outlineMaterial)}_updateTransform(h=this.object){const R=this._size*this.view.state.camera.computeScreenPixelSizeAt(this._position),J=Math.min(this._maxSize,R);(0,d.f)(X,this._position),(0,d.h)(X,X,[J,J,J]),(0,U.pC)(h)&&(h.transformation=X)}_quadGeometryData(h,y){const R=(0,w.a)(L.WM.get(),h,y);return new f.Z([[_.T.POSITION,{size:3,data:[0,0,0,...y,...h,...R],exclusive:!0}]],[[_.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const X=(0,ie.c)()}}]);