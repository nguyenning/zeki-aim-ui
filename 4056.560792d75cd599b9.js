"use strict";(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[4056],{44056:(y,p,r)=>{r.r(p),r.d(p,{default:()=>C});var b=r(62208),D=r(55713),I=r(48977),v=r(56729),O=r(84161),c=r(14658),P=r(55915),E=r(65234),i=r(14471);class A{transform(t){const a=this._transform(t),e=[a.points.buffer,a.rgb.buffer];(0,b.pC)(a.pointIdFilterMap)&&e.push(a.pointIdFilterMap.buffer);for(const n of a.attributes)"buffer"in n.values&&(0,D.eP)(n.values.buffer)&&n.values.buffer!==a.rgb.buffer&&e.push(n.values.buffer);return Promise.resolve({result:a,transferList:e})}_transform(t){const a=(0,i.Ym)(t.schema,t.geometryBuffer);let e=a.length/3,n=null;const u=[],l=(0,i.dH)(t.primaryAttributeData,a,e);(0,b.pC)(t.primaryAttributeData)&&l&&u.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:l});const s=(0,i.dH)(t.modulationAttributeData,a,e);(0,b.pC)(t.modulationAttributeData)&&s&&u.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:s});let f=(0,i.aE)(t.rendererInfo,l,s,e);if(t.filterInfo&&t.filterInfo.length>0&&(0,b.pC)(t.filterAttributesData)){const o=t.filterAttributesData.map(h=>{const d=(0,i.dH)(h,a,e),M={attributeInfo:h.attributeInfo,values:d};return u.push(M),M});n=new Uint32Array(e),e=(0,i.hv)(a,f,n,t.filterInfo,o)}for(const o of t.userAttributesData){const h=(0,i.dH)(o,a,e);u.push({attributeInfo:o.attributeInfo,values:h})}3*e<f.length&&(f=new Uint8Array(f.buffer.slice(0,3*e))),this._applyElevationOffsetInPlace(a,e,t.elevationOffset);const _=this._transformCoordinates(a,e,t.obb,E.Z.fromJSON(t.inSR),E.Z.fromJSON(t.outSR));return{obb:t.obb,points:_,rgb:f,attributes:u,pointIdFilterMap:n}}_transformCoordinates(t,a,e,n,u){if(!(0,P.CM)(t,n,0,t,u,0,a))throw Error("Can't reproject");const l=(0,c.f)(e.center[0],e.center[1],e.center[2]),s=(0,c.c)(),f=(0,c.c)();(0,I.c)(m,e.quaternion);const _=new Float32Array(3*a);for(let o=0;o<a;o++)s[0]=t[3*o]-l[0],s[1]=t[3*o+1]-l[1],s[2]=t[3*o+2]-l[2],(0,O.q)(f,s,m),e.halfSize[0]=Math.max(e.halfSize[0],Math.abs(f[0])),e.halfSize[1]=Math.max(e.halfSize[1],Math.abs(f[1])),e.halfSize[2]=Math.max(e.halfSize[2],Math.abs(f[2])),_[3*o]=s[0],_[3*o+1]=s[1],_[3*o+2]=s[2];return _}_applyElevationOffsetInPlace(t,a,e){if(0!==e)for(let n=0;n<a;n++)t[3*n+2]+=e}}const m=(0,v.c)();function C(){return new A}}}]);